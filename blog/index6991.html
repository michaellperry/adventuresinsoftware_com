<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr">


<!-- Mirrored from adventuresinsoftware.com/blog/?cat=27&paged=3 by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 13 Jan 2017 13:09:48 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- /Added by HTTrack -->
<head profile="http://gmpg.org/xfn/11">
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />

<title>Adventures in Software   &raquo; Historic Modeling</title>

<meta name="generator" content="WordPress 2.3.3" /> <!-- leave this for stats -->

<link rel="stylesheet" href="wp-content/themes/ais2/style.css" type="text/css" media="screen" />
<link rel="alternate" type="application/rss+xml" title="Adventures in Software RSS Feed" href="indexd784.html?feed=rss2" />
<link rel="pingback" href="xmlrpc.html" />
    <script type="text/javascript">
        function onSilverlightError(sender, args) {
            var appSource = "";
            if (sender != null && sender != 0) {
              appSource = sender.getHost().Source;
            }
            
            var errorType = args.ErrorType;
            var iErrorCode = args.ErrorCode;

            if (errorType == "ImageError" || errorType == "MediaError") {
              return;
            }

            var errMsg = "Unhandled Error in Silverlight Application " +  appSource + "\n" ;

            errMsg += "Code: "+ iErrorCode + "    \n";
            errMsg += "Category: " + errorType + "       \n";
            errMsg += "Message: " + args.ErrorMessage + "     \n";

            if (errorType == "ParserError") {
                errMsg += "File: " + args.xamlFile + "     \n";
                errMsg += "Line: " + args.lineNumber + "     \n";
                errMsg += "Position: " + args.charPosition + "     \n";
            }
            else if (errorType == "RuntimeError") {           
                if (args.lineNumber != 0) {
                    errMsg += "Line: " + args.lineNumber + "     \n";
                    errMsg += "Position: " +  args.charPosition + "     \n";
                }
                errMsg += "MethodName: " + args.methodName + "     \n";
            }

            throw new Error(errMsg);
        }
    </script>

	<link rel="EditURI" type="application/rsd+xml" title="RSD" href="xmlrpc0db0.php?rsd" />
 <link rel="wlwmanifest" type="application/wlwmanifest+xml" href="wp-includes/wlwmanifest.xml" /> <style type='text/css'>
<!--#header { background: url('wp-content/themes/ais2/images/header-imgae03.html?upper=A7A73F&amp;lower=77773F') no-repeat bottom center; }
--></style>
</head>
<body>
<div id="page">

<div class="aisTopBar">
	<form method="get" id="searchform" action="http://adventuresinsoftware.com/blog/">
<div>
<a href="indexd784.html?feed=rss2"><img src="../images/feed-icon-28x28.png" border="0"></a>
<input type="text" value="" name="s" id="s" />
<input type="submit" id="searchsubmit" value="Search" />
</div>
</form>
</div>

<div class="aisHeaderImageRight">
	<div class="aisHeaderImage">
	<div class="aisHeaderCornerRight">
	<div class="aisHeaderCornerLeft">
	<div class="aisImageBar">
	<div class="aisSubSites">
		<a href="index.html" class="aisSubSiteLink"><span class="aisSiteTabRight"><span class="aisSiteTabLeft"><span class="aisSiteTab">
			home</span></span></span></a>
		<a class="aisSubSiteLink" href="indexb60a.html?cat=27"><span class="aisSiteTabRight"><span class="aisSiteTabLeft"><span class="aisSiteTab">
			historic modeling</span></span></span></a>
		<a class="aisSubSiteLink" href="indexa88f.html?cat=36"><span class="aisSiteTabRight"><span class="aisSiteTabLeft"><span class="aisSiteTab">
			update controls</span></span></span></a>
		<a href="index2d79.html?cat=26" class="aisSubSiteLink"><span class="aisSiteTabRight"><span class="aisSiteTabLeft"><span class="aisSiteTab">
			degrees of freedom</span></span></span></a>
		<a class="aisSubSiteLink" href="indexba53.html?page_id=2"><span class="aisSiteTabRight"><span class="aisSiteTabLeft"><span class="aisSiteTab">
			about us</span></span></span></a>

	</div>
	</div>
	</div>
	</div>
	</div>
</div>

<table style="width: 100%" cellspacing="0" cellpadding="0">
	<tr valign="top">
		<td width="210px">
<div id="sidebar">
<div class="aisLeftColumnFill">
<div class="aisLeftColumnBottom">
<div class="aisLeftColumnTop">
<div id="twitter_div" class="aisLeftNav">
<h2 class="sidebar-title">Twitter Updates</h2>
<ul id="twitter_update_list"></ul>
<a href="http://twitter.com/michaellperry" id="follow">Follow me</a>
</div>
<div id="twitter_reply_div" class="aisLeftNav">
<h2 class="sidebar-title">Twitter Replies</h2>
<ul id="twitter_reply_list"></ul>
</div>

<div class="aisLeftNav">
<a href='http://ineta.org/Speakers/SearchCommunitySpeakers.aspx?SpeakerId=c5110e21-9243-461b-a464-a6548524e885'><img alt='INETA Community Speakers Program' border='0' src='../../www.ineta.org/images/OfficialLogos/InetaCommunitySpeakersRequestMe.html' /></a>
</div>

<div class="aisLeftNav">
	<li class="pagenav"><h2>Pages</h2><ul><li class="page_item page-item-2"><a href="indexba53.html?page_id=2" title="About Us">About Us</a></li>
<li class="page_item page-item-210"><a href="index6ae3.html?page_id=210" title="Templates">Templates</a></li>
</ul></li></div>

<div class="aisLeftNav">
<h2>Archives</h2>
<ul>
	<li><a href='indexb4d5.html?m=201110' title='October 2011'>October 2011</a></li>
	<li><a href='indexc61a.html?m=201106' title='June 2011'>June 2011</a></li>
	<li><a href='indexa80d.html?m=201105' title='May 2011'>May 2011</a></li>
	<li><a href='index512b.html?m=201104' title='April 2011'>April 2011</a></li>
	<li><a href='index08fb.html?m=201103' title='March 2011'>March 2011</a></li>
	<li><a href='index52f4.html?m=201102' title='February 2011'>February 2011</a></li>
	<li><a href='index74f1.html?m=201101' title='January 2011'>January 2011</a></li>
	<li><a href='index8956.html?m=201012' title='December 2010'>December 2010</a></li>
	<li><a href='indexa1aa.html?m=201011' title='November 2010'>November 2010</a></li>
	<li><a href='indexe3d5.html?m=201010' title='October 2010'>October 2010</a></li>
	<li><a href='index9ab9.html?m=201009' title='September 2010'>September 2010</a></li>
	<li><a href='index1ff0.html?m=201008' title='August 2010'>August 2010</a></li>
	<li><a href='index9f11.html?m=201007' title='July 2010'>July 2010</a></li>
	<li><a href='index31f0.html?m=201006' title='June 2010'>June 2010</a></li>
	<li><a href='indexd189.html?m=201005' title='May 2010'>May 2010</a></li>
	<li><a href='indexb5c0.html?m=201004' title='April 2010'>April 2010</a></li>
	<li><a href='indexf258.html?m=201003' title='March 2010'>March 2010</a></li>
	<li><a href='index6e30.html?m=201002' title='February 2010'>February 2010</a></li>
	<li><a href='index6b19.html?m=201001' title='January 2010'>January 2010</a></li>
	<li><a href='index5c0a.html?m=200912' title='December 2009'>December 2009</a></li>
	<li><a href='index8f62.html?m=200911' title='November 2009'>November 2009</a></li>
	<li><a href='index451d.html?m=200910' title='October 2009'>October 2009</a></li>
	<li><a href='index3e04.html?m=200909' title='September 2009'>September 2009</a></li>
	<li><a href='index425a.html?m=200908' title='August 2009'>August 2009</a></li>
	<li><a href='index9907.html?m=200907' title='July 2009'>July 2009</a></li>
	<li><a href='index3104.html?m=200906' title='June 2009'>June 2009</a></li>
	<li><a href='indexc36d.html?m=200905' title='May 2009'>May 2009</a></li>
	<li><a href='index17e8.html?m=200904' title='April 2009'>April 2009</a></li>
	<li><a href='index10a5.html?m=200903' title='March 2009'>March 2009</a></li>
	<li><a href='index8988.html?m=200902' title='February 2009'>February 2009</a></li>
	<li><a href='index1419.html?m=200901' title='January 2009'>January 2009</a></li>
	<li><a href='index7866.html?m=200812' title='December 2008'>December 2008</a></li>
	<li><a href='index55f6.html?m=200811' title='November 2008'>November 2008</a></li>
	<li><a href='indexa7bc.html?m=200810' title='October 2008'>October 2008</a></li>
	<li><a href='indexe77c.html?m=200809' title='September 2008'>September 2008</a></li>
	<li><a href='indexcffc.html?m=200808' title='August 2008'>August 2008</a></li>
	<li><a href='index0e62.html?m=200807' title='July 2008'>July 2008</a></li>
	<li><a href='indexfda7.html?m=200806' title='June 2008'>June 2008</a></li>
	<li><a href='index7d64.html?m=200805' title='May 2008'>May 2008</a></li>
	<li><a href='index94dd.html?m=200804' title='April 2008'>April 2008</a></li>
	<li><a href='index9631.html?m=200803' title='March 2008'>March 2008</a></li>
	<li><a href='indexdd52.html?m=200802' title='February 2008'>February 2008</a></li>
	<li><a href='index21ee.html?m=200801' title='January 2008'>January 2008</a></li>
	<li><a href='index363c.html?m=200712' title='December 2007'>December 2007</a></li>
	<li><a href='index7493.html?m=200711' title='November 2007'>November 2007</a></li>
	<li><a href='index93a7.html?m=200710' title='October 2007'>October 2007</a></li>
	<li><a href='index4ca8.html?m=200709' title='September 2007'>September 2007</a></li>
	<li><a href='index6124.html?m=200708' title='August 2007'>August 2007</a></li>
	<li><a href='index6013.html?m=200707' title='July 2007'>July 2007</a></li>
	<li><a href='index2ab6.html?m=200706' title='June 2007'>June 2007</a></li>
	<li><a href='index44f0.html?m=200705' title='May 2007'>May 2007</a></li>
	<li><a href='indexf0b4.html?m=200704' title='April 2007'>April 2007</a></li>
	<li><a href='index481d.html?m=200703' title='March 2007'>March 2007</a></li>
	<li><a href='indexcbea.html?m=200702' title='February 2007'>February 2007</a></li>
	<li><a href='index9cdc.html?m=200701' title='January 2007'>January 2007</a></li>
	<li><a href='index3ea4.html?m=200612' title='December 2006'>December 2006</a></li>
	<li><a href='index67ca.html?m=200611' title='November 2006'>November 2006</a></li>
	<li><a href='indexff49.html?m=200610' title='October 2006'>October 2006</a></li>
	<li><a href='index611c.html?m=200609' title='September 2006'>September 2006</a></li>
	<li><a href='index9a21.html?m=200608' title='August 2006'>August 2006</a></li>
	<li><a href='index3ee9.html?m=200607' title='July 2006'>July 2006</a></li>
	<li><a href='indexe13a.html?m=200606' title='June 2006'>June 2006</a></li>
</ul>
</div>

<div class="aisLeftNav">
	</div>

<div class="aisLeftNav">
<h2>Books</h2>
<iframe src="http://rcm.amazon.com/e/cm?t=adventures0d2-20&amp;o=1&amp;p=8&amp;l=as1&amp;asins=0764526413&amp;fc1=000000&amp;IS2=1&amp;lt1=_blank&amp;lc1=0000ff&amp;bc1=000000&amp;bg1=ffffff&amp;f=ifr" style="width:120px;height:240px;" scrolling="no" marginwidth="0" marginheight="0" frameborder="0" name="I5" id="I5"></iframe>
<br/>
<iframe src="http://rcm.amazon.com/e/cm?t=adventures0d2-20&amp;o=1&amp;p=8&amp;l=as1&amp;asins=0201633612&amp;fc1=000000&amp;IS2=1&amp;lt1=_blank&amp;lc1=0000ff&amp;bc1=000000&amp;bg1=ffffff&amp;f=ifr" style="width:120px;height:240px;" scrolling="no" marginwidth="0" marginheight="0" frameborder="0" name="I6" id="I6"></iframe>
<br/>
<iframe src="http://rcm.amazon.com/e/cm?t=adventures0d2-20&amp;o=1&amp;p=8&amp;l=as1&amp;asins=0136291554&amp;fc1=000000&amp;IS2=1&amp;lt1=_blank&amp;lc1=0000ff&amp;bc1=000000&amp;bg1=ffffff&amp;f=ifr" style="width:120px;height:240px;" scrolling="no" marginwidth="0" marginheight="0" frameborder="0" name="I7" id="I7"></iframe>
<br/>
<iframe src="http://rcm.amazon.com/e/cm?t=adventures0d2-20&amp;o=1&amp;p=8&amp;l=as1&amp;asins=1888009195&amp;fc1=000000&amp;IS2=1&amp;lt1=_blank&amp;lc1=0000ff&amp;bc1=000000&amp;bg1=ffffff&amp;f=ifr" style="width:120px;height:240px;" scrolling="no" marginwidth="0" marginheight="0" frameborder="0" name="I8" id="I8"></iframe>
</div>
<div class="aisLeftNav">
<h2>Meta</h2>
<ul>
		<li><a href="wp-login.html">Login</a></li>
	<li><a href="http://validator.w3.org/check/referer" title="This page validates as XHTML 1.0 Transitional">Valid <abbr title="eXtensible HyperText Markup Language">XHTML</abbr></a></li>
	<li><a href="http://gmpg.org/xfn/"><abbr title="XHTML Friends Network">XFN</abbr></a></li>
	<li><a href="http://wordpress.org/" title="Powered by WordPress, state-of-the-art semantic personal publishing platform.">WordPress</a></li>
	</ul>
</div>
<div class="aisLeftContent">
<h2>Community</h2>
<ul>
	<script type="text/javascript" src="../../localhost/embed/92q2bbma.js"></script>
</ul>
</div>

</div></div></div>
</div>		</td>
		<td>

	<div id="content" class="narrowcolumn">

		
		 		<h2 class="pagetitle">Archive for the &#8216;Historic Modeling&#8217; Category</h2>

 	  

		<div class="navigation">
			<div class="alignleft"></div>
			<div class="alignright"><a href="index95b0.html?cat=27&amp;paged=2">Next Entries &raquo;</a></div>
		</div>

				<div class="post">
				<h3 id="post-272"><a href="indexcde3.html?p=272" rel="bookmark" title="Permanent Link to Mutable properties">Mutable properties</a></h3>
				<small>Thursday, October 30th, 2008</small>

				<div class="entry">
					<p>All of the fields of a Correspondence object are immutable. They are set at the time of construction. They define the identity of an object, so they cannot be allowed to change.</p>
<p>How, then, can you represent mutable properties in Correspondence? By doing the only thing that Correspondence allows you to do: create more objects.<strong></p>
<p></strong>
<p><strong>A class for each atomic operation</strong><br />A Correspondence object represents an atomic operation. It records the fact that someone has made a change. So one such change could be the modification of a property. Let's express the atomic operations of a project and one of its mutable properties:</p>
<ul>
<li>CreateProject(): Project</li>
<li>SetProjectName(project: Project, name: string)</li>
</ul>
<p>Since we have two atomic operations, we define two Correspondence classes. The class that represents the CreateProject operation is the Project itself. The class that represents the SetProjectName operation will be called ProjectName.</p>
<p><strong>Define prerequisites</strong><br />It is apparent from the definitions of these two atomic operations that the Project is a prerequisite for the ProjectName. You can't name a project before you create it. And in order for the ProjectName to make sense, you must know which Project you are talking about.</p>
<p><a href="../../www.adventuresinsoftware.com/blog/wp-content/uploads/2008/10/image2.png"><img style="border-right: 0px; border-top: 0px; border-left: 0px; border-bottom: 0px" height="94" alt="image" src="../../www.adventuresinsoftware.com/blog/wp-content/uploads/2008/10/image-thumb.png" width="244" align="right" border="0"></a> So if Project is the only prerequisite for ProjectName, we can have an object model like the diagram on the right. If we set the project name three times, we end up with three ProjectName objects that are equal successors of the Project object.</p>
<p>There's one significant problem with the model just described. It is impossible to tell from the model alone which is the correct name of the project. It was set three times, and nothing about the diagram tells us which is the intended name. We could go by the time of creation, but that is insufficient in light of synchronization. One user might have set the name on one machine, while another user set the name on a different machine. We can't see the intent of the users in the model, so we can't make a reasonable decision.</p>
<p><strong>Current knowledge is a prerequisite</strong><br />The solution is to capture that intent by adding prerequisites. The prerequisites of an atomic operation are not just the parameters required for the operation to make sense in isolation. They also include the operations that have come before. The operation was performed by a user with a certain set of knowledge. If we capture that knowledge as prerequisites, we can glean the user's intent.</p>
<p><a href="../../www.adventuresinsoftware.com/blog/wp-content/uploads/2008/10/image5.png"><img style="border-right: 0px; border-top: 0px; border-left: 0px; border-bottom: 0px" height="177" alt="image" src="../../www.adventuresinsoftware.com/blog/wp-content/uploads/2008/10/image-thumb3.png" width="244" align="left" border="0"></a> In our case, we are going to capture the current project name as a prerequisite for any new project name. The user knew that the project was called WSE when he changed it to Indigo. Later, he knew that it was Indigo when changing it to WCF. This changes the diagram to the one on the left.</p>
<p>This diagram captures the intent of the user. He was changing the project name with the knowledge of the prior project name. And now the diagram clearly shows what the current name is: it is the last in the chain of succession.</p>
<p><strong>Detect conflicts</strong><br /><a href="../../www.adventuresinsoftware.com/blog/wp-content/uploads/2008/10/image4.png"><img style="border-right: 0px; border-top: 0px; border-left: 0px; border-bottom: 0px" height="144" alt="image" src="../../www.adventuresinsoftware.com/blog/wp-content/uploads/2008/10/image-thumb2.png" width="244" align="right" border="0"></a> So what about the case of the two users on different machines? What if the developer chose the name Indigo while the analyst chose WCF? Both of those decisions were made with the knowledge of the name WSE, and so you get the diagram on the right.</p>
<p>From this diagram, it is apparent that there is a conflict. We no longer have just one leaf of the tree of ProjectNames. Now we have two leaves. Both of these siblings are just as worthy in the chain of succession of representing the current name of the project.</p>
<p>Correspondence makes no assumptions about how to resolve conflicts. But it does make it obvious when they have occurred. It is now up to the application to decide on a conflict resolution strategy. Knowing that there was a problem is the first step.</p>
<p>Fields of a Correspondence object are immutable. Modifiable properties are implemented as a pattern involving a new class, prior operations as prerequisites, and conflict detection. Conflict resolution is the responsibility of the application.</p>
				</div>

				<p class="postmetadata">Posted in <a href="indexb60a.html?cat=27" title="View all posts in Historic Modeling" rel="category">Historic Modeling</a> |   <a href="indexcde3.html?p=272#respond" title="Comment on Mutable properties">No Comments &#187;</a></p>

			</div>

				<div class="post">
				<h3 id="post-263"><a href="index8fee.html?p=263" rel="bookmark" title="Permanent Link to Correspondence">Correspondence</a></h3>
				<small>Thursday, October 23rd, 2008</small>

				<div class="entry">
					<p>Correspondence is a base class library (currently in Java and C#) for historic data models.</p>
<p>A historic data model is one in which the objects represent atomic operations rather than entities. To record that an operation has taken place, you create an object. You can then observe the history of related objects to determine the current state.</p>
<p><strong>Anatomy of a correspondence object</strong><br />The base class is CorrespondenceObject. A correspondence object has fields (simple data types) and predecessors (references to other correspondence objects). <strong>These fields and predecessors are assigned at construction and never change.</strong></p>
<p>I'll demonstrate with the Java version of the library. Here is a simple correspondence object representing a project in a bug tracking system:</p>
<pre>@Correspondence
<span style="color: blue">public</span> <span style="color: blue">class</span> Project <span style="color: blue">extends</span> CorrespondenceObject {

	<span style="color: blue">private</span> @Field UUID id;

	<span style="color: blue">private</span> Query&lt;Issue&gt; issue = <span style="color: blue">new</span> Query&lt;Issue&gt;(<span style="color: blue">this</span>)
		.joinSuccessors(<span style="color: maroon">"project_issue"</span>);

	<span style="color: blue">public</span> Project() {
		id = UUID.randomUUID();
	}

	<span style="color: blue">public</span> Project(Memento memento) {
	}

	<span style="color: blue">public</span> Iterable&lt;Issue&gt; getIssues() {
		<span style="color: blue">return</span> issue;
	}
}</pre>
<p>And here's a bug:</p>
<pre>@Correspondence
<span style="color: blue">public</span> <span style="color: blue">class</span> Issue <span style="color: blue">extends</span> CorrespondenceObject {

	<span style="color: blue">private</span> PredecessorObj&lt;Project&gt; project;

	<span style="color: blue">private</span> @Field UUID id;

	<span style="color: blue">public</span> Issue(Project project) {
		<span style="color: blue">this</span>.project = <span style="color: blue">new</span> PredecessorObj&lt;Project&gt;(<span style="color: blue">this</span>, <span style="color: maroon">"project_issue"</span>, project);
		<span style="color: blue">this</span>.id = UUID.randomUUID();
	}

	<span style="color: blue">public</span> Issue(Memento memento) <span style="color: blue">throws</span> CorrespondenceException {
		<span style="color: blue">this</span>.project = <span style="color: blue">new</span> PredecessorObj&lt;Project&gt;(<span style="color: blue">this</span>, <span style="color: maroon">"project_issue"</span>, memento);
	}

	<span style="color: blue">public</span> Project getProject() {
		<span style="color: blue">return</span> project.getObject();
	}
}</pre>
<p>A correspondence object has two constructors. One is used by the application to create the first instance of a new object. The other is used by the library to rehydrate an existing object from a memento.</p>
<p>Notice that both of these objects have id fields that are initialized to unique random numbers. This is how identity is assured in Correspondence. <strong>The identity of a correspondence object is the set of its predecessors and fields.</strong> If you try to create another object with the same predecessors and fields, you get back the same object.</p>
<p>These predecessors and fields cannot be changed. You cannot move an issue from one project to another. That is why you don't see project name or issue name as fields. These should be modifiable properties. We'll see how to make modifiable properties in a later post.</p>
<p>The list of issues for a project is dependent. It is represented by a query for all successors of the project. When a new issue is created, it will be returned from this query. You don't write code to add the issue to the list. Instead, the library updates this query when the new issue is created.</p>
<p><strong>Data storage</strong><br />The library takes care of persisting and caching objects and their relationships with one another. When you set up your correspondence project, you select a storage strategy. In Java, I have implemented MySQL and PostgreSQL storage strategies so far. In C#, I have ADO, DAO, and SQL Server CE. The Memento class is the intermediary that separates correspondence objects from the storage strategy and make that possible.</p>
<p>Although all of the storage strategies that I've implemented so far are built on relational databases, don't confuse Correspondence for an ORM. It does not map objects to a relational schema. The database does not resemble your object model in any way. It has two tables: Object and Predecessor. If you love relational data, do us both a favor and don't look in the database.</p>
<p>Even though it does not produce a database that you would want to use for reporting (or anything else, for that matter), the Correspondence library takes care of the persistence and caching of your objects automatically. You write an object model, and you get storage and caching for free. When you create an object, it gets stored. When you follow a reference to a predecessor, it gets cached. When you execute a query, the results are cached.</p>
<p>Next, we'll continue the development of the bug tracking system to demonstrate some of the common patterns that occur while using Correspondece.</p>
				</div>

				<p class="postmetadata">Posted in <a href="indexb60a.html?cat=27" title="View all posts in Historic Modeling" rel="category">Historic Modeling</a> |   <a href="index8fee.html?p=263#respond" title="Comment on Correspondence">No Comments &#187;</a></p>

			</div>

				<div class="post">
				<h3 id="post-262"><a href="index7d69.html?p=262" rel="bookmark" title="Permanent Link to Partial order of transactions">Partial order of transactions</a></h3>
				<small>Tuesday, October 21st, 2008</small>

				<div class="entry">
					<p>Prerequisites define a partial order among transactions.</p>
<p>We've established that an object's state is dependent upon its history. All of the operations in the object's history are transactions. As such, they obey all four of the ACID principles.</p>
<p>An operation performed on an object is <strong>atomic</strong>. Remember that there is no method body for an operation. The system simply records that it has occurred. Since there are no imperative steps required to complete the operation, it cannot be partially done. It has either occurred, or it hasn't.</p>
<p>An operation is <strong>consistent</strong>. It exercises only one degree of freedom. Everything that depends upon that operation is represented by dependent data. When the operation is performed, and the dependent data is subsequently observed, it will be found to be consistent with the results of the operation.</p>
<p>An operation is <strong>durable</strong>. The system permanently records that it has occurred. When the object is observed later, the operation will be visible.</p>
<p>An operation is <strong>isolated</strong> from other operations occurring simultaneously. Again, since there are no imperative steps, this is easy to achieve. But there's more to it than that. Either of two operations that have occurred simultaneously could be assumed to have taken place before the other. There is no order prescribed between them. Instead of imposing a full order on the set of operations, we can only define a <a href="http://en.wikipedia.org/wiki/Partially_ordered_set">partial order</a>.</p>
<p><strong>Prerequisites of an operation</strong><br />
Every operation performed on an object is made within the context of prior information. All of the transactions that lead up to the current state of the object are known. These are prerequisites of the next operation.</p>
<p>Prerequisites are operations that must have occurred prior to a given operation. If those prerequisites themselves have prerequisites, we can trace a tree back to its root. This gives us a list of operations that must have occurred in the given order. But parallel branches of this tree that split off from the root could have occurred before or after any other branch.</p>
<p>Going back to the canonical chess board example, we have three operations:</p>
<ul>
<li>CreatePlayer(): Player</li>
<li>CreateGame(black: Player, white: Player): Game</li>
<li>MakeMove(from: int, to: int, game: Game, prior: Move ?): Move</li>
</ul>
<p><a href="../../www.adventuresinsoftware.com/blog/wp-content/uploads/2008/10/chess-game-model.png"><img src="../../www.adventuresinsoftware.com/blog/wp-content/uploads/2008/10/chess-game-model.png" style="border: 0px none " title="chess-game-model.png" alt="chess-game-model.png" align="right" border="0" width="250" height="378" /></a>A game must have two players. Those player objects must have been created prior to the game. Each move is made within the context of one game. The prior move must have been made before the current one. The first move will have a null prior, hence the question mark.</p>
<p>This chain of prerequisites constrains the moves such that they must have been made in the specified order. It makes no sense to play the moves out of order. But if the players decide to start a parallel game, that one is completely isolated. It could have occurred before, after, or during the current game, with no loss of integrity.</p>
<p><strong>Summary</strong><br />
With this, we have enough theory to build a robust synchronization system. This system uses atomic operations for persistence, representation, caching, and communication. It relies upon the three axioms that we've just discussed:</p>
<ul>
<li>All object behavior is either dependent or independent.</li>
<li>An object’s state is dependent upon its history.</li>
<li>Prerequisites define a partial order among transactions.</li>
</ul>
<p>Now it's time to turn the theory into practice.</p>
				</div>

				<p class="postmetadata">Posted in <a href="indexb60a.html?cat=27" title="View all posts in Historic Modeling" rel="category">Historic Modeling</a>,  <a href="index489b.html?cat=34" title="View all posts in Synchronization" rel="category">Synchronization</a> |   <a href="index7d69.html?p=262#respond" title="Comment on Partial order of transactions">No Comments &#187;</a></p>

			</div>

				<div class="post">
				<h3 id="post-258"><a href="indexb773.html?p=258" rel="bookmark" title="Permanent Link to Synchronization of history, not state">Synchronization of history, not state</a></h3>
				<small>Friday, October 17th, 2008</small>

				<div class="entry">
					<p>An object's state is dependent upon its history.</p>
<p>When an object is constructed, it is initialized to a starting state. From then on, every action performed on that object changes its state. If you constructed another object and performed exactly the same actions on it, then it would end up in exactly the same state.</p>
<p>Suppose the object is a chess board. Its initial state has the two teams facing off against each other. Each move alters that state by one or two pieces. Start a new game and make the same moves, and the board will end up in the same position.</p>
<p><strong>Store history</strong>    <br />Caching aside, it is better to store independent data than dependent data. The dependent data can be calculated from the independent data, so there is no loss of information.</p>
<p>But the converse is not true. Several different sequences of moves could lead to the same board position. Given a board position, it is impossible to determine exactly which path was taken to get there.</p>
<p>The current state of an object is usually sufficient to make business decisions. That's why most of our business systems can get by with storing state, not history. A chess player makes his next move based solely on the current position of the pieces.</p>
<p>But the current state of an object does not carry sufficient information for synchronization. Synchronization is all about bringing two or more discrete representations into agreement. If I claim that an object is in one state, and you claim that it is in another, who is right? To decide, we have to go back through the histories and see where they diverge.</p>
<p><strong>Calculate state</strong>    <br />In an imperative object-oriented language, every mutating operation performed on an object causes changes to its member variables. Code inside the body of the method assigns new values to the members of the object. The prior state of the object, combined with the parameters of the method, determine what values get assigned.</p>
<p>If we allow our languages to be more functional and declarative, we could instead express the current state as a function of history. Suppose that there was no code in the method. The object just records the fact that the method was called. Now, move the code to the member variable. Its job is to calculate the value of that member variable given the history of method calls.</p>
<p>With this new declaration of an object, the current state is calculated based on history. From the outside it looks the same. You can call a method, then observe the state of the object to see that it has changed. The difference is that the method call did not imperatively change the state of the object, it just recorded a fact. It was the observation of that object's state, seeing this new fact, that caused the change. And now that the object retains history, it can be easily synchronized.</p>
<p>My synchronization system uses history, not state, to persist, exchange, and represent objects.</p>
				</div>

				<p class="postmetadata">Posted in <a href="indexb60a.html?cat=27" title="View all posts in Historic Modeling" rel="category">Historic Modeling</a>,  <a href="index489b.html?cat=34" title="View all posts in Synchronization" rel="category">Synchronization</a> |   <a href="indexb773.html?p=258#respond" title="Comment on Synchronization of history, not state">No Comments &#187;</a></p>

			</div>

				<div class="post">
				<h3 id="post-192"><a href="index5a6a.html?p=192" rel="bookmark" title="Permanent Link to Entity Fact Diagrams">Entity Fact Diagrams</a></h3>
				<small>Thursday, January 17th, 2008</small>

				<div class="entry">
					<p><a href="indexb7c7.html?p=177">Historic modeling</a> is the technique of representing a solution as a history of discrete events. This differs from static modeling, which represents the solution as a snapshot. The static model is concerned with the state of the system, whereas the historic model is more concerned with how it got there.</p>
<p>A historic model can be represented in an Entity Fact diagram. This is analogous to the Entity Relationship diagram used in static models. The difference is that you represent historic facts instead of static relationships. Relationships can change over time, but facts are always true.</p>
<p><strong>Automotive Wireless</strong><br />
I am currently working on an automotive wireless system that provides an excellent example of an Entity Fact diagram. This system tracks wireless devices such as OnStar modules that are installed in vehicles. The entities in this domain are things like the phone number (MDN/MIN), the wireless unit, the vehicle, the customer, and the service. We can draw an ERD to represent the relationships among these entities.</p>
<p><a href="../../www.adventuresinsoftware.com/blog/wp-content/uploads/2008/01/auto_erd.png"><img src="../../www.adventuresinsoftware.com/blog/wp-content/uploads/2008/01/auto-erd-thumb.png" style="border-width: 0px" alt="auto_erd" border="0" height="77" width="503" /></a></p>
<p>In this ERD, we represent entities as rectangles, relationships as diamonds, and properties as ellipses. We are particularly concerned with the status of a wireless account (active, suspended, inactive, etc.) and the status of a wireless device (scrap, replacement, defective, etc.) The account status is a property of the relationship between phone number and device.</p>
<p>In this ERD, relationships can come and go. A unit can be removed from a vehicle and a replacement installed. A customer can enroll in a service, and later cancel their subscription. In a typical static model, these relationships are created and destroyed to represent the current state.</p>
<p><strong>Expand to an EFD</strong><br />
To model the system historically, we make note of all the events that could occur. Each of these events is one fact: it occurred at some point in time. Whether the effect of that event is still present is less important. The fact is, and always will be, that it happened.</p>
<p>The facts in this system are things like:</p>
<ul>
<li>An MDN/MIN was paired with a unit.</li>
<li>The MDN/MIN pairing was removed (the account was closed).</li>
<li>A customer took delivery of a vehicle.</li>
<li>A customer enrolled in a service for a vehicle.</li>
<li>A service enrollment was canceled.</li>
</ul>
<p>There are many others as well. Here is the complete diagram.</p>
<p><a href="../../www.adventuresinsoftware.com/blog/wp-content/uploads/2008/01/auto_efd.png"><img src="../../www.adventuresinsoftware.com/blog/wp-content/uploads/2008/01/auto-efd-thumb.png" style="border-width: 0px" alt="auto_efd" border="0" height="180" width="491" /></a></p>
<p>You'll notice that these facts usually relate two or more entities. In fact, they usually create or destroy relationships between those entities. When one fact modifies the effect of another fact, it references the original. So, for example, an Unpairing destroys the relationship established by a Pairing.</p>
<p><strong>Prerequisites</strong><br />
A fact cannot exist until its referenced entities exist. An MDN/MIN must be assigned by the phone company before it can be paired with the MEID of a device. Both the vehicle and the customer must exist before the customer can take delivery of the vehicle.</p>
<p>This prerequisite relationship is also true for facts. An MDN/MIN pairing must occur before they can be unpaired. A customer must take delivery of a vehicle before enrolling in services for that vehicle. So the arrows not only indicate references, but also define a partial order. The referenced fact must occur before the referencing fact.</p>
<p><strong>Atomicity</strong><br />
Facts are either true or not. The event has either occurred or it hasn't. There is no intermediate state.</p>
<p>Notice the history formed by Manufacture and Replacement. A vehicle is manufactured with one unit. At some time later, that unit is replaced with another unit. The replacement destroys the vehicle-unit relationship created by the manufacture, and <strong>simultaneously creates another relationship</strong>. That replacement unit can later be replaced by yet another replacement unit, and so on.</p>
<p><strong>The source of truth</strong><br />
This ERD is color coded to indicate the source of each of these facts. Blue facts come from the phone company, green from the device supplier, and red from the auto manufacturer. This helps us see interactions between various parties. We can see, for example, that the device supplier can't tell us that a pairing will not be used until the phone company tells us that it exists. This helps us see that we have to wait for the phone company to tell us that the number is paired before we send an unpairing request, thus avoiding a race condition.</p>
<p>Whether the program is written historically, an Entity Fact Diagram can help us capture important information. It is more complete than the ERD alone, as it shows all the ways in which relationships can come and go. It helps us communicate the order in which events can occur, and gives us guidance on transaction scope and system interactions.</p>
				</div>

				<p class="postmetadata">Posted in <a href="indexb60a.html?cat=27" title="View all posts in Historic Modeling" rel="category">Historic Modeling</a>,  <a href="index54cb.html?cat=23" title="View all posts in Processes" rel="category">Processes</a> |   <a href="index5a6a.html?p=192#respond" title="Comment on Entity Fact Diagrams">No Comments &#187;</a></p>

			</div>

				<div class="post">
				<h3 id="post-178"><a href="indexb50d.html?p=178" rel="bookmark" title="Permanent Link to Behavior vs State">Behavior vs State</a></h3>
				<small>Tuesday, December 11th, 2007</small>

				<div class="entry">
					<p>When discussing topics such as definitiveness or dependency, I'll use the word &quot;behavior&quot; when others might say &quot;state&quot;. The difference might seem academic, but it has some practical ramifications that become apparent later.</p>
<p>The behavior of an object is what you can observe. It can be measured using the object's public interface alone. The interface is a contract that constrains an object's behavior, and that contract doesn't allow you to see anything else. This is the object-oriented concept of information hiding.</p>
<p>The state of an object is what it contains. You need to pierce the public interface or use a debugger to observe an object's state. A loose contract (a.k.a. a &quot;<a href="http://www.joelonsoftware.com/articles/LeakyAbstractions.html">leaky abstraction</a>&quot;) might let some of that state show through. The object uses its own state to implement its behavior. This is the object-oriented concept of encapsulation.</p>
<p>So the behavior of an object is implemented in terms of state. But behavior can be described without invoking state at all. I can say that the behavior of a business object is dependent upon the behavior of a row in a database. There may be caching going on, and that cache may have state that can change. But that doesn't make it dynamic. A properly implemented cache is still dependent, because it behaves that way.</p>
<p>When considering the public interface of an object, behavior is all that matters. So when I want to say something about an object and its interaction with other objects, I'll limit myself to talking about behavior. I'll ignore state until it's time to code.</p>
<p><strong>The behavior of numbers</strong>    <br />Consider the number 3. I can represent this number in any of a number of ways. I can draw three vertical lines. I can hold up three fingers. I can draw the numeral 3. Or I can store the bits 00000011. These are different states that represent the object 3, depending upon its implementation.</p>
<p>Mathematicians have defined integers based entirely on their behavior. They say that there exists an integer called zero. They also say that if you increment or decrement any integer, you will get another integer. This is a sufficient definition, and it has nothing to do with representation.</p>
<p>So you can define the number 3 as the integer that you get when you increment zero, increment the result, and increment again. It doesn't matter how you store the state &quot;3&quot;, a correct implementation will exhibit this behavior.</p>
<p>If we use vertical lines, you increment by drawing one more. If we use fingers, you hold up one more. If we use binary, you flip bits from left to right, stopping at the first zero-to-one transition. These are all implementation details based on state. But the behavior is always the same.</p>
<p><strong>The effect of describing behavior</strong>    <br />If I limit myself to talking about behavior, then I get to do a few good things. First, I get to say what I mean without a bunch of qualifications. I can say that the business object depends upon the database row without having to describe the cache that sits in between. I can say that history grows indefinitely, even though a program that actually did that would eventually crash.</p>
<p>Second, I get to procrastinate. I can put decisions off until I have enough information to make them. I can implement an object's behavior one way, then measure the system to see if I need to change it.</p>
<p>Third, I get to prove things. There is a reason that mathematicians define integers based on behavior. It's hard to prove things about state. Formal proofs of algorithms is notoriously difficult. But proofs based on behavior are trivial by comparison.</p>
<p>When I explore some techniques for historic modeling in upcoming posts, I'll be talking about the behavior of objects. When getting down to the implementation details, I'll start talking about state. It's the difference between the two that makes these techniques so useful.</p>
				</div>

				<p class="postmetadata">Posted in <a href="index1cd2.html?cat=10" title="View all posts in Contracts" rel="category">Contracts</a>,  <a href="indexb60a.html?cat=27" title="View all posts in Historic Modeling" rel="category">Historic Modeling</a> |   <a href="indexb50d.html?p=178#respond" title="Comment on Behavior vs State">No Comments &#187;</a></p>

			</div>

				<div class="post">
				<h3 id="post-177"><a href="indexb7c7.html?p=177" rel="bookmark" title="Permanent Link to Historic Modeling">Historic Modeling</a></h3>
				<small>Wednesday, December 5th, 2007</small>

				<div class="entry">
					<p>There is one pattern for using definitive behavior that I failed to mention in the <a href="indexa09e.html?p=175">previous post</a>. This is perhaps the most important of them all, so it deserves special treatment.</p>
<p>Historic modeling is quite simply storing a history of actions, not the current state of a system. The current state is mutable, whereas history is fixed. Once something has been done, it cannot be undone, and it cannot be changed. A history is an ever growing log of permanent records.</p>
<p>One example of historic modeling from the real world is a chess game. The position of the board changes regularly during the course of a game. The position is dynamic. Yet the record of moves does not change. Once a move is made, it cannot be taken back or changed.</p>
<p>Another example is a checkbook register. The current balance can change over time, but the history of checks, once written, never changes.</p>
<p><strong>Advantages of historic modeling</strong>    <br />History is sufficient. Given a history of a system, it is trivial to go back to any point in time to construct it's state. If you have a record of chess moves, you just make each move in turn to produce the board position at every point in the game. If you have a ledger of checks, you can just add up the amounts including the opening balance up to a certain point in time. The current state doesn't contain enough information to reconstruct the history, but the history is sufficient to reconstruct the current state.</p>
<p>History is atomic. Each action in the history has happened. Actions not yet in the history have not. There is no middle ground. This is why <a href="index2c90.html?p=120">banks keep ledgers of account transfers</a>, rather than trying to decrement one account balance and increment another. Balance, being state, is not atomic.</p>
<p>History is consistent. Two people comparing notes can easily disagree on the current state of a system. To come to an agreement, they must compare histories. That's why the bank sends you a list of transactions at the end of each month, rather than just your account balance. That's the only way to reconcile your version of the truth with your bank's. Eventually, all parties will come to agree on the same version of history.</p>
<p>History is transparent. Logging and auditing systems exist to help us trace anomalies to their source. Without them, all we could do is look at the current state and wonder if it is correct. It is relatively easy to hide money in a series of accounts; but if you must produce an accurate history of transactions, each one can be called into question.</p>
<p><strong>History as definitive behavior</strong>    <br />So what does historic modeling have to do with definitive behavior? After all, history is always growing, while definitive behavior is something that doesn't change during the life of an object.</p>
<p>While the history of a given system changes, each event in history is constant. Once it is added to history, it cannot be changed. The behavior of the event is definitive, even if the history of events is dynamic.</p>
<p>The effect of an event might change over time. For example, you might think you have enough in your account to write that check, only to learn later that your spouse made a withdrawal beforehand. In your original history, that check left a positive balance in the account. But after learning about other events, you discover that the check left you overdrawn. Still, that doesn't change the fact that the check was written for a certain amount.</p>
<p><strong>History in practice</strong>    <br />By the above discussion, a historic model is a database that allows inserts, but no updates or deletes. Every time you need to make a change, you insert the appropriate type of record. To determine the current state of the system, you need to query the aggregate of history.</p>
<p>This is obviously impractical. Such a database would grow without bounds. The aggregate queries would get slower over time and eventually make the system unusable. We need one more observation to make it all work.</p>
<p>A system is historic if it appears to be so, whether it actually works as advertised. This observation allows for optimizations like caching, archiving, and pruning. As long as there is some level of abstraction at which you cannot see that the optimization is taking place (without using a stopwatch), then you can still claim to have a historic model. Future posts will discuss these optimizations in detail.</p>
				</div>

				<p class="postmetadata">Posted in <a href="indexb60a.html?cat=27" title="View all posts in Historic Modeling" rel="category">Historic Modeling</a>,  <a href="indexb0b7.html?cat=6" title="View all posts in Patterns" rel="category">Patterns</a>,  <a href="index2d79.html?cat=26" title="View all posts in dof" rel="category">dof</a> |   <a href="indexb7c7.html?p=177#comments" title="Comment on Historic Modeling">1 Comment &#187;</a></p>

			</div>

				<div class="post">
				<h3 id="post-120"><a href="index2c90.html?p=120" rel="bookmark" title="Permanent Link to Record Transactions, not Balances">Record Transactions, not Balances</a></h3>
				<small>Friday, May 18th, 2007</small>

				<div class="entry">
					<p>The typical example of an atomic transaction is a financial transfer. You want to make sure that you reduce the balance of one account by $100 and increase the balance of another account by $100 atomically. It is incorrect for one to occur without the other. And so, the example shows us, you wrap these two actions within one atomic transaction.</p>
<p>The problem is, this example is completely bogus. Banks don't work this way. They record individual transactions, not account balances.</p>
<p>I learned this lesson the hard way when I worked on the eCard product at Radiant Systems -- a refillable gift-card service. Storing account balances is a Bad Idea. Here's what can go wrong.</p>
<p><strong>Select/Update</strong><br />
In order to adjust an account balance stored directly in the database, you have to issue two SQL statements: SELECT the current balance, perform the calculation, then UPDATE to the new balance. (Sure, you could do this with the one statement "UPDATE SET balance=balance-100", but then you couldn't check for overdrafts.) Even within a database transaction, there is the possibility that the record is changed between the SELECT and the UPDATE. This could happen any time the transaction isolation level is set to something lower than the most paranoid "serializable". To fix this, raise the level, or apply a query hint to the SELECT statement, such as "for update".</p>
<p>Whichever solution you choose, you have just increased the locking in your database, and decreased concurrency and scalability. And we have seen that occasionally, even these tight restrictions don't work as advertised. There are still some incorrect balances that we can't explain to this day.</p>
<p><strong>Reconciliation</strong><br />
When you have a distributed system, such as Radiant's eCard in caching mode, you always have to bring the transactions together at some point and verify correct balances. This is the same process that you go through each month when you balance your check book, only at a larger scale and with greater automation. Reconciling balances is simply impossible. You need to identify and compare individual transactions (think check numbers), and add missing transactions to each list.</p>
<p><strong>Diagnostics</strong><br />
When things go wrong, you often need to go back through the transaction history to see where it diverges. If you don't have this history, then you obviously have a problem. But even if you just keep a log in parallel with a balance (as we did at Radiant), you will have a hard time determining exactly which of those transactions was applied incorrectly.</p>
<p>The best practice is to keep a running list of transactions by account. Occasionally, you can snapshot and archive those transactions, like an accountant closing the books each quarter. Then to find the current balance of an account, apply all recent transactions to the snapshot. This solution is scalable, distributable, and auditable.</p>
				</div>

				<p class="postmetadata">Posted in <a href="indexc728.html?cat=7" title="View all posts in Databases" rel="category">Databases</a>,  <a href="indexb60a.html?cat=27" title="View all posts in Historic Modeling" rel="category">Historic Modeling</a>,  <a href="indexb0b7.html?cat=6" title="View all posts in Patterns" rel="category">Patterns</a> |   <a href="index2c90.html?p=120#respond" title="Comment on Record Transactions, not Balances">No Comments &#187;</a></p>

			</div>

		
		<div class="navigation">
			<div class="alignleft"></div>
			<div class="alignright"><a href="index95b0.html?cat=27&amp;paged=2">Next Entries &raquo;</a></div>
		</div>

	
	</div>
		</td>
	</tr>
</table>

<hr />
<div id="footer">
<!-- If you'd like to support WordPress, having the "powered by" link someone on your blog is the best way, it's our only promotion or advertising. -->
	<p>
		Adventures in Software is proudly powered by 
		<a href="http://wordpress.org/">WordPress</a>
		<br /><a href="indexd784.html?feed=rss2">Entries (RSS)</a>
		and <a href="indexa6da.html?feed=comments-rss2">Comments (RSS)</a>.
		<!-- 17 queries. 0.428 seconds. -->
	</p>
</div>
<script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
try {
var pageTracker = _gat._getTracker("UA-389401-3");
pageTracker._trackPageview();
} catch(err) {}</script></div>

<!-- Gorgeous design by Michael Heilemann - http://binarybonsai.com/kubrick/ -->

		<div id="sk2-footer" style="color:#FFF; background-color:#444; padding: 3px 2px 3px 2px; border-top: #888 solid 1px;">This blog is protected by <a href="http://unknowngenius.com/blog/" title="Dave">dr Dave</a>'s <strong><a href="http://unknowngenius.com/blog/wordpress/spam-karma/" title="SK2">Spam Karma 2</a></strong>: <strong>274531</strong>  Spams eaten and counting...</div><script type="text/javascript" src="replies.js"></script>
<script type="text/javascript" src="blogger.js"></script>
<script type="text/javascript" src="http://twitter.com/statuses/user_timeline/michaellperry.json?callback=twitterCallback2&amp;count=5"></script>
<script type="text/javascript" src="http://search.twitter.com/search.json?q=@michaellperry&amp;callback=twitterCallbackReplies&amp;rpp=5"></script>
</body>

<!-- Mirrored from adventuresinsoftware.com/blog/?cat=27&paged=3 by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 13 Jan 2017 13:09:48 GMT -->
</html>
