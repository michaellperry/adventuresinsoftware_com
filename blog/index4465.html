<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr">


<!-- Mirrored from adventuresinsoftware.com/blog/?m=200909&paged=2 by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 13 Jan 2017 12:56:49 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- /Added by HTTrack -->
<head profile="http://gmpg.org/xfn/11">
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />

<title>Adventures in Software   &raquo; 2009&raquo; September</title>

<meta name="generator" content="WordPress 2.3.3" /> <!-- leave this for stats -->

<link rel="stylesheet" href="wp-content/themes/ais2/style.css" type="text/css" media="screen" />
<link rel="alternate" type="application/rss+xml" title="Adventures in Software RSS Feed" href="indexd784.html?feed=rss2" />
<link rel="pingback" href="xmlrpc.html" />
    <script type="text/javascript">
        function onSilverlightError(sender, args) {
            var appSource = "";
            if (sender != null && sender != 0) {
              appSource = sender.getHost().Source;
            }
            
            var errorType = args.ErrorType;
            var iErrorCode = args.ErrorCode;

            if (errorType == "ImageError" || errorType == "MediaError") {
              return;
            }

            var errMsg = "Unhandled Error in Silverlight Application " +  appSource + "\n" ;

            errMsg += "Code: "+ iErrorCode + "    \n";
            errMsg += "Category: " + errorType + "       \n";
            errMsg += "Message: " + args.ErrorMessage + "     \n";

            if (errorType == "ParserError") {
                errMsg += "File: " + args.xamlFile + "     \n";
                errMsg += "Line: " + args.lineNumber + "     \n";
                errMsg += "Position: " + args.charPosition + "     \n";
            }
            else if (errorType == "RuntimeError") {           
                if (args.lineNumber != 0) {
                    errMsg += "Line: " + args.lineNumber + "     \n";
                    errMsg += "Position: " +  args.charPosition + "     \n";
                }
                errMsg += "MethodName: " + args.methodName + "     \n";
            }

            throw new Error(errMsg);
        }
    </script>

	<link rel="EditURI" type="application/rsd+xml" title="RSD" href="xmlrpc0db0.php?rsd" />
 <link rel="wlwmanifest" type="application/wlwmanifest+xml" href="wp-includes/wlwmanifest.xml" /> <style type='text/css'>
<!--#header { background: url('wp-content/themes/ais2/images/header-imgae03.html?upper=A7A73F&amp;lower=77773F') no-repeat bottom center; }
--></style>
</head>
<body>
<div id="page">

<div class="aisTopBar">
	<form method="get" id="searchform" action="http://adventuresinsoftware.com/blog/">
<div>
<a href="indexd784.html?feed=rss2"><img src="../images/feed-icon-28x28.png" border="0"></a>
<input type="text" value="" name="s" id="s" />
<input type="submit" id="searchsubmit" value="Search" />
</div>
</form>
</div>

<div class="aisHeaderImageRight">
	<div class="aisHeaderImage">
	<div class="aisHeaderCornerRight">
	<div class="aisHeaderCornerLeft">
	<div class="aisImageBar">
	<div class="aisSubSites">
		<a href="index.html" class="aisSubSiteLink"><span class="aisSiteTabRight"><span class="aisSiteTabLeft"><span class="aisSiteTab">
			home</span></span></span></a>
		<a class="aisSubSiteLink" href="indexb60a.html?cat=27"><span class="aisSiteTabRight"><span class="aisSiteTabLeft"><span class="aisSiteTab">
			historic modeling</span></span></span></a>
		<a class="aisSubSiteLink" href="indexa88f.html?cat=36"><span class="aisSiteTabRight"><span class="aisSiteTabLeft"><span class="aisSiteTab">
			update controls</span></span></span></a>
		<a href="index2d79.html?cat=26" class="aisSubSiteLink"><span class="aisSiteTabRight"><span class="aisSiteTabLeft"><span class="aisSiteTab">
			degrees of freedom</span></span></span></a>
		<a class="aisSubSiteLink" href="indexba53.html?page_id=2"><span class="aisSiteTabRight"><span class="aisSiteTabLeft"><span class="aisSiteTab">
			about us</span></span></span></a>

	</div>
	</div>
	</div>
	</div>
	</div>
</div>

<table style="width: 100%" cellspacing="0" cellpadding="0">
	<tr valign="top">
		<td width="210px">
<div id="sidebar">
<div class="aisLeftColumnFill">
<div class="aisLeftColumnBottom">
<div class="aisLeftColumnTop">
<div id="twitter_div" class="aisLeftNav">
<h2 class="sidebar-title">Twitter Updates</h2>
<ul id="twitter_update_list"></ul>
<a href="http://twitter.com/michaellperry" id="follow">Follow me</a>
</div>
<div id="twitter_reply_div" class="aisLeftNav">
<h2 class="sidebar-title">Twitter Replies</h2>
<ul id="twitter_reply_list"></ul>
</div>

<div class="aisLeftNav">
<a href='http://ineta.org/Speakers/SearchCommunitySpeakers.aspx?SpeakerId=c5110e21-9243-461b-a464-a6548524e885'><img alt='INETA Community Speakers Program' border='0' src='../../www.ineta.org/images/OfficialLogos/InetaCommunitySpeakersRequestMe.html' /></a>
</div>

<div class="aisLeftNav">
	<li class="pagenav"><h2>Pages</h2><ul><li class="page_item page-item-2"><a href="indexba53.html?page_id=2" title="About Us">About Us</a></li>
<li class="page_item page-item-210"><a href="index6ae3.html?page_id=210" title="Templates">Templates</a></li>
</ul></li></div>

<div class="aisLeftNav">
<h2>Archives</h2>
<ul>
	<li><a href='indexb4d5.html?m=201110' title='October 2011'>October 2011</a></li>
	<li><a href='indexc61a.html?m=201106' title='June 2011'>June 2011</a></li>
	<li><a href='indexa80d.html?m=201105' title='May 2011'>May 2011</a></li>
	<li><a href='index512b.html?m=201104' title='April 2011'>April 2011</a></li>
	<li><a href='index08fb.html?m=201103' title='March 2011'>March 2011</a></li>
	<li><a href='index52f4.html?m=201102' title='February 2011'>February 2011</a></li>
	<li><a href='index74f1.html?m=201101' title='January 2011'>January 2011</a></li>
	<li><a href='index8956.html?m=201012' title='December 2010'>December 2010</a></li>
	<li><a href='indexa1aa.html?m=201011' title='November 2010'>November 2010</a></li>
	<li><a href='indexe3d5.html?m=201010' title='October 2010'>October 2010</a></li>
	<li><a href='index9ab9.html?m=201009' title='September 2010'>September 2010</a></li>
	<li><a href='index1ff0.html?m=201008' title='August 2010'>August 2010</a></li>
	<li><a href='index9f11.html?m=201007' title='July 2010'>July 2010</a></li>
	<li><a href='index31f0.html?m=201006' title='June 2010'>June 2010</a></li>
	<li><a href='indexd189.html?m=201005' title='May 2010'>May 2010</a></li>
	<li><a href='indexb5c0.html?m=201004' title='April 2010'>April 2010</a></li>
	<li><a href='indexf258.html?m=201003' title='March 2010'>March 2010</a></li>
	<li><a href='index6e30.html?m=201002' title='February 2010'>February 2010</a></li>
	<li><a href='index6b19.html?m=201001' title='January 2010'>January 2010</a></li>
	<li><a href='index5c0a.html?m=200912' title='December 2009'>December 2009</a></li>
	<li><a href='index8f62.html?m=200911' title='November 2009'>November 2009</a></li>
	<li><a href='index451d.html?m=200910' title='October 2009'>October 2009</a></li>
	<li><a href='index3e04.html?m=200909' title='September 2009'>September 2009</a></li>
	<li><a href='index425a.html?m=200908' title='August 2009'>August 2009</a></li>
	<li><a href='index9907.html?m=200907' title='July 2009'>July 2009</a></li>
	<li><a href='index3104.html?m=200906' title='June 2009'>June 2009</a></li>
	<li><a href='indexc36d.html?m=200905' title='May 2009'>May 2009</a></li>
	<li><a href='index17e8.html?m=200904' title='April 2009'>April 2009</a></li>
	<li><a href='index10a5.html?m=200903' title='March 2009'>March 2009</a></li>
	<li><a href='index8988.html?m=200902' title='February 2009'>February 2009</a></li>
	<li><a href='index1419.html?m=200901' title='January 2009'>January 2009</a></li>
	<li><a href='index7866.html?m=200812' title='December 2008'>December 2008</a></li>
	<li><a href='index55f6.html?m=200811' title='November 2008'>November 2008</a></li>
	<li><a href='indexa7bc.html?m=200810' title='October 2008'>October 2008</a></li>
	<li><a href='indexe77c.html?m=200809' title='September 2008'>September 2008</a></li>
	<li><a href='indexcffc.html?m=200808' title='August 2008'>August 2008</a></li>
	<li><a href='index0e62.html?m=200807' title='July 2008'>July 2008</a></li>
	<li><a href='indexfda7.html?m=200806' title='June 2008'>June 2008</a></li>
	<li><a href='index7d64.html?m=200805' title='May 2008'>May 2008</a></li>
	<li><a href='index94dd.html?m=200804' title='April 2008'>April 2008</a></li>
	<li><a href='index9631.html?m=200803' title='March 2008'>March 2008</a></li>
	<li><a href='indexdd52.html?m=200802' title='February 2008'>February 2008</a></li>
	<li><a href='index21ee.html?m=200801' title='January 2008'>January 2008</a></li>
	<li><a href='index363c.html?m=200712' title='December 2007'>December 2007</a></li>
	<li><a href='index7493.html?m=200711' title='November 2007'>November 2007</a></li>
	<li><a href='index93a7.html?m=200710' title='October 2007'>October 2007</a></li>
	<li><a href='index4ca8.html?m=200709' title='September 2007'>September 2007</a></li>
	<li><a href='index6124.html?m=200708' title='August 2007'>August 2007</a></li>
	<li><a href='index6013.html?m=200707' title='July 2007'>July 2007</a></li>
	<li><a href='index2ab6.html?m=200706' title='June 2007'>June 2007</a></li>
	<li><a href='index44f0.html?m=200705' title='May 2007'>May 2007</a></li>
	<li><a href='indexf0b4.html?m=200704' title='April 2007'>April 2007</a></li>
	<li><a href='index481d.html?m=200703' title='March 2007'>March 2007</a></li>
	<li><a href='indexcbea.html?m=200702' title='February 2007'>February 2007</a></li>
	<li><a href='index9cdc.html?m=200701' title='January 2007'>January 2007</a></li>
	<li><a href='index3ea4.html?m=200612' title='December 2006'>December 2006</a></li>
	<li><a href='index67ca.html?m=200611' title='November 2006'>November 2006</a></li>
	<li><a href='indexff49.html?m=200610' title='October 2006'>October 2006</a></li>
	<li><a href='index611c.html?m=200609' title='September 2006'>September 2006</a></li>
	<li><a href='index9a21.html?m=200608' title='August 2006'>August 2006</a></li>
	<li><a href='index3ee9.html?m=200607' title='July 2006'>July 2006</a></li>
	<li><a href='indexe13a.html?m=200606' title='June 2006'>June 2006</a></li>
</ul>
</div>

<div class="aisLeftNav">
	</div>

<div class="aisLeftNav">
<h2>Books</h2>
<iframe src="http://rcm.amazon.com/e/cm?t=adventures0d2-20&amp;o=1&amp;p=8&amp;l=as1&amp;asins=0764526413&amp;fc1=000000&amp;IS2=1&amp;lt1=_blank&amp;lc1=0000ff&amp;bc1=000000&amp;bg1=ffffff&amp;f=ifr" style="width:120px;height:240px;" scrolling="no" marginwidth="0" marginheight="0" frameborder="0" name="I5" id="I5"></iframe>
<br/>
<iframe src="http://rcm.amazon.com/e/cm?t=adventures0d2-20&amp;o=1&amp;p=8&amp;l=as1&amp;asins=0201633612&amp;fc1=000000&amp;IS2=1&amp;lt1=_blank&amp;lc1=0000ff&amp;bc1=000000&amp;bg1=ffffff&amp;f=ifr" style="width:120px;height:240px;" scrolling="no" marginwidth="0" marginheight="0" frameborder="0" name="I6" id="I6"></iframe>
<br/>
<iframe src="http://rcm.amazon.com/e/cm?t=adventures0d2-20&amp;o=1&amp;p=8&amp;l=as1&amp;asins=0136291554&amp;fc1=000000&amp;IS2=1&amp;lt1=_blank&amp;lc1=0000ff&amp;bc1=000000&amp;bg1=ffffff&amp;f=ifr" style="width:120px;height:240px;" scrolling="no" marginwidth="0" marginheight="0" frameborder="0" name="I7" id="I7"></iframe>
<br/>
<iframe src="http://rcm.amazon.com/e/cm?t=adventures0d2-20&amp;o=1&amp;p=8&amp;l=as1&amp;asins=1888009195&amp;fc1=000000&amp;IS2=1&amp;lt1=_blank&amp;lc1=0000ff&amp;bc1=000000&amp;bg1=ffffff&amp;f=ifr" style="width:120px;height:240px;" scrolling="no" marginwidth="0" marginheight="0" frameborder="0" name="I8" id="I8"></iframe>
</div>
<div class="aisLeftNav">
<h2>Meta</h2>
<ul>
		<li><a href="wp-login.html">Login</a></li>
	<li><a href="http://validator.w3.org/check/referer" title="This page validates as XHTML 1.0 Transitional">Valid <abbr title="eXtensible HyperText Markup Language">XHTML</abbr></a></li>
	<li><a href="http://gmpg.org/xfn/"><abbr title="XHTML Friends Network">XFN</abbr></a></li>
	<li><a href="http://wordpress.org/" title="Powered by WordPress, state-of-the-art semantic personal publishing platform.">WordPress</a></li>
	</ul>
</div>
<div class="aisLeftContent">
<h2>Community</h2>
<ul>
	<script type="text/javascript" src="../../localhost/embed/92q2bbma.js"></script>
</ul>
</div>

</div></div></div>
</div>		</td>
		<td>

	<div id="content" class="narrowcolumn">

		
		 		<h2 class="pagetitle">Archive for September, 2009</h2>

		

		<div class="navigation">
			<div class="alignleft"></div>
			<div class="alignright"><a href="index3e04.html?m=200909">Next Entries &raquo;</a></div>
		</div>

				<div class="post">
				<h3 id="post-431"><a href="index88c3.html?p=431" rel="bookmark" title="Permanent Link to My wish for C#: class parameters">My wish for C#: class parameters</a></h3>
				<small>Friday, September 11th, 2009</small>

				<div class="entry">
					<p>How C# works today:</p>
<pre><span style="color: blue">public</span> <span style="color: blue">class</span> Order
{
    <span style="color: blue">private</span> Customer _customer;

    <span style="color: blue">public</span> Order(Customer customer)
    {
        _customer = customer;
    }

    <span style="color: blue">public</span> Customer Customer
    {
        <span style="color: blue">get</span> { <span style="color: blue">return</span> _customer; }
    }

    <span style="color: blue">public</span> <span style="color: blue">void</span> Fulfill()
    {
        Package.ShipTo(_customer.ShippingAddress);
    }
}</pre>
<p>How I wish it worked:</p>
<pre><span style="color: blue">public</span> <span style="color: blue">class</span> Order(Customer _customer)
{
    <span style="color: blue">public</span> Customer Customer
    {
        <span style="color: blue">get</span> { <span style="color: blue">return</span> _customer; }
    }

    <span style="color: blue">public</span> <span style="color: blue">void</span> Fulfill()
    {
        Package.ShipTo(_customer.ShippingAddress);
    }
}</pre>
<p>Advantages:</p>
<ul>
<li>Class parameters would be immutable.</li>
<li>Classes could only have one constructor.</li>
<li>Constructors could not have side effects.</li>
<li>Constructors could not throw exceptions.</li>
<li>Class parameters would only have to be declared once instead of 3 times (counting the assignment).</li>
</ul>
				</div>

				<p class="postmetadata">Posted in <a href="index8e7f.html?cat=19" title="View all posts in C#" rel="category">C#</a>,  <a href="index51fa.html?cat=40" title="View all posts in qed" rel="category">qed</a> |   <a href="index88c3.html?p=431#respond" title="Comment on My wish for C#: class parameters">No Comments &#187;</a></p>

			</div>

				<div class="post">
				<h3 id="post-430"><a href="indexbdc5.html?p=430" rel="bookmark" title="Permanent Link to Anonymous delegates vs. lambdas">Anonymous delegates vs. lambdas</a></h3>
				<small>Thursday, September 10th, 2009</small>

				<div class="entry">
					<p>An interesting question came up during last week's Q.E.D. discussion on closure. Why are there two language features in C# that do the same thing?</p>
<p>Lambdas:</p>
<pre><span style="color: blue">public</span> Order GetOrder(<span style="color: blue">string</span> orderId)
{
    <span style="color: blue">return</span> GetOrderRepository()
        .GetSatisfying(o =&gt; o.OrderId == orderId)
        .Query()
        .FirstOrDefault();
}</pre>
<p>Anonymous delegates:</p>
<pre><span style="color: blue">public</span> Order GetOrder(<span style="color: blue">string</span> orderId)
{
    <span style="color: blue">return</span> GetOrderRepository()
        .GetSatisfying(<span style="color: blue">delegate</span>(Order o)
            { <span style="color: blue">return</span> o.OrderId == orderId; })
        .Query()
        .FirstOrDefault();
}</pre>
<p>Do you see the difference? Let me give you a clue. Here's another way to write the anonymous delegate:</p>
<pre><span style="color: blue">public</span> Order GetOrder(<span style="color: blue">string</span> orderId)
{
    <span style="color: blue">return</span> GetOrderRepository()
        .GetSatisfying(o =&gt;
           { <span style="color: blue">return</span> o.OrderId == orderId; })
        .Query()
        .FirstOrDefault();
}</pre>
<p>Even though this syntax uses the lambda operator "=&gt;", it still behaves more like an anonymous delegate. The important difference is not the "=&gt;" or the "delegate", its the "return" and the semicolon.</p>
<p>A lambda contains an expression. An anonymous delegate contains statements. Sure, that <em>could</em> be a single return statement, but it doesn't have to be.</p>
<p>It should be stated that only the first block of code compiles in this instance. That's because GetSatisfying takes "Expression&lt;Func&lt;Order, bool&gt;&gt;", and not just "Func&lt;Order, bool&gt;". A function is just a block of code that you can call which happens to return a value. An expression, on the other hand, exists only to produce that value.</p>
<p>Lambdas are expressions. Anonymous delegates are functions.</p>
				</div>

				<p class="postmetadata">Posted in <a href="index8e7f.html?cat=19" title="View all posts in C#" rel="category">C#</a>,  <a href="index51fa.html?cat=40" title="View all posts in qed" rel="category">qed</a> |   <a href="indexbdc5.html?p=430#respond" title="Comment on Anonymous delegates vs. lambdas">No Comments &#187;</a></p>

			</div>

				<div class="post">
				<h3 id="post-429"><a href="indexedce.html?p=429" rel="bookmark" title="Permanent Link to Closure">Closure</a></h3>
				<small>Wednesday, September 9th, 2009</small>

				<div class="entry">
					<p>It's only Q.E.D. Hour 2 and we're already talking about closure.</p>
<p>No, it's not the end of Q.E.D. It's just the beginning. When I say "closure", I'm talking about two things. First, there's the language feature. Second, there's the concept. Either way, it is fundamental to proving software.</p>
<p><strong>Language feature</strong><br />As a language feature, closure is the ability to bring variables into scope and encapsulate them within a function. Different languages support this feature in different ways. In C#, it is supported in lambdas and anonymous delegates.</p>
<pre><span style="color: blue">public</span> Order GetOrder(<span style="color: blue">string</span> <strong>orderId</strong>)
{
    <span style="color: blue">return</span> GetOrderRepository()
        .GetSatisfying(o =&gt; o.OrderId == <strong>orderId</strong>)
        .Query()
        .FirstOrDefault();
}</pre>
<p>The parameter orderId is available within the lambda, even though the lambda executes outside of the scope of this method.</p>
<p>As of Java 6, closure is supported only by anonymous inner classes. It is slated for becoming a first-class language feature in Java 7.</p>
<pre><span style="color: blue">public</span> Order getOrder(<span style="color: blue">final</span> string <strong>orderId</strong>) {
    <span style="color: blue">return</span> Query
        .from(getOrders())
        .where(<span style="color: blue">new</span> Predicate&lt;Order&gt;() {
            <span style="color: blue">public</span> <span style="color: blue">boolean</span> where(Order row) {
                <span style="color: blue">return</span> row.getOrderId() == <strong>orderId</strong>;
            }
        })
        .selectOne();
}</pre>
<p>Again, the orderId parameter is available within the anonymous inner class. It will be set to the the correct value even though Predicate.where() is called by code not located in the method. In Java, the variables to be enclosed must be marked as "final" to ensure that they are not changed after the closure is created.</p>
<p><strong>Factory methods</strong><br />As a concept, closure can be used in several places. It doesn't take an explicit language feature to take advantage of the concept. In fact, the Factory Method pattern is often used to perform closure.</p>
<p>A factory method constructs an object, but hides its class. In doing so, it usually takes parameters that are injected into the new object. These parameters obey the laws of closure.</p>
<pre><span style="color: blue">public</span> IOrderService
    CreateOrderService(
        ITransaction <strong>transaction</strong>)
{
    <span style="color: blue">return</span> <span style="color: blue">new</span>
        OrderService(
            <strong>transaction</strong>,
            _accountsServiceProvider,
            _catalogServiceProvider);
}</pre>
<p>The transaction parameter is enclosed within the object. An object, just like a lambda, is a packet of behavior that can be executed later. The value of transaction is already set at the time that the behavior is executed.</p>
<p><strong>Constructors</strong><br />Notice that there are two other parameters passed into the OrderService. These two are set in the constructor of the factory itself.</p>
<pre><span style="color: blue">private</span> IServiceProvider&lt;IAccountsService&gt; <strong>_accountsServiceProvider</strong>;
<span style="color: blue">private</span> IServiceProvider&lt;ICatalogService&gt; <strong>_catalogServiceProvider</strong>;

<span style="color: blue">public</span> OrderServiceFactory(
    IServiceProvider&lt;IAccountsService&gt; <strong>accountsServiceProvider</strong>,
    IServiceProvider&lt;ICatalogService&gt; <strong>catalogServiceProvider</strong>)
{
    _accountsServiceProvider = accountsServiceProvider;
    _catalogServiceProvider = catalogServiceProvider;
}</pre>
<p>The factory encloses some parameters and forwards them on to all of the objects it creates. In this way, closure can be nested.</p>
<p>Just like the "final" parameter in the Java example, we don't want these values changing. For the same reason that Java requires the "final" keyword for closure, fields initialized by the constructor should be considered immutable.</p>
<p>Closure is a useful mechanism for writing provable software. Whether we use it as a language feature or simply as a pattern, it allows us to bring values into a function or object. We can then prove interesting things about those values, as we will see in coming posts.</p>
				</div>

				<p class="postmetadata">Posted in <a href="index51fa.html?cat=40" title="View all posts in qed" rel="category">qed</a> |   <a href="indexedce.html?p=429#respond" title="Comment on Closure">No Comments &#187;</a></p>

			</div>

				<div class="post">
				<h3 id="post-428"><a href="indexc7ce.html?p=428" rel="bookmark" title="Permanent Link to Append only databases, domain events, and historic models">Append only databases, domain events, and historic models</a></h3>
				<small>Tuesday, September 8th, 2009</small>

				<div class="entry">
					<p>People are starting to talk about the concept of append-only models or domain events:</p>
<ul>
<li><a title="http://ayende.com/Blog/archive/2009/09/06/soft-deletes-arenrsquot-append-only-model.aspx" href="http://ayende.com/Blog/archive/2009/09/06/soft-deletes-arenrsquot-append-only-model.aspx">Ayende on append-only models</a>
<li><a title="http://www.udidahan.com/2009/06/14/domain-events-salvation/" href="http://www.udidahan.com/2009/06/14/domain-events-salvation/">Udi Dahan on domain events</a>
<li><a title="http://www.infoq.com/presentations/greg-young-unshackle-qcon08" href="http://www.infoq.com/presentations/greg-young-unshackle-qcon08">Greg Young on domain events</a></li>
</ul>
<p>It's not a new idea, but it has seen increased awareness recently. The idea is that changes (a.k.a. events, or what I call "facts") become a part of the domain model. Instead of performing CRUD operations on records, a system keeps a history of these changes. The changes themselves are modeled as first-class entities, not as side-effects.</p>
<p>The advantages of this approach are many.</p>
<ul>
<li>Auditability - The transaction history is the primary source of record.
<li>Synchronization - Merge conflicts are easily detected.
<li>Isolation - Publishers and subscribers know nothing about each other.</li>
</ul>
<p>But there are some details that I haven't heard others mention, yet. These details are going to determine whether people adopt the tools and practices that will emerge from this idea.</p>
<p><strong>Partial order</strong><br />Many of the implementations of this idea impose a full order on the changes. Each transaction knows the time at which it is committed. The transactions then line up temporally to flow through the system. Before you can process one transaction, you must first have processed the transactions that came before.</p>
<p>This is a pattern I call the "Transaction Pipeline". It is highly restrictive. The only way to know the true result of a transaction is to know all transactions that have come before. This restriction takes what could be a decentralized model and gives it a central authority. The consequence is a loss of local authority.</p>
<p>In Greg Young's video, he draws a system in which changes flow from a client through a server and back again. The client captures the user's intent, then queues up those changes to be sent to the server in serial. The server examines each change, resolves merge conflicts, and updates a central database. The client runs all of its queries against that central database. The local client has no authority. Even though it knows that the user has requested a change, it cannot promise that change until it sees the results in the central database.</p>
<p>If the transactions were not so strictly ordered, the local client could make better decisions about the results of a change. Rather than ordering changes strictly by time, it could impose a partial order on facts. Facts that are related to one another must occur in the proper order. But unrelated facts are allowed to occur in any order. This allows a local client to make decisions based on a subset of the facts. It knows that it has enough information to make the decision, even if it doesn't yet have all of the information.</p>
<p><strong>Parallel storage</strong><br />Another common implementation detail is that objects are stored in parallel with changes. As the changes come in, they are stored in a queue. As they are processed, their effects are performed on relational data. The relational model can then be queried for current state.</p>
<p>A perfect example is the architecture of <a href="http://www.nservicebus.com/ArchitecturalPrinciples.aspx">NServiceBus</a>. The message bus is added as a mechanism for disparate components to indirectly communicate with one another. Once the component gets the message, it processes the command in a database. This is a natural extension of the way we build systems today.</p>
<p>Unfortunately, this kind of architecture makes it difficult to query the transaction stream itself. Before we can see the effect of a command, it must be executed against relational storage. A local client cannot easily combine the relational snapshot on the server with the outgoing queue of changes that it wishes to impose.</p>
<p>An alternative is to forego relational storage for a mechanism that can query the changes themselves. To find the current state of an entity, it is only necessary to locate all known changes to that entity. If those changes are organized in the right way, that query is as simple and performant as going to the relational database. But the advantage is that we can query <em>through</em> the message queue, not <em>around</em> it.</p>
<p><strong>Disconnected operation</strong><br />A smart client is often defined as one that can detect whether it is connected or disconnected, and change modes appropriately. These kinds of systems keep a local database as an off-line insurance policy against the eventuality of being disconnected. When the connection is reestablished, the client sends to the server all of the changes that have occurred since the last synchronization.</p>
<p>The problem with this model is that the client needs to switch modes. In "connected" mode, it acts like a dumb terminal. In "disconnected" mode, it acts like a rich client. This yields twice the code to write, test, and maintain. The developer has to decide which features will be available in disconnected mode, and degrade the experience graciously. On top of that is the complexity of switching modes, and the errors that might arise from inconsistencies between the two implementations.</p>
<p>It would be better for a smart client to operate in only one mode. The changes that the user requests are simultaneously committed to a local database and placed in a queue (preferably as one data structure instead of two). The only difference between connected and disconnected operation is whether that queue is currently being serviced. Either way, the application is blissfully unaware. The users changes are captured nonetheless. The developer only has to write the code once, so there is never a decision whether a feature will be supported while off-line. All features are available at all times.</p>
<p><strong>The devil is in the details</strong><br />Append-only or domain-event models are a powerful idea. But the fact that you only insert and never update or delete is only the beginning. It's great that events are modeled as part of the domain, but if they are just <em>in addition to</em> the domain then it hasn't been taken far enough. For this idea to gain the wide adoption that it deserves, the patterns and tools must impose partial order, forego parallel storage, and support disconnected operation.</p>
<p>For more information on a pattern and a tool that supports these concepts, please see <a href="http://historicmodeling.com/">Historic Modeling</a> and <a href="http://correspondence.codeplex.com/">Correspondence</a>.</p>
				</div>

				<p class="postmetadata">Posted in <a href="indexb60a.html?cat=27" title="View all posts in Historic Modeling" rel="category">Historic Modeling</a> |   <a href="indexc7ce.html?p=428#respond" title="Comment on Append only databases, domain events, and historic models">No Comments &#187;</a></p>

			</div>

				<div class="post">
				<h3 id="post-427"><a href="indexa942.html?p=427" rel="bookmark" title="Permanent Link to Correct the induction problem">Correct the induction problem</a></h3>
				<small>Thursday, September 3rd, 2009</small>

				<div class="entry">
					<p>Let's take another run at proving that a watch movement with 20 parts has 19 connections.</p>
<p><a href="wp-content/uploads/2009/09/sixgears.jpg"><img style="border-top-width: 0px; border-left-width: 0px; border-bottom-width: 0px; border-right-width: 0px" height="169" alt="SixGears" src="wp-content/uploads/2009/09/sixgears-thumb.jpg" width="235" align="right" border="0"></a> It is difficult to prove that any movement can be constructed one gear at a time by making just one connection with an existing gear. And here is a counter-example to demonstrate the problem.</p>
<p>A ring of six gears, all the same size, is a movement with one degree of freedom. If you construct this movement one gear at a time, you will connect the final gear to two prior components, not to just one. This movement has 6 gears and 6 connections, not the 5 that we want our proof to show.</p>
<p>Something is obviously wrong here. This movement is not what is intended by the problem, but it is not explicitly prohibited either. We need to change the problem:</p>
<p><strong>Given:</strong> A movement with 20 moving parts having one degree of freedom <strong><em>and no redundant connections</em></strong>.
<p><strong>Prove: </strong>There are 19 connections among those parts.
<p>Now our problem is precise enough. While it may seem wrong to change a problem in order to solve it, this is something that happens all the time in software. The requirements are never stated precisely. We always have to go back and ask questions. In the process, we refine the definition of the problem until we agree on something that can be implemented unambiguously.
<p><strong>Find a new induction</strong><br />After changing our problem to make it provable, we still find that our original approach is difficult. In order to prove that any valid movement can be built on part at a time, we have to prove that there is always at least one component connected to only one neighbor. We have to prove the existence of a leaf.
<p>While this is not a terribly difficult proof, there is an easier way. We could choose a less restrictive induction. Rather than assuming that we can build a movement one part at a time, we only need to know that we can build any movement from two smaller movements. This satisfies the requirements of inductive reasoning.
<p>So first, to prove that we can construct any movement from two smaller movements, we just need to select any connection within the movement. Now break this connection. One of two things will happen:
<ul>
<li>You are left with one movement, in which case the connection was redundant. The larger movement was invalid and therefore not covered by the proof.
<li>You are left with two movements, each with one degree of freedom. Since we broke only one connection, the others remain intact. Assuming the larger movement had no redundant connections, neither do the smaller ones.</li>
</ul>
<p>So the process of building a movement out of smaller movements is valid. Now we can write our proof:</p>
<ol>
<li>Let M<sub>j+k</sub> be the movement formed by connecting M<sub>j</sub> and M<sub>k</sub>.
<li>g(M<sub>j+k</sub>) = g(M<sub>j</sub>) + g(M<sub>k</sub>), because we combined two sets of gears.
<li>c(M<sub>j+k</sub>) = c(M<sub>j</sub>) + c(M<sub>k</sub>) + 1, because we added only one new connection.
<li>c(M<sub>j+k</sub>) = g(M<sub>j</sub>)-1 + g(M<sub>k</sub>)-1 + 1, by applying the assumption of the induction.
<li>c(M<sub>j+k</sub>) = g(M<sub>j</sub>) + g(M<sub>k</sub>) - 1, by association.
<li>c(M<sub>j+k</sub>) = g(M<sub>j+k</sub>) - 1, by combining 2 and 5.</li>
</ol>
<p>Q.E.D.</p>
				</div>

				<p class="postmetadata">Posted in <a href="index51fa.html?cat=40" title="View all posts in qed" rel="category">qed</a> |   <a href="indexa942.html?p=427#respond" title="Comment on Correct the induction problem">No Comments &#187;</a></p>

			</div>

				<div class="post">
				<h3 id="post-424"><a href="index007a.html?p=424" rel="bookmark" title="Permanent Link to Inductive reasoning">Inductive reasoning</a></h3>
				<small>Wednesday, September 2nd, 2009</small>

				<div class="entry">
					<p>The problem was:</p>
<p><strong>Given:</strong> A movement with 20 moving parts having one degree of freedom.</p>
<p><strong>Prove: </strong>There are ___ connections among those parts.</p>
<p>The answer, of course, is 19. But the real exercise is in the proof.</p>
<p>This problem is solvable using a technique called inductive reasoning. Inductive reasoning is proving a statement in two parts. First, you prove it for a trivial case. Then, you prove that if it's true for a smaller case, it must be true for a larger case.</p>
<p><strong>State the problem</strong><br />To begin, we need to define some terms to help us reason about the problem. We'll define the terms M, g(M), and c(M) like this:</p>
<ul>
<li>Let M be a movement with one degree of freedom.
<li>Let g(M) be the number of gears in the movement.
<li>Let c(M) be the number of connections in the movement.</li>
</ul>
<p>Using these terms, we can state the problem as:</p>
<ul>
<li>Proove that c(M) = g(M)-1.</li>
</ul>
<p><strong>Start with the trivial</strong><br />The trivial case is a movement having a single gear. This movement has no connections, since there are no other gears to which it can connect. Written using our new terms:</p>
<ul>
<li>Let M<sub>0</sub> be a movement having only one gear.
<li>g(M<sub>0</sub>) = 1.
<li>c(M<sub>0</sub>) = 0.
<li>c(M<sub>0</sub>) = g(M<sub>0</sub>) - 1.</li>
</ul>
<p><strong>Build upward</strong><br />Now if I have a movement M<sub>j</sub>, what happens when I add another gear to it? I end up with a movement M<sub>j+1</sub>. I want to prove that the connections in M<sub>j+1</sub> are one fewer than the gears. Inductive reasoning lets me assume that this is true for M<sub>j</sub>.</p>
<ol>
<li>c(M<sub>j</sub>) = g(M<sub>j</sub>) - 1.</li>
<li>g(M<sub>j+1</sub>) = g(M<sub>j</sub>) + 1, because I added a gear.</li>
<li>c(M<sub>j+1</sub>) = c(M<sub>j</sub>) + 1, because I connected that gear to exactly one previous gear.</li>
<li>c(M<sub>j+1</sub>) = g(M<sub>j</sub>) - 1 + 1, by combining steps 1 and 3.</li>
<li>c(M<sub>j+1</sub>) = g(M<sub>j</sub>) + 1 - 1, by commuting step 4.</li>
<li>c(M<sub>j+1</sub>) = g(M<sub>j+1</sub>) - 1, by combining steps 2 and 5.</li>
</ol>
<p>Q.E.D.</p>
<p><strong>Not so fast</strong><br />I was imprecise in my reasoning in a few places. While this still led to the correct answer in this case, it might have led to something completely wrong in a different problem.</p>
<p>Inductive reasoning requires that you prove that the steps you take to get from a smaller problem to a bigger one will cover all possible problems. You have to prove that you can build a movement one part at a time by connecting that gear to exactly one gear of the previous movement. While this is true, it is by no means obvious.</p>
<p>If we can't prove that our induction can build any movement, then we can't use it to prove statements about all movements. What about those that can't be assembled one part at a time? What we need is a different induction, one that more obviously covers all movements.</p>
				</div>

				<p class="postmetadata">Posted in <a href="index51fa.html?cat=40" title="View all posts in qed" rel="category">qed</a> |   <a href="index007a.html?p=424#respond" title="Comment on Inductive reasoning">No Comments &#187;</a></p>

			</div>

				<div class="post">
				<h3 id="post-423"><a href="indexb351.html?p=423" rel="bookmark" title="Permanent Link to Exercise in proof">Exercise in proof</a></h3>
				<small>Tuesday, September 1st, 2009</small>

				<div class="entry">
					<p>In Q.E.D. Hour, we will be proving things about our code. To get the group started in thinking about proof, I assigned some homework. It has to do with a watch.</p>
<p>The mechanism inside of a wristwatch is known as a movement. It has many moving parts, but all of those parts work together in unison. It measures only one thing. It has only one degree of freedom.</p>
<p>The secret to why the movement works is not in the parts. It is in the connections between the parts, where a connection is the point at which two moving parts touch. Which brings us to our proof.</p>
<p><strong>Given:</strong> A movement with 20 moving parts having one degree of freedom.</p>
<p><strong>Prove: </strong>There are ___ connections among those parts.</p>
<p>Fill in the blank. I'm sure you already know the answer. But the challenge is to prove it. This is representative of the types of proofs that we will write in Q.E.D. Hour.</p>
				</div>

				<p class="postmetadata">Posted in <a href="index2d79.html?cat=26" title="View all posts in dof" rel="category">dof</a>,  <a href="index51fa.html?cat=40" title="View all posts in qed" rel="category">qed</a> |   <a href="indexb351.html?p=423#respond" title="Comment on Exercise in proof">No Comments &#187;</a></p>

			</div>

		
		<div class="navigation">
			<div class="alignleft"></div>
			<div class="alignright"><a href="index3e04.html?m=200909">Next Entries &raquo;</a></div>
		</div>

	
	</div>
		</td>
	</tr>
</table>

<hr />
<div id="footer">
<!-- If you'd like to support WordPress, having the "powered by" link someone on your blog is the best way, it's our only promotion or advertising. -->
	<p>
		Adventures in Software is proudly powered by 
		<a href="http://wordpress.org/">WordPress</a>
		<br /><a href="indexd784.html?feed=rss2">Entries (RSS)</a>
		and <a href="indexa6da.html?feed=comments-rss2">Comments (RSS)</a>.
		<!-- 17 queries. 0.392 seconds. -->
	</p>
</div>
<script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
try {
var pageTracker = _gat._getTracker("UA-389401-3");
pageTracker._trackPageview();
} catch(err) {}</script></div>

<!-- Gorgeous design by Michael Heilemann - http://binarybonsai.com/kubrick/ -->

		<div id="sk2-footer" style="color:#FFF; background-color:#444; padding: 3px 2px 3px 2px; border-top: #888 solid 1px;">This blog is protected by <a href="http://unknowngenius.com/blog/" title="Dave">dr Dave</a>'s <strong><a href="http://unknowngenius.com/blog/wordpress/spam-karma/" title="SK2">Spam Karma 2</a></strong>: <strong>274531</strong>  Spams eaten and counting...</div><script type="text/javascript" src="replies.js"></script>
<script type="text/javascript" src="blogger.js"></script>
<script type="text/javascript" src="http://twitter.com/statuses/user_timeline/michaellperry.json?callback=twitterCallback2&amp;count=5"></script>
<script type="text/javascript" src="http://search.twitter.com/search.json?q=@michaellperry&amp;callback=twitterCallbackReplies&amp;rpp=5"></script>
</body>

<!-- Mirrored from adventuresinsoftware.com/blog/?m=200909&paged=2 by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 13 Jan 2017 12:56:49 GMT -->
</html>
