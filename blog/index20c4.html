<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr">


<!-- Mirrored from adventuresinsoftware.com/blog/?paged=34 by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 13 Jan 2017 13:11:15 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- /Added by HTTrack -->
<head profile="http://gmpg.org/xfn/11">
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />

<title>Adventures in Software  </title>

<meta name="generator" content="WordPress 2.3.3" /> <!-- leave this for stats -->

<link rel="stylesheet" href="wp-content/themes/ais2/style.css" type="text/css" media="screen" />
<link rel="alternate" type="application/rss+xml" title="Adventures in Software RSS Feed" href="indexd784.html?feed=rss2" />
<link rel="pingback" href="xmlrpc.html" />
    <script type="text/javascript">
        function onSilverlightError(sender, args) {
            var appSource = "";
            if (sender != null && sender != 0) {
              appSource = sender.getHost().Source;
            }
            
            var errorType = args.ErrorType;
            var iErrorCode = args.ErrorCode;

            if (errorType == "ImageError" || errorType == "MediaError") {
              return;
            }

            var errMsg = "Unhandled Error in Silverlight Application " +  appSource + "\n" ;

            errMsg += "Code: "+ iErrorCode + "    \n";
            errMsg += "Category: " + errorType + "       \n";
            errMsg += "Message: " + args.ErrorMessage + "     \n";

            if (errorType == "ParserError") {
                errMsg += "File: " + args.xamlFile + "     \n";
                errMsg += "Line: " + args.lineNumber + "     \n";
                errMsg += "Position: " + args.charPosition + "     \n";
            }
            else if (errorType == "RuntimeError") {           
                if (args.lineNumber != 0) {
                    errMsg += "Line: " + args.lineNumber + "     \n";
                    errMsg += "Position: " +  args.charPosition + "     \n";
                }
                errMsg += "MethodName: " + args.methodName + "     \n";
            }

            throw new Error(errMsg);
        }
    </script>

	<link rel="EditURI" type="application/rsd+xml" title="RSD" href="xmlrpc0db0.php?rsd" />
 <link rel="wlwmanifest" type="application/wlwmanifest+xml" href="wp-includes/wlwmanifest.xml" /> <style type='text/css'>
<!--#header { background: url('wp-content/themes/ais2/images/header-imgae03.html?upper=A7A73F&amp;lower=77773F') no-repeat bottom center; }
--></style>
</head>
<body>
<div id="page">

<div class="aisTopBar">
	<form method="get" id="searchform" action="http://adventuresinsoftware.com/blog/">
<div>
<a href="indexd784.html?feed=rss2"><img src="../images/feed-icon-28x28.png" border="0"></a>
<input type="text" value="" name="s" id="s" />
<input type="submit" id="searchsubmit" value="Search" />
</div>
</form>
</div>

<div class="aisHeaderImageRight">
	<div class="aisHeaderImage">
	<div class="aisHeaderCornerRight">
	<div class="aisHeaderCornerLeft">
	<div class="aisImageBar">
	<div class="aisSubSites">
		<a href="index.html" class="aisSubSiteLink"><span class="aisSiteTabRight"><span class="aisSiteTabLeft"><span class="aisSiteTab">
			home</span></span></span></a>
		<a class="aisSubSiteLink" href="indexb60a.html?cat=27"><span class="aisSiteTabRight"><span class="aisSiteTabLeft"><span class="aisSiteTab">
			historic modeling</span></span></span></a>
		<a class="aisSubSiteLink" href="indexa88f.html?cat=36"><span class="aisSiteTabRight"><span class="aisSiteTabLeft"><span class="aisSiteTab">
			update controls</span></span></span></a>
		<a href="index2d79.html?cat=26" class="aisSubSiteLink"><span class="aisSiteTabRight"><span class="aisSiteTabLeft"><span class="aisSiteTab">
			degrees of freedom</span></span></span></a>
		<a class="aisSubSiteLink" href="indexba53.html?page_id=2"><span class="aisSiteTabRight"><span class="aisSiteTabLeft"><span class="aisSiteTab">
			about us</span></span></span></a>

	</div>
	</div>
	</div>
	</div>
	</div>
</div>

<table style="width: 100%" cellspacing="0" cellpadding="0">
	<tr valign="top">
		<td width="210px">
<div id="sidebar">
<div class="aisLeftColumnFill">
<div class="aisLeftColumnBottom">
<div class="aisLeftColumnTop">
<div id="twitter_div" class="aisLeftNav">
<h2 class="sidebar-title">Twitter Updates</h2>
<ul id="twitter_update_list"></ul>
<a href="http://twitter.com/michaellperry" id="follow">Follow me</a>
</div>
<div id="twitter_reply_div" class="aisLeftNav">
<h2 class="sidebar-title">Twitter Replies</h2>
<ul id="twitter_reply_list"></ul>
</div>

<div class="aisLeftNav">
<a href='http://ineta.org/Speakers/SearchCommunitySpeakers.aspx?SpeakerId=c5110e21-9243-461b-a464-a6548524e885'><img alt='INETA Community Speakers Program' border='0' src='../../www.ineta.org/images/OfficialLogos/InetaCommunitySpeakersRequestMe.html' /></a>
</div>

<div class="aisLeftNav">
	<li class="pagenav"><h2>Pages</h2><ul><li class="page_item page-item-2"><a href="indexba53.html?page_id=2" title="About Us">About Us</a></li>
<li class="page_item page-item-210"><a href="index6ae3.html?page_id=210" title="Templates">Templates</a></li>
</ul></li></div>

<div class="aisLeftNav">
<h2>Archives</h2>
<ul>
	<li><a href='indexb4d5.html?m=201110' title='October 2011'>October 2011</a></li>
	<li><a href='indexc61a.html?m=201106' title='June 2011'>June 2011</a></li>
	<li><a href='indexa80d.html?m=201105' title='May 2011'>May 2011</a></li>
	<li><a href='index512b.html?m=201104' title='April 2011'>April 2011</a></li>
	<li><a href='index08fb.html?m=201103' title='March 2011'>March 2011</a></li>
	<li><a href='index52f4.html?m=201102' title='February 2011'>February 2011</a></li>
	<li><a href='index74f1.html?m=201101' title='January 2011'>January 2011</a></li>
	<li><a href='index8956.html?m=201012' title='December 2010'>December 2010</a></li>
	<li><a href='indexa1aa.html?m=201011' title='November 2010'>November 2010</a></li>
	<li><a href='indexe3d5.html?m=201010' title='October 2010'>October 2010</a></li>
	<li><a href='index9ab9.html?m=201009' title='September 2010'>September 2010</a></li>
	<li><a href='index1ff0.html?m=201008' title='August 2010'>August 2010</a></li>
	<li><a href='index9f11.html?m=201007' title='July 2010'>July 2010</a></li>
	<li><a href='index31f0.html?m=201006' title='June 2010'>June 2010</a></li>
	<li><a href='indexd189.html?m=201005' title='May 2010'>May 2010</a></li>
	<li><a href='indexb5c0.html?m=201004' title='April 2010'>April 2010</a></li>
	<li><a href='indexf258.html?m=201003' title='March 2010'>March 2010</a></li>
	<li><a href='index6e30.html?m=201002' title='February 2010'>February 2010</a></li>
	<li><a href='index6b19.html?m=201001' title='January 2010'>January 2010</a></li>
	<li><a href='index5c0a.html?m=200912' title='December 2009'>December 2009</a></li>
	<li><a href='index8f62.html?m=200911' title='November 2009'>November 2009</a></li>
	<li><a href='index451d.html?m=200910' title='October 2009'>October 2009</a></li>
	<li><a href='index3e04.html?m=200909' title='September 2009'>September 2009</a></li>
	<li><a href='index425a.html?m=200908' title='August 2009'>August 2009</a></li>
	<li><a href='index9907.html?m=200907' title='July 2009'>July 2009</a></li>
	<li><a href='index3104.html?m=200906' title='June 2009'>June 2009</a></li>
	<li><a href='indexc36d.html?m=200905' title='May 2009'>May 2009</a></li>
	<li><a href='index17e8.html?m=200904' title='April 2009'>April 2009</a></li>
	<li><a href='index10a5.html?m=200903' title='March 2009'>March 2009</a></li>
	<li><a href='index8988.html?m=200902' title='February 2009'>February 2009</a></li>
	<li><a href='index1419.html?m=200901' title='January 2009'>January 2009</a></li>
	<li><a href='index7866.html?m=200812' title='December 2008'>December 2008</a></li>
	<li><a href='index55f6.html?m=200811' title='November 2008'>November 2008</a></li>
	<li><a href='indexa7bc.html?m=200810' title='October 2008'>October 2008</a></li>
	<li><a href='indexe77c.html?m=200809' title='September 2008'>September 2008</a></li>
	<li><a href='indexcffc.html?m=200808' title='August 2008'>August 2008</a></li>
	<li><a href='index0e62.html?m=200807' title='July 2008'>July 2008</a></li>
	<li><a href='indexfda7.html?m=200806' title='June 2008'>June 2008</a></li>
	<li><a href='index7d64.html?m=200805' title='May 2008'>May 2008</a></li>
	<li><a href='index94dd.html?m=200804' title='April 2008'>April 2008</a></li>
	<li><a href='index9631.html?m=200803' title='March 2008'>March 2008</a></li>
	<li><a href='indexdd52.html?m=200802' title='February 2008'>February 2008</a></li>
	<li><a href='index21ee.html?m=200801' title='January 2008'>January 2008</a></li>
	<li><a href='index363c.html?m=200712' title='December 2007'>December 2007</a></li>
	<li><a href='index7493.html?m=200711' title='November 2007'>November 2007</a></li>
	<li><a href='index93a7.html?m=200710' title='October 2007'>October 2007</a></li>
	<li><a href='index4ca8.html?m=200709' title='September 2007'>September 2007</a></li>
	<li><a href='index6124.html?m=200708' title='August 2007'>August 2007</a></li>
	<li><a href='index6013.html?m=200707' title='July 2007'>July 2007</a></li>
	<li><a href='index2ab6.html?m=200706' title='June 2007'>June 2007</a></li>
	<li><a href='index44f0.html?m=200705' title='May 2007'>May 2007</a></li>
	<li><a href='indexf0b4.html?m=200704' title='April 2007'>April 2007</a></li>
	<li><a href='index481d.html?m=200703' title='March 2007'>March 2007</a></li>
	<li><a href='indexcbea.html?m=200702' title='February 2007'>February 2007</a></li>
	<li><a href='index9cdc.html?m=200701' title='January 2007'>January 2007</a></li>
	<li><a href='index3ea4.html?m=200612' title='December 2006'>December 2006</a></li>
	<li><a href='index67ca.html?m=200611' title='November 2006'>November 2006</a></li>
	<li><a href='indexff49.html?m=200610' title='October 2006'>October 2006</a></li>
	<li><a href='index611c.html?m=200609' title='September 2006'>September 2006</a></li>
	<li><a href='index9a21.html?m=200608' title='August 2006'>August 2006</a></li>
	<li><a href='index3ee9.html?m=200607' title='July 2006'>July 2006</a></li>
	<li><a href='indexe13a.html?m=200606' title='June 2006'>June 2006</a></li>
</ul>
</div>

<div class="aisLeftNav">
			<li id="linkcat-16" class="linkcat"><h2>Blogroll</h2>
	<ul>
<li><a href="http://ayende.com/Blog">Ayende Rahien</a></li>
<li><a href="http://www.softinsight.com/bnoyes/default.aspx">Brian Noyes</a></li>
<li><a href="http://chriskoenig.net/">Chris Koenig</a></li>
<li><a href="http://scienceblogs.com/goodmath/" title="MarkCC reveals the beauty in mathematics and exposes its misuse.">Good Math, Bad Math</a></li>
<li><a href="http://joshsmithonwpf.wordpress.com/">Josh Smith on WPF</a></li>
<li><a href="http://west-wind.com/Weblog/default.aspx">Rick Strahl</a></li>
<li><a href="http://www.udidahan.com/?blog=true">Udi Dahan</a></li>

	</ul>
</li>
<li id="linkcat-17" class="linkcat"><h2>Links</h2>
	<ul>
<li><a href="http://www.absg.com/" title="my day job">ABSG</a></li>
<li><a href="http://www.d20universe.com/" title="my friends boostrap">d20 Universe</a></li>
<li><a href="http://updatecontrols.net/" title="my open source project">Update Controls .NET</a></li>

	</ul>
</li>
<li id="linkcat-32" class="linkcat"><h2>Podroll</h2>
	<ul>
<li><a href="http://dotnetrocks.com/" title="Interviews with leaders in the .NET community.">.NET Rocks!</a></li>
<li><a href="http://hanselminutes.com/" title="News and interviews from all aspects of software, with an insider&#039;s view of Microsoft.">Hanselminutes</a></li>

	</ul>
</li>
	</div>

<div class="aisLeftNav">
<h2>Books</h2>
<iframe src="http://rcm.amazon.com/e/cm?t=adventures0d2-20&amp;o=1&amp;p=8&amp;l=as1&amp;asins=0764526413&amp;fc1=000000&amp;IS2=1&amp;lt1=_blank&amp;lc1=0000ff&amp;bc1=000000&amp;bg1=ffffff&amp;f=ifr" style="width:120px;height:240px;" scrolling="no" marginwidth="0" marginheight="0" frameborder="0" name="I5" id="I5"></iframe>
<br/>
<iframe src="http://rcm.amazon.com/e/cm?t=adventures0d2-20&amp;o=1&amp;p=8&amp;l=as1&amp;asins=0201633612&amp;fc1=000000&amp;IS2=1&amp;lt1=_blank&amp;lc1=0000ff&amp;bc1=000000&amp;bg1=ffffff&amp;f=ifr" style="width:120px;height:240px;" scrolling="no" marginwidth="0" marginheight="0" frameborder="0" name="I6" id="I6"></iframe>
<br/>
<iframe src="http://rcm.amazon.com/e/cm?t=adventures0d2-20&amp;o=1&amp;p=8&amp;l=as1&amp;asins=0136291554&amp;fc1=000000&amp;IS2=1&amp;lt1=_blank&amp;lc1=0000ff&amp;bc1=000000&amp;bg1=ffffff&amp;f=ifr" style="width:120px;height:240px;" scrolling="no" marginwidth="0" marginheight="0" frameborder="0" name="I7" id="I7"></iframe>
<br/>
<iframe src="http://rcm.amazon.com/e/cm?t=adventures0d2-20&amp;o=1&amp;p=8&amp;l=as1&amp;asins=1888009195&amp;fc1=000000&amp;IS2=1&amp;lt1=_blank&amp;lc1=0000ff&amp;bc1=000000&amp;bg1=ffffff&amp;f=ifr" style="width:120px;height:240px;" scrolling="no" marginwidth="0" marginheight="0" frameborder="0" name="I8" id="I8"></iframe>
</div>
<div class="aisLeftNav">
<h2>Meta</h2>
<ul>
		<li><a href="wp-login.html">Login</a></li>
	<li><a href="http://validator.w3.org/check/referer" title="This page validates as XHTML 1.0 Transitional">Valid <abbr title="eXtensible HyperText Markup Language">XHTML</abbr></a></li>
	<li><a href="http://gmpg.org/xfn/"><abbr title="XHTML Friends Network">XFN</abbr></a></li>
	<li><a href="http://wordpress.org/" title="Powered by WordPress, state-of-the-art semantic personal publishing platform.">WordPress</a></li>
	</ul>
</div>
<div class="aisLeftContent">
<h2>Community</h2>
<ul>
	<script type="text/javascript" src="../../localhost/embed/92q2bbma.js"></script>
</ul>
</div>

</div></div></div>
</div>		</td>
		<td>

	<div id="content" class="narrowcolumn">

	
		
			<div class="post" id="post-64">
				<h2><a href="index8cd4.html?p=64" rel="bookmark" title="Permanent Link to MySQL row_count() is Broken">MySQL row_count() is Broken</a></h2>
				<small>December 6th, 2006 <!-- by Michael L Perry --></small>

				<div class="entry">
					<p>Like most other SQL-based relational database engines, MySQL provides a mechanism to get the number of rows affected by the last operation. In MySQL, it is the row_count() function. This function is useful for implementing a number of patterns, including the "update/insert" pattern (or "upsert" as it is sometimes known).</p>
<p>It is often necessary to have one procedure that inserts a row if it doesn't yet exist, or update it if it does. There are several ways to accomplish this. You could SELECT first to determine whether it exists, then UPDATE or INSERT based on the result. However, this is not the most efficient mechanism, and may even result in consistency problems or deadlocking depending upon the agressiveness of the RDBMS locking mechanism. A faster and safer approach is the update/insert pattern.</p>
<p>In an update/insert procedure, you attempt an UPDATE statement to modify the desired records. Then you check row_count() to see if any rows were affected. If the records did not previously exist, row_count() would return 0. In that case, you would INSERT.</p>
<p>Unfortunately, the MySQL implementation of row_count() does not support this pattern. Whereas most RDBMS engines count the number of rows matched, MySQL does not count records that haven't actually changed during an UPDATE statement.</p>
<p>Try this experiment. Create a table:</p>
<pre>mysql&gt; create table rcbroke
(rcbroke_id int auto_increment not null primary key,
val int not null default 0,
create_date datetime not null,
modify_date timestamp not null);
Query OK, 0 rows affected (0.08 sec)</pre>
<p>Insert a couple of rows.</p>
<pre>mysql&gt; insert into rcbroke (create_date) values (NOW());
Query OK, 1 row affected (0.03 sec)

mysql&gt; insert into rcbroke (create_date) values (NOW());
Query OK, 1 row affected (0.03 sec)

mysql&gt; select * from rcbroke;
+------------+-----+---------------------+---------------------+
| rcbroke_id | val | create_date         | modify_date         |
+------------+-----+---------------------+---------------------+
|          1 |   0 | 2006-12-06 10:27:27 | 2006-12-06 10:27:27 |
|          2 |   0 | 2006-12-06 10:27:30 | 2006-12-06 10:27:30 |
+------------+-----+---------------------+---------------------+
2 rows in set (0.00 sec)</pre>
<p>Now update one of those rows, setting the value that it already contains. Select row_count() to see if the matching row is counted.</p>
<pre>mysql&gt; update rcbroke set val=0 where rcbroke_id=1; select row_count();
Query OK, 0 rows affected (0.00 sec) Rows matched: 1  Changed: 0  Warnings: 0

+-------------+
| row_count() |
+-------------+
|           0 |
+-------------+
1 row in set (0.00 sec)</pre>
<p>Notice that MySQL reports one row matched, but no rows changed. For the update/insert pattern (and most other useful SQL patterns), we are most interested in the rows matched, but row_count() returns the number of rows changed.</p>
<p>But our test table contains a Timestamp column, which is automatically updated when a row changes. Surely, MySQL has set the timestamp for us. Sorry, but no...</p>
<pre>mysql&gt; select * from rcbroke;
+------------+-----+---------------------+---------------------+
| rcbroke_id | val | create_date         | modify_date         |
+------------+-----+---------------------+---------------------+
|          1 |   0 | 2006-12-06 10:27:27 | 2006-12-06 10:27:27 |
|          2 |   0 | 2006-12-06 10:27:30 | 2006-12-06 10:27:30 |
+------------+-----+---------------------+---------------------+
2 rows in set (0.00 sec)</pre>
<p>If we change the value of a column, then row_count() works correctly.</p>
<pre>mysql&gt; update rcbroke set val=1 where rcbroke_id=1; select row_count();
Query OK, 1 row affected (0.02 sec) Rows matched: 1  Changed: 1  Warnings: 0

+-------------+
| row_count() |
+-------------+
|           1 |
+-------------+
1 row in set (0.00 sec)</pre>
<p>And the modify_date is automatically changed for us.</p>
<pre>mysql&gt; select * from rcbroke;
+------------+-----+---------------------+---------------------+
| rcbroke_id | val | create_date         | modify_date         |
+------------+-----+---------------------+---------------------+
|          1 |   1 | 2006-12-06 10:27:27 | 2006-12-06 10:28:35 |
|          2 |   0 | 2006-12-06 10:27:30 | 2006-12-06 10:27:30 |
+------------+-----+---------------------+---------------------+
2 rows in set (0.00 sec)</pre>
<p><strong>Here's my solution</strong><br />
The Timestamp column is our saving grace, although it may as well be a regular Datetime column for all it's worth. If we explicitly update modify_date to the current time, MySQL will count that row as changed. There is still a small chance that we might call the UPDATE twice within the same Timestamp granularity, but that chance is small enough to live with in most scenarios.</p>
<pre>mysql&gt; update rcbroke set val=1, modify_date=NOW() where rcbroke_id=1; select row_count();
Query OK, 1 row affected (0.02 sec) Rows matched: 1  Changed: 1  Warnings: 0

+-------------+
| row_count() |
+-------------+
|           1 |
+-------------+

1 row in set (0.00 sec)mysql&gt; select * from rcbroke;
+------------+-----+---------------------+---------------------+
| rcbroke_id | val | create_date         | modify_date         |
+------------+-----+---------------------+---------------------+
|          1 |   1 | 2006-12-06 10:27:27 | 2006-12-06 10:29:12 |
|          2 |   0 | 2006-12-06 10:27:30 | 2006-12-06 10:27:30 |
+------------+-----+---------------------+---------------------+
2 rows in set (0.00 sec)</pre>
<p>This is the closest we can get to correct behavior of MySQL's row_count(). Even though it may return the correct "number of rows affected" by one interpretation of the SQL spec, I see no valid use for the function as defined.</p>
				</div>

				<p class="postmetadata">Posted in <a href="indexc728.html?cat=7" title="View all posts in Databases" rel="category">Databases</a> |   <a href="index8cd4.html?p=64#comments" title="Comment on MySQL row_count() is Broken">4 Comments &#187;</a></p>
			</div>

		
			<div class="post" id="post-63">
				<h2><a href="index2cce.html?p=63" rel="bookmark" title="Permanent Link to Episode 3: Identity">Episode 3: Identity</a></h2>
				<small>December 5th, 2006 <!-- by Michael L Perry --></small>

				<div class="entry">
					<p><a href="http://media.libsyn.com/media/ais/AiS3.mp3">Listen Now</a></p>
<p>Michael, Raymond, and Charles discuss the fundamental law of object -oriented programming: identity.</p>
<p><a href="http://en.wikipedia.org/wiki/James_Rumbaugh">James Rumbaugh</a>, <a title="Michael Blaha" class="new" href="http://en.wikipedia.org/w/index.php?title=Michael_Blaha&amp;action=edit">Michael Blaha</a>, <a title="William Premerlani" class="new" href="http://en.wikipedia.org/w/index.php?title=William_Premerlani&amp;action=edit">William Premerlani</a>, <a title="Frederick Eddy" class="new" href="http://en.wikipedia.org/w/index.php?title=Frederick_Eddy&amp;action=edit">Frederick Eddy</a>, <a title="William Lorensen" class="new" href="http://en.wikipedia.org/w/index.php?title=William_Lorensen&amp;action=edit">William Lorensen</a>: <em>Object-Oriented Modeling and Design</em>, Prentice Hall, <a class="internal" href="http://en.wikipedia.org/w/index.php?title=Special:Booksources&amp;isbn=0136298419">ISBN 0-13-629841-9</a></p>
<p><a href="http://en.wikipedia.org/wiki/Identity_(object-oriented_programming)">http://en.wikipedia.org/wiki/Identity_%28object-oriented_programming%29</a></p>
				</div>

				<p class="postmetadata">Posted in <a href="indexb0b7.html?cat=6" title="View all posts in Patterns" rel="category">Patterns</a>,  <a href="indexb5e7.html?cat=15" title="View all posts in Shows" rel="category">Shows</a> |   <a href="index2cce.html?p=63#respond" title="Comment on Episode 3: Identity">No Comments &#187;</a></p>
			</div>

		
			<div class="post" id="post-62">
				<h2><a href="index5c36.html?p=62" rel="bookmark" title="Permanent Link to Constant Contact, a Browser-Based Business Service">Constant Contact, a Browser-Based Business Service</a></h2>
				<small>December 4th, 2006 <!-- by Michael L Perry --></small>

				<div class="entry">
					<p>My wife runs a scrapbooking business (<a href="http://myscraproom.net/">http://myscraproom.net</a>). She uses the Internet to keep in touch with her customers. Yesterday she started using Constant Contact (<a href="http://www.constantcontact.com/">http://www.constantcontact.com</a>), a service that sends out beautifully presented form letters to her email subscribers (opt-in only; they don't believe in spam). She was very happy with the newsletter editing and management capabilities of this service. But when it came time to import her distribution list, she got quite upset.</p>
<p>The service has a feature to import distribution lists via CSV or Excel. Her distribution list is in Outlook 2000. You would think that moving that distribution list over would be a supported use-case. However, niether Outlook nor Constant Contact made this easy.</p>
<p>At first, I showed her how to export contacts to CSV. We walked through the export wizard until it got to the screen where you chose your contact folder. The My Scrap Room distribution list did not appear as an option. The screen lists only folders, not distribution lists.</p>
<p>So I suggested she export all of her contacts to CSV and sort them out at the site. She did that, uploaded the CSV to the site, and was presented with a long ugly screen that asked her to individually format each contact. There was no option on this screen to select which ones to import and which to ignore.</p>
<p>So my next suggestion was that we edit the CSV file before uploading. I won't describe how upset she got when we opened the CSV in notepad and she saw the jumbled mess that I was asking her to sift through. Trying the same thing in Excel only provided a slightly better presentation of the same junk.</p>
<p>She has since entered her distribution list by hand, cursing the state of software the whole time. This was particularly embarrasing to me, since I am constantly telling her (and everybody else) how much better it could be. You would think that Constant Contact would consider importing an Outlook distribution list to be a primary use-case. They imply that it is when they claim to "easily import permission-based email lists from your contact management software, MS Outlook® or spreadsheet". In practice, though, their support for Outlook is limited to CSV.</p>
<p>Microsoft, of course, has their share of the blame. There is no way in Outlook 2000 to export a distribution list to CSV. I don't know if this has been added in later versions, as I tend to keep my wife's machine on a very slow upgrade cycle. But even at the time that Outlook 2000 was developed, this should have been an obvious feature.</p>
<p>The bulk of the blame, however, goes to browser-based services in general. When a browser is between your service and your customers, you cannot integrate with their data and applications. A rich client could have easily used the Outlook API to extract email addresses without going through the export/import mess. The Web has brought us an amazing array of services, but has also set the state of user interaction back 15 years. Even now, Web 2.0 is struggling to catch back up to what is trivial on the desktop. Sure, the browser is fine for less intimate contact, like buying a book, but software that helps you run your business deserves a rich client.</p>
				</div>

				<p class="postmetadata">Posted in <a href="indexd65e.html?cat=8" title="View all posts in User Interface" rel="category">User Interface</a> |   <a href="index5c36.html?p=62#comments" title="Comment on Constant Contact, a Browser-Based Business Service">2 Comments &#187;</a></p>
			</div>

		
			<div class="post" id="post-61">
				<h2><a href="index094d.html?p=61" rel="bookmark" title="Permanent Link to The Work Queue Pattern">The Work Queue Pattern</a></h2>
				<small>November 30th, 2006 <!-- by Michael L Perry --></small>

				<div class="entry">
					<p>In each of the Enterprise systems I've worked on, we've had background processes to massage data. They could be report aggregators, media renderers, or message processors. The features that they have in common are:</p>
<ul>
<li>Work items may not be lost.</li>
<li>Work must not be interrupted.</li>
<li>Work items are independent of one-another.</li>
<li>Work items may not be repeated.</li>
</ul>
<p>The pattern that best implements these features is a work queue. A work queue has a publish-subscribe queue of work items serviced by redundant processors. The durability of the queue ensures that work items are not lost. Processors are allowed to work in parallel since work items are independent. That redundancy ensures that work continues even if a processor goes down. And proper use of the queue ensures that no two processors get the same work item.</p>
<p>This problem could be solved with JMS or MSMQ, but in my experience these solutions imposed undesirable requirements. JMS marries your code to J2EE, while MSMQ requires a Microsoft server environment. I prefer to keep my options open. Fortunately, it is not difficult to implement a work queue directly in the database of your choice.</p>
<p><span style="font-weight: bold">Here's my solution</span><br />
First you have to define a work queue table. In addition to columns that describe the work to be done, this table must also have a column that identifies the processor that is performing the work. A foreign key to a processor table works well. The processor table has a primary key (the processor ID) and the name of the machine running the process.</p>
<p>When a processor is ready to perform some work, it must query the work queue table twice. First it looks for any available work item, and then it ensures that no other processor has claimed that work item. This two-step query is the most effective way I've found to detect and resolve collisions let me explain in more detail.</p>
<p>The first query is performed with the transaction isolation level set to "read uncommitted". This allows the query to see any work queue items that are currently being claimed. The result of this query is the work item ID that the processor will try to claim for itself.</p>
<pre>SET TRANSACTION ISOLATION LEVEL READ UNCOMMITTED;
SET @id = (SELECT WorkItemID FROM WorkQueue WHERE ProcessorID=NULL);</pre>
<p>The second query is performed with the standard transaction isolation level of "read committed". It both locks the record and verifies that the work has not yet been claimed.</p>
<pre>SET TRANSACTION ISOLATION LEVEL READ COMMITTED;
SELECT ProcessorID FROM WorkQueue (UPDATE) WHERE WorkItemID=@id;</pre>
<p>If the row is found and the processor ID comes back NULL, then you know that the work has not yet been claimed. You may now update the ProcessorID and commit the transaction.</p>
<p>However, if the row is not found, then the work has already been completed and deleted from the queue. If the processor ID is not NULL, then a collision has occurred. Another processor is already busy working on that item. So you just commit your transaction and try again.</p>
<p>It took several days of trial-and-error to get the pattern right the first time. But now that I have it, it is easy to create a work queue without the overhead of JMS or MSMQ.</p>
				</div>

				<p class="postmetadata">Posted in <a href="indexc728.html?cat=7" title="View all posts in Databases" rel="category">Databases</a>,  <a href="indexb0b7.html?cat=6" title="View all posts in Patterns" rel="category">Patterns</a>,  <a href="indexb31a.html?cat=1" title="View all posts in Uncategorized" rel="category">Uncategorized</a> |   <a href="index094d.html?p=61#respond" title="Comment on The Work Queue Pattern">No Comments &#187;</a></p>
			</div>

		
			<div class="post" id="post-60">
				<h2><a href="index0721.html?p=60" rel="bookmark" title="Permanent Link to Episode 2: Design Patterns">Episode 2: Design Patterns</a></h2>
				<small>November 28th, 2006 <!-- by Michael L Perry --></small>

				<div class="entry">
					<p><a href="http://media.libsyn.com/media/ais/AiS2.mp3">Listen to the show</a></p>
<p>Charles Martin returns (<a href="http://webcudgel.com/">http://webcudgel.com</a>) and Raymond Jensen joins in (<a href="http://jensensoftware.com/">http://jensensoftware.com</a>).</p>
<ol>
<li>Erich Gamma, et al. Design Patterns. a.k.a. Gang of Four: <a href="http://en.wikipedia.org/wiki/Design_Patterns">http://en.wikipedia.org/wiki/Design_Patterns</a></li>
<li>Martin Fowler. Patterns of Enterprise Application Architecture: <a href="http://en.wikipedia.org/wiki/Martin_Fowler">http://en.wikipedia.org/wiki/Martin_Fowler</a></li>
<li>Stelting and Maassen. Applied Java Patterns.</li>
<li>Steven John Metsker. Design Patterns in C#.</li>
<li>Ron Jacobs. ARCast. Patterns and Anti-Patterns for SOA. <a href="http://arcast.net/">http://arcast.net</a></li>
<li><a href="http://www.codeproject.com/">http://www.codeproject.com/</a></li>
<li>Microsoft Patterns and Practices. <a href="http://msdn.microsoft.com/practices/">http://msdn.microsoft.com/practices/</a></li>
<li><a href="http://www.patternshare.org/">http://www.patternshare.org/</a></li>
</ol>
				</div>

				<p class="postmetadata">Posted in <a href="indexb0b7.html?cat=6" title="View all posts in Patterns" rel="category">Patterns</a>,  <a href="indexb5e7.html?cat=15" title="View all posts in Shows" rel="category">Shows</a> |   <a href="index0721.html?p=60#respond" title="Comment on Episode 2: Design Patterns">No Comments &#187;</a></p>
			</div>

		
			<div class="post" id="post-59">
				<h2><a href="index1098.html?p=59" rel="bookmark" title="Permanent Link to Indexes in the File System">Indexes in the File System</a></h2>
				<small>November 26th, 2006 <!-- by Michael L Perry --></small>

				<div class="entry">
					<p>The Windows file system has become a jumble of mixed concerns. What started out as a way of organizing information hierarchically has mutated into something that second-guesses users at every turn.</p>
<p>Case in point. I finished building my wife's new machine and started copying photos from mine. I left the process running for a while, then went back to my machine to check on its progress. I found a message on the screen asking if I would like to overwrite the file "Thumbs.db". As Alan Cooper says, the computer had gone stupid. Instead of doing something useful, like continuing to copy the files that it could, it stopped and waited for someone who wasn't there to answer a dumb question.</p>
<p>This, of course, happened because Windows creates an index file whenever you switch to thumbnail view. Her machine had the folder open in thumbnail view so that we could verify that the pictures were indeed being copied. So her machine created an index file, and my machine tried to push a new one to it.</p>
<p>The root of the problem is that the OS is using my file system for something other than my files. My intent is to store pictures in this folder, but the OS throws something else in for its own purpose. Who does this folder belong to, anyway?</p>
<p>There are plenty of other examples of this. When you edit a Word document, the program creates a temporary tilde file in the same folder. This is used as a workspace while the program runs, and as a restore point if the program crashes. I once made the mistake of editing a Word document directly on a floppy disk (yes, it was that long ago) and removing the disk while editing. The program crashed soon afterward and the disk was left in an unusable state. I intended to put the disk back in prior to saving, but Word was using it for its own purposes.</p>
<p>Some source code control systems also exhibit this behavior. Visual Source Safe puts index files in all of your working folders. Subversion creates an entire subdirectory called .svn in each working folder. This makes it impossible to just check out a snapshot of the project, say for an automated build, and get a pristine copy. Or to check out of one branch in order to check into another. And what if, for some strange reason, a folder named .svn was actually part of my project?</p>
<p><strong>Here's my solution</strong><br />
Just use your own database for information about a user's files. Leave the  file system alone. That belongs to the user.</p>
<p>Or better yet, put the user's documents into your database, too. The file system is just a confusing jumble of metaphors for the average user. The less they have to see it, the better their experience will be.</p>
<p>But in any case, don't put indexes in the file system.</p>
				</div>

				<p class="postmetadata">Posted in <a href="indexd65e.html?cat=8" title="View all posts in User Interface" rel="category">User Interface</a>,  <a href="indexaa1e.html?cat=4" title="View all posts in VSS" rel="category">VSS</a> |   <a href="index1098.html?p=59#respond" title="Comment on Indexes in the File System">No Comments &#187;</a></p>
			</div>

		
			<div class="post" id="post-57">
				<h2><a href="index9787.html?p=57" rel="bookmark" title="Permanent Link to The Single-Queue Dispatcher Pattern">The Single-Queue Dispatcher Pattern</a></h2>
				<small>November 25th, 2006 <!-- by Michael L Perry --></small>

				<div class="entry">
					<p>Today is Black Friday in the States: the day after Thanksgiving when the Christmas shopping season officially begins. I usually try to avoid stores on this day, but my wife needs a new PC, so we went to Fry's.</p>
<p>There was quite a crowd there as we were picking out components, but the experience was incredible. They had extra staff helping customers on the floor, and even more manning the registers. The line moved quickly and smoothly due to their excellent planning.</p>
<p>The system that Fry's uses is a single queue. One person stands at the head of the queue and dispatches customers to multiple registers. Unlike a grocery store, with its one queue per register, this system doesn't force you to chose your server prior to getting in line. Have you ever gotten behind the person with three price-checks only to see the people who queued up after you served first in the next line? That won't happen at Fry's.</p>
<p>The single-queue solution is so simple and elegant that it is my favorite parallel-service software pattern. It is applicable any time you have units of work concurrently flowing into a system, when those units of work are independent. Examples I've seen include HTTP requests, financial transactions, and remote procedure calls.</p>
<p>This pattern has three components. First is the queue, which holds units of work. Second is the dispatcher, which draws units of work from the queue. Third is the pool, which holds the processors to which the dispatcher assigns work.</p>
<p>The queue is a thread-safe container. It may be implemented in memory if it is OK for work items to be lost (e.g. HTTP requests, which will be retried). Or it may be implemented in a database if work items cannot be lost (e.g. financial transactions).</p>
<p>The dispatcher is a single thread in a tight loop. It blocks on the queue until a unit of work is available, then it blocks on the pool until a processor can be allocated. More sophisticated dispatchers may even grow and shrink the pool based on demand.</p>
<p>The pool is another thread-safe collection, this one of processors. A processor carries with it the resources it needs to do the work, such as threads or database connections. Allocation of these resources can be expensive, so processors are returned to the pool with their resource intact. Usually the pool is implemented as a stack, so that a small number of processors will be kept as busy as possible. Processors that sink to the bottom of the pool will go stale, and will be the first to be reclaimed by a sophisticated dispatcher.</p>
<p>This pattern is supported by Berkley Sockets. The accept() function blocks on a queue within the TCP/IP stack. The ideal use of this function is for a dispatcher thread to call it in a tight loop and allocate the sockets it returns to threads in a pool.</p>
<p>This pattern is implemented in .NET's ThreadPool. The QueueUserWorkItem method places a unit of work into a managed queue, and the .NET Framework dispatches that work to a pooled thread for processing.</p>
<p>There are countless other implementations of this pattern, from JMS to MSMQ. But even if one of these solutions is more than you need, you can implement the pattern yourself. It is simple, efficient, and effective.</p>
				</div>

				<p class="postmetadata">Posted in <a href="indexb0b7.html?cat=6" title="View all posts in Patterns" rel="category">Patterns</a> |   <a href="index9787.html?p=57#respond" title="Comment on The Single-Queue Dispatcher Pattern">No Comments &#187;</a></p>
			</div>

		
			<div class="post" id="post-56">
				<h2><a href="index2dc8.html?p=56" rel="bookmark" title="Permanent Link to Episode 1: User Interface Design">Episode 1: User Interface Design</a></h2>
				<small>November 21st, 2006 <!-- by Michael L Perry --></small>

				<div class="entry">
					<p><a href="http://media.libsyn.com/media/ais/AiS01.mp3">Download the show</a></p>
<p>Michael is joined by special guest Charles Martin, a web designer who blogs at <a href="http://www.adventuresinsoftware.com/blog/at http://www.webcudgel.com">http://www.webcudgel.com</a>. We discuss user interaction design as described in <a href="http://www.cooper.com/content/insights/cooper_books.asp">Alan Cooper's About Face 2.0: The essentials of interaction design</a>. We talk about a poor user interface that we both worked on in the past, as well as a good one in the <a href="http://hamachi.cc/">Hamachi VPN</a>. We round out the conversation with a comparison of Windows vs. Mac.</p>
				</div>

				<p class="postmetadata">Posted in <a href="indexb5e7.html?cat=15" title="View all posts in Shows" rel="category">Shows</a>,  <a href="indexd65e.html?cat=8" title="View all posts in User Interface" rel="category">User Interface</a> |   <a href="index2dc8.html?p=56#respond" title="Comment on Episode 1: User Interface Design">No Comments &#187;</a></p>
			</div>

		
			<div class="post" id="post-55">
				<h2><a href="index8054.html?p=55" rel="bookmark" title="Permanent Link to You are Invited to a Talk Cast">You are Invited to a Talk Cast</a></h2>
				<small>November 16th, 2006 <!-- by Michael L Perry --></small>

				<div class="entry">
					<p>Please sign up for a TalkShoe account, then come join me for a <a href="http://www.talkshoe.com/talkshoe/web/talkCast.jsp?masterId=6136">talk cast</a>. We will start on Monday, November 20, at 9 PM Central (GMT-6). I'll host a 20-30 minute show every Monday, and post the high-quality audio for listening on-line or downloading for later.</p>
<p>This week, we will discuss user interface design. We will draw from Alan Cooper's book and personal experience. Come participate.</p>
				</div>

				<p class="postmetadata">Posted in <a href="index49ce.html?cat=14" title="View all posts in Talk cast" rel="category">Talk cast</a> |   <a href="index8054.html?p=55#comments" title="Comment on You are Invited to a Talk Cast">3 Comments &#187;</a></p>
			</div>

		
			<div class="post" id="post-54">
				<h2><a href="indexcc0f.html?p=54" rel="bookmark" title="Permanent Link to Data Aggregation for Reporting">Data Aggregation for Reporting</a></h2>
				<small>November 16th, 2006 <!-- by Michael L Perry --></small>

				<div class="entry">
					<p>A good way to design an enterprise system is to separate reporting from transaction processing. This lets the two processes run independently without interfering with one another. It also allows the database designer to optimize each component for its particular use.</p>
<p>When these two concerns are separated, the data must be moved from the transaction processing side of the business into the reporting side. In the process, data should be aggregated to keep storage requirements low and to make reports run quickly. There are two ways of accomplishing this: real-time and agent-driven.</p>
<p>A real-time aggregation solution updates the aggregate records as transactions are processed. For example, a book sale transaction might update a record that keeps track of the number of books sold by author. The author's record is either inserted or updated during the book sale transaction.</p>
<p>An agent-based aggregation solution, on the other hand, calculates an aggregate in the background after many transactions. For example, a query might run once a day to insert a count of books sold by author for that day.</p>
<p>There are advantages and disadvantages to each technique. Real-time updates provide the most accurate and useful reports, but they can interfere with the main business of the system. Agent-based aggregates don't block current transactions, but they can generate large batches of data that can be hard to move. Which method is right for a given situation?</p>
<p><strong>Here's my solution</strong><br />
The best rule-of-thumb that I've found is to use the granularity as an indicator. Some aggregates are extremely coarse-grained, pulling all of the data into a small number of categories. Others are more fine, rolling up to a large number of very specific line items. Coarse-grained aggregates should be updated by a background agent, while fine-grained aggregates should be summed in real-time.</p>
<p>Coarse-grained aggregates create sums for a small set of keys. Usually, this key set is fixed, as in the categories of books or the locations of book stores. If the key set is small, then a real-time rollup would experience a lot of contention. The same small number rows would be updated many times by many concurrent threads. However, a delayed agent rollup would calculate each of those rows once by a single process. That makes the agent-based approach ideal.</p>
<p>Fine-grained aggregates create sums for a large set of keys. This key set grows over time because is based on the data itself. It might include individual books, authors, or customers. If the key set is large, a background agent would produce a large set of rows all at once. Large row sets cause problems with replication and blocking. But a real-time update would insert or modify one row at a time, leaving plenty of room for replication or blocking operations to interweave. Furthermore, if a user ID is part of the key set, collisions are extremely unlikely. User activity tends to be serialized, since one person can't usually do two things at once with the same application.</p>
<p>Separating reporting from transaction processing is an important part of an enterprise system. Consider the size of the aggregate key set when choosing how to go about moving the data.</p>
				</div>

				<p class="postmetadata">Posted in <a href="indexc728.html?cat=7" title="View all posts in Databases" rel="category">Databases</a>,  <a href="indexb0b7.html?cat=6" title="View all posts in Patterns" rel="category">Patterns</a> |   <a href="indexcc0f.html?p=54#comments" title="Comment on Data Aggregation for Reporting">1 Comment &#187;</a></p>
			</div>

		
		<div class="navigation">
			<div class="alignleft"><a href="index0f9b.html?paged=35">&laquo; Previous Entries</a></div>
			<div class="alignright"><a href="index4e08.html?paged=33">Next Entries &raquo;</a></div>
		</div>

	
	</div>
		</td>
	</tr>
</table>

<hr />
<div id="footer">
<!-- If you'd like to support WordPress, having the "powered by" link someone on your blog is the best way, it's our only promotion or advertising. -->
	<p>
		Adventures in Software is proudly powered by 
		<a href="http://wordpress.org/">WordPress</a>
		<br /><a href="indexd784.html?feed=rss2">Entries (RSS)</a>
		and <a href="indexa6da.html?feed=comments-rss2">Comments (RSS)</a>.
		<!-- 21 queries. 0.385 seconds. -->
	</p>
</div>
<script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
try {
var pageTracker = _gat._getTracker("UA-389401-3");
pageTracker._trackPageview();
} catch(err) {}</script></div>

<!-- Gorgeous design by Michael Heilemann - http://binarybonsai.com/kubrick/ -->

		<div id="sk2-footer" style="color:#FFF; background-color:#444; padding: 3px 2px 3px 2px; border-top: #888 solid 1px;">This blog is protected by <a href="http://unknowngenius.com/blog/" title="Dave">dr Dave</a>'s <strong><a href="http://unknowngenius.com/blog/wordpress/spam-karma/" title="SK2">Spam Karma 2</a></strong>: <strong>274531</strong>  Spams eaten and counting...</div><script type="text/javascript" src="replies.js"></script>
<script type="text/javascript" src="blogger.js"></script>
<script type="text/javascript" src="http://twitter.com/statuses/user_timeline/michaellperry.json?callback=twitterCallback2&amp;count=5"></script>
<script type="text/javascript" src="http://search.twitter.com/search.json?q=@michaellperry&amp;callback=twitterCallbackReplies&amp;rpp=5"></script>
</body>

<!-- Mirrored from adventuresinsoftware.com/blog/?paged=34 by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 13 Jan 2017 13:11:15 GMT -->
</html>
