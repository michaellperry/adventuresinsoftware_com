<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr">


<!-- Mirrored from adventuresinsoftware.com/blog/?cat=6 by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 13 Jan 2017 12:55:00 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- /Added by HTTrack -->
<head profile="http://gmpg.org/xfn/11">
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />

<title>Adventures in Software   &raquo; Patterns</title>

<meta name="generator" content="WordPress 2.3.3" /> <!-- leave this for stats -->

<link rel="stylesheet" href="wp-content/themes/ais2/style.css" type="text/css" media="screen" />
<link rel="alternate" type="application/rss+xml" title="Adventures in Software RSS Feed" href="indexd784.html?feed=rss2" />
<link rel="pingback" href="xmlrpc.html" />
    <script type="text/javascript">
        function onSilverlightError(sender, args) {
            var appSource = "";
            if (sender != null && sender != 0) {
              appSource = sender.getHost().Source;
            }
            
            var errorType = args.ErrorType;
            var iErrorCode = args.ErrorCode;

            if (errorType == "ImageError" || errorType == "MediaError") {
              return;
            }

            var errMsg = "Unhandled Error in Silverlight Application " +  appSource + "\n" ;

            errMsg += "Code: "+ iErrorCode + "    \n";
            errMsg += "Category: " + errorType + "       \n";
            errMsg += "Message: " + args.ErrorMessage + "     \n";

            if (errorType == "ParserError") {
                errMsg += "File: " + args.xamlFile + "     \n";
                errMsg += "Line: " + args.lineNumber + "     \n";
                errMsg += "Position: " + args.charPosition + "     \n";
            }
            else if (errorType == "RuntimeError") {           
                if (args.lineNumber != 0) {
                    errMsg += "Line: " + args.lineNumber + "     \n";
                    errMsg += "Position: " +  args.charPosition + "     \n";
                }
                errMsg += "MethodName: " + args.methodName + "     \n";
            }

            throw new Error(errMsg);
        }
    </script>

	<link rel="EditURI" type="application/rsd+xml" title="RSD" href="xmlrpc0db0.php?rsd" />
 <link rel="wlwmanifest" type="application/wlwmanifest+xml" href="wp-includes/wlwmanifest.xml" /> <style type='text/css'>
<!--#header { background: url('wp-content/themes/ais2/images/header-imgae03.html?upper=A7A73F&amp;lower=77773F') no-repeat bottom center; }
--></style>
</head>
<body>
<div id="page">

<div class="aisTopBar">
	<form method="get" id="searchform" action="http://adventuresinsoftware.com/blog/">
<div>
<a href="indexd784.html?feed=rss2"><img src="../images/feed-icon-28x28.png" border="0"></a>
<input type="text" value="" name="s" id="s" />
<input type="submit" id="searchsubmit" value="Search" />
</div>
</form>
</div>

<div class="aisHeaderImageRight">
	<div class="aisHeaderImage">
	<div class="aisHeaderCornerRight">
	<div class="aisHeaderCornerLeft">
	<div class="aisImageBar">
	<div class="aisSubSites">
		<a href="index.html" class="aisSubSiteLink"><span class="aisSiteTabRight"><span class="aisSiteTabLeft"><span class="aisSiteTab">
			home</span></span></span></a>
		<a class="aisSubSiteLink" href="indexb60a.html?cat=27"><span class="aisSiteTabRight"><span class="aisSiteTabLeft"><span class="aisSiteTab">
			historic modeling</span></span></span></a>
		<a class="aisSubSiteLink" href="indexa88f.html?cat=36"><span class="aisSiteTabRight"><span class="aisSiteTabLeft"><span class="aisSiteTab">
			update controls</span></span></span></a>
		<a href="index2d79.html?cat=26" class="aisSubSiteLink"><span class="aisSiteTabRight"><span class="aisSiteTabLeft"><span class="aisSiteTab">
			degrees of freedom</span></span></span></a>
		<a class="aisSubSiteLink" href="indexba53.html?page_id=2"><span class="aisSiteTabRight"><span class="aisSiteTabLeft"><span class="aisSiteTab">
			about us</span></span></span></a>

	</div>
	</div>
	</div>
	</div>
	</div>
</div>

<table style="width: 100%" cellspacing="0" cellpadding="0">
	<tr valign="top">
		<td width="210px">
<div id="sidebar">
<div class="aisLeftColumnFill">
<div class="aisLeftColumnBottom">
<div class="aisLeftColumnTop">
<div id="twitter_div" class="aisLeftNav">
<h2 class="sidebar-title">Twitter Updates</h2>
<ul id="twitter_update_list"></ul>
<a href="http://twitter.com/michaellperry" id="follow">Follow me</a>
</div>
<div id="twitter_reply_div" class="aisLeftNav">
<h2 class="sidebar-title">Twitter Replies</h2>
<ul id="twitter_reply_list"></ul>
</div>

<div class="aisLeftNav">
<a href='http://ineta.org/Speakers/SearchCommunitySpeakers.aspx?SpeakerId=c5110e21-9243-461b-a464-a6548524e885'><img alt='INETA Community Speakers Program' border='0' src='../../www.ineta.org/images/OfficialLogos/InetaCommunitySpeakersRequestMe.html' /></a>
</div>

<div class="aisLeftNav">
	<li class="pagenav"><h2>Pages</h2><ul><li class="page_item page-item-2"><a href="indexba53.html?page_id=2" title="About Us">About Us</a></li>
<li class="page_item page-item-210"><a href="index6ae3.html?page_id=210" title="Templates">Templates</a></li>
</ul></li></div>

<div class="aisLeftNav">
<h2>Archives</h2>
<ul>
	<li><a href='indexb4d5.html?m=201110' title='October 2011'>October 2011</a></li>
	<li><a href='indexc61a.html?m=201106' title='June 2011'>June 2011</a></li>
	<li><a href='indexa80d.html?m=201105' title='May 2011'>May 2011</a></li>
	<li><a href='index512b.html?m=201104' title='April 2011'>April 2011</a></li>
	<li><a href='index08fb.html?m=201103' title='March 2011'>March 2011</a></li>
	<li><a href='index52f4.html?m=201102' title='February 2011'>February 2011</a></li>
	<li><a href='index74f1.html?m=201101' title='January 2011'>January 2011</a></li>
	<li><a href='index8956.html?m=201012' title='December 2010'>December 2010</a></li>
	<li><a href='indexa1aa.html?m=201011' title='November 2010'>November 2010</a></li>
	<li><a href='indexe3d5.html?m=201010' title='October 2010'>October 2010</a></li>
	<li><a href='index9ab9.html?m=201009' title='September 2010'>September 2010</a></li>
	<li><a href='index1ff0.html?m=201008' title='August 2010'>August 2010</a></li>
	<li><a href='index9f11.html?m=201007' title='July 2010'>July 2010</a></li>
	<li><a href='index31f0.html?m=201006' title='June 2010'>June 2010</a></li>
	<li><a href='indexd189.html?m=201005' title='May 2010'>May 2010</a></li>
	<li><a href='indexb5c0.html?m=201004' title='April 2010'>April 2010</a></li>
	<li><a href='indexf258.html?m=201003' title='March 2010'>March 2010</a></li>
	<li><a href='index6e30.html?m=201002' title='February 2010'>February 2010</a></li>
	<li><a href='index6b19.html?m=201001' title='January 2010'>January 2010</a></li>
	<li><a href='index5c0a.html?m=200912' title='December 2009'>December 2009</a></li>
	<li><a href='index8f62.html?m=200911' title='November 2009'>November 2009</a></li>
	<li><a href='index451d.html?m=200910' title='October 2009'>October 2009</a></li>
	<li><a href='index3e04.html?m=200909' title='September 2009'>September 2009</a></li>
	<li><a href='index425a.html?m=200908' title='August 2009'>August 2009</a></li>
	<li><a href='index9907.html?m=200907' title='July 2009'>July 2009</a></li>
	<li><a href='index3104.html?m=200906' title='June 2009'>June 2009</a></li>
	<li><a href='indexc36d.html?m=200905' title='May 2009'>May 2009</a></li>
	<li><a href='index17e8.html?m=200904' title='April 2009'>April 2009</a></li>
	<li><a href='index10a5.html?m=200903' title='March 2009'>March 2009</a></li>
	<li><a href='index8988.html?m=200902' title='February 2009'>February 2009</a></li>
	<li><a href='index1419.html?m=200901' title='January 2009'>January 2009</a></li>
	<li><a href='index7866.html?m=200812' title='December 2008'>December 2008</a></li>
	<li><a href='index55f6.html?m=200811' title='November 2008'>November 2008</a></li>
	<li><a href='indexa7bc.html?m=200810' title='October 2008'>October 2008</a></li>
	<li><a href='indexe77c.html?m=200809' title='September 2008'>September 2008</a></li>
	<li><a href='indexcffc.html?m=200808' title='August 2008'>August 2008</a></li>
	<li><a href='index0e62.html?m=200807' title='July 2008'>July 2008</a></li>
	<li><a href='indexfda7.html?m=200806' title='June 2008'>June 2008</a></li>
	<li><a href='index7d64.html?m=200805' title='May 2008'>May 2008</a></li>
	<li><a href='index94dd.html?m=200804' title='April 2008'>April 2008</a></li>
	<li><a href='index9631.html?m=200803' title='March 2008'>March 2008</a></li>
	<li><a href='indexdd52.html?m=200802' title='February 2008'>February 2008</a></li>
	<li><a href='index21ee.html?m=200801' title='January 2008'>January 2008</a></li>
	<li><a href='index363c.html?m=200712' title='December 2007'>December 2007</a></li>
	<li><a href='index7493.html?m=200711' title='November 2007'>November 2007</a></li>
	<li><a href='index93a7.html?m=200710' title='October 2007'>October 2007</a></li>
	<li><a href='index4ca8.html?m=200709' title='September 2007'>September 2007</a></li>
	<li><a href='index6124.html?m=200708' title='August 2007'>August 2007</a></li>
	<li><a href='index6013.html?m=200707' title='July 2007'>July 2007</a></li>
	<li><a href='index2ab6.html?m=200706' title='June 2007'>June 2007</a></li>
	<li><a href='index44f0.html?m=200705' title='May 2007'>May 2007</a></li>
	<li><a href='indexf0b4.html?m=200704' title='April 2007'>April 2007</a></li>
	<li><a href='index481d.html?m=200703' title='March 2007'>March 2007</a></li>
	<li><a href='indexcbea.html?m=200702' title='February 2007'>February 2007</a></li>
	<li><a href='index9cdc.html?m=200701' title='January 2007'>January 2007</a></li>
	<li><a href='index3ea4.html?m=200612' title='December 2006'>December 2006</a></li>
	<li><a href='index67ca.html?m=200611' title='November 2006'>November 2006</a></li>
	<li><a href='indexff49.html?m=200610' title='October 2006'>October 2006</a></li>
	<li><a href='index611c.html?m=200609' title='September 2006'>September 2006</a></li>
	<li><a href='index9a21.html?m=200608' title='August 2006'>August 2006</a></li>
	<li><a href='index3ee9.html?m=200607' title='July 2006'>July 2006</a></li>
	<li><a href='indexe13a.html?m=200606' title='June 2006'>June 2006</a></li>
</ul>
</div>

<div class="aisLeftNav">
	</div>

<div class="aisLeftNav">
<h2>Books</h2>
<iframe src="http://rcm.amazon.com/e/cm?t=adventures0d2-20&amp;o=1&amp;p=8&amp;l=as1&amp;asins=0764526413&amp;fc1=000000&amp;IS2=1&amp;lt1=_blank&amp;lc1=0000ff&amp;bc1=000000&amp;bg1=ffffff&amp;f=ifr" style="width:120px;height:240px;" scrolling="no" marginwidth="0" marginheight="0" frameborder="0" name="I5" id="I5"></iframe>
<br/>
<iframe src="http://rcm.amazon.com/e/cm?t=adventures0d2-20&amp;o=1&amp;p=8&amp;l=as1&amp;asins=0201633612&amp;fc1=000000&amp;IS2=1&amp;lt1=_blank&amp;lc1=0000ff&amp;bc1=000000&amp;bg1=ffffff&amp;f=ifr" style="width:120px;height:240px;" scrolling="no" marginwidth="0" marginheight="0" frameborder="0" name="I6" id="I6"></iframe>
<br/>
<iframe src="http://rcm.amazon.com/e/cm?t=adventures0d2-20&amp;o=1&amp;p=8&amp;l=as1&amp;asins=0136291554&amp;fc1=000000&amp;IS2=1&amp;lt1=_blank&amp;lc1=0000ff&amp;bc1=000000&amp;bg1=ffffff&amp;f=ifr" style="width:120px;height:240px;" scrolling="no" marginwidth="0" marginheight="0" frameborder="0" name="I7" id="I7"></iframe>
<br/>
<iframe src="http://rcm.amazon.com/e/cm?t=adventures0d2-20&amp;o=1&amp;p=8&amp;l=as1&amp;asins=1888009195&amp;fc1=000000&amp;IS2=1&amp;lt1=_blank&amp;lc1=0000ff&amp;bc1=000000&amp;bg1=ffffff&amp;f=ifr" style="width:120px;height:240px;" scrolling="no" marginwidth="0" marginheight="0" frameborder="0" name="I8" id="I8"></iframe>
</div>
<div class="aisLeftNav">
<h2>Meta</h2>
<ul>
		<li><a href="wp-login.html">Login</a></li>
	<li><a href="http://validator.w3.org/check/referer" title="This page validates as XHTML 1.0 Transitional">Valid <abbr title="eXtensible HyperText Markup Language">XHTML</abbr></a></li>
	<li><a href="http://gmpg.org/xfn/"><abbr title="XHTML Friends Network">XFN</abbr></a></li>
	<li><a href="http://wordpress.org/" title="Powered by WordPress, state-of-the-art semantic personal publishing platform.">WordPress</a></li>
	</ul>
</div>
<div class="aisLeftContent">
<h2>Community</h2>
<ul>
	<script type="text/javascript" src="../../localhost/embed/92q2bbma.js"></script>
</ul>
</div>

</div></div></div>
</div>		</td>
		<td>

	<div id="content" class="narrowcolumn">

		
		 		<h2 class="pagetitle">Archive for the &#8216;Patterns&#8217; Category</h2>

 	  

		<div class="navigation">
			<div class="alignleft"><a href="indexd72b.html?cat=6&amp;paged=2">&laquo; Previous Entries</a></div>
			<div class="alignright"></div>
		</div>

				<div class="post">
				<h3 id="post-577"><a href="indexe7fb.html?p=577" rel="bookmark" title="Permanent Link to Hands-On MVVM video">Hands-On MVVM video</a></h3>
				<small>Friday, November 5th, 2010</small>

				<div class="entry">
					<p>Many thanks to Shawn Weisfeld for recording my <a href="http://www.drowningintechnicaldebt.com/ShawnWeisfeld/archive/2010/11/05/hands-on-mvvm-by-michael-perry-on-10192010-at-ft.-worth.aspx">Hands-On MVVM session</a> at the Forth Worth .NET User’s Group.</p>
<p><a href="http://live.ineta.org/Presentation/ViewVideo/178"><img border="0" src="../../a.images.blip.tv/InetaLive-20101019_Michael_Perry108-187.jpg" /></a></p>
				</div>

				<p class="postmetadata">Posted in <a href="indexb0b7.html?cat=6" title="View all posts in Patterns" rel="category">Patterns</a> |   <a href="indexe7fb.html?p=577#respond" title="Comment on Hands-On MVVM video">No Comments &#187;</a></p>

			</div>

				<div class="post">
				<h3 id="post-505"><a href="index9b9e.html?p=505" rel="bookmark" title="Permanent Link to Hands-on MVVM 4b: Communicate through the data model">Hands-on MVVM 4b: Communicate through the data model</a></h3>
				<small>Friday, May 14th, 2010</small>

				<div class="entry">
					<p>I presented this material at <a href="http://dallasxaml.com/">Dallas XAML</a> on May 4, 2010. Please <a title="download the demo code" href="wp-content/uploads/2010/05/dallasxaml_mvvm.zip">download the demo code</a> and follow along. This post takes us the rest of the way the project called “Step4”.</p>
<p>When we left the project in part 4, we had injected a layer between the model and the view. In the process, we broke updates. Now let’s fix them.</p>
<p><strong>Add INotifyPropertyChanged to the view model</strong>    <br />Updates stopped working because we are now data binding to the view model. As of yet, the view model does not implement INotifyPropertyChanged. As I mentioned in part 2, there are really only two reasons to ever fire PropertyChanged:</p>
<ol>
<li>Something other than the view changes the property, or </li>
<li>The property depends upon another property.</li>
</ol>
<p>Neither WPF nor Silverlight <em>need</em> you to fire PropertyChanged for a property that the view itself is changing. The view already knows that it has changed. It’s the one that changed it!</p>
<p>The updates that failed are all related to dependent properties. DisplayAs depends upon first name, last name, and email. Title depends upon DisplayAs. We moved both of these properties into the view model. So the view model needs to know when these properties change.</p>
<p><strong>Possible solution: interception</strong>    <br />Since the view model wraps the data model, it is possible to intercept changes on their way to the data model. The PersonViewModel understands what Title depends upon, and it intercepts all of those properties. It can fire the appropriate PropertyChanged events.</p>
<pre><span style="color: blue">public</span> <span style="color: blue">string</span> FirstName
{
    <span style="color: blue">get</span> { <span style="color: blue">return</span> _person.FirstName; }
    <span style="color: blue">set</span> { _person.FirstName = value; <strong>FirePropertyChanged(<span style="color: maroon">&quot;Title&quot;</span>);</strong> }
}

<span style="color: blue">public</span> <span style="color: blue">string</span> LastName
{
    <span style="color: blue">get</span> { <span style="color: blue">return</span> _person.LastName; }
    <span style="color: blue">set</span> { _person.LastName = value; <strong>FirePropertyChanged(<span style="color: maroon">&quot;Title&quot;</span>);</strong> }
}

<span style="color: blue">public</span> <span style="color: blue">string</span> Email
{
    <span style="color: blue">get</span> { <span style="color: blue">return</span> _person.Email; }
    <span style="color: blue">set</span> { _person.Email = value; <strong>FirePropertyChanged(<span style="color: maroon">&quot;Title&quot;</span>);</strong> }
}

<span style="color: blue">public</span> <span style="color: blue">string</span> Phone
{
    <span style="color: blue">get</span> { <span style="color: blue">return</span> _person.Phone; }
    <span style="color: blue">set</span> { _person.Phone = value; }
}

<span style="color: blue">public</span> <span style="color: #2b91af">DisplayStrategyViewModel</span> DisplayAs
{
    <span style="color: blue">get</span> { <span style="color: blue">return</span> <span style="color: blue">new</span> <span style="color: #2b91af">DisplayStrategyViewModel</span>(_person, _person.DisplayAs); }
    <span style="color: blue">set</span> { _person.DisplayAs = value.DisplayStrategy; <strong>FirePropertyChanged(<span style="color: maroon">&quot;Title&quot;</span>);</strong> }
}</pre>
<p>When the user changes any of the properties that Title depends upon, the view model fires PropertyChanged for the Title. Title does not depend upon Phone, so that one doesn’t fire. The view model is keeping track of dependencies.</p>
<p>But what about the DisplayStrategyViewModel? It doesn’t intercept the properties that it depends upon. It needs to be notified when FirstName, LastName, or Email is changed. That means that PersonViewModel would have to send these notifications to DisplayStrategyViewModel. That’s too much coupling between the two. Let’s find a different solution.</p>
<p><strong>Better solution: indirect notification</strong></p>
<p>The view models already have something in common. They both know about the Person data model. Let’s allow them to communicate with each other through the data model.</p>
<p>When the PersonDataModel changes one of the properties on the Person object, the DisplayStrategyViewModel should hear about it. It needs to know about those property changes. We have, conveniently enough, a mechanism for listening to property changed events. Although INotifyPropertyChanged is intended for data binding, you can use it for your own internal notification as well.</p>
<p>Person already implements INotifyPropertyChanged. But it used to fire property changed events for dependent properties. Now we want to know about changes to the properties themselves. Let’s add those notifications.</p>
<pre><span style="color: blue">public</span> <span style="color: blue">class</span> <span style="color: #2b91af">Person</span> : <span style="color: #2b91af">INotifyPropertyChanged</span>
{
    <span style="color: blue">public</span> <span style="color: blue">event</span> <span style="color: #2b91af">PropertyChangedEventHandler</span> PropertyChanged;

    <span style="color: blue">public</span> <span style="color: blue">string</span> FirstName
    {
        <span style="color: blue">get</span> { <span style="color: blue">return</span> _firstName; }
        <span style="color: blue">set</span> { _firstName = value; <strong>FirePropertyChanged(<span style="color: maroon">&quot;FirstName&quot;</span>);</strong> }
    }

    <span style="color: blue">public</span> <span style="color: blue">string</span> LastName
    {
        <span style="color: blue">get</span> { <span style="color: blue">return</span> _lastName; }
        <span style="color: blue">set</span> { _lastName = value; <strong>FirePropertyChanged(<span style="color: maroon">&quot;LastName&quot;</span>);</strong> }
    }

    <span style="color: blue">public</span> <span style="color: blue">string</span> Email
    {
        <span style="color: blue">get</span> { <span style="color: blue">return</span> _email; }
        <span style="color: blue">set</span> { _email = value; <strong>FirePropertyChanged(<span style="color: maroon">&quot;Email&quot;</span>);</strong> }
    }

    <span style="color: blue">public</span> <span style="color: blue">string</span> Phone
    {
        <span style="color: blue">get</span> { <span style="color: blue">return</span> _phone; }
        <span style="color: blue">set</span> { _phone = value; <strong>FirePropertyChanged(<span style="color: maroon">&quot;Phone&quot;</span>);</strong> }
    }
}</pre>
<p>Person no longer keeps track of dependent properties. That’s the view model’s job. Now it’s firing PropertyChanged events so that the view models can collaborate with each other. To close the loop, DisplayStrategyViewModel needs to listen.</p>
<pre><span style="color: blue">public</span> <span style="color: blue">class</span> <span style="color: #2b91af">DisplayStrategyViewModel</span> : <span style="color: #2b91af">INotifyPropertyChanged</span>
{
    <span style="color: blue">public</span> <span style="color: blue">event</span> <span style="color: #2b91af">PropertyChangedEventHandler</span> PropertyChanged;

    <span style="color: blue">public</span> DisplayStrategyViewModel(
        <span style="color: #2b91af">Person</span> person,
        <span style="color: #2b91af">DisplayStrategy</span> displayStrategy)
    {
        _person = person;
        _displayStrategy = displayStrategy;

        _person.PropertyChanged += PersonPropertyChanged;
    }

    <span style="color: blue">private</span> <span style="color: blue">void</span> PersonPropertyChanged(<span style="color: blue">object</span> sender, PropertyChangedEventArgs e)
    {
        <span style="color: blue">if</span> (e.PropertyName == <span style="color: maroon">&quot;FirstName&quot;</span> || e.PropertyName == <span style="color: maroon">&quot;LastName&quot;</span> || e.PropertyName == <span style="color: maroon">&quot;Email&quot;</span>)
            FirePropertyChanged(<span style="color: maroon">&quot;Display&quot;</span>);
    }
}</pre>
<p>Now when the PersonViewModel changes one of the properties that DisplayStrategyViewModel depends upon, it can notify the view.</p>
<p><strong>Best solution: automatic dependency management</strong></p>
<p>Wouldn’t it be better if you didn’t have to write all of that dependency management code in the view model? You don’t, if you use <a href="http://updatecontrols.net/">Update Controls</a>. But this isn’t an Update Controls presentation, so back to doing it manually.</p>
<p><strong>Finish it out</strong></p>
<p>To finish the transition from the interception solution to the notification solution, we remove the interceptors from the PersonViewModel. Instead, that view model also listens to changes.</p>
<pre><span style="color: blue">public</span> <span style="color: blue">class</span> <span style="color: #2b91af">PersonViewModel</span> : <span style="color: #2b91af">INotifyPropertyChanged</span>
{
    <span style="color: blue">public</span> <span style="color: blue">event</span> <span style="color: #2b91af">PropertyChangedEventHandler</span> PropertyChanged;

    <span style="color: blue">private</span> <span style="color: #2b91af">Person</span> _person;

    <span style="color: blue">public</span> PersonViewModel(<span style="color: #2b91af">Person</span> person)
    {
        _person = person;

        _person.PropertyChanged += PersonPropertyChanged;
    }

    <span style="color: blue">void</span> PersonPropertyChanged(<span style="color: blue">object</span> sender, <span style="color: #2b91af">PropertyChangedEventArgs</span> e)
    {
        FirePropertyChanged(<span style="color: maroon">&quot;Title&quot;</span>);
    }
}</pre>
<p>Now all of the view models listen to changes in the data model. If anything changes the data model, the view model will notify the view of changes to dependent properties. It’s like a publish-subscribe mechanism, but we’re using the data model itself. The data model has become the conduit for messages.</p>
<p>Next time, we’ll upgrade our application to manage a collection of people. In the process, we will dispel some of the myths about ObservableCollection.</p>
				</div>

				<p class="postmetadata">Posted in <a href="indexb0b7.html?cat=6" title="View all posts in Patterns" rel="category">Patterns</a> |   <a href="index9b9e.html?p=505#respond" title="Comment on Hands-on MVVM 4b: Communicate through the data model">No Comments &#187;</a></p>

			</div>

				<div class="post">
				<h3 id="post-503"><a href="index6c15.html?p=503" rel="bookmark" title="Permanent Link to Convention-based view model registration">Convention-based view model registration</a></h3>
				<small>Sunday, May 9th, 2010</small>

				<div class="entry">
					<p>When you create a ListBox or ItemsControl, you usually specify an ItemTemplate to render each of the items. You can do so directly in the ItemsControl itself.</p>
<pre><span style="color: blue">&lt;</span><span style="color: maroon">ListBox</span> <span style="color: red">ItemsSource</span>=&quot;<span style="color: blue">{Binding Projects}</span>&quot; <span style="color: red">SelectedItem</span>=&quot;<span style="color: blue">{Binding SelectedProject}</span>&quot;<span style="color: blue">&gt;</span>
    <span style="color: blue">&lt;</span><span style="color: maroon">ListBox.ItemTemplate</span><span style="color: blue">&gt;</span>
        <span style="color: blue">&lt;</span><span style="color: maroon">DataTemplate</span><span style="color: blue">&gt;</span>
            <span style="color: blue">&lt;</span><span style="color: maroon">TextBlock</span> <span style="color: red">Text</span>=&quot;<span style="color: blue">{Binding Name}</span>&quot;/<span style="color: blue">&gt;</span>
        <span style="color: blue">&lt;</span>/<span style="color: maroon">DataTemplate</span><span style="color: blue">&gt;</span>
    <span style="color: blue">&lt;</span>/<span style="color: maroon">ListBox.ItemTemplate</span><span style="color: blue">&gt;</span>
<span style="color: blue">&lt;</span>/<span style="color: maroon">ListBox</span><span style="color: blue">&gt;</span></pre>
<p>Or you can identify a resource by name.</p>
<pre><span style="color: blue">&lt;</span><span style="color: maroon">UserControl.Resources</span><span style="color: blue">&gt;</span>
    <span style="color: blue">&lt;</span><span style="color: maroon">DataTemplate</span> <span style="color: red">x:Key</span>=&quot;<span style="color: blue">ProjectItemTemplate</span>&quot;<span style="color: blue">&gt;</span>
        <span style="color: blue">&lt;</span><span style="color: maroon">TextBlock</span> <span style="color: red">Text</span>=&quot;<span style="color: blue">{Binding Name}</span>&quot;/<span style="color: blue">&gt;</span>
    <span style="color: blue">&lt;</span>/<span style="color: maroon">DataTemplate</span><span style="color: blue">&gt;</span>
<span style="color: blue">&lt;</span>/<span style="color: maroon">UserControl.Resources</span><span style="color: blue">&gt;</span>

<span style="color: blue">&lt;</span><span style="color: maroon">ListBox</span>
    <span style="color: red">ItemsSource</span>=&quot;<span style="color: blue">{Binding Projects}</span>&quot;
    <span style="color: red">SelectedItem</span>=&quot;<span style="color: blue">{Binding SelectedProject}</span>&quot;
    <span style="color: red">ItemTemplate</span>=&quot;<span style="color: blue">{StaticResource ProjectItemTemplate}</span>&quot;/<span style="color: blue">&gt;</span></pre>
<p>Either of these methods causes every item to be rendered in the same way. But what if different kinds of items are represented with different views? If you want each item to be rendered according to its type, you can add all of the data templates to the resource dictionary. The list will select the data template based on the item type.</p>
<pre><span style="color: blue">&lt;</span><span style="color: maroon">UserControl.Resources</span><span style="color: blue">&gt;</span>
    <span style="color: blue">&lt;</span><span style="color: maroon">DataTemplate</span> <span style="color: red">DataType</span>=&quot;<span style="color: blue">{x:Type projects:SoftwareProject}</span>&quot;<span style="color: blue">&gt;</span>
        <span style="color: blue">&lt;</span><span style="color: maroon">StackPanel</span><span style="color: blue">&gt;</span>
            <span style="color: blue">&lt;</span><span style="color: maroon">TextBlock</span> <span style="color: red">Text</span>=&quot;<span style="color: blue">{Binding Name}</span>&quot;/<span style="color: blue">&gt;</span>
            <span style="color: blue">&lt;</span><span style="color: maroon">TextBlock</span> <span style="color: red">Text</span>=&quot;<span style="color: blue">{Binding LinesOfCode}</span>&quot;/<span style="color: blue">&gt;</span>
        <span style="color: blue">&lt;</span>/<span style="color: maroon">StackPanel</span><span style="color: blue">&gt;</span>
    <span style="color: blue">&lt;</span>/<span style="color: maroon">DataTemplate</span><span style="color: blue">&gt;</span>
    <span style="color: blue">&lt;</span><span style="color: maroon">DataTemplate</span> <span style="color: red">DataType</span>=&quot;<span style="color: blue">{x:Type projects:HardwareProject}</span>&quot;<span style="color: blue">&gt;</span>
        <span style="color: blue">&lt;</span><span style="color: maroon">StackPanel</span><span style="color: blue">&gt;</span>
            <span style="color: blue">&lt;</span><span style="color: maroon">TextBlock</span> <span style="color: red">Text</span>=&quot;<span style="color: blue">{Binding Name}</span>&quot;/<span style="color: blue">&gt;</span>
            <span style="color: blue">&lt;</span><span style="color: maroon">TextBlock</span> <span style="color: red">Text</span>=&quot;<span style="color: blue">{Binding ServerCount}</span>&quot;/<span style="color: blue">&gt;</span>
        <span style="color: blue">&lt;</span>/<span style="color: maroon">StackPanel</span><span style="color: blue">&gt;</span>
    <span style="color: blue">&lt;</span>/<span style="color: maroon">DataTemplate</span><span style="color: blue">&gt;</span>
<span style="color: blue">&lt;</span>/<span style="color: maroon">UserControl.Resources</span><span style="color: blue">&gt;</span>

<span style="color: blue">&lt;</span><span style="color: maroon">ListBox</span>
    <span style="color: red">ItemsSource</span>=&quot;<span style="color: blue">{Binding Projects}</span>&quot;
    <span style="color: red">SelectedItem</span>=&quot;<span style="color: blue">{Binding SelectedProject}</span>&quot;/<span style="color: blue">&gt;</span></pre>
<p><strong>Convention over configuration</strong></p>
<p>You can explicitly add data templates to a resource dictionary if you have only a few closely related types to choose from. But explicit configuration becomes tedious if this set of types changes frequently, if there are many of them, or if they are located in different namespaces. In some cases, it is easier to adopt a convention-based approach.</p>
<p>I started the <a href="http://wpflob.codeplex.com/">WPF LOB project</a> on Codeplex to experiment with patterns for line-of-business applications in WPF. One of those patterns is switching among views within the same window. The project defines a base class for view models that represent panes within the window. It uses convention over configuration to associate those view models with their views.</p>
<p>The main form looks for all classes that inherit from Pane and end with the words “ViewModel”. By convention, the view model will be located in a namespace called “ViewModel”. The associated view will be a user control located in a namespace called “View”, and ending with the word “View”. The main form applies that convention to locate the view, and adds a data template to the resource dictionary.</p>
<pre><span style="color: blue">public</span> MainWindow()
{
    InitializeComponent();
    RegisterAllPanes();
}

<span style="color: blue">private</span> <span style="color: blue">void</span> RegisterAllPanes()
{
    <span style="color: green">// Find all pane view model types in the assembly.</span>
    <span style="color: #2b91af">Assembly</span> assembly = <span style="color: #2b91af">Assembly</span>.GetExecutingAssembly();
    <span style="color: blue">foreach</span> (<span style="color: #2b91af">Type</span> viewModelType <span style="color: blue">in</span> assembly.GetTypes())
    {
        <span style="color: blue">if</span> (<span style="color: blue">typeof</span>(<span style="color: #2b91af">Pane</span>).IsAssignableFrom(viewModelType) &amp;&amp; viewModelType.Name.EndsWith(<span style="color: maroon">&quot;ViewModel&quot;</span>))
        {
            <span style="color: blue">string</span> viewTypeName = viewModelType.FullName.Replace(<span style="color: maroon">&quot;ViewModel&quot;</span>, <span style="color: maroon">&quot;View&quot;</span>);
            <span style="color: #2b91af">Type</span> viewType = assembly.GetType(viewTypeName);
            <span style="color: blue">if</span> (viewType != <span style="color: blue">null</span>)
                RegisterDataTemplate(viewModelType, viewType);
        }
    }
}

<span style="color: blue">private</span> <span style="color: blue">void</span> RegisterDataTemplate(<span style="color: #2b91af">Type</span> viewModelType, <span style="color: #2b91af">Type</span> viewType)
{
    <span style="color: #2b91af">DataTemplate</span> dataTemplate = <span style="color: blue">new</span> <span style="color: #2b91af">DataTemplate</span>(viewModelType)
    {
        VisualTree = <span style="color: blue">new</span> <span style="color: #2b91af">FrameworkElementFactory</span>(viewType)
    };
    Resources.Add(dataTemplate.DataTemplateKey, dataTemplate);
}</pre>
<p><strong>Caliburn</strong></p>
<p>Rob Eisenberg created an MVVM framework called <a href="http://caliburn.codeplex.com/">Calliburn</a> that relies heavily on convention over configuration. His framework goes so far as to data bind controls to properties based on convention, rather than configuring each using the “{Binding}” markup extension. Watch his <a href="http://live.visitmix.com/MIX10/Sessions/EX15">presentation from Mix10</a>. If you would like to develop applications within the realm of his opinion, I recommend investing the time in learning Caliburn. But even if you don’t, you can still use simple techniques like the one above to take advantage of convention over configuration when it makes the most sense.</p>
				</div>

				<p class="postmetadata">Posted in <a href="indexb0b7.html?cat=6" title="View all posts in Patterns" rel="category">Patterns</a>,  <a href="index667c.html?cat=43" title="View all posts in XAML" rel="category">XAML</a> |   <a href="index6c15.html?p=503#respond" title="Comment on Convention-based view model registration">No Comments &#187;</a></p>

			</div>

				<div class="post">
				<h3 id="post-502"><a href="indexda6e.html?p=502" rel="bookmark" title="Permanent Link to Hands-on MVVM 4: the View Model layer">Hands-on MVVM 4: the View Model layer</a></h3>
				<small>Friday, May 7th, 2010</small>

				<div class="entry">
					<p>I presented this material at <a href="http://dallasxaml.com/">Dallas XAML</a> on May 4, 2010. Please <a title="download the demo code" href="wp-content/uploads/2010/05/dallasxaml_mvvm.zip">download the demo code</a> and follow along. This post takes us half way the project called “Step4”. The next one will take us the rest of the way, but then the numbers will be out of sync.</p>
<p>In <a href="indexc508.html?p=501">part 3</a>, we added a “Display As” feature to the system. In doing so, the data model started getting messy. This time, we’ll pull those view-specific features out of the data model.</p>
<p>The data model has a job to do. It evaluates domain logic. That’s already enough for a single class. We don’t want to further burden it with managing a view. Robert C. Martin tells us of the <a href="http://www.objectmentor.com/resources/articles/srp.pdf">Single Responsibility Principle</a>. A class should have only one reason to change. If you’re changing the data model, it’s because you are modifying the domain. You shouldn’t also change it when modifying the behavior of a view. So let’s move that behavior out of the data model. The place it goes is the View Model. We data bind to the view model rather than to the data model.</p>
<p><strong>View-specific properties</strong>    <br />The Title property of the Person class exists to serve the view. It’s not the title of a person; it’s the title of a window that displays a person. This is the first to go.</p>
<pre><span style="color: blue">public</span> <span style="color: blue">class</span> <span style="color: #2b91af">PersonViewModel</span>
{
    <span style="color: blue">private</span> <span style="color: #2b91af">Person</span> _person;

    <span style="color: blue">public</span> <span style="color: #2b91af">PersonViewModel</span>(<span style="color: #2b91af">Person</span> person)
    {
        _person = person;
    }

    <span style="color: blue">public</span> <span style="color: blue">string</span> <span style="color: #2b91af">Title</span>
    {
        <span style="color: blue">get</span>
        {
            <span style="color: blue">return</span> <span style="color: maroon">&quot;Person - &quot;</span> + _person.DisplayUsingStrategy(_person.DisplayAs);
        }
    }
}</pre>
<p>The Person View Model takes a reference to a Person. It uses the Person to provide the desired behavior.</p>
<p><strong>Pass-through properties</strong></p>
<p>The view displays text boxes where the user can edit the properties of a person directly. Since the view is no longer bound directly to the data model, we have to pass these properties through the view model.</p>
<pre><span style="color: blue">public</span> <span style="color: blue">class</span> <span style="color: #2b91af">PersonViewModel</span>
{
    <span style="color: blue">private</span> <span style="color: #2b91af">Person</span> _person;

    <span style="color: blue">public</span> <span style="color: #2b91af">PersonViewModel</span>(<span style="color: #2b91af">Person</span> person)
    {
        _person = person;
    }

    <span style="color: blue">public</span> <span style="color: blue">string</span> <span style="color: #2b91af">FirstName</span>
    {
        <span style="color: blue">get</span> { <span style="color: blue">return</span> _person.FirstName; }
        <span style="color: blue">set</span> { _person.FirstName = value; }
    }

    <span style="color: blue">public</span> <span style="color: blue">string</span> <span style="color: #2b91af">LastName</span>
    {
        <span style="color: blue">get</span> { <span style="color: blue">return</span> _person.LastName; }
        <span style="color: blue">set</span> { _person.LastName = value; }
    }

    <span style="color: blue">public</span> <span style="color: blue">string</span> <span style="color: #2b91af">Email</span>
    {
        <span style="color: blue">get</span> { <span style="color: blue">return</span> _person.Email; }
        <span style="color: blue">set</span> { _person.Email = value; }
    }

    <span style="color: blue">public</span> <span style="color: blue">string</span> <span style="color: #2b91af">Phone</span>
    {
        <span style="color: blue">get</span> { <span style="color: blue">return</span> _person.Phone; }
        <span style="color: blue">set</span> { _person.Phone = value; }
    }

    <span style="color: blue">public</span> <span style="color: blue">string</span> <span style="color: #2b91af">Title</span>
    {
        <span style="color: blue">get</span>
        {
            <span style="color: blue">return</span> <span style="color: maroon">&quot;Person - &quot;</span> + _person.DisplayUsingStrategy(_person.DisplayAs);
        }
    }
}</pre>
<p>No data is stored in the view model itself. It all passes through to the data model.</p>
<p><strong>One view model per DataContext</strong></p>
<p>The “Display As” combo box has an ItemsSource that is data bound to a collection. Each item in this collection is the DataContext of one combo box item. Before it was a string. Now we’ll make it a view model of its own.</p>
<pre><span style="color: blue">public</span> <span style="color: blue">class</span> <span style="color: #2b91af">DisplayStrategyViewModel</span>
{
    <span style="color: blue">private</span> <span style="color: #2b91af">Person</span> _person;
    <span style="color: blue">private</span> <span style="color: #2b91af">DisplayStrategy</span> _displayStrategy;

    <span style="color: blue">public</span> <span style="color: #2b91af">DisplayStrategyViewModel</span>(<span style="color: #2b91af">Person</span> person, <span style="color: #2b91af">DisplayStrategy</span> displayStrategy)
    {
        _person = person;
        _displayStrategy = displayStrategy;
    }

    <span style="color: blue">public</span> <span style="color: blue">string</span> <span style="color: #2b91af">Display</span>
    {
        <span style="color: blue">get</span> { <span style="color: blue">return</span> _person.DisplayUsingStrategy(_displayStrategy); }
    }
}</pre>
<p>Again, this view model passes its behavior through to the Person object. But now it displays that person according to a given display strategy. We use a DataTemplate to show that property in the combo box.</p>
<pre><span style="color: blue">&lt;</span><span style="color: maroon">ComboBox</span> <span style="color: red">ItemsSource</span>=&quot;<span style="color: blue">{Binding DisplayAsOptions}</span>&quot; <span style="color: red">SelectedItem</span>=&quot;<span style="color: blue">{Binding DisplayAs}</span>&quot;<span style="color: blue">&gt;</span>
    <span style="color: blue">&lt;</span><span style="color: maroon">ComboBox.ItemTemplate</span><span style="color: blue">&gt;</span>
        <span style="color: blue">&lt;</span><span style="color: maroon">DataTemplate</span><span style="color: blue">&gt;</span>
            <span style="color: blue">&lt;</span><span style="color: maroon">TextBlock</span> <span style="color: red">Text</span>=&quot;<span style="color: blue">{Binding Display}</span>&quot;/<span style="color: blue">&gt;</span>
        <span style="color: blue">&lt;</span>/<span style="color: maroon">DataTemplate</span><span style="color: blue">&gt;</span>
    <span style="color: blue">&lt;</span>/<span style="color: maroon">ComboBox.ItemTemplate</span><span style="color: blue">&gt;</span>
<span style="color: blue">&lt;</span>/<span style="color: maroon">ComboBox</span><span style="color: blue">&gt;</span></pre>
<p>And now we need to generate these view models.</p>
<p><strong>Project through a factory</strong></p>
<p>The simplest way to generate a collection of view models is to use linq to project a collection of data objects through a view model constructor. In this case, we are listing all of the display options, so we project the values of the DisplayStrategy enumeration. We add this property to the Person View Model.</p>
<pre><span style="color: blue">public</span> <span style="color: #2b91af">IEnumerable</span>&lt;<span style="color: #2b91af">DisplayStrategyViewModel</span>&gt; <span style="color: #2b91af">DisplayAsOptions</span>
{
    <span style="color: blue">get</span>
    {
        <span style="color: blue">return</span> <span style="color: #2b91af">Enum</span>.GetValues(<span style="color: blue">typeof</span>(<span style="color: #2b91af">DisplayStrategy</span>))
            .OfType&lt;<span style="color: #2b91af">DisplayStrategy</span>&gt;()
            .Select(displayStrategy =&gt;
                <span style="color: blue">new</span> <span style="color: #2b91af">DisplayStrategyViewModel</span>(_person, displayStrategy));
    }
}</pre>
<p>From the list of DisplayStrategy values, we produce a list of Display Strategy View Models that render the person using different options.</p>
<p><strong>ItemsSource/SelectedItem duality</strong></p>
<p>Finally, the user needs to select one of the display strategies from the combo box. The SelectedItem property provides this behavior. It is the dual of the ItemsSource property: its type must be the same as the IEnumerable generic parameter.</p>
<pre><span style="color: blue">public</span> <span style="color: #2b91af">DisplayStrategyViewModel</span> <span style="color: #2b91af">DisplayAs</span>
{
    <span style="color: blue">get</span> { <span style="color: blue">return</span> <span style="color: blue">new</span> <span style="color: #2b91af">DisplayStrategyViewModel</span>(_person, _person.DisplayAs); }
    <span style="color: blue">set</span> { _person.DisplayAs = value.DisplayStrategy; }
}</pre>
<p>This property wraps the DisplayAs selection in a view model so that it agrees with the type of the list.</p>
<p><strong>Equals and GetHashCode</strong></p>
<p>If you were to run the code now, you would see that the window comes up initially blank. But when you select a “Display As” setting, it appears correctly. The problem is that the view cannot find the SelectedItem in the ItemsSource collection. For each property, we created a new Display Strategy View Model. These are two different instances of similar objects. To tell the view that they are indeed the same, we need to implement Equals and GetHashCode in DisplayStrategyViewModel.</p>
<pre><span style="color: blue">public</span> <span style="color: blue">override</span> <span style="color: blue">bool</span> <span style="color: #2b91af">Equals</span>(<span style="color: blue">object</span> obj)
{
    <span style="color: blue">if</span> (obj == <span style="color: blue">this</span>)
        <span style="color: blue">return</span> <span style="color: maroon">true</span>;
    <span style="color: #2b91af">DisplayStrategyViewModel</span> that = obj <span style="color: blue">as</span> <span style="color: #2b91af">DisplayStrategyViewModel</span>;
    <span style="color: blue">if</span> (that == <span style="color: blue">null</span>)
        <span style="color: blue">return</span> <span style="color: maroon">false</span>;
    <span style="color: blue">return</span> _displayStrategy == that._displayStrategy;
}

<span style="color: blue">public</span> <span style="color: blue">override</span> <span style="color: blue">int</span> <span style="color: #2b91af">GetHashCode</span>()
{
    <span style="color: blue">return</span> _displayStrategy.GetHashCode();
}</pre>
<p>Now the view recognizes that they are the same, so the window appears correctly. You must always implement Equals and GetHashCode when you create an ItemsSource/SelectedItem dual.</p>
<p>We have successfully moved the view-specific behavior out of the data model and into a view model. We pass all of the properties that are data-bound to the view through to the data model. By projecting related objects through a constructor, we can keep a view model layer in between the view and the data model at all times.</p>
<p>The application works now, but there are a few places that no longer update. That’s because we didn’t implement INotifyPropertyChanged on the view model to tell the view about dependent properties. In part 4, we’ll add INotifyPropertyChanged to get that behavior back.</p>
				</div>

				<p class="postmetadata">Posted in <a href="indexb0b7.html?cat=6" title="View all posts in Patterns" rel="category">Patterns</a> |   <a href="indexda6e.html?p=502#respond" title="Comment on Hands-on MVVM 4: the View Model layer">No Comments &#187;</a></p>

			</div>

				<div class="post">
				<h3 id="post-501"><a href="indexc508.html?p=501" rel="bookmark" title="Permanent Link to Hands-on MVVM 3: ItemsSource and SelectedItem">Hands-on MVVM 3: ItemsSource and SelectedItem</a></h3>
				<small>Wednesday, May 5th, 2010</small>

				<div class="entry">
					<p><a href="wp-content/uploads/2010/05/display-as.jpg"><img title="display_as" style="border-right: 0px; border-top: 0px; display: inline; margin-left: 0px; border-left: 0px; margin-right: 0px; border-bottom: 0px" height="191" alt="display_as" src="wp-content/uploads/2010/05/display-as-thumb.jpg" width="244" align="right" border="0" /></a>I presented this material at <a href="http://dallasxaml.com/">Dallas XAML</a> last night (May 4, 2010). If you attended, I hope you had as much fun as I did. If not, just <a title="download the demo code" href="wp-content/uploads/2010/05/dallasxaml_mvvm.zip">download the demo code</a> and follow along.</p>
<p>In <a href="index5b8d.html?p=498">part 2</a>, we saw why we need to fire PropertyChanged events. It’s not for the benefit of the properties that the view is changing directly. It’s for the dependent properties.</p>
<p><strong>Display strategy</strong>    <br />Now we want to add another new feature to the system. We want to let the user choose how a person is displayed. They can choose from among three display strategies: last-first, first-last, or email.</p>
<p>The chosen display strategy is stored with the person. The user can choose to display one person using their formal name (last-first), and another using their informal name (first-last). It is not a global setting.</p>
<p>The user selects a display strategy from a combo box. We add this to the person view.</p>
<pre><span style="color: blue">&lt;</span><span style="color: maroon">ComboBox</span> <span style="color: red">Grid.Row</span>=&quot;<span style="color: blue">4</span>&quot; <span style="color: red">Grid.Column</span>=&quot;<span style="color: blue">1</span>&quot; <span style="color: red">x:Name</span>=&quot;<span style="color: blue">displayAs</span>&quot;
    <span style="color: red">ItemsSource</span>=&quot;<span style="color: blue">{Binding DisplayAsOptions}</span>&quot; <span style="color: red">SelectedItem</span>=&quot;<span style="color: blue">{Binding DisplayAs}</span>&quot;/<span style="color: blue">&gt;</span></pre>
<p>This combo box needs to show a list of options. We’ll generate these options by applying different display strategies to the person.</p>
<pre><span style="color: blue">public</span> <span style="color: #2b91af">IEnumerable</span>&lt;<span style="color: blue">string</span>&gt; DisplayAsOptions
{
    <span style="color: blue">get</span>
    {
        <span style="color: blue">return</span> <span style="color: #2b91af">Enum</span>.GetValues(<span style="color: blue">typeof</span>(<span style="color: #2b91af">DisplayStrategy</span>))
            .OfType&lt;<span style="color: #2b91af">DisplayStrategy</span>&gt;()
            .Select(displayStrategy =&gt; DisplayUsingStrategy(displayStrategy));
    }
}

<span style="color: blue">public</span> <span style="color: blue">string</span> DisplayUsingStrategy(<span style="color: #2b91af">DisplayStrategy</span> displayStrategy)
{
    <span style="color: blue">if</span> (displayStrategy == <span style="color: #2b91af">DisplayStrategy</span>.LastFirst)
        <span style="color: blue">return</span> <span style="color: blue">string</span>.Format(<span style="color: maroon">&quot;{0}, {1}&quot;</span>, _lastName, _firstName);
    <span style="color: blue">else</span> <span style="color: blue">if</span> (displayStrategy == <span style="color: #2b91af">DisplayStrategy</span>.FirstLast)
        <span style="color: blue">return</span> <span style="color: blue">string</span>.Format(<span style="color: maroon">&quot;{0} {1}&quot;</span>, _firstName, _lastName);
    <span style="color: blue">else</span>
        <span style="color: blue">return</span> _email;
}</pre>
<p>The DisplayAsOptions property gets all values of the DisplayStrategy enumeration and projects that set through the DisplayUsingStrategy method. The DisplayUsingStrategy method formats the person for the given strategy. The result is a collection of strings.</p>
<p>When the user selects one of those strings, they will set the DisplayAs property. Since DisplayAsOptions is an IEnumerable&lt;string&gt;, DisplayAs has to be a string.</p>
<pre><span style="color: blue">public</span> <span style="color: blue">string</span> <span style="color: #2b91af">DisplayAs</span>
{
    <span style="color: blue">get</span> { <span style="color: blue">return</span> DisplayUsingStrategy(_displayAs); }
    <span style="color: blue">set</span>
    {
        _displayAs = (<span style="color: #2b91af">DisplayStrategy</span>)DisplayAsOptions
            .ToList()
            .FindIndex(option =&gt; option == value);
    }
}</pre>
<p>The DisplayAs getter just applies the current display strategy for the person. The setter, however, has to find the selected string in the list of options. The index of this string corresponds to the ordinal value of the enumeration that generated it.</p>
</p>
<p>The important thing here is the duality of the DisplayAsOptions and DisplayAs properties. DisplayAsOptions has type <strong>IEnumerable&lt;string&gt;</strong>. DisplayAs has type <strong>string</strong>. These types must agree, because one is data bound to ItemsSource and the other to SelectedItem.</p>
<p><strong>Update the title</strong></p>
<p>Now that the user can select the display strategy for the person, we should use that display strategy in the title of the window. We make the necessary change to the Title property.</p>
<pre><span style="color: blue">public</span> <span style="color: blue">string</span> <span style="color: #2b91af">Title</span>
{
    <span style="color: blue">get</span>
    {
        <span style="color: blue">return</span> <span style="color: maroon">&quot;Person - &quot;</span> + DisplayUsingStrategy(_displayAs);
    }
}</pre>
<p>When we run the app, it doesn’t look like it’s working. When we change the display strategy, the title doesn’t update. Did we forget to compile? No. We just forgot to tell XAML that the title depends upon DisplayAs.</p>
<pre><span style="color: blue">public</span> <span style="color: blue">string</span> <span style="color: #2b91af">DisplayAs</span>
{
    <span style="color: blue">get</span> { <span style="color: blue">return</span> DisplayUsingStrategy(_displayAs); }
    <span style="color: blue">set</span>
    {
        _displayAs = (<span style="color: #2b91af">DisplayStrategy</span>)DisplayAsOptions
            .ToList()
            .FindIndex(option =&gt; option == value);
        <strong>FirePropertyChanged(<span style="color: maroon">&quot;Title&quot;</span>);</strong>
    }
}</pre>
<p>Now the title updates when we change the display strategy.</p>
<p><strong>Messy model</strong></p>
<p>Take a step back and look at the model that we’ve created. The Person class has the following properties.</p>
<ul>
<li>FirstName</li>
<li>LastName</li>
<li>Email</li>
<li>Phone</li>
<li>DisplayAs</li>
<li>DisplayAsOptions</li>
<li>Title</li>
</ul>
<p>How many of these are actually the responsibility of the model? How many are just there to satisfy the view? As we’ve added features to the application, we’ve allowed the view’s concerns to creep into the data model. If we continue in this vein, the data model will get very messy.</p>
<p>In part 4, we’ll pull the view’s concerns out of the data model. That’s the first time in this series that we’ll really see the MVVM pattern.</p>
				</div>

				<p class="postmetadata">Posted in <a href="indexb0b7.html?cat=6" title="View all posts in Patterns" rel="category">Patterns</a> |   <a href="indexc508.html?p=501#respond" title="Comment on Hands-on MVVM 3: ItemsSource and SelectedItem">No Comments &#187;</a></p>

			</div>

				<div class="post">
				<h3 id="post-498"><a href="index5b8d.html?p=498" rel="bookmark" title="Permanent Link to Hands-on MVVM 2: Dependent properties">Hands-on MVVM 2: Dependent properties</a></h3>
				<small>Tuesday, May 4th, 2010</small>

				<div class="entry">
					<p>I will be presenting this material at <a href="http://dallasxaml.com/">Dallas XAML</a> tonight (May 4, 2010). If you are in the area, please come by. If not, just <a href="wp-content/uploads/2010/05/dallasxaml_mvvm.zip" title="download the demo code">download the demo code</a> and follow along.</p>
<p>In <a href="indexdba8.html?p=494">part 1</a> we created a model and a view. Now we start adding features and seeing how our code changes.</p>
<p><strong>Window title</strong><br />
The first feature to add is to display the name of the person in the title bar of the window. The view is a user control, but it’s hosted inside of a window. We already set the DataContext of the window so that it would be inherited by the user control. So we can just data bind the title.</p>
<pre><span style="color: blue">&lt;</span><span style="color: maroon">Window</span> <span style="color: red">x:Class</span>="<span style="color: blue">Step2.PersonWindow</span>"
    <span style="color: red">xmlns</span>="<span style="color: blue">http://schemas.microsoft.com/winfx/2006/xaml/presentation</span>"
    <span style="color: red">xmlns:x</span>="<span style="color: blue">http://schemas.microsoft.com/winfx/2006/xaml</span>"
    <span style="color: red">xmlns:view</span>="<span style="color: blue">clr-namespace:Step2.View</span>"
    <span style="color: red">Title</span>="<span style="color: blue"><strong>{Binding Title}</strong></span>" <span style="color: red">Height</span>="<span style="color: blue">300</span>" <span style="color: red">Width</span>="<span style="color: blue">468</span>"<span style="color: blue">&gt;</span>
    <span style="color: blue">&lt;</span><span style="color: maroon">view:PersonUserControl/</span><span style="color: blue">&gt;</span>
<span style="color: blue">&lt;</span>/<span style="color: maroon">Window</span><span style="color: blue">&gt;</span></pre>
<p><strong>Bound property</strong></p>
<p>The data context that we set was the Person model object. So we have to add this Title property to the Person.</p>
<pre><span style="color: blue">public</span> <span style="color: blue">class</span> <span style="color: #2b91af">Person</span>
{
    <span style="color: blue">private</span> <span style="color: blue">string</span> _firstName;
    <span style="color: blue">private</span> <span style="color: blue">string</span> _lastName;
    <span style="color: blue">private</span> <span style="color: blue">string</span> _email;
    <span style="color: blue">private</span> <span style="color: blue">string</span> _phone;

    <span style="color: blue">public</span> <span style="color: blue">string</span> FirstName
    {
        <span style="color: blue">get</span> { <span style="color: blue">return</span> _firstName; }
        <span style="color: blue">set</span> { _firstName = value; }
    }

    <span style="color: blue">public</span> <span style="color: blue">string</span> LastName
    {
        <span style="color: blue">get</span> { <span style="color: blue">return</span> _lastName; }
        <span style="color: blue">set</span> { _lastName = value; }
    }

    <span style="color: blue">public</span> <span style="color: blue">string</span> Email
    {
        <span style="color: blue">get</span> { <span style="color: blue">return</span> _email; }
        <span style="color: blue">set</span> { _email = value; }
    }

    <span style="color: blue">public</span> <span style="color: blue">string</span> Phone
    {
        <span style="color: blue">get</span> { <span style="color: blue">return</span> _phone; }
        <span style="color: blue">set</span> { _phone = value; }
    }

<strong>    <span style="color: blue">public</span> <span style="color: blue">string</span> Title
    {
        <span style="color: blue">get</span>
        {
            <span style="color: blue">return</span> <span style="color: blue">string</span>.Format(<span style="color: maroon">"Person - {0}, {1}"</span>, _lastName, _firstName);
        }
    }
</strong>}</pre>
<p>Run the program and you’ll see that the title properly displays the person’s name. It looks like everything is working. But change the name and see what happens.</p>
<p><a href="wp-content/uploads/2010/05/change-name.jpg"><img src="wp-content/uploads/2010/05/change-name-thumb.jpg" title="change_name" style="border: 0px none; display: inline" alt="change_name" width="1000" border="0" height="300" /></a></p>
<p>The title doesn’t update when the name changes. That’s because the view doesn’t know that the title depends upon the name. Unless you have <a href="http://updatecontrols.net/">a system that automatically discovers dependencies</a> (not discussed in this series), you have to notify the view.</p>
<p>As you can see, INotifyPropertyChanged is not strictly necessary for data binding to work. The view worked just fine up until now. The properties were not notifying the view when they themselves were changing. That’s because it was the view that was changing them. The view already knows. You only <em>really</em> need INotifyPropertyChanged to notify the view when:</p>
<ol>
<li>Something other than the view changes the property, or</li>
<li>The property depends upon another property.</li>
</ol>
<p><strong>Dependent property</strong></p>
<p>In this case, the Title property depends upon the FirstName and LastName properties. So we notify the view that Title has changed when one of <em>those</em> properties change.</p>
<pre><span style="color: blue">public</span> <span style="color: blue">class</span> <span style="color: #2b91af">Person</span> : <span style="color: #2b91af">INotifyPropertyChanged</span>
{
    <span style="color: blue">public</span> <span style="color: blue">event</span> <span style="color: #2b91af">PropertyChangedEventHandler</span> PropertyChanged;

    <span style="color: blue">private</span> <span style="color: blue">string</span> _firstName;
    <span style="color: blue">private</span> <span style="color: blue">string</span> _lastName;
    <span style="color: blue">private</span> <span style="color: blue">string</span> _email;
    <span style="color: blue">private</span> <span style="color: blue">string</span> _phone;

    <span style="color: blue">public</span> <span style="color: blue">string</span> FirstName
    {
        <span style="color: blue">get</span> { <span style="color: blue">return</span> _firstName; }
        <span style="color: blue">set</span> { _firstName = value; <strong>FirePropertyChanged(<span style="color: maroon">"Title"</span>)</strong>; }
    }

    <span style="color: blue">public</span> <span style="color: blue">string</span> LastName
    {
        <span style="color: blue">get</span> { <span style="color: blue">return</span> _lastName; }
        <span style="color: blue">set</span> { _lastName = value; <strong>FirePropertyChanged(<span style="color: maroon">"Title"</span>)</strong>; }
    }

    <span style="color: blue">public</span> <span style="color: blue">string</span> Email
    {
        <span style="color: blue">get</span> { <span style="color: blue">return</span> _email; }
        <span style="color: blue">set</span> { _email = value; }
    }

    <span style="color: blue">public</span> <span style="color: blue">string</span> Phone
    {
        <span style="color: blue">get</span> { <span style="color: blue">return</span> _phone; }
        <span style="color: blue">set</span> { _phone = value; }
    }

    <span style="color: blue">public</span> <span style="color: blue">string</span> Title
    {
        <span style="color: blue">get</span>
        {
            <span style="color: blue">return</span> <span style="color: blue">string</span>.Format(<span style="color: maroon">"Person - {0}, {1}"</span>, _lastName, _firstName);
        }
    }

    <span style="color: blue">private</span> <span style="color: blue">void</span> FirePropertyChanged(<span style="color: blue">string</span> propertyName)
    {
        <span style="color: blue">if</span> (PropertyChanged != <span style="color: blue">null</span>)
            PropertyChanged(<span style="color: blue">this</span>, <span style="color: blue">new</span> <span style="color: #2b91af">PropertyChangedEventArgs</span>(propertyName));
    }
}</pre>
<p>And now the title updates when you change the name.</p>
<p>We are starting to see the need for a view model. The Title property has nothing to do with our data model. But we’ll let that slide for now.</p>
<p>Today we saw what problem INotifyPropertyChanged solves, and we wrote the simplest thing that works. This is not the best thing, nor is it the right thing. We are watching the code evolve to see why we need MVVM.</p>
<p>Next time we will add another feature to the system and see how the code responds to another change. Stay tuned.</p>
				</div>

				<p class="postmetadata">Posted in <a href="indexb0b7.html?cat=6" title="View all posts in Patterns" rel="category">Patterns</a> |   <a href="index5b8d.html?p=498#respond" title="Comment on Hands-on MVVM 2: Dependent properties">No Comments &#187;</a></p>

			</div>

				<div class="post">
				<h3 id="post-494"><a href="indexdba8.html?p=494" rel="bookmark" title="Permanent Link to Hands-on MVVM 1: Model and View">Hands-on MVVM 1: Model and View</a></h3>
				<small>Monday, May 3rd, 2010</small>

				<div class="entry">
					<p>I will be presenting this material at Dallas XAML tomorrow (May 4, 2010). If you are in the area, please come by. If not, just <a href="wp-content/uploads/2010/05/dallasxaml_mvvm.zip" title="download the demo code">download the demo code</a> and follow along.</p>
<p>Microsoft has finally nailed data binding in WPF and Silverlight. It has long been ridiculed as a demo-only feature. But now it is useful in real application development.</p>
<p>As people apply data binding to real applications, patterns have emerged. One of the most prevalent is Model-View-ViewModel. In truth, MVVM is not just one pattern. It is a collection if interrelated patterns. Each person has a different idea of what MVVM actually looks like. This is my opinion.</p>
<p>The goal of this series is to understand why it is good to follow these patterns. We are going to start with direct data binding. We won’t add any code until we need it. When we find that things don’t work, we’ll add code to make them work. When things start to get messy, we will refactor to clean them up.</p>
<p><strong>The model</strong><br />
The application that we are building keeps track of people. It starts innocently enough with a class called Person:</p>
<pre><span style="color: blue">public</span> <span style="color: blue">class</span> <span style="color: #2b91af">Person</span>
{
    <span style="color: blue">private</span> <span style="color: blue">string</span> _firstName;
    <span style="color: blue">private</span> <span style="color: blue">string</span> _lastName;
    <span style="color: blue">private</span> <span style="color: blue">string</span> _email;
    <span style="color: blue">private</span> <span style="color: blue">string</span> _phone;

    <span style="color: blue">public</span> <span style="color: blue">string</span> FirstName
    {
        <span style="color: blue">get</span> { <span style="color: blue">return</span> _firstName; }
        <span style="color: blue">set</span> { _firstName = value; }
    }

    <span style="color: blue">public</span> <span style="color: blue">string</span> LastName
    {
        <span style="color: blue">get</span> { <span style="color: blue">return</span> _lastName; }
        <span style="color: blue">set</span> { _lastName = value; }
    }

    <span style="color: blue">public</span> <span style="color: blue">string</span> Email
    {
        <span style="color: blue">get</span> { <span style="color: blue">return</span> _email; }
        <span style="color: blue">set</span> { _email = value; }
    }

    <span style="color: blue">public</span> <span style="color: blue">string</span> Phone
    {
        <span style="color: blue">get</span> { <span style="color: blue">return</span> _phone; }
        <span style="color: blue">set</span> { _phone = value; }
    }
}</pre>
<p>Notice that this class does not implement INotifyPropertyChanged. We are starting simple so we know why we need that code.</p>
<p><strong>The view</strong></p>
<p>We’ll data bind our view directly to our model. Data binding works against properties. The Person user control defines one text box for each Person property.</p>
<pre><span style="color: blue">&lt;</span><span style="color: maroon">UserControl</span> <span style="color: red">x:Class</span>="<span style="color: blue">Step1.View.PersonUserControl</span>"
    <span style="color: red">xmlns</span>="<span style="color: blue">http://schemas.microsoft.com/winfx/2006/xaml/presentation</span>"
    <span style="color: red">xmlns:x</span>="<span style="color: blue">http://schemas.microsoft.com/winfx/2006/xaml</span>" <span style="color: red">Background</span>="<span style="color: blue">#FF353535</span>"<span style="color: blue">&gt;</span>
    <span style="color: blue">&lt;</span><span style="color: maroon">Grid</span> <span style="color: red">Margin</span>="<span style="color: blue">5</span>"<span style="color: blue">&gt;</span>
        <span style="color: blue">&lt;</span><span style="color: maroon">Grid.RowDefinitions</span><span style="color: blue">&gt;</span>
            <span style="color: blue">&lt;</span><span style="color: maroon">RowDefinition</span> <span style="color: red">Height</span>="<span style="color: blue">Auto</span>"/<span style="color: blue">&gt;</span>
            <span style="color: blue">&lt;</span><span style="color: maroon">RowDefinition</span> <span style="color: red">Height</span>="<span style="color: blue">Auto</span>"/<span style="color: blue">&gt;</span>
            <span style="color: blue">&lt;</span><span style="color: maroon">RowDefinition</span> <span style="color: red">Height</span>="<span style="color: blue">Auto</span>"/<span style="color: blue">&gt;</span>
            <span style="color: blue">&lt;</span><span style="color: maroon">RowDefinition</span> <span style="color: red">Height</span>="<span style="color: blue">Auto</span>"/<span style="color: blue">&gt;</span>
            <span style="color: blue">&lt;</span><span style="color: maroon">RowDefinition/</span><span style="color: blue">&gt;</span>
        <span style="color: blue">&lt;</span>/<span style="color: maroon">Grid.RowDefinitions</span><span style="color: blue">&gt;</span>
        <span style="color: blue">&lt;</span><span style="color: maroon">Grid.ColumnDefinitions</span><span style="color: blue">&gt;</span>
            <span style="color: blue">&lt;</span><span style="color: maroon">ColumnDefinition</span> <span style="color: red">Width</span>="<span style="color: blue">Auto</span>"/<span style="color: blue">&gt;</span>
            <span style="color: blue">&lt;</span><span style="color: maroon">ColumnDefinition</span> <span style="color: red">Width</span>="<span style="color: blue">*</span>"/<span style="color: blue">&gt;</span>
        <span style="color: blue">&lt;</span>/<span style="color: maroon">Grid.ColumnDefinitions</span><span style="color: blue">&gt;</span>

        <span style="color: blue">&lt;</span><span style="color: maroon">Label</span> <span style="color: red">Grid.Row</span>="<span style="color: blue">0</span>" <span style="color: red">Target</span>="<span style="color: blue">{Binding ElementName=firstName}</span>" <span style="color: red">Content</span>="<span style="color: blue">_First Name:</span>"/<span style="color: blue">&gt;</span>
        <span style="color: blue">&lt;</span><span style="color: maroon">Label</span> <span style="color: red">Grid.Row</span>="<span style="color: blue">1</span>" <span style="color: red">Target</span>="<span style="color: blue">{Binding ElementName=lastName}</span>" <span style="color: red">Content</span>="<span style="color: blue">_Last Name:</span>"/<span style="color: blue">&gt;</span>
        <span style="color: blue">&lt;</span><span style="color: maroon">Label</span> <span style="color: red">Grid.Row</span>="<span style="color: blue">2</span>" <span style="color: red">Target</span>="<span style="color: blue">{Binding ElementName=email}</span>" <span style="color: red">Content</span>="<span style="color: blue">_Email:</span>"/<span style="color: blue">&gt;</span>
        <span style="color: blue">&lt;</span><span style="color: maroon">Label</span> <span style="color: red">Grid.Row</span>="<span style="color: blue">3</span>" <span style="color: red">Target</span>="<span style="color: blue">{Binding ElementName=phone}</span>" <span style="color: red">Content</span>="<span style="color: blue">_Phone:</span>"/<span style="color: blue">&gt;</span>

        <span style="color: blue">&lt;</span><span style="color: maroon">TextBox</span> <span style="color: red">Grid.Row</span>="<span style="color: blue">0</span>" <span style="color: red">Grid.Column</span>="<span style="color: blue">1</span>" <span style="color: red">x:Name</span>="<span style="color: blue">firstName</span>" <span style="color: red">Text</span>="<span style="color: blue">{Binding FirstName}</span>"/<span style="color: blue">&gt;</span>
        <span style="color: blue">&lt;</span><span style="color: maroon">TextBox</span> <span style="color: red">Grid.Row</span>="<span style="color: blue">1</span>" <span style="color: red">Grid.Column</span>="<span style="color: blue">1</span>" <span style="color: red">x:Name</span>="<span style="color: blue">lastName</span>" <span style="color: red">Text</span>="<span style="color: blue">{Binding LastName}</span>"/<span style="color: blue">&gt;</span>
        <span style="color: blue">&lt;</span><span style="color: maroon">TextBox</span> <span style="color: red">Grid.Row</span>="<span style="color: blue">2</span>" <span style="color: red">Grid.Column</span>="<span style="color: blue">1</span>" <span style="color: red">x:Name</span>="<span style="color: blue">email</span>" <span style="color: red">Text</span>="<span style="color: blue">{Binding Email}</span>"/<span style="color: blue">&gt;</span>
        <span style="color: blue">&lt;</span><span style="color: maroon">TextBox</span> <span style="color: red">Grid.Row</span>="<span style="color: blue">3</span>" <span style="color: red">Grid.Column</span>="<span style="color: blue">1</span>" <span style="color: red">x:Name</span>="<span style="color: blue">phone</span>" <span style="color: red">Text</span>="<span style="color: blue">{Binding Phone}</span>"/<span style="color: blue">&gt;</span>
    <span style="color: blue">&lt;</span>/<span style="color: maroon">Grid</span><span style="color: blue">&gt;</span>
<span style="color: blue">&lt;</span>/<span style="color: maroon">UserControl</span><span style="color: blue">&gt;</span></pre>
<p>Notice that the view only contains layout and controls. All of the styling is expressed in App.xaml.</p>
<p><strong>The application</strong></p>
<p>The view needs an instance of the model to bind to. Our application will load this instance from a data source – most likely a database or a web service – and give it to the view. The view is hosted within a window. This is all accomplished in Application_Startup.</p>
<pre><span style="color: #2b91af">DataSource</span> dataSource = <span style="color: blue">new</span> <span style="color: #2b91af">DataSource</span>();
<span style="color: blue">this</span>.MainWindow = <span style="color: blue">new</span> <span style="color: #2b91af">PersonWindow</span>();
<span style="color: blue">this</span>.MainWindow.DataContext = dataSource.GetPerson();
<span style="color: blue">this</span>.MainWindow.Show();</pre>
<p>Again, we are keeping it simple. There is no dependency injection. There is no service locator. If we see that we need that code, we will add it.</p>
<p><a href="wp-content/uploads/2010/05/person-window.jpg"><img src="wp-content/uploads/2010/05/person-window-thumb.jpg" title="person_window" style="border: 0px none; display: inline; margin-left: 0px; margin-right: 0px" alt="person_window" width="244" align="right" border="0" height="158" /></a> When you run this program, the Person window appears. It is bound to the person that we loaded from the data source. When you edit the properties of a person, your changes are set directly into the model.</p>
<p>The code is extremely simple, and it worked out-of-the-box. So far we haven’t seen a need to implement INotifyPropertyChanged. Strictly speaking, that interface is not necessary for data binding to work. But very soon we will run into situations in which it is necessary.</p>
<p>Also, we have not yet created a ViewModel. It is not strictly necessary for getting an application working. But again, we will soon see a situation in which it makes our code much cleaner.</p>
<p>In <a href="index5b8d.html?p=498">part 2</a>, we will add features to this application. Let’s see how those features look when we bind the view directly to the model.</p>
				</div>

				<p class="postmetadata">Posted in <a href="indexb0b7.html?cat=6" title="View all posts in Patterns" rel="category">Patterns</a>,  <a href="indexb31a.html?cat=1" title="View all posts in Uncategorized" rel="category">Uncategorized</a> |   <a href="indexdba8.html?p=494#respond" title="Comment on Hands-on MVVM 1: Model and View">No Comments &#187;</a></p>

			</div>

				<div class="post">
				<h3 id="post-443"><a href="indexe0b1.html?p=443" rel="bookmark" title="Permanent Link to Table as queue">Table as queue</a></h3>
				<small>Wednesday, September 30th, 2009</small>

				<div class="entry">
					<p>To play along at home, please download the <a href="wp-content/uploads/2009/09/queues.mp3" title="queues.sql">script</a> for SQL Server 2005. It may work on earlier versions, but I haven't tried it.</p>
<p>Yesterday I said that <a href="index6c6e.html?p=442">the data is the queue</a>. It is a mistake to separate the processing of data from the data itself. I proposed an architecture in which there is no workflow orchestration, there are only autonomous worker processes. These processes pick up work based on attributes of the objects on which they act, not based on any external queue.</p>
<p>There are a small number of database patterns that make this possible. One that I often use is Table as Queue.</p>
<p><strong>Setup a test environment</strong><br />
I created a test database called "Queues" to test this pattern. You can find the script attached. As it is now, this script is incorrect. We will correct it as we go along.</p>
<p>The database has two tables. The Order table holds orders that we want to process. If the order hasn't been processed, it has no confirmation number. If it has, it does. The Log table holds a log of all the steps the order processor has gone through. This will help us see how well we are doing.</p>
<p>There are three stored procedures that we'll use. The InsertLoop stored procedure generates some test data. Run this one first. The ProcessLoop stored procedure simulates the ERP process. You'll want to open two query windows and enter "EXEC ProcessLoop" in both of them. Finally, the ViewLog procedure lets us see how we did.</p>
<p><strong>Anatomy of a queue procedure</strong><br />
The ProcessLoop stored procedure begins by selecting one order to process. It returns only the ID of this order.</p>
<pre>-- Get a work item
SET @orderId =
  (SELECT TOP <span style="color: maroon">1</span>
	OrderId
	FROM [Order]
	WHERE ConfirmationNumber IS NULL)</pre>
<p>This ID has to be the primary key of the table. This is necessary for correct queuing behavior. If it is not the primary key, we will not get the correct locks later.</p>
<p>To process the order, other details about that record will be required. These should be fetched separately by the returned ID. Do not try to combine these steps.</p>
<p><strong>Default isolation level</strong><br />
Right now, the ProcessLoop stored procedure uses the default transaction isolation level (read committed). It starts a transaction, gets an order from the queue, processes it, and updates the confirmation number.</p>
<p>Hit F5 on both of your ProcessLoop query windows. While this is running, run ViewLog. You'll see something like this:</p>
<table style="width: 258pt; border-collapse: collapse" border="0" cellpadding="0" cellspacing="0" width="344">
<tr style="height: 15pt" height="20">
<td class="xl65" style="width: 29pt; height: 15pt" width="55" height="20">OrderID</td>
<td class="xl65" style="width: 66pt" width="80">Action</td>
<td class="xl65" style="width: 31pt" width="41">SPID</td>
<td class="xl65" style="width: 132pt" width="166">Date/Time</td>
</tr>
<tr style="height: 15pt" height="20">
<td class="xl65" style="width: 29pt; height: 15pt" width="55" height="20">89</td>
<td class="xl65" style="width: 66pt" width="80">Processing</td>
<td class="xl65" style="width: 31pt" width="41">52</td>
<td class="xl65" style="width: 132pt" width="166">2009-09-29 12:51:18.163</td>
</tr>
<tr style="height: 15pt" height="20">
<td class="xl65" style="height: 15pt" width="55" height="20">89</td>
<td class="xl65" width="80">Processing</td>
<td class="xl65">53</td>
<td class="xl65">2009-09-29 12:51:18.337</td>
</tr>
<tr style="height: 15pt" height="20">
<td class="xl65" style="height: 15pt" width="55" height="20">89</td>
<td class="xl65" width="80">Updating</td>
<td class="xl65">52</td>
<td class="xl65">2009-09-29 12:51:19.163</td>
</tr>
<tr style="height: 15pt" height="20">
<td class="xl65" style="height: 15pt" width="55" height="20">89</td>
<td class="xl65" width="80">Finished</td>
<td class="xl65">52</td>
<td class="xl65">2009-09-29 12:51:19.163</td>
</tr>
<tr style="height: 15pt" height="20">
<td class="xl65" style="height: 15pt" width="55" height="20">89</td>
<td class="xl65" width="80">Updating</td>
<td class="xl65">53</td>
<td class="xl65">2009-09-29 12:51:19.337</td>
</tr>
<tr style="height: 15pt" height="20">
<td class="xl65" style="height: 15pt" width="55" height="20">89</td>
<td class="xl65" width="80">Finished</td>
<td class="xl65">53</td>
<td class="xl65">2009-09-29 12:51:19.337</td>
</tr>
<tr style="height: 15pt" height="20">
<td class="xl65" style="height: 15pt" width="55" height="20">90</td>
<td class="xl65" width="80">Processing</td>
<td class="xl65">52</td>
<td class="xl65">2009-09-29 12:51:19.663</td>
</tr>
<tr style="height: 15pt" height="20">
<td class="xl65" style="height: 15pt" width="55" height="20">90</td>
<td class="xl65" width="80">Processing</td>
<td class="xl65">53</td>
<td class="xl65">2009-09-29 12:51:19.837</td>
</tr>
<tr style="height: 15pt" height="20">
<td class="xl65" style="height: 15pt" width="55" height="20">90</td>
<td class="xl65" width="80">Updating</td>
<td class="xl65">52</td>
<td class="xl65">2009-09-29 12:51:20.663</td>
</tr>
<tr style="height: 15pt" height="20">
<td class="xl65" style="height: 15pt" width="55" height="20">90</td>
<td class="xl65" width="80">Finished</td>
<td class="xl65">52</td>
<td class="xl65">2009-09-29 12:51:20.663</td>
</tr>
<tr style="height: 15pt" height="20">
<td class="xl65" style="height: 15pt" width="55" height="20">90</td>
<td class="xl65" width="80">Updating</td>
<td class="xl65">53</td>
<td class="xl65">2009-09-29 12:51:20.837</td>
</tr>
<tr style="height: 15pt" height="20">
<td class="xl65" style="height: 15pt" width="55" height="20">90</td>
<td class="xl65" width="80">Finished</td>
<td class="xl65">53</td>
<td class="xl65">2009-09-29 12:51:20.837</td>
</tr>
</table>
<p>Both of the SPIDs are processing all of the orders. This is clearly not what we want. We want only one SPID to process each order.</p>
<p><strong>Higher isolation level</strong><br />
The other process is able to sneak in between the SELECT and the UPDATE and perform an UPDATE of its own. We want to ensure that the row that the process UPDATEs is the same version it SELECTed. The way to do this is to raise the isolation level to REPEATABLE READ. As the name implies, it ensures that two SELECTs within the same transaction will read the same data. What it also means is that an UPDATE in the same transaction will update the same version of the row. No intermediate UPDATEs will be allowed.</p>
<p>Make the following change to the ProcessLoop procedure:</p>
<pre>SET TRANSACTION ISOLATION LEVEL REPEATABLE READ</pre>
<p>Then start the two ProcessLoops again. Before long you will get the error "Transaction (Process ID 53) was deadlocked on lock resources with another process and has been chosen as the deadlock victim. Rerun the transaction." The other process will still be running.</p>
<p>Kill the remaining process. Close the window so that you can commit the transactions that got left open. Then open a new window and type "EXEC ProcessLoop" again to prepare for the next step.</p>
<p>If you look at the log, you'll see only one of the SPIDs represented. The logs from the other one were rolled back with its transaction.</p>
<p>What happened is that both SPIDs SELECTed the same record. The first one UPDATEd it, which prevented the second from doing so. When it tried to UPDATE, SQL recognized the deadlock and rolled it back.</p>
<p><strong>Update lock</strong><br />
What we want to do is lock the record so that the first one to SELECT it is the one to process it. We'll do this by escalating our read lock to an update lock.</p>
<pre>-- Get a work item
SET @orderId =
  (SELECT TOP <span style="color: maroon">1</span>
	OrderId
	FROM [Order] <strong>WITH (UPDLOCK)</strong>
	WHERE ConfirmationNumber IS NULL)</pre>
<p>Now run the two processes and see what happens.</p>
<table style="width: 258pt; border-collapse: collapse" border="0" cellpadding="0" cellspacing="0" width="344">
<tr style="height: 15pt" height="20">
<td class="xl65" style="width: 29pt; height: 15pt" width="55" height="20">OrderID</td>
<td class="xl65" style="width: 66pt" width="80">Action</td>
<td class="xl65" style="width: 31pt" width="41">SPID</td>
<td class="xl65" style="width: 132pt" width="166">Date/Time</td>
</tr>
<tr style="height: 15pt" height="20">
<td class="xl65" style="width: 29pt; height: 15pt" width="55" height="20">138</td>
<td class="xl65" style="width: 66pt" width="80">Processing</td>
<td class="xl65" style="width: 31pt" width="41">52</td>
<td class="xl65" style="width: 132pt" width="166">2009-09-29 14:05:26.173</td>
</tr>
<tr style="height: 15pt" height="20">
<td class="xl65" style="height: 15pt" width="55" height="20">138</td>
<td class="xl65" width="80">Updating</td>
<td class="xl65">52</td>
<td class="xl65">2009-09-29 14:05:27.173</td>
</tr>
<tr style="height: 15pt" height="20">
<td class="xl65" style="height: 15pt" width="55" height="20">138</td>
<td class="xl65" width="80">Finished</td>
<td class="xl65">52</td>
<td class="xl65">2009-09-29 14:05:27.173</td>
</tr>
<tr style="height: 15pt" height="20">
<td class="xl65" style="height: 15pt" width="55" height="20">139</td>
<td class="xl65" width="80">Processing</td>
<td class="xl65">53</td>
<td class="xl65">2009-09-29 14:05:27.173</td>
</tr>
<tr style="height: 15pt" height="20">
<td class="xl65" style="height: 15pt" width="55" height="20">139</td>
<td class="xl65" width="80">Updating</td>
<td class="xl65">53</td>
<td class="xl65">2009-09-29 14:05:28.173</td>
</tr>
<tr style="height: 15pt" height="20">
<td class="xl65" style="height: 15pt" width="55" height="20">139</td>
<td class="xl65" width="80">Finished</td>
<td class="xl65">53</td>
<td class="xl65">2009-09-29 14:05:28.173</td>
</tr>
<tr style="height: 15pt" height="20">
<td class="xl65" style="height: 15pt" width="55" height="20">140</td>
<td class="xl65" width="80">Processing</td>
<td class="xl65">52</td>
<td class="xl65">2009-09-29 14:05:28.173</td>
</tr>
<tr style="height: 15pt" height="20">
<td class="xl65" style="height: 15pt" width="55" height="20">140</td>
<td class="xl65" width="80">Updating</td>
<td class="xl65">52</td>
<td class="xl65">2009-09-29 14:05:29.173</td>
</tr>
<tr style="height: 15pt" height="20">
<td class="xl65" style="height: 15pt" width="55" height="20">140</td>
<td class="xl65" width="80">Finished</td>
<td class="xl65">52</td>
<td class="xl65">2009-09-29 14:05:29.377</td>
</tr>
</table>
<p>At first glance this looks good. Each order is processed by just one SPID. But look closely at the times. The two processes are taking turns. Each one enters SELECT, but then waits for the other one to commit its transaction before SELECT returns.</p>
<p>Since we've requested an update lock, the higher transaction isolation level makes no difference. We can turn it back down to the default.</p>
<p><strong>Read past</strong><br />
We want each process to skip over locked rows. We do this by specifying the READPAST query hint.</p>
<pre>-- Get a work item
SET @orderId =
  (SELECT TOP <span style="color: maroon">1</span>
	OrderId
	FROM [Order] WITH (UPDLOCK, <strong>READPAST</strong>)
	WHERE ConfirmationNumber IS NULL)</pre>
<p>With this hint in place, we get some good behavior.</p>
<table style="width: 258pt; border-collapse: collapse" border="0" cellpadding="0" cellspacing="0" width="344">
<tr style="height: 15pt" height="20">
<td class="xl65" style="width: 29pt; height: 15pt" width="55" height="20">OrderID</td>
<td class="xl65" style="width: 66pt" width="80">Action</td>
<td class="xl65" style="width: 31pt" width="41">SPID</td>
<td class="xl65" style="width: 132pt" width="166">Date/Time</td>
</tr>
<tr style="height: 15pt" height="20">
<td class="xl65" style="width: 29pt; height: 15pt" width="39" height="20">583</td>
<td class="xl65" style="width: 66pt" width="88">Processing</td>
<td class="xl65" style="width: 31pt" width="41">53</td>
<td class="xl65" style="width: 132pt" width="176">2009-09-29 14:37:21.740</td>
</tr>
<tr style="height: 15pt" height="20">
<td class="xl65" style="height: 15pt" height="20">584</td>
<td class="xl65">Processing</td>
<td class="xl65">52</td>
<td class="xl65">2009-09-29 14:37:22.020</td>
</tr>
<tr style="height: 15pt" height="20">
<td class="xl65" style="height: 15pt" height="20">583</td>
<td class="xl65">Updating</td>
<td class="xl65">53</td>
<td class="xl65">2009-09-29 14:37:22.740</td>
</tr>
<tr style="height: 15pt" height="20">
<td class="xl65" style="height: 15pt" height="20">583</td>
<td class="xl65">Finished</td>
<td class="xl65">53</td>
<td class="xl65">2009-09-29 14:37:22.740</td>
</tr>
<tr style="height: 15pt" height="20">
<td class="xl65" style="height: 15pt" height="20">584</td>
<td class="xl65">Updating</td>
<td class="xl65">52</td>
<td class="xl65">2009-09-29 14:37:23.020</td>
</tr>
<tr style="height: 15pt" height="20">
<td class="xl65" style="height: 15pt" height="20">584</td>
<td class="xl65">Finished</td>
<td class="xl65">52</td>
<td class="xl65">2009-09-29 14:37:23.020</td>
</tr>
</table>
<p>Now the two processes are running concurrently. Each order is handled by only one process. There are no deadlocks.</p>
<p>With this pattern, the data itself can be used as a queue. But you have to remember the details:</p>
<ul>
<li>SELECT TOP 1 just the primary key of the queue table.</li>
<li>Use both the UPDLOCK and READPAST query hints on the SELECT.</li>
<li>Fetch additional information by ID in a separate query.</li>
<li>After operating on the data, update the record to exclude it from the original WHERE clause.</li>
<li>Perform both the SELECT and the UPDATE within the same transaction.</li>
</ul>
				</div>

				<p class="postmetadata">Posted in <a href="indexc728.html?cat=7" title="View all posts in Databases" rel="category">Databases</a>,  <a href="indexb0b7.html?cat=6" title="View all posts in Patterns" rel="category">Patterns</a> |   <a href="indexe0b1.html?p=443#respond" title="Comment on Table as queue">No Comments &#187;</a></p>

			</div>

				<div class="post">
				<h3 id="post-442"><a href="index6c6e.html?p=442" rel="bookmark" title="Permanent Link to The data is the queue">The data is the queue</a></h3>
				<small>Tuesday, September 29th, 2009</small>

				<div class="entry">
					<p>Our eCommerce system uses BizTalk to process orders. The BizTalk orchestration keeps track of the status of the order. Queues keep track of communications between BizTalk and external systems, like the ERP. The database is updated at all points in the process so the web site reflects the current order status.</p>
<p>This system is fragile.</p>
<p><strong>Problem 1: Diagnostics are scattered</strong><br />When something goes wrong, there are different ways of observing the system. The customer observes it from the web. They call support to report a problem. Support looks at the system in the Business Activity Monitor (BAM). They call ops. Ops observes the system through Health and Activity Tracking (HAT). If an activity is waiting on the receipt of a message, they will then inspect the appropriate queue. Each of these places holds part of the story.</p>
<p><strong>Problem 2: Things get out of sync</strong><br />In order to fix a problem, ops needs to take action at some level. They might cancel an orchestration. They might delete a message from a queue. They might manually enter an order into the ERP. When they do, the other parts of the system don't know about the change.</p>
<p><strong>Problem 3: Blocking</strong><br />One process is querying by status; another is updating it. One process is working on a request; another needs to skip it and go to the next. The workflow problem seems to attract blocking behaviors.</p>
<p><strong>Problem 4: Distributed transactions</strong><br />When the orchestration moves from one step to another, it needs to update the order status. Before it can wait on the receive queue, it must push to the send queue. It would be disastrous to perform one of these operations without also performing the other. So the BizTalk message box, the order database, and the outgoing and incoming message queues must be accessed within the same transaction. This brings the Distributed Transaction Coordinator into the picture, increasing fragility and exacerbating blocking behaviors.</p>
<p><strong>Here's my solution</strong><br />There is no need to manage workflow separate from data. This is the fundamental flaw in all workflow systems: BizTalk, WF, MSMQ, Service Broker, just to name a few. They all have their own data storage separate from the subject of the workflow.</p>
<p>If we relied upon the Order table instead of using BizTalk and external queues, we would have a more consistent system. We could diagnose the entire workflow from the database. Having one shared system of record, services would never get out of sync. Certain patterns could be used to eliminate unnecessary blocking. And all transactions would be local.</p>
<p>Broken down in this way, the system no longer has an overarching orchestration. You cannot open a designer and see the workflow. Instead, it has a number of autonomous processes that each move a unit of work further along the pipeline. Each process does its work in the same database.</p>
<p>There is one cardinal rule that makes this possible. <strong>The action that a process performs must also remove it from its queue.</strong></p>
<p>A process runs a query to get a work item. It then performs some action on that work item. The outcome of that action is going to be a single database command. That command, whatever it is, must render the work item ineligible for the query.</p>
<p>It is tempting to perform two database commands in the same transaction: record the results of the action and update the work item status. Avoid this pattern. This allows work items to become out of sync. Instead, design one database command that both records the result and disqualifies the work item from the query.</p>
<p><strong>Confirmation number</strong><br />Let's look at one unit of the order processing orchestration. Take the part of the system that submits the order to the ERP system. This process sends an order to a web service, and receives a confirmation number. So what if we designed this process to use the following query?</p>
<pre>SELECT TOP 1 OrderId, OrderDetails FROM [Order] WHERE ConfirmationNumber IS NULL</pre>
<p>And then recording the results of the action was:</p>
<pre>UPDATE [Order] SET ConfirmationNumber ? WHERE OrderId = ?</pre>
<p>This single UPDATE statement disqualifies the order from the SELECT statement. That means that the process will move the unit of work forward, but it can never be out of sync.</p>
<p>Unfortunately, this SELECT ... UPDATE pattern is prone to blocking. We'll look at some patterns that satisfy this cardinal rule without blocking in future posts.</p>
				</div>

				<p class="postmetadata">Posted in <a href="indexb0b7.html?cat=6" title="View all posts in Patterns" rel="category">Patterns</a> |   <a href="index6c6e.html?p=442#respond" title="Comment on The data is the queue">No Comments &#187;</a></p>

			</div>

				<div class="post">
				<h3 id="post-413"><a href="index672e.html?p=413" rel="bookmark" title="Permanent Link to MVVM and Linq to SQL the easy way">MVVM and Linq to SQL the easy way</a></h3>
				<small>Sunday, August 9th, 2009</small>

				<div class="entry">
					<p>Download the <a href="wp-content/uploads/2009/08/noteworthy.zip">source code</a> and follow along.</p>
<p>The biggest challenge implementing the MVVM pattern is the View Model responding to changes in the Data Model. Usually, the View Model needs to subscribe to the PropertyChanged events fired by the Data Model, update its internal state, and then fire its own PropertyChanged events for the View. That's the hard way.</p>
<p>The easy way is to use <a href="http://updatecontrols.net/">Update Controls</a>. With Update Controls, you just decorate the Data Model and wrap the View Model. The library takes care of everything in between.</p>
<p><strong>Decorate a Linq to SQL data model</strong><br />
You decorate the data model by adding <a href="http://updatecontrols.net/documentation/classDocumentation/vb/UpdateControls.Independent.do">Independent</a> sentries to every property. Whenever the property is accessed, call OnGet(). Whenever it is modified, call OnSet(). To decorate a Linq to SQL data model, we just need to inject these calls into the generated code. Unfortunately, the Linq to SQL code generator does not give you a way to easily tweak its output.</p>
<p>Damien Guard has solved that problem. His open source project <a href="http://l2st4.codeplex.com/">LINQ to SQL templates for T4</a> is incredibly easy to set up and start using. It drops straight into Visual Studio and replaces the build-in code generator with one that you control. With just a few edits to his provided T4 template, I replaced INotifyPropertyChanged with Independent sentries.</p>
<p>I added a sentry for each single-valued property, and called OnGet() inside of the getter and OnSet() in the setter. I also added a sentry for each collection. They require OnGet() in the getter, and OnSet() when something is added or removed. Finally, I added a sentry per table, to take care of the top-level queries. For these, I call OnSet() on any insert, update, and delete. The final T4 template is in the example source code.</p>
<p><strong>Wrap the view model for WPF</strong><br />
Wrapping the view model for the view is a one-liner.</p>
<pre><span style="color: blue">public</span> Window1()
{
    InitializeComponent();

    <span style="color: green">// Create a data model and a navigation model.</span>
    _blog = <span style="color: blue">new</span> Blog();
    BlogNavigationModel navigationModel = <span style="color: blue">new</span> BlogNavigationModel();

    <span style="color: green">// Put them both in a view model, then wrap it for the view.</span>
    <span style="color: blue">this</span>.DataContext = <strong>ForView.Wrap</strong>(<span style="color: blue">new</span> BlogViewModel(_blog, navigationModel));
}</pre>
<p>We create a view model based on the decorated data model and a similarly decorated navigation model (more on that later). Then we let Update Controls wrap it up before we give it to the view.</p>
<p><strong>View model per scope</strong><br />
<a href="wp-content/uploads/2009/08/noteworthy.png"><img src="wp-content/uploads/2009/08/noteworthy-thumb.png" style="border: 0px none " alt="Noteworthy" width="209" align="right" border="0" height="244" /></a>The example application -- Noteworthy -- is a blog editor. Different parts of the view focus on different granularities of data. The main view (shown in red) focuses on the blog as a whole. The article list items and detail pane (shown in blue) focus on a single article. And the tag list items (shown in green) focus on a single tag.</p>
<p>We define one view model class for each of these three scopes. Each one takes constructor parameters to put itself in context. So the BlogViewModel takes a Blog, the ArticleViewModel takes a Blog and an Article, and the TagViewModel takes a Blog and a Tag.</p>
<p>The DataContext property of a WPF control determines where it begins for data binding. If you don't set it, the control inherits it from its parent. If the control is an item in a list, then it is automatically set to an element of the ItemsSource. Finally, you can data bind to a property of its parent scope. Noteworthy uses all three techniques.</p>
<p><strong>Property per control attribute</strong><br />
WPF data binding connects control attributes to object properties. So within each view model, we define a property for each attribute of a control. The view model exists to serve of the view, so this one-to-one mapping is to be expected. The view model is an isolation layer designed to keep these view-specific concerns out of your data model.</p>
<p><strong>Navigation model per user context</strong><br />
The user of your application has a conceptual model of how controls should work together. Noteworthy is a single window program, so they expect all of the controls on that window to interact appropriately. If it had multiple child windows all within a parent, they would expect each window to be its own context, but participate within the context of the main window. And if it were a composite application, they would expect all of the components to work together.</p>
<p>Where the user draws their conceptual boundary, we create a navigation model. A navigation model records the user's point-of-view as they navigate through the application. It keeps track of their selection and temporary input.</p>
<p>All of the state in the navigation model is transient. Nothing is written to the database. Persistent state belongs in the data model. This keeps the view model completely stateless. The view model has only behavior, which depends upon the data model and the navigation model.</p>
<p>Because the navigation model is transient, we just write fields, select them, and hit Ctrl+D, G to generate the properties. For example, here's the property that records the selected article. The part that I wrote by hand is highlighted:</p>
<pre><span style="color: blue">public</span> <span style="color: blue">class</span> BlogNavigationModel
{
<strong>    <span style="color: blue">private</span> Article _selectedArticle;
</strong>
    <span style="color: blue">#region</span> Independent properties
    <span style="color: green">// Generated by Update Controls --------------------------------</span>
    <span style="color: blue">private</span> Independent _indSelectedArticle = <span style="color: blue">new</span> Independent();

    <span style="color: gray">/// &lt;summary&gt;</span>
    <span style="color: gray">/// The article for which to display details.</span>
    <span style="color: gray">/// &lt;/summary&gt;</span>
    <span style="color: blue">public</span> Article SelectedArticle
    {
        <span style="color: blue">get</span> { _indSelectedArticle.OnGet(); <span style="color: blue">return</span> _selectedArticle; }
        <span style="color: blue">set</span> { _indSelectedArticle.OnSet(); _selectedArticle = value; }
    }
    <span style="color: green">// End generated code --------------------------------</span>
    <span style="color: blue">#endregion</span>
}</pre>
<p>The properties of the navigation model are always data model types, never view model types. The view model depends upon the navigation model, not vice-versa.</p>
<p><strong>Explore on your own</strong><br />
That's just enough to get you started. There are many interesting patterns that came together in the making of Noteworthy. Here are some that you might want to examine on your own:</p>
<ul>
<li>The BlogViewModel.Articles property is filtered by the selected tag.</li>
<li>The article detail pane is a Grid within a Grid. The outer grid binds IsEnabled, while the inner grid binds DataContext.</li>
<li>The TagListBoxStyle resource binds the ListBoxItem.IsSelected attribute to the TagViewModel.TagIsSelected property to support multiple selection.</li>
<li>The Blog data model class uses a Dependent sentry to cache Tags.</li>
<li>Every view model setter and command that affects the data model calls SubmitChanges.</li>
<li>The ArticleViewModel.AvailableTags property uses .Except() to get all tags not assigned to the article.</li>
<li>The BlogViewModel.SelectedArticle property wraps the data object from the navigation model in a view model, and then unwraps it on the way back.</li>
<li>The first tag in BlogViewModel.Filters is actually not a tag at all. It is a null to represent the lack of a filter.</li>
</ul>
<p>Expect future posts to return to this example and explore these points in more detail.</p>
				</div>

				<p class="postmetadata">Posted in <a href="indexb0b7.html?cat=6" title="View all posts in Patterns" rel="category">Patterns</a>,  <a href="indexa88f.html?cat=36" title="View all posts in Update Controls" rel="category">Update Controls</a> |   <a href="index672e.html?p=413#comments" title="Comment on MVVM and Linq to SQL the easy way">1 Comment &#187;</a></p>

			</div>

		
		<div class="navigation">
			<div class="alignleft"><a href="indexd72b.html?cat=6&amp;paged=2">&laquo; Previous Entries</a></div>
			<div class="alignright"></div>
		</div>

	
	</div>
		</td>
	</tr>
</table>

<hr />
<div id="footer">
<!-- If you'd like to support WordPress, having the "powered by" link someone on your blog is the best way, it's our only promotion or advertising. -->
	<p>
		Adventures in Software is proudly powered by 
		<a href="http://wordpress.org/">WordPress</a>
		<br /><a href="indexd784.html?feed=rss2">Entries (RSS)</a>
		and <a href="indexa6da.html?feed=comments-rss2">Comments (RSS)</a>.
		<!-- 17 queries. 0.542 seconds. -->
	</p>
</div>
<script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
try {
var pageTracker = _gat._getTracker("UA-389401-3");
pageTracker._trackPageview();
} catch(err) {}</script></div>

<!-- Gorgeous design by Michael Heilemann - http://binarybonsai.com/kubrick/ -->

		<div id="sk2-footer" style="color:#FFF; background-color:#444; padding: 3px 2px 3px 2px; border-top: #888 solid 1px;">This blog is protected by <a href="http://unknowngenius.com/blog/" title="Dave">dr Dave</a>'s <strong><a href="http://unknowngenius.com/blog/wordpress/spam-karma/" title="SK2">Spam Karma 2</a></strong>: <strong>274531</strong>  Spams eaten and counting...</div><script type="text/javascript" src="replies.js"></script>
<script type="text/javascript" src="blogger.js"></script>
<script type="text/javascript" src="http://twitter.com/statuses/user_timeline/michaellperry.json?callback=twitterCallback2&amp;count=5"></script>
<script type="text/javascript" src="http://search.twitter.com/search.json?q=@michaellperry&amp;callback=twitterCallbackReplies&amp;rpp=5"></script>
</body>

<!-- Mirrored from adventuresinsoftware.com/blog/?cat=6 by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 13 Jan 2017 12:55:00 GMT -->
</html>
