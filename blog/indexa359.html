<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr">


<!-- Mirrored from adventuresinsoftware.com/blog/?paged=9 by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 13 Jan 2017 13:10:15 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- /Added by HTTrack -->
<head profile="http://gmpg.org/xfn/11">
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />

<title>Adventures in Software  </title>

<meta name="generator" content="WordPress 2.3.3" /> <!-- leave this for stats -->

<link rel="stylesheet" href="wp-content/themes/ais2/style.css" type="text/css" media="screen" />
<link rel="alternate" type="application/rss+xml" title="Adventures in Software RSS Feed" href="indexd784.html?feed=rss2" />
<link rel="pingback" href="xmlrpc.html" />
    <script type="text/javascript">
        function onSilverlightError(sender, args) {
            var appSource = "";
            if (sender != null && sender != 0) {
              appSource = sender.getHost().Source;
            }
            
            var errorType = args.ErrorType;
            var iErrorCode = args.ErrorCode;

            if (errorType == "ImageError" || errorType == "MediaError") {
              return;
            }

            var errMsg = "Unhandled Error in Silverlight Application " +  appSource + "\n" ;

            errMsg += "Code: "+ iErrorCode + "    \n";
            errMsg += "Category: " + errorType + "       \n";
            errMsg += "Message: " + args.ErrorMessage + "     \n";

            if (errorType == "ParserError") {
                errMsg += "File: " + args.xamlFile + "     \n";
                errMsg += "Line: " + args.lineNumber + "     \n";
                errMsg += "Position: " + args.charPosition + "     \n";
            }
            else if (errorType == "RuntimeError") {           
                if (args.lineNumber != 0) {
                    errMsg += "Line: " + args.lineNumber + "     \n";
                    errMsg += "Position: " +  args.charPosition + "     \n";
                }
                errMsg += "MethodName: " + args.methodName + "     \n";
            }

            throw new Error(errMsg);
        }
    </script>

	<link rel="EditURI" type="application/rsd+xml" title="RSD" href="xmlrpc0db0.php?rsd" />
 <link rel="wlwmanifest" type="application/wlwmanifest+xml" href="wp-includes/wlwmanifest.xml" /> <style type='text/css'>
<!--#header { background: url('wp-content/themes/ais2/images/header-imgae03.html?upper=A7A73F&amp;lower=77773F') no-repeat bottom center; }
--></style>
</head>
<body>
<div id="page">

<div class="aisTopBar">
	<form method="get" id="searchform" action="http://adventuresinsoftware.com/blog/">
<div>
<a href="indexd784.html?feed=rss2"><img src="../images/feed-icon-28x28.png" border="0"></a>
<input type="text" value="" name="s" id="s" />
<input type="submit" id="searchsubmit" value="Search" />
</div>
</form>
</div>

<div class="aisHeaderImageRight">
	<div class="aisHeaderImage">
	<div class="aisHeaderCornerRight">
	<div class="aisHeaderCornerLeft">
	<div class="aisImageBar">
	<div class="aisSubSites">
		<a href="index.html" class="aisSubSiteLink"><span class="aisSiteTabRight"><span class="aisSiteTabLeft"><span class="aisSiteTab">
			home</span></span></span></a>
		<a class="aisSubSiteLink" href="indexb60a.html?cat=27"><span class="aisSiteTabRight"><span class="aisSiteTabLeft"><span class="aisSiteTab">
			historic modeling</span></span></span></a>
		<a class="aisSubSiteLink" href="indexa88f.html?cat=36"><span class="aisSiteTabRight"><span class="aisSiteTabLeft"><span class="aisSiteTab">
			update controls</span></span></span></a>
		<a href="index2d79.html?cat=26" class="aisSubSiteLink"><span class="aisSiteTabRight"><span class="aisSiteTabLeft"><span class="aisSiteTab">
			degrees of freedom</span></span></span></a>
		<a class="aisSubSiteLink" href="indexba53.html?page_id=2"><span class="aisSiteTabRight"><span class="aisSiteTabLeft"><span class="aisSiteTab">
			about us</span></span></span></a>

	</div>
	</div>
	</div>
	</div>
	</div>
</div>

<table style="width: 100%" cellspacing="0" cellpadding="0">
	<tr valign="top">
		<td width="210px">
<div id="sidebar">
<div class="aisLeftColumnFill">
<div class="aisLeftColumnBottom">
<div class="aisLeftColumnTop">
<div id="twitter_div" class="aisLeftNav">
<h2 class="sidebar-title">Twitter Updates</h2>
<ul id="twitter_update_list"></ul>
<a href="http://twitter.com/michaellperry" id="follow">Follow me</a>
</div>
<div id="twitter_reply_div" class="aisLeftNav">
<h2 class="sidebar-title">Twitter Replies</h2>
<ul id="twitter_reply_list"></ul>
</div>

<div class="aisLeftNav">
<a href='http://ineta.org/Speakers/SearchCommunitySpeakers.aspx?SpeakerId=c5110e21-9243-461b-a464-a6548524e885'><img alt='INETA Community Speakers Program' border='0' src='../../www.ineta.org/images/OfficialLogos/InetaCommunitySpeakersRequestMe.html' /></a>
</div>

<div class="aisLeftNav">
	<li class="pagenav"><h2>Pages</h2><ul><li class="page_item page-item-2"><a href="indexba53.html?page_id=2" title="About Us">About Us</a></li>
<li class="page_item page-item-210"><a href="index6ae3.html?page_id=210" title="Templates">Templates</a></li>
</ul></li></div>

<div class="aisLeftNav">
<h2>Archives</h2>
<ul>
	<li><a href='indexb4d5.html?m=201110' title='October 2011'>October 2011</a></li>
	<li><a href='indexc61a.html?m=201106' title='June 2011'>June 2011</a></li>
	<li><a href='indexa80d.html?m=201105' title='May 2011'>May 2011</a></li>
	<li><a href='index512b.html?m=201104' title='April 2011'>April 2011</a></li>
	<li><a href='index08fb.html?m=201103' title='March 2011'>March 2011</a></li>
	<li><a href='index52f4.html?m=201102' title='February 2011'>February 2011</a></li>
	<li><a href='index74f1.html?m=201101' title='January 2011'>January 2011</a></li>
	<li><a href='index8956.html?m=201012' title='December 2010'>December 2010</a></li>
	<li><a href='indexa1aa.html?m=201011' title='November 2010'>November 2010</a></li>
	<li><a href='indexe3d5.html?m=201010' title='October 2010'>October 2010</a></li>
	<li><a href='index9ab9.html?m=201009' title='September 2010'>September 2010</a></li>
	<li><a href='index1ff0.html?m=201008' title='August 2010'>August 2010</a></li>
	<li><a href='index9f11.html?m=201007' title='July 2010'>July 2010</a></li>
	<li><a href='index31f0.html?m=201006' title='June 2010'>June 2010</a></li>
	<li><a href='indexd189.html?m=201005' title='May 2010'>May 2010</a></li>
	<li><a href='indexb5c0.html?m=201004' title='April 2010'>April 2010</a></li>
	<li><a href='indexf258.html?m=201003' title='March 2010'>March 2010</a></li>
	<li><a href='index6e30.html?m=201002' title='February 2010'>February 2010</a></li>
	<li><a href='index6b19.html?m=201001' title='January 2010'>January 2010</a></li>
	<li><a href='index5c0a.html?m=200912' title='December 2009'>December 2009</a></li>
	<li><a href='index8f62.html?m=200911' title='November 2009'>November 2009</a></li>
	<li><a href='index451d.html?m=200910' title='October 2009'>October 2009</a></li>
	<li><a href='index3e04.html?m=200909' title='September 2009'>September 2009</a></li>
	<li><a href='index425a.html?m=200908' title='August 2009'>August 2009</a></li>
	<li><a href='index9907.html?m=200907' title='July 2009'>July 2009</a></li>
	<li><a href='index3104.html?m=200906' title='June 2009'>June 2009</a></li>
	<li><a href='indexc36d.html?m=200905' title='May 2009'>May 2009</a></li>
	<li><a href='index17e8.html?m=200904' title='April 2009'>April 2009</a></li>
	<li><a href='index10a5.html?m=200903' title='March 2009'>March 2009</a></li>
	<li><a href='index8988.html?m=200902' title='February 2009'>February 2009</a></li>
	<li><a href='index1419.html?m=200901' title='January 2009'>January 2009</a></li>
	<li><a href='index7866.html?m=200812' title='December 2008'>December 2008</a></li>
	<li><a href='index55f6.html?m=200811' title='November 2008'>November 2008</a></li>
	<li><a href='indexa7bc.html?m=200810' title='October 2008'>October 2008</a></li>
	<li><a href='indexe77c.html?m=200809' title='September 2008'>September 2008</a></li>
	<li><a href='indexcffc.html?m=200808' title='August 2008'>August 2008</a></li>
	<li><a href='index0e62.html?m=200807' title='July 2008'>July 2008</a></li>
	<li><a href='indexfda7.html?m=200806' title='June 2008'>June 2008</a></li>
	<li><a href='index7d64.html?m=200805' title='May 2008'>May 2008</a></li>
	<li><a href='index94dd.html?m=200804' title='April 2008'>April 2008</a></li>
	<li><a href='index9631.html?m=200803' title='March 2008'>March 2008</a></li>
	<li><a href='indexdd52.html?m=200802' title='February 2008'>February 2008</a></li>
	<li><a href='index21ee.html?m=200801' title='January 2008'>January 2008</a></li>
	<li><a href='index363c.html?m=200712' title='December 2007'>December 2007</a></li>
	<li><a href='index7493.html?m=200711' title='November 2007'>November 2007</a></li>
	<li><a href='index93a7.html?m=200710' title='October 2007'>October 2007</a></li>
	<li><a href='index4ca8.html?m=200709' title='September 2007'>September 2007</a></li>
	<li><a href='index6124.html?m=200708' title='August 2007'>August 2007</a></li>
	<li><a href='index6013.html?m=200707' title='July 2007'>July 2007</a></li>
	<li><a href='index2ab6.html?m=200706' title='June 2007'>June 2007</a></li>
	<li><a href='index44f0.html?m=200705' title='May 2007'>May 2007</a></li>
	<li><a href='indexf0b4.html?m=200704' title='April 2007'>April 2007</a></li>
	<li><a href='index481d.html?m=200703' title='March 2007'>March 2007</a></li>
	<li><a href='indexcbea.html?m=200702' title='February 2007'>February 2007</a></li>
	<li><a href='index9cdc.html?m=200701' title='January 2007'>January 2007</a></li>
	<li><a href='index3ea4.html?m=200612' title='December 2006'>December 2006</a></li>
	<li><a href='index67ca.html?m=200611' title='November 2006'>November 2006</a></li>
	<li><a href='indexff49.html?m=200610' title='October 2006'>October 2006</a></li>
	<li><a href='index611c.html?m=200609' title='September 2006'>September 2006</a></li>
	<li><a href='index9a21.html?m=200608' title='August 2006'>August 2006</a></li>
	<li><a href='index3ee9.html?m=200607' title='July 2006'>July 2006</a></li>
	<li><a href='indexe13a.html?m=200606' title='June 2006'>June 2006</a></li>
</ul>
</div>

<div class="aisLeftNav">
			<li id="linkcat-16" class="linkcat"><h2>Blogroll</h2>
	<ul>
<li><a href="http://ayende.com/Blog">Ayende Rahien</a></li>
<li><a href="http://www.softinsight.com/bnoyes/default.aspx">Brian Noyes</a></li>
<li><a href="http://chriskoenig.net/">Chris Koenig</a></li>
<li><a href="http://scienceblogs.com/goodmath/" title="MarkCC reveals the beauty in mathematics and exposes its misuse.">Good Math, Bad Math</a></li>
<li><a href="http://joshsmithonwpf.wordpress.com/">Josh Smith on WPF</a></li>
<li><a href="http://west-wind.com/Weblog/default.aspx">Rick Strahl</a></li>
<li><a href="http://www.udidahan.com/?blog=true">Udi Dahan</a></li>

	</ul>
</li>
<li id="linkcat-17" class="linkcat"><h2>Links</h2>
	<ul>
<li><a href="http://www.absg.com/" title="my day job">ABSG</a></li>
<li><a href="http://www.d20universe.com/" title="my friends boostrap">d20 Universe</a></li>
<li><a href="http://updatecontrols.net/" title="my open source project">Update Controls .NET</a></li>

	</ul>
</li>
<li id="linkcat-32" class="linkcat"><h2>Podroll</h2>
	<ul>
<li><a href="http://dotnetrocks.com/" title="Interviews with leaders in the .NET community.">.NET Rocks!</a></li>
<li><a href="http://hanselminutes.com/" title="News and interviews from all aspects of software, with an insider&#039;s view of Microsoft.">Hanselminutes</a></li>

	</ul>
</li>
	</div>

<div class="aisLeftNav">
<h2>Books</h2>
<iframe src="http://rcm.amazon.com/e/cm?t=adventures0d2-20&amp;o=1&amp;p=8&amp;l=as1&amp;asins=0764526413&amp;fc1=000000&amp;IS2=1&amp;lt1=_blank&amp;lc1=0000ff&amp;bc1=000000&amp;bg1=ffffff&amp;f=ifr" style="width:120px;height:240px;" scrolling="no" marginwidth="0" marginheight="0" frameborder="0" name="I5" id="I5"></iframe>
<br/>
<iframe src="http://rcm.amazon.com/e/cm?t=adventures0d2-20&amp;o=1&amp;p=8&amp;l=as1&amp;asins=0201633612&amp;fc1=000000&amp;IS2=1&amp;lt1=_blank&amp;lc1=0000ff&amp;bc1=000000&amp;bg1=ffffff&amp;f=ifr" style="width:120px;height:240px;" scrolling="no" marginwidth="0" marginheight="0" frameborder="0" name="I6" id="I6"></iframe>
<br/>
<iframe src="http://rcm.amazon.com/e/cm?t=adventures0d2-20&amp;o=1&amp;p=8&amp;l=as1&amp;asins=0136291554&amp;fc1=000000&amp;IS2=1&amp;lt1=_blank&amp;lc1=0000ff&amp;bc1=000000&amp;bg1=ffffff&amp;f=ifr" style="width:120px;height:240px;" scrolling="no" marginwidth="0" marginheight="0" frameborder="0" name="I7" id="I7"></iframe>
<br/>
<iframe src="http://rcm.amazon.com/e/cm?t=adventures0d2-20&amp;o=1&amp;p=8&amp;l=as1&amp;asins=1888009195&amp;fc1=000000&amp;IS2=1&amp;lt1=_blank&amp;lc1=0000ff&amp;bc1=000000&amp;bg1=ffffff&amp;f=ifr" style="width:120px;height:240px;" scrolling="no" marginwidth="0" marginheight="0" frameborder="0" name="I8" id="I8"></iframe>
</div>
<div class="aisLeftNav">
<h2>Meta</h2>
<ul>
		<li><a href="wp-login.html">Login</a></li>
	<li><a href="http://validator.w3.org/check/referer" title="This page validates as XHTML 1.0 Transitional">Valid <abbr title="eXtensible HyperText Markup Language">XHTML</abbr></a></li>
	<li><a href="http://gmpg.org/xfn/"><abbr title="XHTML Friends Network">XFN</abbr></a></li>
	<li><a href="http://wordpress.org/" title="Powered by WordPress, state-of-the-art semantic personal publishing platform.">WordPress</a></li>
	</ul>
</div>
<div class="aisLeftContent">
<h2>Community</h2>
<ul>
	<script type="text/javascript" src="../../localhost/embed/92q2bbma.js"></script>
</ul>
</div>

</div></div></div>
</div>		</td>
		<td>

	<div id="content" class="narrowcolumn">

	
		
			<div class="post" id="post-488">
				<h2><a href="indexfaa1.html?p=488" rel="bookmark" title="Permanent Link to Map IDs during data import">Map IDs during data import</a></h2>
				<small>March 25th, 2010 <!-- by Michael L Perry --></small>

				<div class="entry">
					<p>It’s always best to develop against realistic data. No data is more realistic than production data. If you can legally and ethically import production data to development, you should definitely do so.</p>
<p>We’re developing a new rebate program for pharmaceuticals. Rather than creating a dummy product catalog, we would rather import the actual catalog from production.</p>
<p>The problem is the auto-incrementing IDs. We’re not just pulling in a flat structure; we’re maintaining relationships in a tree structure. When we insert rows into the dev database, these rows get different IDs than the production rows. As a result, the foreign key relationships get broken.</p>
<p>One solution to this problem is to drop all of the data and do an identity insert. Temporarily turn off the auto-incrementing behavior of the primary key so that you can specify exactly what it should be. This brings all of the production IDs into dev, so the foreign key relationships still line up.</p>
<p>The problem with that solution is that you have to drop all of the existing dev data in order to import. We have other structures that are loosely related to the product catalog. Dropping the product catalog would require us to drop some of the tables used by these other systems. All of the test data we loaded for those systems would be lost.</p>
<p><strong>Here’s my solution</strong>     <br />Instead of enforcing that the development IDs are equal to the production IDs, we can instead record a map. By joining to this map, we can insert the development IDs into foreign key columns, preserving the relationships from production. Here’s how we do it.</p>
<p><strong>Step 1:</strong> Restore a backup of production data into a new database on the development server. You might also use replication for this, if you already have a subscription. Be sure that you get only the subset that you are legally and ethically permitted to use. In our case, the product catalog is what we need, but we do not restore any tables containing patient information.</p>
<p><strong>Step 2:</strong> Identify the natural key. The ID that you are mapping is the surrogate key. The natural key is the set of columns that tell you that this is conceptually the same row. In our case, we are using the drug class name and the product group name.</p>
<p><strong>Step 3:</strong> Copy rows that do not already exist based on the natural key. Use INSERT … SELECT … WHERE NOT EXISTS for this operation. For example:</p>
<pre><span style="color: blue">INSERT</span> <span style="color: blue">INTO</span> [<span style="color: black">Dev</span>].<span style="color: black">dbo</span>.[<span style="color: black">DrugClass</span>]
           ([<span style="color: black">Name</span>])
<span style="color: blue">SELECT</span> [<span style="color: black">Name</span>]
  <span style="color: blue">FROM</span> [<span style="color: black">Prod</span>].<span style="color: black">dbo</span>.[<span style="color: black">DrugClass</span>] <span style="color: black">s</span>
  <span style="color: blue">WHERE</span> <span style="color: silver">NOT</span> <span style="color: silver">EXISTS</span> (<span style="color: blue">SELECT</span> * <span style="color: blue">FROM</span> [<span style="color: black">Dev</span>].<span style="color: black">dbo</span>.[<span style="color: black">DrugClass</span>] <span style="color: black">t</span> <span style="color: blue">WHERE</span> <span style="color: black">t</span>.<span style="color: black">Name</span> = <span style="color: black">s</span>.<span style="color: black">Name</span>)
<span style="color: blue">GO</span></pre>
<p><strong>Step 4:</strong> Create a temp table to map surrogate keys. Populate this table by joining the natural keys.</p>
<pre><span style="color: blue">DROP</span> <span style="color: blue">TABLE</span> #<span style="color: black">DrugClassMap</span>
<span style="color: blue">GO</span>

<span style="color: blue">SELECT</span> <span style="color: black">s</span>.<span style="color: black">DrugClassId</span> <span style="color: blue">as</span> <span style="color: black">SourceDrugClassId</span>, <span style="color: black">t</span>.<span style="color: black">DrugClassId</span> <span style="color: blue">as</span> <span style="color: black">TargetDrugClassId</span>
  <span style="color: blue">INTO</span> #<span style="color: black">DrugClassMap</span>
  <span style="color: blue">FROM</span> [<span style="color: black">Prod</span>].<span style="color: black">dbo</span>.[<span style="color: black">DrugClass</span>] <span style="color: black">s</span>
  <span style="color: blue">JOIN</span> [<span style="color: black">Dev</span>].<span style="color: black">dbo</span>.[<span style="color: black">DrugClass</span>] <span style="color: black">t</span> <span style="color: blue">ON</span> <span style="color: black">s</span>.<span style="color: black">Name</span> = <span style="color: black">t</span>.<span style="color: black">Name</span>
<span style="color: blue">GO</span></pre>
<p><strong>Step 5:</strong> Use the temp table to import related tables. Join to the source table by source ID, and insert by target ID.</p>
<pre><span style="color: blue">INSERT</span> <span style="color: blue">INTO</span> [<span style="color: black">Dev</span>].<span style="color: black">dbo</span>.[<span style="color: black">ProductGroup</span>]
           ([<span style="color: black">DrugClassId</span>]
           ,[<span style="color: black">Name</span>])
<span style="color: blue">SELECT</span> <span style="color: black">m</span>.[<span style="color: black">TargetDrugClassId</span>]
      ,<span style="color: black">s</span>.[<span style="color: black">Name</span>]
  <span style="color: blue">FROM</span> [<span style="color: black">Prod</span>].<span style="color: black">dbo</span>.[<span style="color: black">ProductGroup</span>] <span style="color: black">s</span>
  <span style="color: blue">JOIN</span> #<span style="color: black">DrugClassMap</span> <span style="color: black">m</span> <span style="color: blue">ON</span> <span style="color: black">m</span>.<span style="color: black">SourceDrugClassId</span> = <span style="color: black">s</span>.<span style="color: black">DrugClassId</span>
  <span style="color: blue">WHERE</span> <span style="color: silver">NOT</span> <span style="color: silver">EXISTS</span> (<span style="color: blue">SELECT</span> * <span style="color: blue">FROM</span> [<span style="color: black">Dev</span>].<span style="color: black">dbo</span>.[<span style="color: black">ProductGroup</span>] <span style="color: black">t</span> <span style="color: blue">WHERE</span> <span style="color: black">t</span>.<span style="color: black">Name</span> = <span style="color: black">s</span>.<span style="color: black">Name</span> <span style="color: blue">AND</span> <span style="color: black">t</span>.<span style="color: black">DrugClassId</span> = <span style="color: black">m</span>.<span style="color: black">TargetDrugClassId</span>)
<span style="color: blue">GO</span></pre>
<p>Now you can run the script anytime you need to import data. You won’t destroy existing data in the process.</p>
				</div>

				<p class="postmetadata">Posted in <a href="indexc728.html?cat=7" title="View all posts in Databases" rel="category">Databases</a> |   <a href="indexfaa1.html?p=488#respond" title="Comment on Map IDs during data import">No Comments &#187;</a></p>
			</div>

		
			<div class="post" id="post-487">
				<h2><a href="indexe3b6.html?p=487" rel="bookmark" title="Permanent Link to Pass through view model">Pass through view model</a></h2>
				<small>March 21st, 2010 <!-- by Michael L Perry --></small>

				<div class="entry">
					<p>I will be speaking at the <a href="http://dallasxaml.com/">Dallas XAML</a> user’s group on May 4. I’ll guide the group through the creation of a simple MVVM application to demonstrate why you want to use the pattern. This is a hands-on format, so bring your laptop. We will be using Visual Studio 2008 and WPF, so no special downloads will be required.</p>
<p>In preparing for this presentation, I’ve researched much of the MVVM advice currently available. Here are just some of the sources that I’ve found:</p>
<ul>
<li><a href="http://blog.lab49.com/archives/2650">Jason Dolinger on Model-View-ViewModel</a> </li>
<li><a href="http://live.visitmix.com/MIX10/Sessions/EX14">Laurent Bugnion Understanding the Model-View-ViewModel pattern</a> </li>
<li><a href="http://live.visitmix.com/MIX10/Sessions/EX15">Ron Eisenberg Build your own MVVM Framework</a> </li>
<li><a href="http://joshsmithonwpf.wordpress.com/advanced-mvvm/">Josh Smith Advanced MVVM</a> </li>
<li><a href="http://weblogs.asp.net/craigshoemaker/archive/2009/11/03/vm-workshop-model-view-viewmodel-mvvm-and-the-presentation-model-pattern-in-5-ui-platforms.aspx">Craig Shoemaker VM Workshop</a> </li>
<li><a href="http://www.vimeo.com/8915487">MVVM Made Easy</a> </li>
</ul>
<p>In almost every example, the presenter copies data from their Model into the View Model. Some don’t even have a Model at all! I, on the other hand, create pass-through View Models. My View Models don’t store any data. So either I’m doing it wrong, or my idea of MVVM is different from everybody else’s. Before I present the pattern to a room full of people with laptops, I’d like to know which.</p>
<p><strong>Disconnected View Model</strong>     <br />The typical example of a View Model example keeps a copy of its data. The properties work against local fields.</p>
<pre><span style="color: blue">public</span> <span style="color: blue">class</span> <span style="color: #2b91af">PersonViewModel</span> : <span style="color: #2b91af">INotifyPropertyChanged</span>
{
    <span style="color: blue">public</span> <span style="color: blue">event</span> <span style="color: #2b91af">PropertyChangedEventHandler</span> PropertyChanged;

    <span style="color: blue">private</span> <span style="color: blue">string</span> _firstName;
    <span style="color: blue">private</span> <span style="color: blue">string</span> _lastName;

    <span style="color: blue">public</span> <span style="color: blue">string</span> FirstName
    {
        <span style="color: blue">get</span>
        {
            <span style="color: blue">return</span> _firstName;
        }
        <span style="color: blue">set</span>
        {
            _firstName = value;
            FirePropetyChanged(<span style="color: maroon">&quot;FirstName&quot;</span>);
            FirePropetyChanged(<span style="color: maroon">&quot;FullName&quot;</span>);
        }
    }

    <span style="color: blue">public</span> <span style="color: blue">string</span> LastName
    {
        <span style="color: blue">get</span>
        {
            <span style="color: blue">return</span> _lastName;
        }
        <span style="color: blue">set</span>
        {
            _lastName = value;
            FirePropetyChanged(<span style="color: maroon">&quot;LastName&quot;</span>);
            FirePropetyChanged(<span style="color: maroon">&quot;FullName&quot;</span>);
        }
    }

    <span style="color: blue">public</span> <span style="color: blue">string</span> FullName
    {
        <span style="color: blue">get</span>
        {
            <span style="color: blue">return</span> <span style="color: blue">string</span>.Format(<span style="color: maroon">&quot;{1}, {0}&quot;</span>, _firstName, _lastName);
        }
    }

    <span style="color: blue">private</span> <span style="color: blue">void</span> FirePropetyChanged(<span style="color: blue">string</span> propertyName)
    {
        <span style="color: blue">if</span> (PropertyChanged != <span style="color: blue">null</span>)
            PropertyChanged(<span style="color: blue">this</span>, <span style="color: blue">new</span> <span style="color: #2b91af">PropertyChangedEventArgs</span>(propertyName));
    }
}</pre>
<p>Before you display the view, you have to copy the data into the view model. At some point later, you copy the data back out of the view model.</p>
<pre><span style="color: blue">public</span> <span style="color: blue">class</span> <span style="color: #2b91af">PersonViewModel</span>

    <span style="color: green">//...</span>

    <span style="color: blue">public</span> <span style="color: blue">static</span> <span style="color: #2b91af">PersonViewModel</span> FromPerson(<span style="color: #2b91af">Person</span> person)
    {
        <span style="color: blue">return</span> <span style="color: blue">new</span> <span style="color: #2b91af">PersonViewModel</span>()
        {
            FirstName = person.FirstName,
            LastName = person.LastName
        };
    }

    <span style="color: blue">public</span> <span style="color: blue">void</span> ToPerson(<span style="color: #2b91af">Person</span> person)
    {
        person.FirstName = _firstName;
        person.LastName = _lastName;
    }
}</pre>
<p>Some of the experts just skip the model class altogether and go straight from their view model to the database or service.</p>
<p><strong>Pass Through View Model</strong> </p>
<p>I prefer the pass through style. The view model stores no data.</p>
<pre><span style="color: blue">public</span> <span style="color: blue">class</span> <span style="color: #2b91af">PersonViewModel</span> : <span style="color: #2b91af">INotifyPropertyChanged</span>
{
    <span style="color: blue">public</span> <span style="color: blue">event</span> <span style="color: #2b91af">PropertyChangedEventHandler</span> PropertyChanged;

    <strong><span style="color: blue">private</span> <span style="color: #2b91af">Person</span> _person;</strong>

<strong>    <span style="color: blue">public</span> PersonViewModel(<span style="color: #2b91af">Person</span> person)
    {
        _person = person;
    }
</strong>
    <span style="color: blue">public</span> <span style="color: blue">string</span> FirstName
    {
        <span style="color: blue">get</span>
        {
            <span style="color: blue">return</span> _<strong>person.FirstName</strong>;
        }
        <span style="color: blue">set</span>
        {
            <strong>_person.FirstName</strong> = value;
            FirePropetyChanged(<span style="color: maroon">&quot;FirstName&quot;</span>);
            FirePropetyChanged(<span style="color: maroon">&quot;FullName&quot;</span>);
        }
    }

    <span style="color: blue">public</span> <span style="color: blue">string</span> LastName
    {
        <span style="color: blue">get</span>
        {
            <span style="color: blue">return</span> <strong>_person.LastName;</strong>
        }
        <span style="color: blue">set</span>
        {
            <strong>_person.LastName</strong> = value;
            FirePropetyChanged(<span style="color: maroon">&quot;LastName&quot;</span>);
            FirePropetyChanged(<span style="color: maroon">&quot;FullName&quot;</span>);
        }
    }

    <span style="color: blue">public</span> <span style="color: blue">string</span> FullName
    {
        <span style="color: blue">get</span>
        {
            <span style="color: blue">return</span> <span style="color: blue">string</span>.Format(<span style="color: maroon">&quot;{1}, {0}&quot;</span>, <strong>_person.FirstName</strong>, <strong>_person.LastName</strong>);
        }
    }

    <span style="color: blue">private</span> <span style="color: blue">void</span> FirePropetyChanged(<span style="color: blue">string</span> propertyName)
    {
        <span style="color: blue">if</span> (PropertyChanged!= <span style="color: blue">null</span>)
            PropertyChanged(<span style="color: blue">this</span>, <span style="color: blue">new</span> <span style="color: #2b91af">PropertyChangedEventArgs</span>(propertyName));
    }
}</pre>
<p>Instead of storing a copy of the Person data, this view model uses the storage that is in the actual Person model. There is no back-and-forth copying of data.</p>
<p><strong>The advantages of pass through</strong> </p>
<p>I prefer the pass through style because it limits the number of moving parts in the application; in other words, it minimizes the “degrees of freedom”. Fewer moving parts means:</p>
<ol>
<li>Less code </li>
<li>Fewer tests </li>
<li>Fewer things that could break </li>
<li>Simpler communication </li>
</ol>
<p>If data exists in two places, then it will diverge. Data in one place will be more up-to-date than data in the other place. You have to write code to manage the divergence. That code needs to be tested. That code could break.</p>
<p>Many of the MVVM frameworks that the experts use have a mechanism for sending messages from one view model to another. This is necessary because each view model has its own copy of the data. But if each view model passes through to the same model object, then message passing is no longer necessary. The data model itself becomes the means of communication between view models.</p>
<p><strong>The disadvantages of pass through</strong> </p>
<p>There is a trade-off between the disconnected and pass through styles. The pass through style does have some disadvantages:</p>
<ol>
<li>Harder to support Cancel </li>
<li>Requires change notification from model </li>
<li>Difficult to represent complex transformations </li>
</ol>
<p>Some applications call for the modal dialog OK/Cancel metaphor. It is easier to implement this metaphor if you copy the data into a disconnected view model. If the user presses cancel, you just don’t copy the data back to the model.</p>
<p>While view models can use the data model to share data, they need to be notified of changes that other view models are making. That means that your view models not only implement INotifyPropertyChanged, they also subscribe to it. This can lead to a lot of bookkeeping code. Fortunately, there is a <a href="http://www.code-magazine.com/Article.aspx?quickid=0907101">solution to this</a>, but you have to use a third-party library.</p>
<p>Some transformations cannot be easily represented as a pass through. Maybe the objects in the data model need to be combined or regrouped in different ways. This regrouping cannot be easily done with pass through properties. A disconnected view model can make large scale transformations during the copying process.</p>
<p>None of the experts that I’ve studied make a distinction between disconnected view models and pass through view models. This is unfortunate, because the differences are significant. Where the advantages of a pass through view model outweigh the disadvantages, I find it to be an excellent choice. But before you can make that choice, you have to know that there is a choice to be made.</p>
				</div>

				<p class="postmetadata">Posted in <a href="indexa88f.html?cat=36" title="View all posts in Update Controls" rel="category">Update Controls</a>,  <a href="index2d79.html?cat=26" title="View all posts in dof" rel="category">dof</a> |   <a href="indexe3b6.html?p=487#comments" title="Comment on Pass through view model">2 Comments &#187;</a></p>
			</div>

		
			<div class="post" id="post-486">
				<h2><a href="index2807.html?p=486" rel="bookmark" title="Permanent Link to A better Ignite Dallas video">A better Ignite Dallas video</a></h2>
				<small>March 11th, 2010 <!-- by Michael L Perry --></small>

				<div class="entry">
					<p>Here’s a high quality video of last weekend with slides included.</p>
<div style="padding-bottom: 0px; margin: 0px; padding-left: 0px; padding-right: 0px; display: inline; float: none; padding-top: 0px" id="scid:5737277B-5D6D-4f48-ABFC-DD9C333F4C5D:61ed124f-ab8a-4d04-adcd-25c55546a009" class="wlWriterEditableSmartContent">
<div><object width="425" height="355">
<param name="movie" value="http://www.youtube.com/v/uwgTKuQZ8ts&amp;hl=en"></param><embed src="http://www.youtube.com/v/uwgTKuQZ8ts&amp;hl=en" type="application/x-shockwave-flash" width="425" height="355"></embed></object></div>
</div>
				</div>

				<p class="postmetadata">Posted in <a href="indexb60a.html?cat=27" title="View all posts in Historic Modeling" rel="category">Historic Modeling</a>,  <a href="index489b.html?cat=34" title="View all posts in Synchronization" rel="category">Synchronization</a> |   <a href="index2807.html?p=486#comments" title="Comment on A better Ignite Dallas video">2 Comments &#187;</a></p>
			</div>

		
			<div class="post" id="post-485">
				<h2><a href="indexca96.html?p=485" rel="bookmark" title="Permanent Link to Expression of Intent">Expression of Intent</a></h2>
				<small>March 8th, 2010 <!-- by Michael L Perry --></small>

				<div class="entry">
					<p>This weekend I worked on the <a href="http://historicmodeling.com/book/factual" target="_blank">Factual</a> language parser. I started with a brute-force recursive descent parser, but ended up with something more elegant. The final product expresses the intent better than the original code did. It is easier to maintain, and easier to extend. You can follow along with the <a href="http://correspondence.codeplex.com/SourceControl/list/changesets">changesets on Codeplex</a>. Here’s how I did it.</p>
<p><strong>Step 1: Make it work</strong>     <br />The goal was to create a parser for a known language. It was not to create a framework for any language that you could throw at it. My constraints were well defined:</p>
<ul>
<li>Parse the Factual language </li>
<li>Produce an Abstract Syntax Tree </li>
<li>Work within an open source license </li>
</ul>
<p>These constraints defined my solution. Since I am working on an open source project, I did not want to take a dependency upon a proprietary parser generator. And since I knew the language that I was parsing, I was able to choose parser patterns that fit that language.</p>
<p>It would be foolish to take on this project without knowing the theory of compiler design. I have seen too many ad-hoc parsers created by people who did not do their research. The mistakes that they made could have easily been avoided. “Make it work” does not mean throwing together the simplest thing that would work. It means think it through, but go straight at the problem. Persistence is no substitute for understanding.</p>
<p>Knowing the theory, I knew that my language as defined was LL(4). It is unambiguous with a lookahead of only 4 tokens. I also knew that with a slight modification, I could transform it into an LL(1) grammar. This kind of grammar is easily parsable using recursive descent.</p>
<p>I started with this unit test:</p>
<pre>[<span style="color: #2b91af">TestMethod</span>]
<span style="color: blue">public</span> <span style="color: blue">void</span> WhenNamespaceHasNoDot_NamepaceIsRecognized()
{
    <span style="color: #2b91af">Parser</span> parser = <span style="color: blue">new</span> <span style="color: #2b91af">Parser</span>(<span style="color: blue">new</span> <span style="color: #2b91af">StringReader</span>(<span style="color: maroon">&quot;namespace GameModel;&quot;</span>));
    <span style="color: #2b91af">Namespace</span> result = parser.Parse();
    <span style="color: #2b91af">Pred</span>.Assert(result.Identifier, <span style="color: #2b91af">Is</span>.EqualTo(<span style="color: maroon">&quot;GameModel&quot;</span>));
    <span style="color: #2b91af">Pred</span>.Assert(result.LineNumber, <span style="color: #2b91af">Is</span>.EqualTo(<span style="color: maroon">1</span>));
}</pre>
<p>I did not write this code, as some proponents of TDD would recommend:</p>
<pre><span style="color: blue">public</span> <span style="color: #2b91af">Namespace</span> Parse()
{
    <span style="color: blue">return</span> <span style="color: blue">new</span> <span style="color: #2b91af">Namespace</span>(<span style="color: maroon">&quot;GameModel&quot;</span>, <span style="color: maroon">1</span>);
}</pre>
<p>Instead, I wrote this:</p>
<pre><span style="color: blue">public</span> <span style="color: #2b91af">Namespace</span> Parse()
{
    <span style="color: #2b91af">Consume</span>();
    <span style="color: #2b91af">Namespace</span> namespaceNode = MatchNamespace();
    <span style="color: blue">return</span> namespaceNode;
}

<span style="color: blue">private</span> <span style="color: #2b91af">Namespace</span> MatchNamespace()
{
    <span style="color: #2b91af">Token</span> namespaceToken = Expect(<span style="color: #2b91af">Symbol</span>.Namespace, <span style="color: maroon">&quot;Add a 'namespace' declaration.&quot;</span>);

    <span style="color: blue">if</span> (Lookahead.Symbol != <span style="color: #2b91af">Symbol</span>.Identifier)
        <span style="color: blue">throw</span> <span style="color: blue">new</span> <span style="color: #2b91af">FactualException</span>(<span style="color: maroon">&quot;Provide a dotted identifier for the namespace.&quot;</span>, <span style="color: #2b91af">Lookahead</span>.LineNumber);
    <span style="color: blue">string</span> namespaceIdentifier = MatchDottedIdentifier();

    Expect(<span style="color: #2b91af">Symbol</span>.Semicolon, <span style="color: maroon">&quot;Terminate the namespace declaration with a semicolon.&quot;</span>);

    <span style="color: blue">return</span> <span style="color: blue">new</span> <span style="color: #2b91af">Namespace</span>(namespaceIdentifier, namespaceToken.LineNumber);
}</pre>
<p>That first method would have made the test pass, but it represents none of the understanding of the problem space. I find it better to capture that understanding in code as soon as possible, rather than writing a foolish method that I will throw away later.</p>
<p>After getting it working, I had a suite of unit tests. Each subsequent step was performed while keeping that same test suite passing.</p>
<p><strong>Step 2: Clean up the working code</strong> </p>
<p>It bothered me that MatchNamespace knew that MatchDottedIdentifier expected an Identifier. So I did a quick refactoring to move that knowledge closer to the right place.</p>
<pre><span style="color: blue">private</span> <span style="color: #2b91af">Namespace</span> MatchNamespace()
{
    ...

    <span style="color: blue">if</span> (<strong>!StartOfDottedIdentifier()</strong>)
        <span style="color: blue">throw</span> <span style="color: blue">new</span> <span style="color: #2b91af">FactualException</span>(<span style="color: maroon">&quot;Provide a dotted identifier for the namespace.&quot;</span>, Lookahead.LineNumber);
    <span style="color: blue">string</span> namespaceIdentifier = MatchDottedIdentifier();

    ...
}

<span style="color: blue">private</span> <span style="color: blue">bool</span> StartOfDottedIdentifier()
{
    <span style="color: blue">return</span> Lookahead.Symbol == <span style="color: #2b91af">Symbol</span>.Identifier;
}

<span style="color: blue">private</span> <span style="color: blue">string</span> MatchDottedIdentifier()
{
    <span style="color: #2b91af">StringBuilder</span> result = <span style="color: blue">new</span> <span style="color: #2b91af">StringBuilder</span>();

    <span style="color: #2b91af">Token</span> idenifier = Expect(<span style="color: #2b91af">Symbol</span>.Identifier, <span style="color: maroon">&quot;Begin with an identifier.&quot;</span>);
    result.Append(idenifier.Value);

    ...
}</pre>
<p><strong>Step 3: Find the patterns</strong> </p>
<p>After cleaning the code in a similar way in several places, I noticed that there were Start and Match pairs for almost every rule. I compared this with my knowledge of parsers, and found that it is a valid generalization.</p>
<p>In an LL(1) grammar, you can calculate the First and Follow sets of every production. The First set is the set of tokens that could appear at the beginning of the production. The Follow set is the set that could appear after the production has been reduced. I recognized that Start represented the First set. The Follow set is useful for generating the First set (First includes Follow if the production could be empty), but was not strictly required for my grammar.</p>
<p>Having discovered that pattern, I extracted a common interface (actually an abstract base class).</p>
<pre><span style="color: blue">public</span> <span style="color: blue">abstract</span> <span style="color: blue">class</span> <span style="color: #2b91af">Rule</span>&lt;T&gt;
{
    <span style="color: blue">public</span> <span style="color: blue">abstract</span> <span style="color: blue">bool</span> Start(<span style="color: #2b91af">Symbol</span> symbol);
    <span style="color: blue">public</span> <span style="color: blue">abstract</span> T Match(<span style="color: #2b91af">TokenStream</span> tokenStream);
}</pre>
<p>I implemented this interface with one derived class per production.</p>
<p><strong>Step 4: Find the common intent</strong> </p>
<p>Several of the rules had a common structure. They each called a sequence of other rules in turn. Each time, they would check the Start, and then call Match. This commonality was not accidental. Each of these rules intended to represent a sequence. They only differed in which sequence, and what was done with it. So I factored out that intent.</p>
<pre><span style="color: blue">public</span> <span style="color: blue">class</span> <span style="color: #2b91af">RuleSequence3</span>&lt;<span style="color: #2b91af">T1</span>, <span style="color: #2b91af">T2</span>, <span style="color: #2b91af">T3</span>, <span style="color: #2b91af">T</span>&gt; : <span style="color: #2b91af">Rule</span>&lt;<span style="color: #2b91af">T</span>&gt;
{
    <span style="color: blue">private</span> <span style="color: #2b91af">Rule</span>&lt;<span style="color: #2b91af">T1</span>&gt; _rule1;
    <span style="color: blue">private</span> <span style="color: #2b91af">Rule</span>&lt;<span style="color: #2b91af">T2</span>&gt; _rule2;
    <span style="color: blue">private</span> <span style="color: blue">string</span> _error2;
    <span style="color: blue">private</span> <span style="color: #2b91af">Rule</span>&lt;<span style="color: #2b91af">T3</span>&gt; _rule3;
    <span style="color: blue">private</span> <span style="color: blue">string</span> _error3;
    <span style="color: blue">private</span> <span style="color: #2b91af">Func</span>&lt;<span style="color: #2b91af">T1</span>, <span style="color: #2b91af">T2</span>, <span style="color: #2b91af">T3</span>, <span style="color: #2b91af">T</span>&gt; _reduce;

    <span style="color: blue">public</span> <span style="color: #2b91af">RuleSequence3</span>(<span style="color: #2b91af">Rule</span>&lt;<span style="color: #2b91af">T1</span>&gt; rule1, <span style="color: #2b91af">Rule</span>&lt;<span style="color: #2b91af">T2</span>&gt; rule2, <span style="color: blue">string</span> error2, <span style="color: #2b91af">Rule</span>&lt;<span style="color: #2b91af">T3</span>&gt; rule3, <span style="color: blue">string</span> error3, <span style="color: #2b91af">Func</span>&lt;<span style="color: #2b91af">T1</span>, <span style="color: #2b91af">T2</span>, <span style="color: #2b91af">T3</span>, <span style="color: #2b91af">T</span>&gt; reduce)
    {
        _rule1 = rule1;
        _rule2 = rule2;
        _error2 = error2;
        _rule3 = rule3;
        _error3 = error3;
        _reduce = reduce;
    }

    <span style="color: blue">public</span> <span style="color: blue">override</span> <span style="color: blue">bool</span> Start(<span style="color: #2b91af">Symbol</span> symbol)
    {
        <span style="color: blue">return</span> _rule1.Start(symbol);
    }

    <span style="color: blue">public</span> <span style="color: blue">override</span> <span style="color: #2b91af">T</span> Match(<span style="color: #2b91af">TokenStream</span> tokenStream)
    {
        <span style="color: #2b91af">T1</span> value1 = _rule1.Match(tokenStream);

        <span style="color: blue">if</span> (!_rule2.Start(tokenStream.Lookahead.Symbol))
            <span style="color: blue">throw</span> <span style="color: blue">new</span> <span style="color: #2b91af">FactualException</span>(_error2, tokenStream.Lookahead.LineNumber);
        <span style="color: #2b91af">T2</span> value2 = _rule2.Match(tokenStream);

        <span style="color: blue">if</span> (!_rule3.Start(tokenStream.Lookahead.Symbol))
            <span style="color: blue">throw</span> <span style="color: blue">new</span> <span style="color: #2b91af">FactualException</span>(_error3, tokenStream.Lookahead.LineNumber);
        <span style="color: #2b91af">T3</span> value3 = _rule3.Match(tokenStream);

        <span style="color: blue">return</span> _reduce(value1, value2, value3);
    }
}</pre>
<p><strong>Step 5: Express the intent<br />
    <br /></strong>Now that rules can be built from the outside rather than coded from within, I had the opportunity to create a fluent interface. The code that uses this interface expresses the grammar of the language, rather than the steps required to parse it. The resulting code reads like a specification rather than an implementation.</p>
<pre><span style="color: green">// dotted_identifier -&gt; identifier (&quot;.&quot; identifier)*</span>
<span style="color: green">// namespace_declaration -&gt; &quot;namespace&quot; dotted_identifier &quot;;&quot;</span>
var dottedIdentifier = Separated(
    Terminal(<span style="color: #2b91af">Symbol</span>.Identifier),
    <span style="color: #2b91af">Symbol</span>.Dot,
    identifier =&gt; <span style="color: blue">new</span> <span style="color: #2b91af">StringBuilder</span>().Append(identifier.Value),
    (stringBuilder, identifier) =&gt; stringBuilder.Append(<span style="color: maroon">&quot;.&quot;</span>).Append(identifier.Value));
var namespaceRule = Sequence(
    Terminal(<span style="color: #2b91af">Symbol</span>.Namespace),
    dottedIdentifier, <span style="color: maroon">&quot;Provide a dotted identifier for the namespace.&quot;</span>,
    Terminal(<span style="color: #2b91af">Symbol</span>.Semicolon), <span style="color: maroon">&quot;Terminate the namespace declaration with a semicolon.&quot;</span>,
    (namespaceToken, identifier, ignored) =&gt; <span style="color: blue">new</span> <span style="color: #2b91af">Namespace</span>(identifier.ToString(), namespaceToken.LineNumber));</pre>
<p>I find that this code is much easier to maintain and extend. The engineering of getting the parser right has been done once. Additional productions can take advantage of that engineering, so that simple mistakes are avoided. The goal was no reuse, but in the end I had created a reusable parser generator.</p>
<p>I might have been able to go straight there, but only at the risk of over engineering the solution. By refactoring my way from a working system toward an expression of intent, I was able to bring in just the theory that this particular problem requires. I know the limitations of my parser, and I can live within them.</p>
				</div>

				<p class="postmetadata">Posted in <a href="index54cb.html?cat=23" title="View all posts in Processes" rel="category">Processes</a> |   <a href="indexca96.html?p=485#respond" title="Comment on Expression of Intent">No Comments &#187;</a></p>
			</div>

		
			<div class="post" id="post-484">
				<h2><a href="index4c50.html?p=484" rel="bookmark" title="Permanent Link to Ignite video online">Ignite video online</a></h2>
				<small>March 7th, 2010 <!-- by Michael L Perry --></small>

				<div class="entry">
					<p>How do we collaborate through software?</p>
<ul>
<li>The CAP Theorem – Eric Brewer</li>
<li>Eventual Consistency – Werner Vogels</li>
<li>Event Sourcing – Greg Young and Udi Dahan</li>
<li>Partial Order</li>
</ul>
<p style="margin: 0px; padding: 0px; display: inline; float: none" id="scid:5737277B-5D6D-4f48-ABFC-DD9C333F4C5D:b3bdc654-2825-4f89-8127-5d974ad20878" class="wlWriterEditableSmartContent"><object height="355" width="425"></p>
<param name="movie" value="http://www.youtube.com/v/qysC6zmgYT0&amp;hl=en"></param><embed src="http://www.youtube.com/v/qysC6zmgYT0&amp;hl=en" type="application/x-shockwave-flash" height="355" width="425"></embed></object></p>
<p style="margin: 0px; padding: 0px; display: inline; float: none" id="scid:fb3a1972-4489-4e52-abe7-25a00bb07fdf:56630752-a8c8-432d-be2f-7c5d1620ea18" class="wlWriterEditableSmartContent"> <a href="../pictures/Ignitevideoonline_11874/PerryCollaborateThroughSoftware.ppt">Download the slides</a></p>
				</div>

				<p class="postmetadata">Posted in <a href="indexb60a.html?cat=27" title="View all posts in Historic Modeling" rel="category">Historic Modeling</a>,  <a href="index489b.html?cat=34" title="View all posts in Synchronization" rel="category">Synchronization</a> |   <a href="index4c50.html?p=484#respond" title="Comment on Ignite video online">No Comments &#187;</a></p>
			</div>

		
			<div class="post" id="post-483">
				<h2><a href="index3758.html?p=483" rel="bookmark" title="Permanent Link to How do we collaborate through software: Take 2">How do we collaborate through software: Take 2</a></h2>
				<small>February 25th, 2010 <!-- by Michael L Perry --></small>

				<div class="entry">
					<p>It is official. I have been invited to speak at <a href="http://ignitedallas.org/">Ignite Dallas</a>.</p>
<p>In my prior recording of the talk, I neglected to mention the names of some folks who have been influential in collaborative application design. This new recording remedies that oversight.</p>
<p>I also modified the second half of the talk to tell the partial ordering story a little better. It still needs the slides in order to really get it, but fortunately those are coming along.</p>
<p>Give it a <a href="../bin/CollaborateThroughSoftware2.mp3">listen</a>. Hope to see you next Wednesday!</p>
				</div>

				<p class="postmetadata">Posted in <a href="indexb60a.html?cat=27" title="View all posts in Historic Modeling" rel="category">Historic Modeling</a>,  <a href="index489b.html?cat=34" title="View all posts in Synchronization" rel="category">Synchronization</a> |   <a href="index3758.html?p=483#respond" title="Comment on How do we collaborate through software: Take 2">No Comments &#187;</a></p>
			</div>

		
			<div class="post" id="post-482">
				<h2><a href="index54a8.html?p=482" rel="bookmark" title="Permanent Link to How do we collaborate through software?">How do we collaborate through software?</a></h2>
				<small>February 20th, 2010 <!-- by Michael L Perry --></small>

				<div class="entry">
					<p>I am preparing for the upcoming <a href="http://ignitedallas.org/">Ignite Dallas</a> event. 5 minutes, 20 slides that auto advance every 15 seconds. The final speaker list has not yet been determined, but I’m hopeful that I’ll have a chance to present.</p>
<p>I will be talking about the current thinking in collaborative applications.</p>
<ul>
<li>The CAP Theorem</li>
<li>Eventual Consistency</li>
<li>Event Sourcing</li>
<li>Partial Ordering</li>
</ul>
<p>The challenge is to condense all of this learning into 5 minutes, make it accessible, and make it entertaining. You can help.</p>
<p>Please take five minutes (actually 4:45) to listen to my <a href="../bin/CollaborateThroughSoftware.mp3">rough draft</a>. Leave comments on what I can improve, what I didn’t make clear, and anything I could leave out.</p>
<p>Then order your tickets to the event and see some really great performances. Or submit one of your own.</p>
				</div>

				<p class="postmetadata">Posted in <a href="indexb60a.html?cat=27" title="View all posts in Historic Modeling" rel="category">Historic Modeling</a>,  <a href="index489b.html?cat=34" title="View all posts in Synchronization" rel="category">Synchronization</a> |   <a href="index54a8.html?p=482#comments" title="Comment on How do we collaborate through software?">1 Comment &#187;</a></p>
			</div>

		
			<div class="post" id="post-481">
				<h2><a href="indexf705.html?p=481" rel="bookmark" title="Permanent Link to Java/WCF Interop">Java/WCF Interop</a></h2>
				<small>February 8th, 2010 <!-- by Michael L Perry --></small>

				<div class="entry">
					<p>As of today (February 2010), the story of Java/WCF interoperability is fair. That wasn’t always the case. In the past, I’ve struggled to get Java and .NET to play nice. Today, I was able to make a .NET WCF client talk to a Java CXF web service with just a little coaxing. Here’s how I did it.</p>
<p><strong>Contract first</strong>    <br />The first step to successful interoperability is to define the contract. Somehow you need to generate the WSDL, and you need to tightly control what it looks like. Use tools to help you, but keep a close eye on what those tools do.</p>
<p>I started with a WCF service contract. This is a .NET interface that uses the [ServiceContract] and [OperationContract] attributes. Put this interface and all of the data types it uses into a class library project. Here’s an example:</p>
<pre>[<span style="color: #2b91af">ServiceContract</span>(Namespace = <span style="color: maroon">&quot;http://correspondence.updatecontrols.com&quot;</span>)]
<span style="color: blue">public</span> <span style="color: blue">interface</span> <span style="color: #2b91af">ISynchronizationService</span>
{
    [<span style="color: #2b91af">OperationContract</span>]
    <span style="color: #2b91af">FactTree</span> Get(<span style="color: #2b91af">FactTree</span> pivotTree, <span style="color: blue">long</span> pivotId, <span style="color: blue">long</span> timestamp);

    [<span style="color: #2b91af">OperationContract</span>]
    <span style="color: blue">void</span> Post(<span style="color: #2b91af">FactTree</span> messageBody);
}</pre>
<p>The FactTree data type used by this interface is decorated with the [DataContract] and [DataMember] attributes.</p>
<pre>[<span style="color: #2b91af">DataContract</span>(<span style="color: #2b91af">Namespace</span> = <span style="color: maroon">&quot;http://correspondence.updatecontrols.com&quot;</span>)]
<span style="color: blue">public</span> <span style="color: blue">class</span> <span style="color: #2b91af">FactTree</span>
{
    [<span style="color: #2b91af">DataMember</span>]
    <span style="color: blue">public</span> <span style="color: blue">long</span> <span style="color: #2b91af">DatabaseId</span> { <span style="color: blue">get</span>; <span style="color: blue">set</span>; }

    [<span style="color: #2b91af">DataMember</span>]
    <span style="color: blue">public</span> <span style="color: #2b91af">List</span>&lt;<span style="color: #2b91af">Fact</span>&gt; <span style="color: #2b91af">Facts</span> { <span style="color: blue">get</span>; <span style="color: blue">set</span>; }

    [<span style="color: #2b91af">DataMember</span>]
    <span style="color: blue">public</span> <span style="color: #2b91af">List</span>&lt;<span style="color: #2b91af">FactRole</span>&gt; <span style="color: #2b91af">Roles</span> { <span style="color: blue">get</span>; <span style="color: blue">set</span>; }

    [<span style="color: #2b91af">DataMember</span>]
    <span style="color: blue">public</span> <span style="color: #2b91af">List</span>&lt;<span style="color: #2b91af">FactType</span>&gt; <span style="color: #2b91af">Types</span> { <span style="color: blue">get</span>; <span style="color: blue">set</span>; }
}</pre>
<p><strong>Create a WCF service</strong></p>
<p>Even though we want to end up with a Java web service, an intermediate step is to implement this service in WCF.</p>
<ol>
<li>Create a new project in Visual Studio using the template Visual C#: Web: WCF Service Application.</li>
<li>Add a reference to the class library that defines the interface.</li>
<li>Change the name of the generated service from Service1 to something meaningful.</li>
<li>Delete the generated IService1 interface.</li>
<li>Use your own interface instead.</li>
<li>Add a [ServiceBehavior] attribute to set the Namespace.</li>
</ol>
<p>At this point, the service looks something like this:</p>
<pre><span style="color: green">// NOTE: If you change the class name &quot;Service1&quot; here, you must also update the reference to &quot;Service1&quot; in Web.config and in the associated .svc file.</span>
[<span style="color: #2b91af">ServiceBehavior</span>(<span style="color: #2b91af">Namespace</span> = <span style="color: maroon">&quot;http://correspondence.updatecontrols.com&quot;</span>)]
<span style="color: blue">public</span> <span style="color: blue">class</span> <span style="color: #2b91af">SynchronizationService</span> : <span style="color: #2b91af">ISynchronizationService</span>
{
    <span style="color: blue">public</span> <span style="color: #2b91af">FactTree</span> <span style="color: #2b91af">Get</span>(<span style="color: #2b91af">FactTree</span> pivotTree, <span style="color: blue">long</span> pivotId, <span style="color: blue">long</span> timestamp)
    {
        <span style="color: blue">throw</span> <span style="color: blue">new</span> <span style="color: #2b91af">NotImplementedException</span>();
    }

    <span style="color: blue">public</span> <span style="color: blue">void</span> <span style="color: #2b91af">Post</span>(<span style="color: #2b91af">FactTree</span> messageBody)
    {
        <span style="color: blue">throw</span> <span style="color: blue">new</span> <span style="color: #2b91af">NotImplementedException</span>();
    }
}</pre>
<p>Like the comment says, we need to edit the svc file and the web.config. Right-click the svc file in the project tree and select “View Markup”. Change the Service attribute to the fully qualified name of the service class.</p>
<pre><span style="color: blue">&lt;</span><span style="color: maroon">%@</span> ServiceHost <span style="color: red">Language</span>=&quot;<span style="color: blue">C#</span>&quot; <span style="color: red">Debug</span>=&quot;<span style="color: blue">true</span>&quot;
  <span style="color: red">Service</span>=&quot;<span style="color: blue">UpdateControls.Correspondence.WebService.SynchronizationService</span>&quot;
  <span style="color: red">CodeBehind</span>=&quot;<span style="color: blue">SynchronizationService.svc.cs</span>&quot; %<span style="color: blue">&gt;</span></pre>
<p>The web.config change is slightly more complicated. There’s a lot of junk in web.config that you don’t need to worry about. The section you want is all the way at the bottom. Look for the &lt;service&gt; tag. It has two attributes: name and behaviorConfiguration. Also look for the &lt;endpoint&gt; tag right below it. It has three attributes: address, binding, and contract.</p>
<ol>
<li>Change the service name to the fully qualified name of your service class.</li>
<li>Change the endpoint binding from wsHttpBinding to basicHttpBinding.</li>
<li>Change the endpoint contract from IService1 to the fully qualified name of your interface.</li>
</ol>
<p>Here’s a trick to getting the fully qualified names. Delete the text between the quotes of the attributes. Open the Class View by hitting Ctrl+Shift+C in Visual Studio. Expand the tree to find your service class and interface. Drag them onto the web.config file between the quotes.</p>
<p>You can also change the name of the service behavior, but that’s not necessary for this intermediate step.</p>
<p><strong>Examine the WSDL</strong></p>
<p>These steps ensure that we have nice clean WSDL to work from. Take a look at it by running your WCF service application. A directory listing will open in the browser. Click on the svc file. If you get a yellow screen, please double-check your steps.</p>
<p>Click on the link to see the WSDL you’ve created. Different browsers react differently to raw XML. IE and Firefox will show it to you, but Chrome will give you a blank screen. You’ll have to view source to see the WSDL in Chrome.</p>
<p>On this first page, you’ll see all of the input and output messages, and the operations, and the service itself. Double-check that the service uses binding=&quot;i0:BasicHttpBinding_...&quot;.</p>
<p>Hack the url to look at more detailed information. Change the query string to “?wsdl=wsdl0” to see the declaration for the binding. It uses “http://schemas.xmlsoap.org/soap/http” with the “document” style.</p>
<p>Hack the url again with “?xsd=xsd0” to see the data types. You should recognize these data types as the ones you wrote in C#. Notice that it turns all of your List&lt;T&gt;s into ArrayOfTs. When we import these into Java, they will become classes containing List&lt;T&gt;.</p>
<p><strong>Create the Java contract project</strong></p>
<p>Create a Java project in your favorite IDE (mine is Eclipse). Open a command prompt and go to the source directory of that project (probably ends in “src”). Download <a href="http://cxf.apache.org/">Apache CXF</a> and unzip it to your hard drive (mine is in “c:\apache-cxf-2.2.6”).</p>
<p>Go back to the first WSDL page, the one with the “?wsdl” query string. This is the URL that we are going to generate Java files from. Copy this URL and use it at the command line:</p>
<pre>\apache-cxf-<span style="color: maroon">2</span><span style="color: maroon">.2</span><span style="color: maroon">.6</span>\bin\wsdl2java.bat http://localhost:<span style="color: maroon">3642</span>/SynchronizationService.svc<span style="color: #2b91af">?</span>wsdl</pre>
<p>CXF will generate a bunch of class files. Most will be in a package derived from your namespace. One will be in “com.microsoft.schemas._2003._10.serialization”. If you find one in org.tempuri package, you forgot a Namespace setting in one of your attributes. These class files are decorated with enough annotations to make them compatible with the WCF service.</p>
<p><strong>Create the Java service project</strong></p>
<p>Although you could put your service implementation and contract in the same project, I prefer to keep them separate. You can use the contract project to write a different service implementation, or even to write a client.</p>
<p>Create a new Dynamic Web Project. Add to the new project a reference to the contact project. You will also need to add this reference to the Java EE Module Dependencies in the project properties. Otherwise it won’t copy the contract jar file to the service lib directory, resulting in a NoClassDefFoundError at runtime. Then add a class that implements the service contract. Copy the @WebService annotation from the interface to the class. The service looks something like this:</p>
<pre>@WebService(targetNamespace = <span style="color: maroon">&quot;http://correspondence.updatecontrols.com&quot;</span>, name = <span style="color: maroon">&quot;ISynchronizationService&quot;</span>)
<span style="color: blue">public</span> <span style="color: blue">class</span> SynchronizationService <span style="color: blue">implements</span> ISynchronizationService {

    @Override
    <span style="color: blue">public</span> FactTree get(FactTree pivotTree, Long pivotId, Long timestamp) {
        <span style="color: green">// TODO Auto-generated method stub</span>
        <span style="color: blue">return</span> <span style="color: blue">null</span>;
    }

    @Override
    <span style="color: blue">public</span> <span style="color: blue">void</span> post(FactTree messageBody) {
        <span style="color: green">// TODO Auto-generated method stub</span>

    }

}</pre>
<p>The service project needs the CXF jar files. Copy them from the CXF install folder (C:\apache-cxf-2.2.6\lib) into the project’s library folder (WebContent\WEB-INF\lib). This is the minimal set that you will need:</p>
<ul>
<li>jaxb-api-2.1.jar</li>
<li>jaxb-impl-2.1.12.jar</li>
<li>wsdl4j-1.6.2.jar</li>
<li>XmlSchema-1.4.5.jar</li>
<li>cxf-2.2.6.jar</li>
</ul>
<p>Now we need to publish this web service as a servlet. The quickest way to do that is to derive a class from CXFNonSpringServlet. Right-click the project and select &quot;New: Servlet”. Change the servlet base class to “org.apache.cxf.transport.servlet.CXFNonSpringServlet”. Uncheck the boxes to implement doGet and doPost. The base class handles those for you. Once the class is created, override the loadBus method.</p>
<pre><span style="color: blue">package</span> com.updatecontrols.correspondence.service;

<span style="color: blue">import</span> javax.servlet.ServletConfig;
<span style="color: blue">import</span> javax.servlet.ServletException;
<span style="color: blue">import</span> javax.xml.ws.Endpoint;

<span style="color: blue">import</span> org.apache.cxf.transport.servlet.CXFNonSpringServlet;

<span style="color: blue">public</span> <span style="color: blue">class</span> SynchronizationServlet <span style="color: blue">extends</span> CXFNonSpringServlet {
    @Override
    <span style="color: blue">public</span> <span style="color: blue">void</span> loadBus(ServletConfig servletConfig) <span style="color: blue">throws</span> ServletException {
        <span style="color: blue">super</span>.loadBus(servletConfig);        

        Endpoint.publish(<span style="color: maroon">&quot;/SynchronizationService&quot;</span>, <span style="color: blue">new</span> SynchronizationService());
    }
}</pre>
<p>Open the web.xml file. You will notice that a servlet mapping was created for you. This mapping is set up to handle URLs that directly address the servlet, but the CXF servlet adds the service name to the URL. Add a “/*” to the end of the URL pattern to direct all such addresses to the servlet.</p>
<pre><span style="color: blue">&lt;?</span><span style="color: maroon">xml</span> <span style="color: red">version</span>=&quot;<span style="color: blue">1.0</span>&quot; <span style="color: red">encoding</span>=&quot;<span style="color: blue">UTF-8</span>&quot;<span style="color: blue">?&gt;</span>
<span style="color: blue">&lt;</span><span style="color: maroon">web-app</span> <span style="color: red">id</span>=&quot;<span style="color: blue">WebApp_ID</span>&quot; <span style="color: red">version</span>=&quot;<span style="color: blue">2.4</span>&quot; <span style="color: red">xmlns</span>=&quot;<span style="color: blue">http://java.sun.com/xml/ns/j2ee</span>&quot; <span style="color: red">xmlns:xsi</span>=&quot;<span style="color: blue">http://www.w3.org/2001/XMLSchema-instance</span>&quot; <span style="color: red">xsi:schemaLocation</span>=&quot;<span style="color: blue">http://java.sun.com/xml/ns/j2ee http://java.sun.com/xml/ns/j2ee/web-app_2_4.xsd</span>&quot;<span style="color: blue">&gt;</span>
    <span style="color: blue">&lt;</span><span style="color: maroon">display-name</span><span style="color: blue">&gt;</span>correspondence_sync_service<span style="color: blue">&lt;</span>/<span style="color: maroon">display-name</span><span style="color: blue">&gt;</span>
    <span style="color: blue">&lt;</span><span style="color: maroon">servlet</span><span style="color: blue">&gt;</span>
        <span style="color: blue">&lt;</span><span style="color: maroon">description</span><span style="color: blue">&gt;</span>
        <span style="color: blue">&lt;</span>/<span style="color: maroon">description</span><span style="color: blue">&gt;</span>
        <span style="color: blue">&lt;</span><span style="color: maroon">display-name</span><span style="color: blue">&gt;</span>SynchronizationServlet<span style="color: blue">&lt;</span>/<span style="color: maroon">display-name</span><span style="color: blue">&gt;</span>
        <span style="color: blue">&lt;</span><span style="color: maroon">servlet-name</span><span style="color: blue">&gt;</span>SynchronizationServlet<span style="color: blue">&lt;</span>/<span style="color: maroon">servlet-name</span><span style="color: blue">&gt;</span>
        <span style="color: blue">&lt;</span><span style="color: maroon">servlet-class</span><span style="color: blue">&gt;</span>
        com.updatecontrols.correspondence.service.SynchronizationServlet<span style="color: blue">&lt;</span>/<span style="color: maroon">servlet-class</span><span style="color: blue">&gt;</span>
    <span style="color: blue">&lt;</span>/<span style="color: maroon">servlet</span><span style="color: blue">&gt;</span>
    <span style="color: blue">&lt;</span><span style="color: maroon">servlet-mapping</span><span style="color: blue">&gt;</span>
        <span style="color: blue">&lt;</span><span style="color: maroon">servlet-name</span><span style="color: blue">&gt;</span>SynchronizationServlet<span style="color: blue">&lt;</span>/<span style="color: maroon">servlet-name</span><span style="color: blue">&gt;</span>
        <span style="color: blue">&lt;</span><span style="color: maroon">url-pattern</span><span style="color: blue">&gt;</span>/SynchronizationServlet<strong>/*</strong><span style="color: blue">&lt;</span>/<span style="color: maroon">url-pattern</span><span style="color: blue">&gt;</span>
    <span style="color: blue">&lt;</span>/<span style="color: maroon">servlet-mapping</span><span style="color: blue">&gt;</span>
<span style="color: blue">&lt;</span>/<span style="color: maroon">web-app</span><span style="color: blue">&gt;</span></pre>
<p>Run the project in Tomcat to make sure the servlet is published correctly. Point a browser at the servlet (in my case http://localhost:8080/correspondence_sync_service/SynchronizationServlet) and you should see a listing of available SOAP services. Append the service name to the URL (http://localhost:8080/correspondence_sync_service/SynchronizationServlet/SynchronizationService) and you will get a 500 error. If you get a 404, you haven’t modified the web.xml file correctly.</p>
<p><strong>Create a WCF client</strong></p>
<p>The last step is the easiest. Since we started by creating a WCF service contract, we can ask WCF to create a client proxy. I documented this technique in <a href="indexbcd6.html?p=338">.NET to .NET web services without WSDL</a>. It turns out that this trick works equally well for .NET to Java web services.</p>
<p>Add an endpoint to the app.config of your client. The URL should be the servlet name followed by the service name. For example:</p>
<pre><span style="color: blue">&lt;?</span><span style="color: maroon">xml</span> <span style="color: red">version</span>=&quot;<span style="color: blue">1.0</span>&quot; <span style="color: red">encoding</span>=&quot;<span style="color: blue">utf-8</span>&quot; <span style="color: blue">?&gt;</span>
<span style="color: blue">&lt;</span><span style="color: maroon">configuration</span><span style="color: blue">&gt;</span>
  <span style="color: blue">&lt;</span><span style="color: maroon">system.serviceModel</span><span style="color: blue">&gt;</span>
    <span style="color: blue">&lt;</span><span style="color: maroon">bindings</span><span style="color: blue">&gt;</span>
      <span style="color: blue">&lt;</span><span style="color: maroon">basicHttpBinding</span><span style="color: blue">&gt;</span>
        <span style="color: blue">&lt;</span><span style="color: maroon">binding</span> <span style="color: red">name</span>=&quot;<span style="color: blue">SynchronizationServiceSoapBinding</span>&quot; <span style="color: red">closeTimeout</span>=&quot;<span style="color: blue">00:01:00</span>&quot;
            <span style="color: red">openTimeout</span>=&quot;<span style="color: blue">00:01:00</span>&quot; <span style="color: red">receiveTimeout</span>=&quot;<span style="color: blue">00:10:00</span>&quot; <span style="color: red">sendTimeout</span>=&quot;<span style="color: blue">00:01:00</span>&quot;
            <span style="color: red">allowCookies</span>=&quot;<span style="color: blue">false</span>&quot; <span style="color: red">bypassProxyOnLocal</span>=&quot;<span style="color: blue">false</span>&quot; <span style="color: red">hostNameComparisonMode</span>=&quot;<span style="color: blue">StrongWildcard</span>&quot;
            <span style="color: red">maxBufferSize</span>=&quot;<span style="color: blue">65536</span>&quot; <span style="color: red">maxBufferPoolSize</span>=&quot;<span style="color: blue">524288</span>&quot; <span style="color: red">maxReceivedMessageSize</span>=&quot;<span style="color: blue">65536</span>&quot;
            <span style="color: red">messageEncoding</span>=&quot;<span style="color: blue">Text</span>&quot; <span style="color: red">textEncoding</span>=&quot;<span style="color: blue">utf-8</span>&quot; <span style="color: red">transferMode</span>=&quot;<span style="color: blue">Buffered</span>&quot;
            <span style="color: red">useDefaultWebProxy</span>=&quot;<span style="color: blue">true</span>&quot;<span style="color: blue">&gt;</span>
          <span style="color: blue">&lt;</span><span style="color: maroon">readerQuotas</span> <span style="color: red">maxDepth</span>=&quot;<span style="color: blue">32</span>&quot; <span style="color: red">maxStringContentLength</span>=&quot;<span style="color: blue">8192</span>&quot; <span style="color: red">maxArrayLength</span>=&quot;<span style="color: blue">16384</span>&quot;
              <span style="color: red">maxBytesPerRead</span>=&quot;<span style="color: blue">4096</span>&quot; <span style="color: red">maxNameTableCharCount</span>=&quot;<span style="color: blue">16384</span>&quot; /<span style="color: blue">&gt;</span>
          <span style="color: blue">&lt;</span><span style="color: maroon">security</span> <span style="color: red">mode</span>=&quot;<span style="color: blue">None</span>&quot;<span style="color: blue">&gt;</span>
            <span style="color: blue">&lt;</span><span style="color: maroon">transport</span> <span style="color: red">clientCredentialType</span>=&quot;<span style="color: blue">None</span>&quot; <span style="color: red">proxyCredentialType</span>=&quot;<span style="color: blue">None</span>&quot; <span style="color: red">realm</span>=&quot;<span style="color: blue"></span>&quot;/<span style="color: blue">&gt;</span>
            <span style="color: blue">&lt;</span><span style="color: maroon">message</span> <span style="color: red">clientCredentialType</span>=&quot;<span style="color: blue">UserName</span>&quot; <span style="color: red">algorithmSuite</span>=&quot;<span style="color: blue">Default</span>&quot; /<span style="color: blue">&gt;</span>
          <span style="color: blue">&lt;</span>/<span style="color: maroon">security</span><span style="color: blue">&gt;</span>
        <span style="color: blue">&lt;</span>/<span style="color: maroon">binding</span><span style="color: blue">&gt;</span>
      <span style="color: blue">&lt;</span>/<span style="color: maroon">basicHttpBinding</span><span style="color: blue">&gt;</span>
    <span style="color: blue">&lt;</span>/<span style="color: maroon">bindings</span><span style="color: blue">&gt;</span>
    <span style="color: blue">&lt;</span><span style="color: maroon">client</span><span style="color: blue">&gt;</span>
      <span style="color: blue">&lt;</span><span style="color: maroon">endpoint</span> <span style="color: red">address</span>=&quot;<span style="color: blue"><strong>http://localhost:8080/correspondence_sync_service/SynchronizationServlet/SynchronizationService</strong></span>&quot;
          <span style="color: red">binding</span>=&quot;<span style="color: blue">basicHttpBinding</span>&quot; <span style="color: red">bindingConfiguration</span>=&quot;<span style="color: blue">SynchronizationServiceSoapBinding</span>&quot;
          <span style="color: red">contract</span>=&quot;<span style="color: blue">UpdateControls.Correspondence.WebService.Contract.ISynchronizationService</span>&quot; <span style="color: red">name</span>=&quot;<span style="color: blue">SynchronizationService</span>&quot; /<span style="color: blue">&gt;</span>
    <span style="color: blue">&lt;</span>/<span style="color: maroon">client</span><span style="color: blue">&gt;</span>
  <span style="color: blue">&lt;</span>/<span style="color: maroon">system.serviceModel</span><span style="color: blue">&gt;</span>
<span style="color: blue">&lt;</span>/<span style="color: maroon">configuration</span><span style="color: blue">&gt;</span></pre>
<p>And with that you have a .NET WCF client communicating with a Java CXF server. I expect that similar strategies could be used to go the other direction, although I haven’t tried yet.</p>
				</div>

				<p class="postmetadata">Posted in <a href="index8e7f.html?cat=19" title="View all posts in C#" rel="category">C#</a>,  <a href="index5b0d.html?cat=12" title="View all posts in Java" rel="category">Java</a> |   <a href="indexf705.html?p=481#respond" title="Comment on Java/WCF Interop">No Comments &#187;</a></p>
			</div>

		
			<div class="post" id="post-479">
				<h2><a href="index5657.html?p=479" rel="bookmark" title="Permanent Link to Correspondence Reversi">Correspondence Reversi</a></h2>
				<small>January 27th, 2010 <!-- by Michael L Perry --></small>

				<div class="entry">
					<p>Correspondence is a library for creating collaborative smart client applications in .NET. When you express a model in Correspondence, it provides three things:</p>
<ul>
<li>Storage</li>
<li>UI updates</li>
<li>Synchronization</li>
</ul>
<p>This open source library includes a demo application to illustrate its collaborative capabilities. Correspondence Reversi is a WPF rendition of a popular two player game. Download the <a href="http://correspondence.codeplex.com/Release/ProjectReleases.aspx?ReleaseId=39602#DownloadId=103570">client</a> to play against a friend, or to randomly join in a game with a stranger. Download the <a href="http://correspondence.codeplex.com/">source code</a> to learn how Correspondence makes collaboration easy.</p>
<p><strong>Storage</strong><br />
Applications typically store their data in a relational database. But they act upon that data by loading objects into memory. To bride the gap, application designers can choose from several object-relational mappers (ORMs).</p>
<p>The problem with the ORM approach is that it requires the application designer to express their model three times:</p>
<ul>
<li>Database schema</li>
<li>Objects</li>
<li>Mapping configuration</li>
</ul>
<p>Keeping these three in synch becomes a maintenance task each time the model changes. And deploying a new version requires that the data be migrated to the new schema.</p>
<p>Correspondence is not an ORM. The application model is not reflected in a relational database schema. When the model changes, only the objects are changed. The schema remains consistent. This allows for new versions to be deployed without changing the database or migrating data. And it eliminates the need for mapping configuration, as the library stores all models the same way.</p>
<p><strong>UI updates</strong><br />
Correspondence is built on top of <a href="http://updatecontrols.codeplex.com/">Update Controls</a>, a library for keeping UI controls up-to-date. While most UI update libraries require you to manage your own dependencies, Update Controls discovers them for you and manages them on your behalf. The only thing that Update Controls requires is that your model alert it when a property is accessed or modified.</p>
<p>Correspondence takes on the responsibility of notifying Update Controls. A Correspondence model can be bound to a Winforms or WPF user interface – even through an intermediate View Model – to provide automatic dependency discovery and change notification. A Correspondence application developer will never see INotifyPropertyChanged or ObservableCollection.</p>
<p><strong>Synchronization</strong><br />
By far the most compelling feature of Correspondence is that it automatically synchronizes a data model among clients. Two or more people collaborating on the same data on different machines will automatically see each other’s changes. The automatic UI updates provided by Update Controls ensure that changes made on one machine automatically appear on the screen of another.</p>
<p>Most smart client applications switch from off-line mode to on-line mode based on the availability of the network. While on-line, smart clients communicate changes that the user makes with a server. It runs queries on the server to bring back information that the user wants to see. While off-line, they switch into a mode where data storage and queries are performed locally. Typically, smart client synchronization occurs during the switch between modes.</p>
<p>Correspondence works differently. It offers a consistent programming model whether the network is available or not. Objects created in Correspondence are stored locally, regardless of network availability. A background thread constantly synchronizes the local storage with a server when available, and silently waits when it is not. By eliminating the switch between modes, Correspondence simplifies the task of smart-client development, and improves the end-user experience.</p>
<p>Correspondence Reversi synchronizes with a cloud service running in Windows Azure. This service collects data from each client, and redistributes that data to other clients who need it. Two people playing a game together will see each other’s moves. But they will not see any of the traffic from other games. <strong>This is not a special feature of the Reversi game model. This is a feature of Correspondence.</strong> A different model will be synchronized just as intelligently, and will work with <strong>the same synchronization service</strong>. There is nothing application-specific about the cloud service.</p>
<p>Please download the <a href="http://correspondence.codeplex.com/Release/ProjectReleases.aspx?ReleaseId=39602#DownloadId=103570">client </a>and play against your friends. Then explore the <a href="http://correspondence.codeplex.com/">source code</a> and see what you can do with Correspondence.</p>
				</div>

				<p class="postmetadata">Posted in <a href="index489b.html?cat=34" title="View all posts in Synchronization" rel="category">Synchronization</a>,  <a href="indexa88f.html?cat=36" title="View all posts in Update Controls" rel="category">Update Controls</a> |   <a href="index5657.html?p=479#respond" title="Comment on Correspondence Reversi">No Comments &#187;</a></p>
			</div>

		
			<div class="post" id="post-478">
				<h2><a href="index50ba.html?p=478" rel="bookmark" title="Permanent Link to Entity Framework exception from Sum over an empty set">Entity Framework exception from Sum over an empty set</a></h2>
				<small>January 18th, 2010 <!-- by Michael L Perry --></small>

				<div class="entry">
					<p>The sum of an empty set is zero. This is a well-known mathematical truth that the .NET Framework understands.</p>
<pre><span style="color: blue">int</span> sum = <span style="color: #2b91af">Enumerable</span>.Empty&lt;<span style="color: blue">int</span>&gt;().Sum();
<span style="color: #2b91af">Assert</span>.AreEqual(<span style="color: maroon">0</span>, sum);</pre>
<p>Entity Framework 1.0, however, doesn’t work like that. If you try to sum an empty set, it will throw an exception.</p>
<pre><span style="color: #2b91af">OrderEntities</span> entities = <span style="color: blue">new</span> <span style="color: #2b91af">OrderEntities</span>();
<span style="color: blue">int</span> totalQuantity = entities.OrderLine
    .Where(orderLine =&gt; <span style="color: maroon">false</span>)
    .Sum(orderLine =&gt; orderLine.Quantity);
<span style="color: #2b91af">Assert</span>.AreEqual(<span style="color: maroon">0</span>, totalQuantity);</pre>
<blockquote>
<p>System.InvalidOperationException: The cast to value type 'Int32' failed because the materialized value is null. Either the result type's generic parameter or the query must use a nullable type.</p>
</blockquote>
<p><strong>Here’s my solution</strong> </p>
<p>Let Sum return a nullable integer. Then, if it is null, coerce it back to zero.</p>
<pre><span style="color: #2b91af">OrderEntities</span> entities = <span style="color: blue">new</span> <span style="color: #2b91af">OrderEntities</span>();
<span style="color: blue">int</span> totalQuantity = entities.OrderLine
    .Where(orderLine =&gt; <span style="color: maroon">false</span>)
    .Sum(orderLine =&gt; <strong>(<span style="color: blue">int?</span>)</strong>orderLine.Quantity)<strong> ?? <span style="color: maroon">0</span></strong>;
<span style="color: #2b91af">Assert</span>.AreEqual(<span style="color: maroon">0</span>, totalQuantity);</pre>
<p>You know that Quantity cannot be null. I know that Quantity cannot be null. But we have to trick Entity Framework into thinking that it could be null. By casting the integer to int?, you select the Sum overload that allows for a null. Since Entity Framework doesn’t do the right thing with that null, then we’ll do it ourselves.</p>
				</div>

				<p class="postmetadata">Posted in <a href="indexe8fb.html?cat=39" title="View all posts in Entity Framework" rel="category">Entity Framework</a> |   <a href="index50ba.html?p=478#comments" title="Comment on Entity Framework exception from Sum over an empty set">4 Comments &#187;</a></p>
			</div>

		
		<div class="navigation">
			<div class="alignleft"><a href="indexe43e.html?paged=10">&laquo; Previous Entries</a></div>
			<div class="alignright"><a href="indexb2de.html?paged=8">Next Entries &raquo;</a></div>
		</div>

	
	</div>
		</td>
	</tr>
</table>

<hr />
<div id="footer">
<!-- If you'd like to support WordPress, having the "powered by" link someone on your blog is the best way, it's our only promotion or advertising. -->
	<p>
		Adventures in Software is proudly powered by 
		<a href="http://wordpress.org/">WordPress</a>
		<br /><a href="indexd784.html?feed=rss2">Entries (RSS)</a>
		and <a href="indexa6da.html?feed=comments-rss2">Comments (RSS)</a>.
		<!-- 21 queries. 0.543 seconds. -->
	</p>
</div>
<script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
try {
var pageTracker = _gat._getTracker("UA-389401-3");
pageTracker._trackPageview();
} catch(err) {}</script></div>

<!-- Gorgeous design by Michael Heilemann - http://binarybonsai.com/kubrick/ -->

		<div id="sk2-footer" style="color:#FFF; background-color:#444; padding: 3px 2px 3px 2px; border-top: #888 solid 1px;">This blog is protected by <a href="http://unknowngenius.com/blog/" title="Dave">dr Dave</a>'s <strong><a href="http://unknowngenius.com/blog/wordpress/spam-karma/" title="SK2">Spam Karma 2</a></strong>: <strong>274531</strong>  Spams eaten and counting...</div><script type="text/javascript" src="replies.js"></script>
<script type="text/javascript" src="blogger.js"></script>
<script type="text/javascript" src="http://twitter.com/statuses/user_timeline/michaellperry.json?callback=twitterCallback2&amp;count=5"></script>
<script type="text/javascript" src="http://search.twitter.com/search.json?q=@michaellperry&amp;callback=twitterCallbackReplies&amp;rpp=5"></script>
</body>

<!-- Mirrored from adventuresinsoftware.com/blog/?paged=9 by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 13 Jan 2017 13:10:15 GMT -->
</html>
