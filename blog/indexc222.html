<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr">


<!-- Mirrored from adventuresinsoftware.com/blog/?cat=46&paged=3 by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 13 Jan 2017 13:09:48 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- /Added by HTTrack -->
<head profile="http://gmpg.org/xfn/11">
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />

<title>Adventures in Software   &raquo; Correspondence</title>

<meta name="generator" content="WordPress 2.3.3" /> <!-- leave this for stats -->

<link rel="stylesheet" href="wp-content/themes/ais2/style.css" type="text/css" media="screen" />
<link rel="alternate" type="application/rss+xml" title="Adventures in Software RSS Feed" href="indexd784.html?feed=rss2" />
<link rel="pingback" href="xmlrpc.html" />
    <script type="text/javascript">
        function onSilverlightError(sender, args) {
            var appSource = "";
            if (sender != null && sender != 0) {
              appSource = sender.getHost().Source;
            }
            
            var errorType = args.ErrorType;
            var iErrorCode = args.ErrorCode;

            if (errorType == "ImageError" || errorType == "MediaError") {
              return;
            }

            var errMsg = "Unhandled Error in Silverlight Application " +  appSource + "\n" ;

            errMsg += "Code: "+ iErrorCode + "    \n";
            errMsg += "Category: " + errorType + "       \n";
            errMsg += "Message: " + args.ErrorMessage + "     \n";

            if (errorType == "ParserError") {
                errMsg += "File: " + args.xamlFile + "     \n";
                errMsg += "Line: " + args.lineNumber + "     \n";
                errMsg += "Position: " + args.charPosition + "     \n";
            }
            else if (errorType == "RuntimeError") {           
                if (args.lineNumber != 0) {
                    errMsg += "Line: " + args.lineNumber + "     \n";
                    errMsg += "Position: " +  args.charPosition + "     \n";
                }
                errMsg += "MethodName: " + args.methodName + "     \n";
            }

            throw new Error(errMsg);
        }
    </script>

	<link rel="EditURI" type="application/rsd+xml" title="RSD" href="xmlrpc0db0.php?rsd" />
 <link rel="wlwmanifest" type="application/wlwmanifest+xml" href="wp-includes/wlwmanifest.xml" /> <style type='text/css'>
<!--#header { background: url('wp-content/themes/ais2/images/header-imgae03.html?upper=A7A73F&amp;lower=77773F') no-repeat bottom center; }
--></style>
</head>
<body>
<div id="page">

<div class="aisTopBar">
	<form method="get" id="searchform" action="http://adventuresinsoftware.com/blog/">
<div>
<a href="indexd784.html?feed=rss2"><img src="../images/feed-icon-28x28.png" border="0"></a>
<input type="text" value="" name="s" id="s" />
<input type="submit" id="searchsubmit" value="Search" />
</div>
</form>
</div>

<div class="aisHeaderImageRight">
	<div class="aisHeaderImage">
	<div class="aisHeaderCornerRight">
	<div class="aisHeaderCornerLeft">
	<div class="aisImageBar">
	<div class="aisSubSites">
		<a href="index.html" class="aisSubSiteLink"><span class="aisSiteTabRight"><span class="aisSiteTabLeft"><span class="aisSiteTab">
			home</span></span></span></a>
		<a class="aisSubSiteLink" href="indexb60a.html?cat=27"><span class="aisSiteTabRight"><span class="aisSiteTabLeft"><span class="aisSiteTab">
			historic modeling</span></span></span></a>
		<a class="aisSubSiteLink" href="indexa88f.html?cat=36"><span class="aisSiteTabRight"><span class="aisSiteTabLeft"><span class="aisSiteTab">
			update controls</span></span></span></a>
		<a href="index2d79.html?cat=26" class="aisSubSiteLink"><span class="aisSiteTabRight"><span class="aisSiteTabLeft"><span class="aisSiteTab">
			degrees of freedom</span></span></span></a>
		<a class="aisSubSiteLink" href="indexba53.html?page_id=2"><span class="aisSiteTabRight"><span class="aisSiteTabLeft"><span class="aisSiteTab">
			about us</span></span></span></a>

	</div>
	</div>
	</div>
	</div>
	</div>
</div>

<table style="width: 100%" cellspacing="0" cellpadding="0">
	<tr valign="top">
		<td width="210px">
<div id="sidebar">
<div class="aisLeftColumnFill">
<div class="aisLeftColumnBottom">
<div class="aisLeftColumnTop">
<div id="twitter_div" class="aisLeftNav">
<h2 class="sidebar-title">Twitter Updates</h2>
<ul id="twitter_update_list"></ul>
<a href="http://twitter.com/michaellperry" id="follow">Follow me</a>
</div>
<div id="twitter_reply_div" class="aisLeftNav">
<h2 class="sidebar-title">Twitter Replies</h2>
<ul id="twitter_reply_list"></ul>
</div>

<div class="aisLeftNav">
<a href='http://ineta.org/Speakers/SearchCommunitySpeakers.aspx?SpeakerId=c5110e21-9243-461b-a464-a6548524e885'><img alt='INETA Community Speakers Program' border='0' src='../../www.ineta.org/images/OfficialLogos/InetaCommunitySpeakersRequestMe.html' /></a>
</div>

<div class="aisLeftNav">
	<li class="pagenav"><h2>Pages</h2><ul><li class="page_item page-item-2"><a href="indexba53.html?page_id=2" title="About Us">About Us</a></li>
<li class="page_item page-item-210"><a href="index6ae3.html?page_id=210" title="Templates">Templates</a></li>
</ul></li></div>

<div class="aisLeftNav">
<h2>Archives</h2>
<ul>
	<li><a href='indexb4d5.html?m=201110' title='October 2011'>October 2011</a></li>
	<li><a href='indexc61a.html?m=201106' title='June 2011'>June 2011</a></li>
	<li><a href='indexa80d.html?m=201105' title='May 2011'>May 2011</a></li>
	<li><a href='index512b.html?m=201104' title='April 2011'>April 2011</a></li>
	<li><a href='index08fb.html?m=201103' title='March 2011'>March 2011</a></li>
	<li><a href='index52f4.html?m=201102' title='February 2011'>February 2011</a></li>
	<li><a href='index74f1.html?m=201101' title='January 2011'>January 2011</a></li>
	<li><a href='index8956.html?m=201012' title='December 2010'>December 2010</a></li>
	<li><a href='indexa1aa.html?m=201011' title='November 2010'>November 2010</a></li>
	<li><a href='indexe3d5.html?m=201010' title='October 2010'>October 2010</a></li>
	<li><a href='index9ab9.html?m=201009' title='September 2010'>September 2010</a></li>
	<li><a href='index1ff0.html?m=201008' title='August 2010'>August 2010</a></li>
	<li><a href='index9f11.html?m=201007' title='July 2010'>July 2010</a></li>
	<li><a href='index31f0.html?m=201006' title='June 2010'>June 2010</a></li>
	<li><a href='indexd189.html?m=201005' title='May 2010'>May 2010</a></li>
	<li><a href='indexb5c0.html?m=201004' title='April 2010'>April 2010</a></li>
	<li><a href='indexf258.html?m=201003' title='March 2010'>March 2010</a></li>
	<li><a href='index6e30.html?m=201002' title='February 2010'>February 2010</a></li>
	<li><a href='index6b19.html?m=201001' title='January 2010'>January 2010</a></li>
	<li><a href='index5c0a.html?m=200912' title='December 2009'>December 2009</a></li>
	<li><a href='index8f62.html?m=200911' title='November 2009'>November 2009</a></li>
	<li><a href='index451d.html?m=200910' title='October 2009'>October 2009</a></li>
	<li><a href='index3e04.html?m=200909' title='September 2009'>September 2009</a></li>
	<li><a href='index425a.html?m=200908' title='August 2009'>August 2009</a></li>
	<li><a href='index9907.html?m=200907' title='July 2009'>July 2009</a></li>
	<li><a href='index3104.html?m=200906' title='June 2009'>June 2009</a></li>
	<li><a href='indexc36d.html?m=200905' title='May 2009'>May 2009</a></li>
	<li><a href='index17e8.html?m=200904' title='April 2009'>April 2009</a></li>
	<li><a href='index10a5.html?m=200903' title='March 2009'>March 2009</a></li>
	<li><a href='index8988.html?m=200902' title='February 2009'>February 2009</a></li>
	<li><a href='index1419.html?m=200901' title='January 2009'>January 2009</a></li>
	<li><a href='index7866.html?m=200812' title='December 2008'>December 2008</a></li>
	<li><a href='index55f6.html?m=200811' title='November 2008'>November 2008</a></li>
	<li><a href='indexa7bc.html?m=200810' title='October 2008'>October 2008</a></li>
	<li><a href='indexe77c.html?m=200809' title='September 2008'>September 2008</a></li>
	<li><a href='indexcffc.html?m=200808' title='August 2008'>August 2008</a></li>
	<li><a href='index0e62.html?m=200807' title='July 2008'>July 2008</a></li>
	<li><a href='indexfda7.html?m=200806' title='June 2008'>June 2008</a></li>
	<li><a href='index7d64.html?m=200805' title='May 2008'>May 2008</a></li>
	<li><a href='index94dd.html?m=200804' title='April 2008'>April 2008</a></li>
	<li><a href='index9631.html?m=200803' title='March 2008'>March 2008</a></li>
	<li><a href='indexdd52.html?m=200802' title='February 2008'>February 2008</a></li>
	<li><a href='index21ee.html?m=200801' title='January 2008'>January 2008</a></li>
	<li><a href='index363c.html?m=200712' title='December 2007'>December 2007</a></li>
	<li><a href='index7493.html?m=200711' title='November 2007'>November 2007</a></li>
	<li><a href='index93a7.html?m=200710' title='October 2007'>October 2007</a></li>
	<li><a href='index4ca8.html?m=200709' title='September 2007'>September 2007</a></li>
	<li><a href='index6124.html?m=200708' title='August 2007'>August 2007</a></li>
	<li><a href='index6013.html?m=200707' title='July 2007'>July 2007</a></li>
	<li><a href='index2ab6.html?m=200706' title='June 2007'>June 2007</a></li>
	<li><a href='index44f0.html?m=200705' title='May 2007'>May 2007</a></li>
	<li><a href='indexf0b4.html?m=200704' title='April 2007'>April 2007</a></li>
	<li><a href='index481d.html?m=200703' title='March 2007'>March 2007</a></li>
	<li><a href='indexcbea.html?m=200702' title='February 2007'>February 2007</a></li>
	<li><a href='index9cdc.html?m=200701' title='January 2007'>January 2007</a></li>
	<li><a href='index3ea4.html?m=200612' title='December 2006'>December 2006</a></li>
	<li><a href='index67ca.html?m=200611' title='November 2006'>November 2006</a></li>
	<li><a href='indexff49.html?m=200610' title='October 2006'>October 2006</a></li>
	<li><a href='index611c.html?m=200609' title='September 2006'>September 2006</a></li>
	<li><a href='index9a21.html?m=200608' title='August 2006'>August 2006</a></li>
	<li><a href='index3ee9.html?m=200607' title='July 2006'>July 2006</a></li>
	<li><a href='indexe13a.html?m=200606' title='June 2006'>June 2006</a></li>
</ul>
</div>

<div class="aisLeftNav">
	</div>

<div class="aisLeftNav">
<h2>Books</h2>
<iframe src="http://rcm.amazon.com/e/cm?t=adventures0d2-20&amp;o=1&amp;p=8&amp;l=as1&amp;asins=0764526413&amp;fc1=000000&amp;IS2=1&amp;lt1=_blank&amp;lc1=0000ff&amp;bc1=000000&amp;bg1=ffffff&amp;f=ifr" style="width:120px;height:240px;" scrolling="no" marginwidth="0" marginheight="0" frameborder="0" name="I5" id="I5"></iframe>
<br/>
<iframe src="http://rcm.amazon.com/e/cm?t=adventures0d2-20&amp;o=1&amp;p=8&amp;l=as1&amp;asins=0201633612&amp;fc1=000000&amp;IS2=1&amp;lt1=_blank&amp;lc1=0000ff&amp;bc1=000000&amp;bg1=ffffff&amp;f=ifr" style="width:120px;height:240px;" scrolling="no" marginwidth="0" marginheight="0" frameborder="0" name="I6" id="I6"></iframe>
<br/>
<iframe src="http://rcm.amazon.com/e/cm?t=adventures0d2-20&amp;o=1&amp;p=8&amp;l=as1&amp;asins=0136291554&amp;fc1=000000&amp;IS2=1&amp;lt1=_blank&amp;lc1=0000ff&amp;bc1=000000&amp;bg1=ffffff&amp;f=ifr" style="width:120px;height:240px;" scrolling="no" marginwidth="0" marginheight="0" frameborder="0" name="I7" id="I7"></iframe>
<br/>
<iframe src="http://rcm.amazon.com/e/cm?t=adventures0d2-20&amp;o=1&amp;p=8&amp;l=as1&amp;asins=1888009195&amp;fc1=000000&amp;IS2=1&amp;lt1=_blank&amp;lc1=0000ff&amp;bc1=000000&amp;bg1=ffffff&amp;f=ifr" style="width:120px;height:240px;" scrolling="no" marginwidth="0" marginheight="0" frameborder="0" name="I8" id="I8"></iframe>
</div>
<div class="aisLeftNav">
<h2>Meta</h2>
<ul>
		<li><a href="wp-login.html">Login</a></li>
	<li><a href="http://validator.w3.org/check/referer" title="This page validates as XHTML 1.0 Transitional">Valid <abbr title="eXtensible HyperText Markup Language">XHTML</abbr></a></li>
	<li><a href="http://gmpg.org/xfn/"><abbr title="XHTML Friends Network">XFN</abbr></a></li>
	<li><a href="http://wordpress.org/" title="Powered by WordPress, state-of-the-art semantic personal publishing platform.">WordPress</a></li>
	</ul>
</div>
<div class="aisLeftContent">
<h2>Community</h2>
<ul>
	<script type="text/javascript" src="../../localhost/embed/92q2bbma.js"></script>
</ul>
</div>

</div></div></div>
</div>		</td>
		<td>

	<div id="content" class="narrowcolumn">

		
		 		<h2 class="pagetitle">Archive for the &#8216;Correspondence&#8217; Category</h2>

 	  

		<div class="navigation">
			<div class="alignleft"></div>
			<div class="alignright"><a href="index56e6.html?cat=46&amp;paged=2">Next Entries &raquo;</a></div>
		</div>

				<div class="post">
				<h3 id="post-641"><a href="indexd2ad.html?p=641" rel="bookmark" title="Permanent Link to Building an occasionally connected Silverlight application with Correspondence">Building an occasionally connected Silverlight application with Correspondence</a></h3>
				<small>Monday, April 18th, 2011</small>

				<div class="entry">
					<p>I posted a <a href="index55df.html?p=640">to-do list application built with Correspondence</a>. It holds the user’s data in isolated storage, and pushes it to a synchronization service. It took about 56 minutes and 41 seconds to build.</p>
<p><iframe src="http://player.vimeo.com/video/22700086" width="600" frameborder="0" height="353"></iframe></p>
<p><a href="http://vimeo.com/22700086">Building an occasionally connected Silverlight application with Correspondence</a> from <a href="http://vimeo.com/michaellperry">Michael L Perry</a> on <a href="http://vimeo.com/">Vimeo</a>.</p>
				</div>

				<p class="postmetadata">Posted in <a href="index38d0.html?cat=46" title="View all posts in Correspondence" rel="category">Correspondence</a> |   <a href="indexd2ad.html?p=641#respond" title="Comment on Building an occasionally connected Silverlight application with Correspondence">No Comments &#187;</a></p>

			</div>

				<div class="post">
				<h3 id="post-640"><a href="index55df.html?p=640" rel="bookmark" title="Permanent Link to Correspondence for Silverlight in NuGet">Correspondence for Silverlight in NuGet</a></h3>
				<small>Saturday, April 16th, 2011</small>

				<div class="entry">
					<p>With Correspondence for Silverlight, you can create occasionally-connected client applications that run either in or out of the browser. They use isolated storage to save the user’s changes before pushing them up to the synchronization service. From there, they are pushed out to other Silverlight or Windows Phone clients. Create a Silverlight application and use NuGet to add a reference to:
<p><font size="4"><strong>Correspondence.Silverlight.AllInOne</strong></font></p>
<p>The package will add the following features to your application:</p>
<ul>
<li>Main view model </li>
<li>View model locator </li>
<li>Model </li>
<li>Navigation model </li>
<li>Synchronization service </li>
</ul>
<p>Open the Readme.txt file for instructions on adding the view model locator to App.xaml and MainPage.xaml.</p>
<h3>To-do list</h3>
<p>As an example, try out this to-do list application. Log in using any user name you like; this example app doesn’t authenticate. You can add tasks, update their name, and mark them completed.</p>
<p><object data="data:application/x-silverlight-2," type="application/x-silverlight-2" width="540" height="300" autoupdate="true">
<param name="source" value="http://adventuresinsoftware.com/pictures/Correspondence_E090/ToDoList_3.xap" />
<param name="minRuntimeVersion" value="3.0.40624.0" />
<param name="background" value="White" />
<param name="autoUpgrade" value="true" /> <a href="http://go.microsoft.com/fwlink/?LinkID=149156&amp;v=3.0.40624.0" style="text-decoration:none">          			  <img src="http://go.microsoft.com/fwlink/?LinkId=161376" alt="Get Microsoft Silverlight" style="border-style:none" /> </a> </object></p>
<p>Some things to try. Log in using your name, enter some tasks, then switch to another user. Those tasks disappear. Switch back and they reappear.</p>
<p>Close the browser, then come back to this page. Your data is still here. Disconnect from the network and this still works.</p>
<p>Now go to a different machine and log in using your name again. At first the list will be empty, but you’ll see tasks come down as the app synchronizes.</p>
<p>A web page that lets you share data between two browsers is nothing new. What makes this different is:</p>
<ul>
<li>Data is still accessible while off line. This is particularly important for out-of-browser applications. </li>
<li>There is no application-specific server-side schema or code. The data model and all of your logic is in the client. </li>
<li>Silverlight applications can synchronize with Windows Phone applications. </li>
</ul>
<p>Here’s how the to-do list example is built. Download the <a href="../pictures/Correspondence_E090/ToDoList.zip" target="_self">source code</a> and follow along. </p>
<h3>Log on</h3>
<p>A User is a fact identified by a user name. We represent the user in the Factual model:</p>
<pre class="code">fact User {
key:
    string userName;
}</pre>
<p>Any time we create a User with a give user name, we get back the same instance. This allows the user to log in. Of course, a production system would authenticate the user, but it would still follow the same pattern. The user input is captured first in a transient navigation model: </p>
<pre class="code"><span style="color: blue">public class </span><span style="color: #2b91af">NavigationModel
</span>{
    <span style="color: blue">private </span><span style="color: #2b91af">Independent</span>&lt;<span style="color: blue">string</span>&gt; _userName = <span style="color: blue">new </span><span style="color: #2b91af">Independent</span>&lt;<span style="color: blue">string</span>&gt;();

    <span style="color: blue">public string </span>UserName
    {
        <span style="color: blue">get </span>{ <span style="color: blue">return </span>_userName; }
        <span style="color: blue">set </span>{ _userName.Value = <span style="color: blue">value</span>; }
    }
}</pre>
<p>This is where the user name is stored while the user is logging in. We expose this property and a login command through the view model. </p>
<pre class="code"><span style="color: blue">public string </span>UserName
{
    <span style="color: blue">get </span>{ <span style="color: blue">return </span>_navigationModel.UserName; }
    <span style="color: blue">set </span>{ _navigationModel.UserName = <span style="color: blue">value</span>; }
}

<span style="color: blue">public </span><span style="color: #2b91af">ICommand </span>LogIn
{
    <span style="color: blue">get
    </span>{
        <span style="color: blue">return </span><span style="color: #2b91af">MakeCommand
            </span>.When(() =&gt; !<span style="color: #2b91af">String</span>.IsNullOrEmpty(_navigationModel.UserName))
            .Do(() =&gt;
            {
                <span style="color: #2b91af">User </span>user = _community.AddFact(<span style="color: blue">new </span><span style="color: #2b91af">User</span>(_navigationModel.UserName));
                _navigationModel.CurrentUser = user;
                _navigationModel.UserName = <span style="color: blue">string</span>.Empty;
            });
    }
}</pre>
<p>The login command is only enabled when a user name has been entered. When the user clicks the button, a new User is created with the name that they entered. That User is then stored in the navigation model, and the entered name is cleared out. </p>
<h3>List tasks</h3>
<p>Once we have a User fact in our navigation model, we can list the tasks assigned to that user. A task is another fact, which references the User to which it is assigned.</p>
<pre class="code">fact Task {
key:
    unique;
    User assignedTo;
}</pre>
<p>Because the key doesn’t already contain enough information to distinguish one task from another, it is marked as “unique”. This causes Correspondence to generate a new Task every time one is created, rather than looking for an existing one. </p>
<p>The User queries for related tasks.</p>
<pre class="code">fact User {
    ...

query:
    Task* openTasks {
        Task t : t.assignedTo = this
            where not t.isCompleted
    }
}</pre>
<p>That query is exposed through the view model. The MainViewModel generates a list of TaskViewModels to wrap the Tasks.</p>
<pre class="code"><span style="color: blue">public </span><span style="color: #2b91af">IEnumerable</span>&lt;<span style="color: #2b91af">TaskViewModel</span>&gt; OpenTasks
{
    <span style="color: blue">get
    </span>{
        <span style="color: blue">if </span>(_navigationModel.CurrentUser != <span style="color: blue">null</span>)
            <span style="color: blue">return
                from </span><span style="color: #2b91af">Task </span>t <span style="color: blue">in </span>_navigationModel.CurrentUser.OpenTasks
                <span style="color: blue">select new </span><span style="color: #2b91af">TaskViewModel</span>(t);
        <span style="color: blue">else
            return </span><span style="color: #2b91af">Enumerable</span>.Empty&lt;<span style="color: #2b91af">TaskViewModel</span>&gt;();
    }
}</pre>
<h3>Add a task</h3>
<p>The user can enter the name of a task, then hit the Add button to add it to the list. Just like the user name, the task name is stored in the navigation model temporarily. When a user is logged on and a name has been entered, the button becomes enabled. When clicked, it adds a task assigned to the user, and sets the task name.</p>
<pre class="code"><span style="color: blue">public </span><span style="color: #2b91af">ICommand </span>AddTask
{
    <span style="color: blue">get
    </span>{
        <span style="color: blue">return </span><span style="color: #2b91af">MakeCommand
            </span>.When(() =&gt;
                _navigationModel.CurrentUser != <span style="color: blue">null </span>&amp;&amp;
                !<span style="color: #2b91af">String</span>.IsNullOrEmpty(_navigationModel.TaskName))
            .Do(() =&gt;
            {
                <span style="color: #2b91af">Task </span>task = _community.AddFact(<span style="color: blue">new </span><span style="color: #2b91af">Task</span>(_navigationModel.CurrentUser));
                task.Name = _navigationModel.TaskName;
                _navigationModel.TaskName = <span style="color: #2b91af">String</span>.Empty;
            });
    }
}</pre>
<h3>Change a task name</h3>
<p>Notice that the constructor above only takes the User to which the task is assigned. That’s because the User is part of the key. The task name is not. It is a mutable property.</p>
<pre class="code">fact Task {
    ...

mutable:
    string name;
}</pre>
<p>Because the property is mutable, the user can edit the name and hit the Update button. The button is only enabled when a task is selected and the name has been entered. </p>
<pre class="code"><span style="color: blue">public </span><span style="color: #2b91af">ICommand </span>UpdateTask
{
    <span style="color: blue">get
    </span>{
        <span style="color: blue">return </span><span style="color: #2b91af">MakeCommand
            </span>.When(() =&gt;
                _navigationModel.SelectedTask != <span style="color: blue">null </span>&amp;&amp;
                !<span style="color: #2b91af">String</span>.IsNullOrEmpty(_navigationModel.TaskName))
            .Do(() =&gt;
            {
                _navigationModel.SelectedTask.Name = _navigationModel.TaskName;
                _navigationModel.TaskName = <span style="color: #2b91af">String</span>.Empty;
            });
    }
}</pre>
<h3>Mark a task completed</h3>
<p>Finally, the user can mark a task as completed. This is itself a new fact.</p>
<pre class="code">fact TaskCompleted {
key:
    Task completedTask;
}</pre>
<p>The Task fact queries for related TaskCompleted facts to see if it is completed. </p>
<pre class="code">fact Task {
    ...

query:
    bool isCompleted {
        exists TaskCompleted c : c.completedTask = this
    }
}</pre>
<p>This query is then used in the User’s query so that he sees only the open tasks. </p>
<pre class="code">fact User {
    ...

query:
    Task* openTasks {
        Task t : t.assignedTo = this
            where not t.isCompleted
    }
}</pre>
<p>When the user clicks the Complete button, it completes the task. We added this method to the Task itself using a partial class. </p>
<pre class="code"><span style="color: blue">public </span><span style="color: #2b91af">ICommand </span>CompleteTask
{
    <span style="color: blue">get
    </span>{
        <span style="color: blue">return </span><span style="color: #2b91af">MakeCommand
            </span>.When(() =&gt; _navigationModel.SelectedTask != <span style="color: blue">null</span>)
            .Do(() =&gt;
            {
                _navigationModel.SelectedTask.Complete();
            });
    }
}</pre>
<pre class="code"><span style="color: blue">public partial class </span><span style="color: #2b91af">Task
</span>{
    <span style="color: blue">public void </span>Complete()
    {
        Community.AddFact(<span style="color: blue">new </span><span style="color: #2b91af">TaskCompleted</span>(<span style="color: blue">this</span>));
    }
}</pre>
<p>Because this creates the TaskCompleted fact, it causes the list to refresh, and the task is removed. </p>
<h3>Build your own apps</h3>
<p>Please download Correspondence and try it out. If you have any questions about building your own models, please contact me by <a href="mailto:mperry@mallardsoft.com">email</a> or <a href="http://twitter.com/michaellperry">Twitter</a>. If you’d like to use my synchronization server, just send me a request for an API key. I’ll be glad to help you get set up.</p>
				</div>

				<p class="postmetadata">Posted in <a href="index38d0.html?cat=46" title="View all posts in Correspondence" rel="category">Correspondence</a> |   <a href="index55df.html?p=640#respond" title="Comment on Correspondence for Silverlight in NuGet">No Comments &#187;</a></p>

			</div>

				<div class="post">
				<h3 id="post-635"><a href="indexb753.html?p=635" rel="bookmark" title="Permanent Link to Correspondence in NuGet">Correspondence in NuGet</a></h3>
				<small>Friday, April 1st, 2011</small>

				<div class="entry">
					<p>I have released Correspondence for Windows Phone 7 to NuGet. Correspondence is a NoSQL database for the phone and other occasionally connected clients. While offline, it queues all of your user’s changes. While online, it pushes those changes to a synchronization server, which in turn pushes it to other devices.Create a Windows Phone 7 application and install the following package:</p>
<p><strong><font size="3">Correspondence.WindowsPhone.AllInOne</font></strong><strong></strong></p>
<p>This will add models, view models, a view model locator, and a synchronization service to your application.</p>
<h3>Models</h3>
<p>Correspondence models are expressed in a language called <a href="http://historicalmodeling.com/book/factual">Factual</a>. The package adds a folder called Models that contains a Factual file and a T4 template to parse it. The first thing you’ll want to do after adding the package reference is to hit the “Transform All Templates” button to generate some code.The starter model contains concepts useful for any Windows Phone 7 application. First it has an Identity:</p>
<pre>fact Identity {
key:
   string anonymousId;
   ...
}</pre>
<p>The Identity fact is uniquely identified by the user’s anonymous Windows Live ID. If they move to a different device, they carry their Identity with them. This makes it really easy to collaborate between users.The model also has the ability to disable and reenable toast notifications:</p>
<pre>fact DisableToastNotification {
key:
   unique;
   Identity identity;
query:
   bool isReenabled {
       exists EnableToastNotification e : e.disable = this
   }
}

fact EnableToastNotification {
key:
   DisableToastNotification* disable;
}</pre>
<p>The Identity fact queries to see if there are any DisableToastNotification facts:<br />
  </p>
<pre>fact Identity {
   ...
query:
   DisableToastNotification* isToastNotificationDisabled {
       DisableToastNotification d : d.identity = this
           where not d.isReenabled
   }
}</pre>
<p>The Identity partial class adds a property that turns these successor facts into a simple boolean property:</p>
<pre class="code"><span style="color: blue">public partial class </span><span style="color: #2b91af">Identity</span>
{
    <span style="color: blue">public bool </span>ToastNotificationEnabled
    {
        <span style="color: blue">get </span>{ <span style="color: blue">return </span>!IsToastNotificationDisabled.Any(); }
        <span style="color: blue">set
        </span>{
            <span style="color: blue">if </span>(IsToastNotificationDisabled.Any() &amp;&amp; <span style="color: blue">value</span>)
            {
                Community.AddFact(<span style="color: blue">new </span><span style="color: #2b91af">EnableToastNotification</span>(IsToastNotificationDisabled));
            }
            <span style="color: blue">else if </span>(!IsToastNotificationDisabled.Any() &amp;&amp; !<span style="color: blue">value</span>)
            {
                Community.AddFact(<span style="color: blue">new </span><span style="color: #2b91af">DisableToastNotification</span>(<span style="color: blue">this</span>));
            }
        }
    }
}</pre>
<p>Extend these facts and build your model in model.fact. Hit “Transform All Templates” after each change to regenerate the classes. Create partial classes to add your own business logic. ViewModelsThe package also adds a ViewModels folder, which contains two view models:</p>
<ul>
<li>MainViewModel </li>
<li>SettingsViewModel </li>
</ul>
<p>The main view model is just an empty starting place. Add properties to this view model to data bind to controls on your main page.Settings view model has one property started for you. It exposes the ToastNotificationEnabled property in the Identity. This is just a simple pass-through. You don’t raise PropertyChanged events or inherit a base class. Correspondence will raise the PropertyChanged event for you. This works because Correspondence is built on <a href="http://updatecontrols.net/">Update Controls</a>.</p>
<pre class="code"><span style="color: blue">public bool </span>ToastNotificationEnabled
{
    <span style="color: blue">get </span>{ <span style="color: blue">return </span>_identity.ToastNotificationEnabled; }
    <span style="color: blue">set </span>{ _identity.ToastNotificationEnabled = <span style="color: blue">value</span>; }
}</pre>
<p>The ViewModels folder also contains a ViewModelLocator class. Open the Readme.txt file for instructions on adding this class to your application resources, and referencing it in your views. As you create your own view models, follow the pattern demonstrated with these two existing view models to add them to the locator.</p>
<pre class="code"><span style="color: blue">public class </span><span style="color: #2b91af">ViewModelLocator</span>
{
    <span style="color: blue">private readonly </span><span style="color: #2b91af">MainViewModel </span>_main;
    <span style="color: blue">public </span>ViewModelLocator()
    {
        ...
        _main = <span style="color: blue">new </span><span style="color: #2b91af">MainViewModel</span>(_synchronizationService.Identity);
        ...
    }
    <span style="color: blue">public object </span>Main
    {
        <span style="color: blue">get </span>{ <span style="color: blue">return </span><span style="color: #2b91af">ForView</span>.Wrap(_main); }
    }
}</pre>
<h3>SynchronizationService</h3>
<p>Correspondence would be just another isolated-storage-based NoSQL database if it weren’t for the synchronization service. For the most part, this class will be invisible to you. It is initialized in the view model locator, and it works automatically.Every time you store a published fact, the synchronization service wakes up and pushes it to the server. If the device is off-line at the time, the fact is queued. The synchronization service will wake up when the network becomes available and start pushing facts.</p>
<p>When another device publishes a fact to which you have subscribed, the server will send a push notification. The synchronization service responds to these push notifications and adds the facts to the repository. Your app is notified via data binding, and the UI updates.The synchronization service is also watching the ToastNotificationEnabled property. When it is true, it subscribes for toast notifications. When it is false, it unsubscribes.</p>
<p>There are two parts of the synchronization service that you are likely to change. The first is the POXConfigurationProvider. When you create an account with a synchronization server, you will be issued a URL, a user name, and a password. Put these into this class.</p>
<pre class="code"><span style="color: blue">public </span><span style="color: #2b91af">POXConfiguration </span>Configuration
{
    <span style="color: blue">get
    </span>{
        <span style="color: blue">string </span>address = <span style="color: #a31515">&quot;https://historicalmodeling.com/correspondence_server_web/pox&quot;</span>;
        <span style="color: blue">string </span>userName = <span style="color: #a31515">&quot;&lt;&lt;Your username&gt;&gt;&quot;</span>;
        <span style="color: blue">string </span>password = <span style="color: #a31515">&quot;&lt;&lt;Your password&gt;&gt;&quot;</span>;
        <span style="color: blue">return new </span><span style="color: #2b91af">POXConfiguration</span>(address, <span style="color: #a31515">&quot;MyCoolWindowsPhoneApplication&quot;</span>, userName, password);
    }
}</pre>
<p>The second is the subscriptions. The synchronization service subscribes to the Identity. The device will receive any facts published to the user’s Identity. As you develop your own model, you will create other publications. Add linq expressions here to subscribe to those facts.</p>
<pre class="code">_community = <span style="color: blue">new </span><span style="color: #2b91af">Community</span>(<span style="color: #2b91af">IsolatedStorageStorageStrategy</span>.Load())
    .AddAsynchronousCommunicationStrategy(<span style="color: blue">new </span><span style="color: #2b91af">POXAsynchronousCommunicationStrategy</span>(configurationProvider))
    .Register&lt;<span style="color: #2b91af">CorrespondenceModel</span>&gt;()
    <strong>.Subscribe(() =&gt; _identity)</strong>
    ;</pre>
<h3>More to come</h3>
<p>There is definitely a learning curve for historical modeling in general, and Correspondence in particular. Please review the body of articles <a href="index38d0.html?cat=46">here</a> and on <a href="http://historicalmodeling.com/book/">Historical Modeling</a>. I will also be posting videos and examples over the next few weeks.I am also opening my synchronization server for a private beta. Please email or mention me to reserve your place. mperry@mallardsoft.com or <a href="http://twitter.com/michaellperry">@michaellperry</a>.</p>
				</div>

				<p class="postmetadata">Posted in <a href="index38d0.html?cat=46" title="View all posts in Correspondence" rel="category">Correspondence</a> |   <a href="indexb753.html?p=635#respond" title="Comment on Correspondence in NuGet">No Comments &#187;</a></p>

			</div>

				<div class="post">
				<h3 id="post-634"><a href="index5cd0.html?p=634" rel="bookmark" title="Permanent Link to Mutable fields in Correspondence">Mutable fields in Correspondence</a></h3>
				<small>Tuesday, March 29th, 2011</small>

				<div class="entry">
					<p><a href="wp-content/uploads/2011/03/image1.png"><img style="border-right-width: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; margin-left: 0px; border-left-width: 0px; margin-right: 0px" title="image" border="0" alt="image" align="right" src="wp-content/uploads/2011/03/image-thumb1.png" width="427" height="351" /></a> <a href="http://correspondence.codeplex.com/">Correspondence</a> is a client-side NoSQL database that synchronizes with other clients through a shared server. If you’ve experimented with the bits, there is a breaking change in the latest changeset. A new build is coming soon, as well as a closed beta of the synchronization server.</p>
<p>Correspondence is built on the concept of <a href="http://historicalmodeling.com/book">historical modeling</a>. This is a set of theory describing historical facts with partial order. The facts have predecessor/successor relationships that define both the order in which they can consistently be applied, and the mechanism for graph traversal.</p>
<p>One of the core tenets of historical modeling is that facts are immutable. This makes them easy to synchronize. Fields also determine the fact’s identity. Two facts having equal fields are actually the same fact.</p>
<p>In many applications, it is desirable to have mutable fields. In historical modeling, you have to use the <a href="http://historicalmodeling.com/book/patterns/entity_property">Entity Property</a> pattern to simulate mutability. This pattern builds on the strengths of historical modeling, allowing participants to unambiguously synchronize state changes. It also has the added benefit of detecting conflicts, and allowing users and applications to resolve them. Unfortunately, this pattern can be cumbersome to apply.</p>
<h3>The mutable keyword</h3>
<p>A Correspondence model is defined using a language called “Factual”. The upcoming release adds three keywords to the Factual modeling language. These three keywords break a fact into sections:</p>
<ul>
<li><strong>key</strong> - Required. Contains all key fields. </li>
<li><strong>mutable</strong> - Optional. Contains all mutable fields. </li>
<li><strong>query</strong> - Optional. Contains all queries and predicates. </li>
</ul>
<p>The key and query sections contain members that have always been in the language. The mutable section adds new functionality.</p>
<p>Fields in the mutable section are mutable. The compiler generates the Entity Property pattern on your behalf. These fields are not part of the key, since they are not actually stored within the fact itself. They are stored in successor facts that track changes.</p>
<p>You write this:</p>
<pre>fact Person {
key:
    unique;

mutable:
    string name;
}</pre>
<p>The Factual compiler generates this:</p>
<pre>fact Person {
key:
    unique;

query:
    PersonName* nameCandidates {
        PersonName n : n.person = this
            where n.isCurrent
    }
}

fact PersonName {
key:
    Person person;
    string value;
    PersonName* prior;

query:
    bool isCurrent {
        not exists PersonName next : next.prior = this
    }
}</pre>
<h3>Disputable properties</h3>
<p>The Entity Property pattern detects conflicts and allows the application to resolve them. To aide the application in this task, Correspondence defines Disputable&lt;T&gt;. This template can be converted to and from the raw type T, but it also exposes two additional properties.</p>
<ul>
<li><strong>InConflict</strong> – A boolean that is true if a conflict has been detected. </li>
<li><strong>Candidates</strong> – A collection of possible values. </li>
</ul>
<p>Using Disputable&lt;T&gt;, the view model can apply an alternate style when a conflict has been detected, and allow the user to choose from among the candidates to resolve it.</p>
<pre class="code"><span style="color: blue">public class </span><span style="color: #2b91af">PersonViewModel
</span>{
    <span style="color: blue">private </span><span style="color: #2b91af">Person </span>_person;

    <span style="color: blue">public </span>PersonViewModel(<span style="color: #2b91af">Person </span>person)
    {
        _person = person;
    }

    <span style="color: blue">public string </span>Name
    {
        <span style="color: blue">get </span>{ <span style="color: blue">return </span>_person.Name; }
        <span style="color: blue">set </span>{ _person.Name = <span style="color: blue">value</span>; }
    }

    <span style="color: blue">public bool </span>ShowConflictStyle
    {
        <span style="color: blue">get </span>{ <span style="color: blue">return </span>_person.Name.InConflict; }
    }

    <span style="color: blue">public </span><span style="color: #2b91af">IEnumerable</span>&lt;<span style="color: blue">string</span>&gt; CandidateNamesItemsSource
    {
        <span style="color: blue">get </span>{ <span style="color: blue">return </span>_person.Name.Candidates; }
    }

    <span style="color: blue">public string </span>CandidateNamesSelectedItem
    {
        <span style="color: blue">get </span>{ <span style="color: blue">return </span>_person.Name; }
        <span style="color: blue">set </span>{ _person.Name = <span style="color: blue">value</span>; }
    }
}</pre>
<p>The <a href="http://historicalmodeling.com/book/factual">Factual modeling language specification</a> has been updated to reflect the new mutable keyword. If you’ve created Correspondence models in the past, you will be required to add key and query section headers once you upgrade. Then you will be able to take advantage of mutability.</p>
				</div>

				<p class="postmetadata">Posted in <a href="index38d0.html?cat=46" title="View all posts in Correspondence" rel="category">Correspondence</a>,  <a href="indexb60a.html?cat=27" title="View all posts in Historic Modeling" rel="category">Historic Modeling</a> |   <a href="index5cd0.html?p=634#respond" title="Comment on Mutable fields in Correspondence">No Comments &#187;</a></p>

			</div>

				<div class="post">
				<h3 id="post-621"><a href="indexb022.html?p=621" rel="bookmark" title="Permanent Link to Remove domain knowledge from the server">Remove domain knowledge from the server</a></h3>
				<small>Tuesday, February 1st, 2011</small>

				<div class="entry">
					<p><a href="wp-content/uploads/2011/02/image.png"><img style="border-right-width: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; margin-left: 0px; border-left-width: 0px; margin-right: 0px" title="image" border="0" alt="image" align="right" src="wp-content/uploads/2011/02/image-thumb.png" width="153" height="484" /></a> Take a look at this architecture diagram. Ask yourself where the domain knowledge resides.</p>
<p>The view is obviously domain-specific. Even a web application running in a general-purpose browser is still a hand-crafted tree of HTML documents. Somebody put effort into the view with specific knowledge of the problem domain.</p>
<p>The model is obviously domain-specific. By today’s best practices, that’s where most of your domain logic lives. But that’s not where it stays. It leaks forward into the view model, and backward into the service agent.</p>
<p>The API is domain-specific. It contains service methods, document types, or REST resources with names from the problem domain. If you were to build a different system, you would have to build a completely different API.</p>
<p>The logic layer is domain-specific. This layer hosts all of the services that the client calls. Most of these services are simple CRUD operations that pass through to the database. But a few add value to the data. In either case, these service functions are only useful within a specific problem domain.</p>
<p>The database is often domain-specific. Relational databases understand the schema of the data that they store, which is how they can execute complex ad-hoc queries over that data. But some databases – particularly the document-oriented NoSQL databases – are schemaless. Since they aren’t given any domain knowledge, they can be used for any problem domain.</p>
<p>Domain knowledge has infiltrated almost every layer of the architecture. The only layers that are spared are the data access layer (e.g. Hibernate, Entity Framework) and perhaps the database (e.g. MongoDB, CouchDB).</p>
<p>Every other layer we must write ourselves. We must write it anew for every application we build. We must redeploy it each time we add even a single feature to an application.</p>
<h3>A typical deployment scenario</h3>
<p>Suppose you have an application in production. You want to add a new feature to that application. What do you have to do?</p>
<p>Unless it’s trivial, that feature is going to record a new piece of data. That means that we will need to modify the schema to add a column, or perhaps a table. We have to be careful not to change or delete any existing columns, as that will complicate deployment. That change will be scripted and deployed to the database.</p>
<p>To expose that feature, we need to add logic and a new API call. We have to be careful how we modify any existing APIs so that they are backward compatible. That change will be built and deployed to the servers. It must be deployed after the database script is run.</p>
<p>Third, we need to avail our users of the new feature. The service agent must be regenerated, and the new data added to the model. We then modify the view and view model to present that new functionality. If this is a web application, these components are deployed with the server: they are the generated HTML and attached JavaScript files. If this is a client application, then we make a new MSI available for download.</p>
<p>All of these steps must be completed in three different environments. The development environment is updated so frequently that we need an automated build. QA is updated less frequently, but still more than once for a new release. Production is updated infrequently, and with the greatest of care.</p>
<p>Every one of these versioning and deployment tasks costs money. So far, that cost has just been accepted as the price of doing business. That’s about to change.</p>
<h3>Correspondence</h3>
<p><a href="wp-content/uploads/2011/02/image1.png"><img style="border-right-width: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; margin-left: 0px; border-left-width: 0px; margin-right: 0px" title="image" border="0" alt="image" align="right" src="wp-content/uploads/2011/02/image-thumb1.png" width="156" height="244" /></a> Correspondence changes the architectural diagram. It eliminates many of the layers. Most importantly, it <strong>removes domain knowledge from the server</strong>.</p>
<p>Correspondence is an application-agnostic synchronization engine. You download the <a href="http://correspondence.codeplex.com/">open-source client libraries and tools</a>, and express your model in a language called <a href="http://historicalmodeling.com/book/factual">Factual</a>. You then point your client at a correspondence server. A free server is provided for development and testing. More robust servers will be available soon for production scenarios.</p>
<p>While Correspondence can be used for web applications, it is best suited for rich clients (WPF or Windows Phone 7 currently). Clients use a publish/subscribe mechanism for sharing data with one another through a common Correspondence server.</p>
<p>A Correspondence rich-client deployment scenario is simpler than the server-based alternative. To add a feature, you first modify the Factual model. Like before, you have to be careful to retain backward compatibility. Then you expose that feature through the view model and the view. With that, you are done. No database scripts. No API changes.</p>
<p>Developers can test their changes without redeploying a development server. They will work either against a local Correspondence server, or one shared by the development team. But none of their changes are deployed <em>to</em> the server. While automated builds are still a good thing, they are not necessary for testing changes in development.</p>
<p>QA will have its own Correspondence server. Again, no part of the application is deployed to this server. This means that testers can pick up builds and start testing independently, even if other members of the team are testing earlier builds.</p>
<p>Production deployments are just client updates. In Windows Phone 7, this is pushed through the Marketplace. For a desktop solution, automatic updates, MSI downloads, and ClickOnce are all viable options. <strong>No software or database changes need to be deployed to a production server.</strong></p>
<h3>Services</h3>
<p><a href="wp-content/uploads/2011/02/image2.png"><img style="border-right-width: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; margin-left: 0px; border-left-width: 0px; margin-right: 0px" title="image" border="0" alt="image" align="right" src="wp-content/uploads/2011/02/image-thumb2.png" width="244" height="239" /></a> Correspondence eliminates the need for CRUD operations on the server. But what if you have server-side logic? What if you have work that can’t be done on the client? Then you need to write a service.</p>
<p>A Correspondence service is nothing more than a faceless client. It doesn’t run on the client device, but it is still a client of the Correspondence Server. It uses the same Factual model as the client. It uses the same publish/subscribe mechanism to exchange data with other clients. Services can even be joined together in a <a href="http://historicalmodeling.com/book/distributed-systems/service-bus">service bus</a> configuration.</p>
<p>Services change the deployment story; you need to deploy them to a server. These services may integrate with a relational database to provide reporting. If so, then you will again need to deploy database changes. But these services no longer sit <em>between</em> the client and the database. As a result, they can be deployed independently. They don’t even need to be deployed to machines accessible by the client.</p>
<h3>Web applications</h3>
<p><a href="wp-content/uploads/2011/02/image3.png"><img style="border-right-width: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; margin-left: 0px; border-left-width: 0px; margin-right: 0px" title="image" border="0" alt="image" align="right" src="wp-content/uploads/2011/02/image-thumb3.png" width="207" height="244" /></a> While Correspondence is best suited to rich-client applications, it can be used for web apps as well. Most likely, you will have a web interface for infrequent visitors, and a rich-client interface for regular users.</p>
</p>
<p>The web application will use the Factual model to query and record its data. Then it will generate the same kind of HTML experience that we are used to. If a richer AJAX interface is still desired, then the additional API and service agent layers can be added. You must weigh the benefits of these layers against the extra development and deployment costs they impose.</p>
<p>A web application backed by Correspondence gains the same benefits as one using a NoSQL database. Since the data layer is schemaless, no database changes need to be deployed. If all users access your application through the web, then there is little extra benefit that Correspondence can offer. But if you want to augment the web experience with a rich-client experience, then Correspondence has a place.</p>
<p>In a layered client/server architecture, domain knowledge resides at almost every layer. That domain knowledge costs us development time and deployment risk. Application-agnostic integration servers like Correspondence remove domain knowledge from many server-side components, making it easier to build, test, and deploy solutions.</p>
				</div>

				<p class="postmetadata">Posted in <a href="index38d0.html?cat=46" title="View all posts in Correspondence" rel="category">Correspondence</a> |   <a href="indexb022.html?p=621#respond" title="Comment on Remove domain knowledge from the server">No Comments &#187;</a></p>

			</div>

				<div class="post">
				<h3 id="post-576"><a href="indexaa4f.html?p=576" rel="bookmark" title="Permanent Link to A non-relational database for Windows Phone 7">A non-relational database for Windows Phone 7</a></h3>
				<small>Monday, November 1st, 2010</small>

				<div class="entry">
					<p>The Windows Phone 7 development platform shipped with no built-in database. This is a surprising departure from Windows CE and Windows Mobile, both of which had on-device database support. Several open-source relational database projects are currently porting their codebases. But perhaps this is a good time to reevaluate the needs of the platform. Do you really want a relational database on a phone?</p>
<p><a href="http://correspondence.codeplex.com/">Correspondence</a> is a non-relational database for occasionally-connected clients. The new build of Correspondence has project templates for Windows Phone 7. It is a natural fit for the platform. After all, what client is more occasionally-connected than a phone?</p>
<h3>What can you do with a non-relational database?</h3>
<p>Relational databases are optimized for ad-hoc queries, such as those required for data analysis and business intelligence. Relational databases are fantastic at reporting, and very efficient at processing large numbers of records. Your typical phone application requires none of these things.</p>
<p>There are several flavors of non-relational database (document, associative array, network, etc.) Each offers different sets of features. In general, however, non-relational databases are good at:</p>
<ul>
<li>Quickly locating related entities.</li>
<li>Representing hierarchical data.</li>
<li>Searching or sorting by application-defined attributes.</li>
<li>Mapping to object-oriented code.</li>
</ul>
<p>These are typically the features most desired by mobile application developers.</p>
<h3>Where does Correspondence fit in?</h3>
<p>Correspondence is a historical database. It is closely related to a network database, but with one significant difference: all entities are immutable. This is how historical databases gain their uncanny ability to synchronize.</p>
<p>Both historical and network databases directly connect entities with their neighbors. A phone application requires quick access to related entities. Starting at one point, the user of the application selects items to drill through a network of objects. They want the application to start up quickly, and they want the phone to be responsive. These phones generally do not have powerful processors or a great deal of memory. So a database that links entities directly to one another rather than indexing them is a win in this situation.</p>
<p>But historical and network databases differ in that network databases allow entities to change over time. This is the way we typically think about object-oriented systems. But historical databases do not allow entities to change. The only way to alter an entity is to append another that changes its meaning. The entity itself is immutable.</p>
<p>The reason for modeling data historically is to support synchronization. Things that change are hard to synchronize. Things that don’t are easy. A phone is only a small part of a person’s life. If their data was only on the device, it would be of limited value. A database that is optimized for synchronizing with the desktop and the Web is much more compelling.</p>
<h3>How do you model changing data with immutable entities?</h3>
<p>Consider a chess board. During the course of the game, the board position changes dramatically. We could model a chess game in an object-oriented system as an 8-by-8 grid of squares whose values change over time.</p>
<p>But the chess game is actually a sequence of discrete moves. Once a move is made, it cannot be changed. By observing that history of moves, we can determine the current position of the board. In fact, we can reconstruct the board position at any point in time. The mutable chess board is modeled with a sequence of immutable moves.</p>
<p>An application based on a historical database works the same way. Rather than capturing the current state of the system, the database captures all of the decisions that led to that state. These decisions have been made in the past, and are now considered historical facts. By querying related facts, the application can quickly determine the state of the system.</p>
<p>Take a contact manager application, for example. Add a person with the name “Mike”. You will have a Person fact and a Name fact.</p>
<p><a href="wp-content/uploads/2010/11/contacts.jpg"><img style="background-image: none; border-bottom: 0px; border-left: 0px; padding-left: 0px; padding-right: 0px; display: inline; border-top: 0px; border-right: 0px; padding-top: 0px" title="Contacts" border="0" alt="Contacts" src="wp-content/uploads/2010/11/contacts-thumb.jpg" width="157" height="155" /></a></p>
<p>Now let’s change the name. We do that by introducing a new Name fact. This one not only references the Person, but also the prior name.</p>
<p><a href="wp-content/uploads/2010/11/contacts1.jpg"><img style="background-image: none; border-bottom: 0px; border-left: 0px; padding-left: 0px; padding-right: 0px; display: inline; border-top: 0px; border-right: 0px; padding-top: 0px" title="Contacts" border="0" alt="Contacts" src="wp-content/uploads/2010/11/contacts-thumb1.jpg" width="227" height="251" /></a></p>
<p>We don’t have to replay all of the historical facts to determine the current name of a contact. We can quickly query a Person for the related Name that has not been replaced. In the modeling language of Correspondence, the query looks like this:</p>
<pre><span style="color: blue">fact</span> <span style="color: #2b91af">Person</span> {
    <span style="color: blue">unique</span>;

    <span style="color: #2b91af">Name</span>* currentNames {
        <span style="color: #2b91af">Name</span> n : n.person = <span style="color: blue">this</span>
            <span style="color: blue">where</span> n.isCurrent
    }
}

<span style="color: blue">fact</span> <span style="color: #2b91af">Name</span> {
    <span style="color: #2b91af">Person</span> person;
    <span style="color: #2b91af">Name</span>* prior;
    <span style="color: blue">string</span> value;

    <span style="color: blue">bool</span> isCurrent {
        <span style="color: blue">not</span> <span style="color: blue">exists</span> <span style="color: #2b91af">Name</span> next : next.prior = <span style="color: blue">this</span>
    }
}</pre>
<p>The currentNames query appears as a collection in code. You can make it look like a mutable property like this:</p>
<pre><span style="color: blue">public</span> <span style="color: blue">partial</span> <span style="color: blue">class</span> <span style="color: #2b91af">Person</span> {
    <span style="color: blue">string</span> <span style="color: #2b91af">Name</span>
    {
        <span style="color: blue">get</span>
        {
            <span style="color: blue">return</span> <span style="color: #2b91af">CurrentNames</span>
                .Select(name =&gt; name.Value)
                .FirstOrDefault();
        }
        <span style="color: blue">set</span>
        {
            <span style="color: #2b91af">Community</span>.AddFact(<span style="color: blue">new</span> <span style="color: #2b91af">Name</span>(<span style="color: blue">this</span>, <span style="color: #2b91af">CurrentNames</span>, value));
        }
    }
}</pre>
<p>The getter pulls the value of the Name matching the query. The setter creates a new name. It passes CurrentNames to the new fact as the value of “prior”, thus ensuring that it replaces the current value.</p>
<h3>What next?</h3>
<p>Please download the latest build of <a href="http://correspondence.codeplex.com/">Correspondence</a> from CodePlex. On that site, you will also find some walkthroughs that take you through building your first Correspondence application in WPF. Once you are comfortable thinking historically, try it on Windows Phone 7. You can find more patterns like the one above on <a href="http://histiricalmodeling.com/">Historical Modeling</a>.</p>
				</div>

				<p class="postmetadata">Posted in <a href="index38d0.html?cat=46" title="View all posts in Correspondence" rel="category">Correspondence</a>,  <a href="indexc728.html?cat=7" title="View all posts in Databases" rel="category">Databases</a> |   <a href="indexaa4f.html?p=576#respond" title="Comment on A non-relational database for Windows Phone 7">No Comments &#187;</a></p>

			</div>

				<div class="post">
				<h3 id="post-545"><a href="index3a3f.html?p=545" rel="bookmark" title="Permanent Link to Correspondence launch">Correspondence launch</a></h3>
				<small>Tuesday, August 3rd, 2010</small>

				<div class="entry">
					<p><a href="wp-content/uploads/2010/08/image.png"><img style="border-right-width: 0px; margin: 0px 0px 0px 5px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px" title="image" border="0" alt="image" align="right" src="wp-content/uploads/2010/08/image-thumb.png" width="644" height="324" /></a> </p>
<p><a href="http://correspondence.codeplex.com/">Download the project from Codeplex.</a></p>
<p>Correspondence is a library for building occasionally connected client applications. In other words, an app that can tolerate being off line. These have typically been hard to write. Correspondence makes it easier. It gives you the following features:</p>
<ul>
<li>Client-side storage </li>
<li>Server-side storage </li>
<li>Client-server communication </li>
<li>Client-to-client collaboration </li>
</ul>
<p>And because it’s based on Update Controls, you also get:</p>
<ul>
<li>Automatic dependency management </li>
<li>UI update notification </li>
<li>MVVM support </li>
</ul>
<p>So imagine that you and a friend are using the same application. They make a change. Your UI is updated. That’s what Correspondence does.</p>
<p><strong>The Factual modeling language</strong>     <br />To get all of these features, you have to model your data differently. You declare your model using a language called Factual. Here’s a snippet of Factual describing players and moves in a Reversi game:</p>
<pre><span style="color: blue">fact</span> <span style="color: #2b91af">Player</span> {
    <span style="color: blue">pivot</span> <span style="color: #2b91af">User</span> user;
    <span style="color: blue">pivot</span> <span style="color: #2b91af">Game</span> game;
    <span style="color: blue">int</span> index;

    <span style="color: #2b91af">Move</span>* moves {
        <span style="color: #2b91af">Move</span> m : m.player = <span style="color: blue">this</span>
    }

    <span style="color: blue">bool</span> isActive {
        <span style="color: blue">not</span> <span style="color: blue">exists</span> <span style="color: #2b91af">Outcome</span> o : o.game = <span style="color: blue">this</span>.game
    }
}

<span style="color: blue">fact</span> <span style="color: #2b91af">Move</span> {
    <span style="color: #2b91af">Player</span> player;
    <span style="color: blue">int</span> index;
    <span style="color: blue">int</span> square;
}</pre>
<p>The model is neither relational, nor object oriented. It is historical. It defines historical facts. These facts have fields, relationships, queries, and predicates. All of that is defined in the model so that Correspondence can generate the storage and communications for you. </p>
<p><strong>The development tools</strong> </p>
<p>When you get the Correspondence bits, you will pull down two installs. The first is for your development machine. It installs:</p>
<ul>
<li>The library assemblies </li>
<li>The Factual compiler </li>
<li>Project templates </li>
</ul>
<p>Once you install this component, you’ll want to go into Visual Studio and hit “File”, “New”, “Visual C#”, “Correspondence”, “Correspondence Model”. This will create a project that references the right assemblies, and has a T4 template that runs the Factual compiler. Using the other project templates, you can create view models, unit tests, and WPF applications that use that model.</p>
<p><strong>SyncExpress</strong> </p>
<p>The second install is for your server. It installs a Windows service called “Correspondence SyncExpress”. It runs on http://localhost:9119/SyncExpress. Point your clients at that service and they will synchronize.</p>
<p>SyncExpress is licensed for development and test environments. It is not intended for production. I’m working on some production-ready options for you. For now, just use it to experiment with Correspondence.</p>
<p><strong>Examples</strong> </p>
<p>If you download the source from Codeplex, you will find a Reversi game. Edit the app.config to point the client at your installation of SyncExpress, and you can play a game with a friend.</p>
<p>I am also writing lessons on the Codeplex site taking you step-by-step through building your own Correspondence application. Eventually, I will record screen cast videos of that content.</p>
<p>Please download the bits and follow along with the lessons. I think you’ll find that creating occasionally connected clients has gotten much easier.</p>
				</div>

				<p class="postmetadata">Posted in <a href="index38d0.html?cat=46" title="View all posts in Correspondence" rel="category">Correspondence</a> |   <a href="index3a3f.html?p=545#respond" title="Comment on Correspondence launch">No Comments &#187;</a></p>

			</div>

		
		<div class="navigation">
			<div class="alignleft"></div>
			<div class="alignright"><a href="index56e6.html?cat=46&amp;paged=2">Next Entries &raquo;</a></div>
		</div>

	
	</div>
		</td>
	</tr>
</table>

<hr />
<div id="footer">
<!-- If you'd like to support WordPress, having the "powered by" link someone on your blog is the best way, it's our only promotion or advertising. -->
	<p>
		Adventures in Software is proudly powered by 
		<a href="http://wordpress.org/">WordPress</a>
		<br /><a href="indexd784.html?feed=rss2">Entries (RSS)</a>
		and <a href="indexa6da.html?feed=comments-rss2">Comments (RSS)</a>.
		<!-- 17 queries. 0.456 seconds. -->
	</p>
</div>
<script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
try {
var pageTracker = _gat._getTracker("UA-389401-3");
pageTracker._trackPageview();
} catch(err) {}</script></div>

<!-- Gorgeous design by Michael Heilemann - http://binarybonsai.com/kubrick/ -->

		<div id="sk2-footer" style="color:#FFF; background-color:#444; padding: 3px 2px 3px 2px; border-top: #888 solid 1px;">This blog is protected by <a href="http://unknowngenius.com/blog/" title="Dave">dr Dave</a>'s <strong><a href="http://unknowngenius.com/blog/wordpress/spam-karma/" title="SK2">Spam Karma 2</a></strong>: <strong>274531</strong>  Spams eaten and counting...</div><script type="text/javascript" src="replies.js"></script>
<script type="text/javascript" src="blogger.js"></script>
<script type="text/javascript" src="http://twitter.com/statuses/user_timeline/michaellperry.json?callback=twitterCallback2&amp;count=5"></script>
<script type="text/javascript" src="http://search.twitter.com/search.json?q=@michaellperry&amp;callback=twitterCallbackReplies&amp;rpp=5"></script>
</body>

<!-- Mirrored from adventuresinsoftware.com/blog/?cat=46&paged=3 by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 13 Jan 2017 13:09:48 GMT -->
</html>
