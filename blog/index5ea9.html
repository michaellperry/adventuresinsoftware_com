<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr">


<!-- Mirrored from adventuresinsoftware.com/blog/?paged=18 by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 13 Jan 2017 13:10:42 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- /Added by HTTrack -->
<head profile="http://gmpg.org/xfn/11">
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />

<title>Adventures in Software  </title>

<meta name="generator" content="WordPress 2.3.3" /> <!-- leave this for stats -->

<link rel="stylesheet" href="wp-content/themes/ais2/style.css" type="text/css" media="screen" />
<link rel="alternate" type="application/rss+xml" title="Adventures in Software RSS Feed" href="indexd784.html?feed=rss2" />
<link rel="pingback" href="xmlrpc.html" />
    <script type="text/javascript">
        function onSilverlightError(sender, args) {
            var appSource = "";
            if (sender != null && sender != 0) {
              appSource = sender.getHost().Source;
            }
            
            var errorType = args.ErrorType;
            var iErrorCode = args.ErrorCode;

            if (errorType == "ImageError" || errorType == "MediaError") {
              return;
            }

            var errMsg = "Unhandled Error in Silverlight Application " +  appSource + "\n" ;

            errMsg += "Code: "+ iErrorCode + "    \n";
            errMsg += "Category: " + errorType + "       \n";
            errMsg += "Message: " + args.ErrorMessage + "     \n";

            if (errorType == "ParserError") {
                errMsg += "File: " + args.xamlFile + "     \n";
                errMsg += "Line: " + args.lineNumber + "     \n";
                errMsg += "Position: " + args.charPosition + "     \n";
            }
            else if (errorType == "RuntimeError") {           
                if (args.lineNumber != 0) {
                    errMsg += "Line: " + args.lineNumber + "     \n";
                    errMsg += "Position: " +  args.charPosition + "     \n";
                }
                errMsg += "MethodName: " + args.methodName + "     \n";
            }

            throw new Error(errMsg);
        }
    </script>

	<link rel="EditURI" type="application/rsd+xml" title="RSD" href="xmlrpc0db0.php?rsd" />
 <link rel="wlwmanifest" type="application/wlwmanifest+xml" href="wp-includes/wlwmanifest.xml" /> <style type='text/css'>
<!--#header { background: url('wp-content/themes/ais2/images/header-imgae03.html?upper=A7A73F&amp;lower=77773F') no-repeat bottom center; }
--></style>
</head>
<body>
<div id="page">

<div class="aisTopBar">
	<form method="get" id="searchform" action="http://adventuresinsoftware.com/blog/">
<div>
<a href="indexd784.html?feed=rss2"><img src="../images/feed-icon-28x28.png" border="0"></a>
<input type="text" value="" name="s" id="s" />
<input type="submit" id="searchsubmit" value="Search" />
</div>
</form>
</div>

<div class="aisHeaderImageRight">
	<div class="aisHeaderImage">
	<div class="aisHeaderCornerRight">
	<div class="aisHeaderCornerLeft">
	<div class="aisImageBar">
	<div class="aisSubSites">
		<a href="index.html" class="aisSubSiteLink"><span class="aisSiteTabRight"><span class="aisSiteTabLeft"><span class="aisSiteTab">
			home</span></span></span></a>
		<a class="aisSubSiteLink" href="indexb60a.html?cat=27"><span class="aisSiteTabRight"><span class="aisSiteTabLeft"><span class="aisSiteTab">
			historic modeling</span></span></span></a>
		<a class="aisSubSiteLink" href="indexa88f.html?cat=36"><span class="aisSiteTabRight"><span class="aisSiteTabLeft"><span class="aisSiteTab">
			update controls</span></span></span></a>
		<a href="index2d79.html?cat=26" class="aisSubSiteLink"><span class="aisSiteTabRight"><span class="aisSiteTabLeft"><span class="aisSiteTab">
			degrees of freedom</span></span></span></a>
		<a class="aisSubSiteLink" href="indexba53.html?page_id=2"><span class="aisSiteTabRight"><span class="aisSiteTabLeft"><span class="aisSiteTab">
			about us</span></span></span></a>

	</div>
	</div>
	</div>
	</div>
	</div>
</div>

<table style="width: 100%" cellspacing="0" cellpadding="0">
	<tr valign="top">
		<td width="210px">
<div id="sidebar">
<div class="aisLeftColumnFill">
<div class="aisLeftColumnBottom">
<div class="aisLeftColumnTop">
<div id="twitter_div" class="aisLeftNav">
<h2 class="sidebar-title">Twitter Updates</h2>
<ul id="twitter_update_list"></ul>
<a href="http://twitter.com/michaellperry" id="follow">Follow me</a>
</div>
<div id="twitter_reply_div" class="aisLeftNav">
<h2 class="sidebar-title">Twitter Replies</h2>
<ul id="twitter_reply_list"></ul>
</div>

<div class="aisLeftNav">
<a href='http://ineta.org/Speakers/SearchCommunitySpeakers.aspx?SpeakerId=c5110e21-9243-461b-a464-a6548524e885'><img alt='INETA Community Speakers Program' border='0' src='../../www.ineta.org/images/OfficialLogos/InetaCommunitySpeakersRequestMe.html' /></a>
</div>

<div class="aisLeftNav">
	<li class="pagenav"><h2>Pages</h2><ul><li class="page_item page-item-2"><a href="indexba53.html?page_id=2" title="About Us">About Us</a></li>
<li class="page_item page-item-210"><a href="index6ae3.html?page_id=210" title="Templates">Templates</a></li>
</ul></li></div>

<div class="aisLeftNav">
<h2>Archives</h2>
<ul>
	<li><a href='indexb4d5.html?m=201110' title='October 2011'>October 2011</a></li>
	<li><a href='indexc61a.html?m=201106' title='June 2011'>June 2011</a></li>
	<li><a href='indexa80d.html?m=201105' title='May 2011'>May 2011</a></li>
	<li><a href='index512b.html?m=201104' title='April 2011'>April 2011</a></li>
	<li><a href='index08fb.html?m=201103' title='March 2011'>March 2011</a></li>
	<li><a href='index52f4.html?m=201102' title='February 2011'>February 2011</a></li>
	<li><a href='index74f1.html?m=201101' title='January 2011'>January 2011</a></li>
	<li><a href='index8956.html?m=201012' title='December 2010'>December 2010</a></li>
	<li><a href='indexa1aa.html?m=201011' title='November 2010'>November 2010</a></li>
	<li><a href='indexe3d5.html?m=201010' title='October 2010'>October 2010</a></li>
	<li><a href='index9ab9.html?m=201009' title='September 2010'>September 2010</a></li>
	<li><a href='index1ff0.html?m=201008' title='August 2010'>August 2010</a></li>
	<li><a href='index9f11.html?m=201007' title='July 2010'>July 2010</a></li>
	<li><a href='index31f0.html?m=201006' title='June 2010'>June 2010</a></li>
	<li><a href='indexd189.html?m=201005' title='May 2010'>May 2010</a></li>
	<li><a href='indexb5c0.html?m=201004' title='April 2010'>April 2010</a></li>
	<li><a href='indexf258.html?m=201003' title='March 2010'>March 2010</a></li>
	<li><a href='index6e30.html?m=201002' title='February 2010'>February 2010</a></li>
	<li><a href='index6b19.html?m=201001' title='January 2010'>January 2010</a></li>
	<li><a href='index5c0a.html?m=200912' title='December 2009'>December 2009</a></li>
	<li><a href='index8f62.html?m=200911' title='November 2009'>November 2009</a></li>
	<li><a href='index451d.html?m=200910' title='October 2009'>October 2009</a></li>
	<li><a href='index3e04.html?m=200909' title='September 2009'>September 2009</a></li>
	<li><a href='index425a.html?m=200908' title='August 2009'>August 2009</a></li>
	<li><a href='index9907.html?m=200907' title='July 2009'>July 2009</a></li>
	<li><a href='index3104.html?m=200906' title='June 2009'>June 2009</a></li>
	<li><a href='indexc36d.html?m=200905' title='May 2009'>May 2009</a></li>
	<li><a href='index17e8.html?m=200904' title='April 2009'>April 2009</a></li>
	<li><a href='index10a5.html?m=200903' title='March 2009'>March 2009</a></li>
	<li><a href='index8988.html?m=200902' title='February 2009'>February 2009</a></li>
	<li><a href='index1419.html?m=200901' title='January 2009'>January 2009</a></li>
	<li><a href='index7866.html?m=200812' title='December 2008'>December 2008</a></li>
	<li><a href='index55f6.html?m=200811' title='November 2008'>November 2008</a></li>
	<li><a href='indexa7bc.html?m=200810' title='October 2008'>October 2008</a></li>
	<li><a href='indexe77c.html?m=200809' title='September 2008'>September 2008</a></li>
	<li><a href='indexcffc.html?m=200808' title='August 2008'>August 2008</a></li>
	<li><a href='index0e62.html?m=200807' title='July 2008'>July 2008</a></li>
	<li><a href='indexfda7.html?m=200806' title='June 2008'>June 2008</a></li>
	<li><a href='index7d64.html?m=200805' title='May 2008'>May 2008</a></li>
	<li><a href='index94dd.html?m=200804' title='April 2008'>April 2008</a></li>
	<li><a href='index9631.html?m=200803' title='March 2008'>March 2008</a></li>
	<li><a href='indexdd52.html?m=200802' title='February 2008'>February 2008</a></li>
	<li><a href='index21ee.html?m=200801' title='January 2008'>January 2008</a></li>
	<li><a href='index363c.html?m=200712' title='December 2007'>December 2007</a></li>
	<li><a href='index7493.html?m=200711' title='November 2007'>November 2007</a></li>
	<li><a href='index93a7.html?m=200710' title='October 2007'>October 2007</a></li>
	<li><a href='index4ca8.html?m=200709' title='September 2007'>September 2007</a></li>
	<li><a href='index6124.html?m=200708' title='August 2007'>August 2007</a></li>
	<li><a href='index6013.html?m=200707' title='July 2007'>July 2007</a></li>
	<li><a href='index2ab6.html?m=200706' title='June 2007'>June 2007</a></li>
	<li><a href='index44f0.html?m=200705' title='May 2007'>May 2007</a></li>
	<li><a href='indexf0b4.html?m=200704' title='April 2007'>April 2007</a></li>
	<li><a href='index481d.html?m=200703' title='March 2007'>March 2007</a></li>
	<li><a href='indexcbea.html?m=200702' title='February 2007'>February 2007</a></li>
	<li><a href='index9cdc.html?m=200701' title='January 2007'>January 2007</a></li>
	<li><a href='index3ea4.html?m=200612' title='December 2006'>December 2006</a></li>
	<li><a href='index67ca.html?m=200611' title='November 2006'>November 2006</a></li>
	<li><a href='indexff49.html?m=200610' title='October 2006'>October 2006</a></li>
	<li><a href='index611c.html?m=200609' title='September 2006'>September 2006</a></li>
	<li><a href='index9a21.html?m=200608' title='August 2006'>August 2006</a></li>
	<li><a href='index3ee9.html?m=200607' title='July 2006'>July 2006</a></li>
	<li><a href='indexe13a.html?m=200606' title='June 2006'>June 2006</a></li>
</ul>
</div>

<div class="aisLeftNav">
			<li id="linkcat-16" class="linkcat"><h2>Blogroll</h2>
	<ul>
<li><a href="http://ayende.com/Blog">Ayende Rahien</a></li>
<li><a href="http://www.softinsight.com/bnoyes/default.aspx">Brian Noyes</a></li>
<li><a href="http://chriskoenig.net/">Chris Koenig</a></li>
<li><a href="http://scienceblogs.com/goodmath/" title="MarkCC reveals the beauty in mathematics and exposes its misuse.">Good Math, Bad Math</a></li>
<li><a href="http://joshsmithonwpf.wordpress.com/">Josh Smith on WPF</a></li>
<li><a href="http://west-wind.com/Weblog/default.aspx">Rick Strahl</a></li>
<li><a href="http://www.udidahan.com/?blog=true">Udi Dahan</a></li>

	</ul>
</li>
<li id="linkcat-17" class="linkcat"><h2>Links</h2>
	<ul>
<li><a href="http://www.absg.com/" title="my day job">ABSG</a></li>
<li><a href="http://www.d20universe.com/" title="my friends boostrap">d20 Universe</a></li>
<li><a href="http://updatecontrols.net/" title="my open source project">Update Controls .NET</a></li>

	</ul>
</li>
<li id="linkcat-32" class="linkcat"><h2>Podroll</h2>
	<ul>
<li><a href="http://dotnetrocks.com/" title="Interviews with leaders in the .NET community.">.NET Rocks!</a></li>
<li><a href="http://hanselminutes.com/" title="News and interviews from all aspects of software, with an insider&#039;s view of Microsoft.">Hanselminutes</a></li>

	</ul>
</li>
	</div>

<div class="aisLeftNav">
<h2>Books</h2>
<iframe src="http://rcm.amazon.com/e/cm?t=adventures0d2-20&amp;o=1&amp;p=8&amp;l=as1&amp;asins=0764526413&amp;fc1=000000&amp;IS2=1&amp;lt1=_blank&amp;lc1=0000ff&amp;bc1=000000&amp;bg1=ffffff&amp;f=ifr" style="width:120px;height:240px;" scrolling="no" marginwidth="0" marginheight="0" frameborder="0" name="I5" id="I5"></iframe>
<br/>
<iframe src="http://rcm.amazon.com/e/cm?t=adventures0d2-20&amp;o=1&amp;p=8&amp;l=as1&amp;asins=0201633612&amp;fc1=000000&amp;IS2=1&amp;lt1=_blank&amp;lc1=0000ff&amp;bc1=000000&amp;bg1=ffffff&amp;f=ifr" style="width:120px;height:240px;" scrolling="no" marginwidth="0" marginheight="0" frameborder="0" name="I6" id="I6"></iframe>
<br/>
<iframe src="http://rcm.amazon.com/e/cm?t=adventures0d2-20&amp;o=1&amp;p=8&amp;l=as1&amp;asins=0136291554&amp;fc1=000000&amp;IS2=1&amp;lt1=_blank&amp;lc1=0000ff&amp;bc1=000000&amp;bg1=ffffff&amp;f=ifr" style="width:120px;height:240px;" scrolling="no" marginwidth="0" marginheight="0" frameborder="0" name="I7" id="I7"></iframe>
<br/>
<iframe src="http://rcm.amazon.com/e/cm?t=adventures0d2-20&amp;o=1&amp;p=8&amp;l=as1&amp;asins=1888009195&amp;fc1=000000&amp;IS2=1&amp;lt1=_blank&amp;lc1=0000ff&amp;bc1=000000&amp;bg1=ffffff&amp;f=ifr" style="width:120px;height:240px;" scrolling="no" marginwidth="0" marginheight="0" frameborder="0" name="I8" id="I8"></iframe>
</div>
<div class="aisLeftNav">
<h2>Meta</h2>
<ul>
		<li><a href="wp-login.html">Login</a></li>
	<li><a href="http://validator.w3.org/check/referer" title="This page validates as XHTML 1.0 Transitional">Valid <abbr title="eXtensible HyperText Markup Language">XHTML</abbr></a></li>
	<li><a href="http://gmpg.org/xfn/"><abbr title="XHTML Friends Network">XFN</abbr></a></li>
	<li><a href="http://wordpress.org/" title="Powered by WordPress, state-of-the-art semantic personal publishing platform.">WordPress</a></li>
	</ul>
</div>
<div class="aisLeftContent">
<h2>Community</h2>
<ul>
	<script type="text/javascript" src="../../localhost/embed/92q2bbma.js"></script>
</ul>
</div>

</div></div></div>
</div>		</td>
		<td>

	<div id="content" class="narrowcolumn">

	
		
			<div class="post" id="post-296">
				<h2><a href="index3e8e.html?p=296" rel="bookmark" title="Permanent Link to Problems with the Entity Framework, and how to overcome them">Problems with the Entity Framework, and how to overcome them</a></h2>
				<small>March 2nd, 2009 <!-- by Michael L Perry --></small>

				<div class="entry">
					<p>I am not a signatory of the <a href="http://efvote.wufoo.com/forms/ado-net-entity-framework-vote-of-no-confidence/">Entity Framework Vote of No Confidence</a>. Not because I have any confidence in the tool, but rather because my concerns are different. The concerns expressed in the VoNC are:</p>
<ul>
<li>Focus on data over behavior</li>
<li>Lack of lazy loading</li>
<li>Shared canonical model</li>
<li>Lack of persistence ignorance</li>
<li>Excessive merge conflicts</li>
</ul>
<p>These are valid concerns coming mostly from a community that uses ORM tools. I am not an ORM advocate, so some of these concerns mean little to me. In particular, persistence ignorance, while a cornerstone of ORM culture, has been of limited value in my experience. I've never had the need to port a data model unchanged into a different database. The database always imposes its constraints on the domain model. (Or maybe I just don't understand what PI really means.)</p>
<p>My concerns, on the other hand, are born out of trying to use EF on an enterprise project. My team has settled on a way of using it that works for us, so we will continue to use it. The problems that we've had to overcome are:</p>
<ul>
<li>Tight coupling to the database schema</li>
<li>Lack of versioning support</li>
<li>Lack of visibility</li>
<li>Confusion between ownership and association</li>
</ul>
<p><strong>Tight coupling to the database schema</strong><br />
The easiest way to create an entity model is to reverse-engineer it from the database. The tool will create an entity type for each table that you select, and a relationship for each foreign key. It will even turn a two-column associative table into a many-to-many relationship. For simple schemas, this works pretty well.</p>
<p>There are many problems with taking this approach, however. The first is that foreign keys are only properties of tables, not views. The import creates an entity for each selected view, but cannot create relationships. Relationships can be created manually, so this is easily overcome. However this shortcoming encourages the use of tables over views, removing one useful layer of indirection.</p>
<p>We will reverse-engineer up to a point, then switch to views under the covers. Once that switch is made, we no longer refresh the EDMX from the model. This practice retains the layer of abstraction that we gain from views, but doesn't completely defeat the usefulness of the tool.</p>
<p><strong>Lack of versioning support</strong><br />
We are building a service-oriented application. There are problems with SOA that I won't get into right now, but the biggest problem has been breaking changes in the service contract.</p>
<p>Entity Framework adds the [DataContract] attribute to all of the entities. This allows you to return an entity from a WCF service. If Microsoft made it this easy, it must the right thing to do, right?</p>
<p>The problem is that there is just one version of each entity type, and therefore of each service signature. If someone adds a column to a table, the client proxy needs to be regenerated. Every change to the database schema is a breaking change to the clients. And there is no way to keep old versions of the service calls while simultaneously adding new versions. This is painful in development. This would be death to production.</p>
<p>The solution is to ignore the help that Microsoft gives you. Don't use EF entities in WCF service contracts. Yes, this means that you have to write left-hand-right-hand code, but at least it's completely under your control. You choose when to define new data types, and you can version them according to your own needs.</p>
<p><strong>Lack of visibility</strong><br />
We have some talented DBAs on the team. They are the reason that I'm not much of an ORM advocate. I see the job that they do, and I don't want my developers to be responsible for it. They think about the health and design of the data. Every day. If you use an ORM, you either ask your developers to be just as concerned, or you get accidental data access. Frankly, my developers have too much to think about without also caring as deeply about the data as my DBAs do.</p>
<p>So since I lean so heavily upon my DBAs, I want to give them all of the information they need. One thing they ask for is a list of queries that the application will be performing. They need this in order to ensure that the tables are properly indexed. Extracting this information from EF is cumbersome. The best way I've discovered is to run SQL Profiler and start the integration tests.</p>
<p>Another thing they ask for is a list of tables and views that a particular build of the application requires. They need this to coordinate database releases with application releases. We don't bring down the whole datacenter in order to release. Database changes are rolled out on a live system in advance of application changes. They are applied in a way that will not break the previous application. Then, when the database is upgraded, the app servers are individually taken off-line and upgraded. During this process, there is zero down-time. Part of the datacenter is on the previous version, while the other part is on the new version. Entity Framework hides the dependency of code upon schema, and gives us absolutely no help in planning for this dance.</p>
<p><strong>Confusion between ownership and association</strong><br />
I observe five axioms of software behavior. One of them is ownership. An object has exactly one owner. It's a parent-child relationship. If the child is removed from the parent, it is deleted.</p>
<p>Ownership is different from association. An association is just a reference. That reference can be changed without deleting the object.</p>
<p>In a relational database, ownership is manifested as a foreign key that you cannot change. A child is added to a parent when it is inserted, and removed when it is deleted. A one-to-one or one-to-many association is also a foreign key, but you are allowed to change it. A many-to-many association is represented as an associative table.</p>
<p>Entity Framework only has navigation properties. It makes no distinction between ownership and association. In fact, it treats all navigation properties as associations, and does not do the right thing with parent-child relationships. Removing an object from a navigation property does not delete it, even if the parent is supposed to be the owner. Instead, it throws this exception:</p>
<blockquote><p>A relationship is being added or deleted from an AssociationSet '***'. With cardinality constraints, a corresponding '***' must also be added or deleted.</p></blockquote>
<p>You have to delete the child object from the container, not from its owner.</p>
<p>The way you code with objects is different than the way you code with relational databases. Entity Framework tries to hide these differences behind a layer of abstraction, but it fails completely. Not being an ORM user, I don't know the extent to which other frameworks succeed. But when I'm working with a relational database, I prefer to code relationally. It's really not that bad.</p>
<p>So when using Entity Framework in an enterprise environment:</p>
<ul>
<li>Don't completely rely upon reverse-engineering the model.</li>
<li>Don't expose entities through WCF services.</li>
<li>Use SQL Profiler to see what EF is doing.</li>
<li>Know the difference between ownership and association, even if the tool doesn't.</li>
</ul>
				</div>

				<p class="postmetadata">Posted in <a href="indexc728.html?cat=7" title="View all posts in Databases" rel="category">Databases</a>,  <a href="indexe8fb.html?cat=39" title="View all posts in Entity Framework" rel="category">Entity Framework</a> |   <a href="index3e8e.html?p=296#respond" title="Comment on Problems with the Entity Framework, and how to overcome them">No Comments &#187;</a></p>
			</div>

		
			<div class="post" id="post-295">
				<h2><a href="index1422.html?p=295" rel="bookmark" title="Permanent Link to The five axioms of software behavior">The five axioms of software behavior</a></h2>
				<small>March 1st, 2009 <!-- by Michael L Perry --></small>

				<div class="entry">
					<p>Inspired by Euclid's Elements. Software as a mathematical description of behavior.</p>
<p><strong>Identity</strong><br />An object is that which has identity. Identity implies consistent behavior.</p>
<p><strong>Interface</strong><br />An interface is the means by which an object exposes its consistent behavior. Interface implies identity.</p>
<p><strong>Ownership</strong><br />Every object except for a singleton has one and only one owner. Ownership cannot be transferred.</p>
<p><strong>Dependency</strong><br />Behavior is either independent or dependent. Independent behavior can be changed by acting upon the object, while dependent behavior represents an objects reaction to other dependent or independent behavior.</p>
<p><strong>Transaction</strong><br />All changes to independent behavior occur within the scope of a transaction. All behaviors dependent upon those changes are simultaneously visible. There exists a partial order among transactions, whereby one transaction could be said to be a prerequisite of another.</p>
				</div>

				<p class="postmetadata">Posted in <a href="index2d79.html?cat=26" title="View all posts in dof" rel="category">dof</a> |   <a href="index1422.html?p=295#comments" title="Comment on The five axioms of software behavior">4 Comments &#187;</a></p>
			</div>

		
			<div class="post" id="post-294">
				<h2><a href="indexe2aa.html?p=294" rel="bookmark" title="Permanent Link to Don&#8217;t unit test the glove">Don&#8217;t unit test the glove</a></h2>
				<small>February 22nd, 2009 <!-- by Michael L Perry --></small>

				<div class="entry">
					<p>There was an email chain letter that my Mom forwarded to me a while back. It was a math magic trick that could predict your age. She asked me how it worked.</p>
<p>It had you start with the year you were born, multiply by one number, add another, repeat the digits, and go through all sorts of numeric hocus-pocus. If you just worked through it using basic algebra, it's easy to see that you were just subtracting the year of your birth from the current year. The intermediate steps added no value. How could thing predict your age? How could it not?</p>
<p>I'm looking at a unit test for a data access service, and I'm reminded of that email that filled Mom with wonder. The unit test mocks an order repository using Rhino Mocks:</p>
<pre><span style="color: blue">int</span> expectedOrderIdentifier = <span style="color: maroon">5</span>;

Order expectedOrder = <span style="color: blue">new</span> Order();
expectedOrder.OrderId = expectedOrderIdentifier;
expectedOrder.WebOrderNumber = <span style="color: maroon">123</span>;
IList&lt;Order&gt; orderList = <span style="color: blue">new</span> List&lt;Order&gt;();
orderList.Add(expectedOrder);

MockRepository mocks = <span style="color: blue">new</span> MockRepository();
IAggregateRootRepository&lt;Order&gt; orderRepositoryMock =
    mocks.CreateMock&lt;IAggregateRootRepository&lt;Order&gt;&gt;();

using (mocks.Record())
{
    Expect.Call(
        orderRepositoryMock.GetSatisfying(dummyOrderSpecification))
        <strong>.IgnoreArguments()</strong>
        .Return(orderList.AsQueryable&lt;Order&gt;());
}
using (mocks.Playback())
{
    OrderService target = <span style="color: blue">new</span> OrderService(orderRepositoryMock);
    Order returnedOrder = target.GetOrderByWebOrderNumber(<strong>expectedOrderIdentifier</strong>);
    Assert.IsTrue(
        returnedOrder == expectedOrder,
        <span style="color: maroon">"The mocked repostiory provided order was not returned by the repository changes will not be tracked by the unit of work."</span>);
    Assert.IsTrue(
        returnedOrder.WebOrderNumber == <span style="color: maroon">123</span>,
        <span style="color: maroon">"The mocked repostiory provided order was not returned by the repository changes will not be tracked by the unit of work."</span>);

}
<span style="color: green">// Tests to make sure the order repository was enlisted in the provided context.</span>
mocks.VerifyAll();
</pre>
<p>Lo and behold the test passes! Amazing! Let's take a look at the code under test:</p>
<pre><span style="color: blue">public</span> Order GetOrderByWebOrderNumber(<span style="color: blue">int</span> webOrderNumber)
{
    <span style="color: green">// Create Specification </span>
    <span style="color: green">// This specification is used to get just the order entity without any dependent entities </span>
    ReferencedOrderByWebOrderNumberSpecification specification =
        <span style="color: blue">new</span> ReferencedOrderByWebOrderNumberSpecification(webOrderNumber);

    <span style="color: green">// Here Assumption is we get only one order from database  for the provided web order number </span>
    Order order = _orderRepository.GetSatisfying(<strong>specification</strong>).FirstOrDefault();

    <span style="color: blue">if</span> (order == <span style="color: blue">null</span>)
    {
        <span style="color: blue">throw</span> <span style="color: blue">new</span> ArgumentException();
    }

    <span style="color: blue">return</span> order;
}
</pre>
<p>A perfectly reasonable bit of code. It pulls an object from the repository according to a specified condition. In fact, the only interesting thing about this code is that condition.</p>
<p>But look closer. The unit test passes in the wrong parameter! The method takes a web order number, and the unit test passes in an order ID. The code under test creates a specification based on this incorrect information, but the mock repository ignores this parameter. No matter what the condition is, it returns the object we tell it to. Since we mocked the repository to return the object we expected, that's exactly what was returned. How could the test ever fail?</p>
<p>This unit test is completely meaningless. It goes through all sorts of gyrations and mock-object hocus-pocus in order to return the object that we expect. The one interesting feature of the code under test is <em>never tested</em>. In fact, this test passes even thought the object that we fed the mock repository didn't satisfy the condition!</p>
<p>Like my Mom with the email, the developer who wrote this test really though something interesting was happening. In striving for greater test coverage, he was just fooling himself into thinking that he was improving the quality of the code. Useless unit tests are worse than no unit tests, because they give you false confidence in the code.</p>
<p>A glove is a thin wrapper over a hand. The glove is going to do what the hand does. How could it do any different? Don't waste your time unit testing the glove.</p>
				</div>

				<p class="postmetadata">Posted in <a href="index3f7b.html?cat=2" title="View all posts in Unit testing" rel="category">Unit testing</a> |   <a href="indexe2aa.html?p=294#respond" title="Comment on Don&#8217;t unit test the glove">No Comments &#187;</a></p>
			</div>

		
			<div class="post" id="post-293">
				<h2><a href="index89a1.html?p=293" rel="bookmark" title="Permanent Link to Null coalescing operator (??) not useful">Null coalescing operator (??) not useful</a></h2>
				<small>February 12th, 2009 <!-- by Michael L Perry --></small>

				<div class="entry">
					<p>I still haven't found a good use for the C# ?? null coalescing operator. I always find that I want a property of the possibly null object, not the object itself. I wish it worked with this code:</p>
<div style="font-family: courier new">Person p = <span style="color: blue">null</span>; <br /><span style="color: blue">string</span> name = p.Name ?? <span style="color: blue">string</span>.Empty; </div>
<p>That is, it should take the left-hand side if <em>any</em> part of the right-hand side is null. Now <em>that</em> would be useful.</p>
<p>Here's the best I could come up with for making use of it:</p>
<div style="font-family: courier new"><span style="color: blue">class</span> Person <br />{ <br />&nbsp;&nbsp;&nbsp; <span style="color: blue">public</span>&nbsp;<span style="color: blue">string</span> Name { <span style="color: blue">get</span>; <span style="color: blue">set</span>; } </p>
<p>&nbsp;&nbsp;&nbsp; <span style="color: blue">public</span>&nbsp;<span style="color: blue">static</span> Person Default = <span style="color: blue">new</span> Person(); <br />} </p>
<p>Person p = <span style="color: blue">null</span>; <br /><span style="color: blue">string</span> name = (p ?? Person.Default).Name ?? <span style="color: blue">string</span>.Empty;</div>
<p>Not exactly intention revealing.</p>
				</div>

				<p class="postmetadata">Posted in <a href="index8e7f.html?cat=19" title="View all posts in C#" rel="category">C#</a> |   <a href="index89a1.html?p=293#respond" title="Comment on Null coalescing operator (??) not useful">No Comments &#187;</a></p>
			</div>

		
			<div class="post" id="post-292">
				<h2><a href="index2af5.html?p=292" rel="bookmark" title="Permanent Link to DDD to English dictionary">DDD to English dictionary</a></h2>
				<small>February 5th, 2009 <!-- by Michael L Perry --></small>

				<div class="entry">
					<p>With apologies to Eric Evans.</p>
<p>What it means</p>
<ul>
<li>Ubiquitous Language - Glossary</li>
<li>Unit of Work - Transaction</li>
<li>Repository - Data access component</li>
<li>Specification - Where clause</li>
<li>Service - Static method</li>
<li>Aggregate - Hierarchy</li>
<li>Intention-Revealing Interfaces - Good names</li>
<li>Anticorruption Layer - Contract</li>
</ul>
<p>What it could mean, but doesn't</p>
<ul>
<li>Ubiquitous Language - The phenomenon that development teams pick one programming language and stick with it</li>
<li>Unit of Work - The detail of your estimates: to the hour, day, or week</li>
<li>Repository - Source control</li>
<li>Specification - Requirements document</li>
<li>Service - RPC over HTTP</li>
<li>Aggregate - A filled-in diamond on a UML diagram</li>
<li>Intention-Revealing Interfaces - Ports 80 and 25</li>
<li>Anticorruption Layer - CRC</li>
</ul>
				</div>

				<p class="postmetadata">Posted in <a href="index9591.html?cat=37" title="View all posts in DDD" rel="category">DDD</a> |   <a href="index2af5.html?p=292#respond" title="Comment on DDD to English dictionary">No Comments &#187;</a></p>
			</div>

		
			<div class="post" id="post-291">
				<h2><a href="index820e.html?p=291" rel="bookmark" title="Permanent Link to Domain Driven Design: we&#8217;re doing it wrong">Domain Driven Design: we&#8217;re doing it wrong</a></h2>
				<small>February 4th, 2009 <!-- by Michael L Perry --></small>

				<div class="entry">
					<p>Several people have recommended the book Domain Driven Design by Eric Evans. I've heard it referenced on podcasts and in blogs. My technical manager informed me when I first started on my current project that the architecture was partially based on this book. It takes a while for a message to seep in, but I finally decided it was time to pick up this book.</p>
<p>When I saw the book cover, I was surprised. No, not by the retro cheesiness of the graphics, colors, and fonts. I was surprised because I recognized it. I had had this book on my shelf for over two years.</p>
<p>I bought this book from Amazon because it was paired with Software Factories. I started reading DDD shortly after finishing SF, but gave up before even getting through the preface. I found Evan's style unnecessarily verbose and obfuscated.</p>
<p>So the book languished on my shelf for over two years before I made the discovery that an important sub-discipline within my industry was passing me by, simply because of my disdain for one man's writing style. So I forced myself to wade through his awkward word choice, parabolic explanations, and prolonged narratives to extract the meat of the subject. And I'm glad I did.</p>
<p>It turns out, we're doing DDD wrong.</p>
<p><strong>What is Domain Driven Design</strong><br />The point of Domain Driven Design is to put all of the domain knowledge into a rich object layer. This layer captures the essential information about the problem domain, the relationships among those objects, and the responsibilities of those objects. If the domain is commerce, as it is in our system, then you have domain objects for products, orders, and shopping carts. The methods of these objects capture business knowledge, like inventory rules and regulatory restrictions.</p>
<p>This is very similar to the old Rumbaugh OOA&amp;D thinking that my career started out with. We as an industry have come to think of that "look for the nouns" guidance as naive. Programs that run on computers need objects that represent computer ideas. So we have objects for windows, database connections, proxies, and sockets. If you follow the Gang of Four as I do, you'll write objects like factories, visitors, and strategies. Nouns from the real world have a hard time coexisting with these technical concepts in today's object oriented programs.</p>
<p>But Evans provides some guidance that allows us to draw from both of these views of objects. The domain objects are isolated from the technical objects. Patterns like Repository/Specification and Unit of Work hydrate domain objects without coupling them to persistence technology. Evans shows us how to take a set of objects that a domain expert would understand, and use them in a modern software application.</p>
<p>The advantage of Domain Driven Design is that domain objects become a medium of communication. Programmers and experts can talk about the domain by using the source code. Or at least, the classes and methods in the source code. If the source code does not accurately reflect the knowledge of the domain expert, then the source code is wrong. Using Evans' guidance and patterns, the domain model can be quickly refactored as developers learn more about the problem domain.</p>
<p>Unfortunately, the way that we have been applying Evans' guidance and patterns on our eCommerce system has made it more difficult to refactor the domain, and left us with a fairly rigid system. Here are some of the big mistakes we made.</p>
<p><strong>Layered architecture does not mean tiered architecture</strong><br />Evans recommends a layered architecture:</p>
<ul>
<li>presentation</li>
<li>application</li>
<li>domain</li>
<li>infrastructure</li>
</ul>
<p>The presentation layer handles UI, the application layer implements features, the domain layer captures business knowledge, and the infrastructure layer lends low-level support. This approach isolates the domain objects from technical concerns like storage and presentation. It allows the solution to be implemented in the language of the domain, instead of forcing the domain to implement those features.</p>
<p>Our approach was to separate these concerns into physical tiers. These tiers could be deployed to different servers in the datacenter for the benefits of security and scalability. Imagine my surprise when I get to page 114, where Evans says, "This could be a strong argument if the code actually got deployed on different servers. Usually it does not." I wasn't surprised because he told me something I didn't know; I was surprised because I knew and hadn't objected.</p>
<p>The fact is, we aren't going to need quite so many tiers. Yes, we are separating the presentation tier because it is hosted in SharePoint and resides in the DMZ. But besides that, the other layers -- not tiers -- can benefit from being in the same process and not being forced across machine boundaries.</p>
<p><strong>SOA's "services" are not DDD's "services"</strong><br />We architected our eCommerce application to be service oriented. The benefits are that isolated services are reusable and independently versionable. These are significant goals of this project, as we are building not just an eCommerce application, but a platform for all commerce in the company.</p>
<p>Domain Driven Design also talks about services. But a DDD service is an operation that doesn't belong to just one object. A service is still a domain concept, in that it captures domain knowledge, but it isn't an instance method on a domain object. We've exposed our services as WCF web services, when it may have been more appropriate to simply expose them as static methods in the domain layer. Only those services that external systems would want to consume should be published through WCF.</p>
<p><strong>Entity Framework's "entities" are not DDD's "entities"</strong><br />Evans' guidance is strongly informed by the difference between entities -- objects whose identity is important -- and value objects -- whose identity is not. His patterns talk about how to carefully rehydrate entities such that their in-memory identity matches their persistent identity (where it is important to do so). Above all, entities are first-class domain objects.</p>
<p>Before I joined the project, linq to SQL was rejected because it does not play well with rich domain objects. Certainly, a linq query pulls data from a record set and puts it into objects, but it does nothing to respect the identity of those objects. If you run two queries, it will happily construct two objects to represent the same ID.</p>
<p>The decision was made to use the Entity Framework, then in beta. The idea was that EF entities were partial classes, so domain logic could be added. The framework would handle persistence, and our code could take over from there.</p>
<p>As it turned out, Entity Framework is no better than linq to SQL for our purpose. The primary concern of the entity model is the mapping between record sets and objects. The entity model exists in a limbo between a good object model and a good relational model. Domain objects are, first and foremost, objects. If they have to compromise to conform to good relational design, then they fail to be good domain objects.</p>
<p>On the other hand, either EF or linq to SQL would make a good memento. Linq to SQL favors anonymous types, while EF favors its flavor of entity. If the persistence of domain objects handled the translation of domain objects to mementos, then either one could take it the rest of the way to the relational database.</p>
<p><strong>We already had a repository and specification</strong><br />The piece of advice from DDD that people most often cite is to use a pattern of Repositories and Specifications. A repository is a place to store objects when they are not in memory. A specification is a condition -- separate from the repository -- that you can use to fetch the objects you are interested in. The advantage of this pattern is that the application layer can provide the specification, the infrastructure layer the repository, and the domain objects remain blissfully unconcerned with these non-domain details.</p>
<p>The piece of advice that is <em>not</em> often cited, however, is "don't fight your frameworks" (page 157). If your framework already has a good implementation of the pattern, just use it. This is advice that we ignored to our peril.</p>
<p>.NET 3.5 introduced linq. Besides the language features that support linq, the core framework component is the IQueryable interface. As it happens, IQueryable <em>is</em> the repository/specification pattern. Any object that implements this interface is a repository. Any boolean delegate (or lambda expression) is a specification. Combine the two using the Where extension method, and you have implemented the pattern.</p>
<p>What we did, however, was to create generic interfaces with names like IAggregateRootRepository, ISpecification, and IUnitOfWork. In order to use these interfaces, you have to define entire classes that differ in no more than a class name and a where clause. The result is a common base class library that is difficult to learn and encumbered with Evans' poor choice of words. Our application is full of extra classes that could have been inlined as lambda expressions. We have an entire suite of unit tests dedicated to ensuring that these specification classes contain the right boolean expression.</p>
<p><strong>Here's my solution</strong><br />Although we are too far along in the process to make radical architectural changes, I like to keep an ideal in mind for new development and refactoring. The ideal is a simple one: encode business knowledge in rich domain objects, use mementos to persist them, build application and domain layers into a single process, and publish WCF web services only where needed.</p>
<p>I am not a born-again DDD convert. I apply Evens' advice only with an open and skeptical mind. But where I see his book brandished as justification for poor decisions, I dig deeper to find what he <em>really</em> meant. Yes, it takes a <em>lot</em> of digging, given his choice of obscure terms for otherwise well-known concepts, but there is value to be found.</p>
				</div>

				<p class="postmetadata">Posted in <a href="index9591.html?cat=37" title="View all posts in DDD" rel="category">DDD</a> |   <a href="index820e.html?p=291#comments" title="Comment on Domain Driven Design: we&#8217;re doing it wrong">4 Comments &#187;</a></p>
			</div>

		
			<div class="post" id="post-290">
				<h2><a href="index5b31.html?p=290" rel="bookmark" title="Permanent Link to The Navigation Model Pattern">The Navigation Model Pattern</a></h2>
				<small>January 19th, 2009 <!-- by Michael L Perry --></small>

				<div class="entry">
					<p>View a <a href="http://updatecontrols.net/videos/NavigationModel/NavigationModel.html">video</a> of this demo. Download version 2.0.3 of <a href="http://updatecontrols.net/vb/download20.shtml">Update Controls</a> and the <a href="wp-content/uploads/2009/01/xamldemo.zip">demo source code</a> to follow along.</p>
<p><strong><a href="wp-content/uploads/2009/01/navigation-model.jpg"><img style="border-top-width: 0px; border-left-width: 0px; border-bottom-width: 0px; border-right-width: 0px" height="244" alt="Navigation Model" src="wp-content/uploads/2009/01/navigation-model-thumb.jpg" width="184" align="right" border="0"></a> Intent</strong><br />The Navigation Model Pattern removes dependencies between view objects and makes UI state available to presentation logic.</p>
<p>Use the Navigation Model Pattern when controls interact with one another in a non-trivial manner. For example, selecting an object in a list displays details in a grid. Or checking a checkbox enables an associated control.</p>
<p><strong>Problem</strong><br />WPF makes it really easy to bind a property of one control to a property of another. For example, if the selected item in a list box becomes the data context for a grid, the code might look like this:</p>
<pre><span style="color: blue">&lt;</span><span style="color: maroon">ListBox</span> <span style="color: red">ItemsSource</span>="<span style="color: blue">{Binding People}</span>" <strong><span style="color: red">x:Name</span>="<span style="color: blue">personListBox</span>"</strong><span style="color: blue">&gt;</span>
	<span style="color: blue">&lt;</span>!-- ... --<span style="color: blue">&gt;</span>
<span style="color: blue">&lt;</span>/<span style="color: maroon">ListBox</span><span style="color: blue">&gt;</span>

<span style="color: blue">&lt;</span><span style="color: maroon">Grid</span> <strong><span style="color: red">DataContext</span>="<span style="color: blue">{Binding ElementName=personListBox, Path=SelectedItem}</span>"</strong><span style="color: blue">&gt;</span>
	<span style="color: blue">&lt;</span>!-- ... --<span style="color: blue">&gt;</span>
	<span style="color: blue">&lt;</span><span style="color: maroon">Label</span> <span style="color: red">Grid.Row</span>="<span style="color: blue">0</span>" <span style="color: red">Grid.Column</span>="<span style="color: blue">0</span>" <span style="color: red">Content</span>="<span style="color: blue">First Name:</span>"/<span style="color: blue">&gt;</span>
	<span style="color: blue">&lt;</span><span style="color: maroon">TextBox</span> <span style="color: red">Grid.Row</span>="<span style="color: blue">0</span>" <span style="color: red">Grid.Column</span>="<span style="color: blue">1</span>" <span style="color: red">Text</span>="<span style="color: blue">{Binding First}</span>"/<span style="color: blue">&gt;</span>
	<span style="color: blue">&lt;</span>!-- ... --<span style="color: blue">&gt;</span>
<span style="color: blue">&lt;</span>/<span style="color: maroon">Grid</span><span style="color: blue">&gt;</span>
</pre>
<p>But direct control-to-control data binding causes trouble. Your UI is no longer composable, since controls directly reference one another. It is difficult to perform presentation logic on control properties, since the presentation model would have a reverse dependency upon the view. And it is difficult to programmatically set a control property based on user action.</p>
<p><strong>Solution</strong><br />Instead of binding controls directly to one another, move all of the user selection state into a Navigation Model. The navigation model is one shared location where user selection state resides. All controls that use this shared state bind to this one place. The controls don't know about one another. Any control can set the selection state, and any control can consume it. When the selection changes, all controls are updated.</p>
<p><strong>Create a navigation model class</strong><br />The navigation model is just a class. It has properties that correspond to the user's current selections. It has no persistent storage for this state. It survives only as long as the user's session.</p>
<p>In the example that we've been building, the user can select a Person. The resulting navigation model looks like this:</p>
<div style="font-family: courier new"><span style="color: blue">public</span>&nbsp;<span style="color: blue">class</span> NavigationModel <br />{ <br />&nbsp;&nbsp;&nbsp; <strong><span style="color: blue">private</span> Person _selectedPerson;</strong> </p>
<p>&nbsp;&nbsp;&nbsp; <span style="color: blue">#region</span> Independent properties <br />&nbsp;&nbsp;&nbsp; <span style="color: green">// Generated by Update Controls --------------------------------</span> <br />&nbsp;&nbsp;&nbsp; <span style="color: blue">private</span> Independent _indSelectedPerson = <span style="color: blue">new</span> Independent(); </p>
<p>&nbsp;&nbsp;&nbsp; <span style="color: blue">public</span> Person SelectedPerson <br />&nbsp;&nbsp;&nbsp; { <br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: blue">get</span> { _indSelectedPerson.OnGet(); <span style="color: blue">return</span> _selectedPerson; } <br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: blue">set</span> { _indSelectedPerson.OnSet(); _selectedPerson = value; } <br />&nbsp;&nbsp;&nbsp; } <br />&nbsp;&nbsp;&nbsp; <span style="color: green">// End generated code --------------------------------</span> <br />&nbsp;&nbsp;&nbsp; <span style="color: blue">#endregion</span> <br />} </div>
<p>To generate this class, declare just the field. Select the field and press Ctrl+D, G. The Update Controls add-in will generate the property and the Independent sentry.</p>
<p><strong>Expose the navigation model through the presentation model</strong><br />The presentation model is a thin, transparent wrapper around the data and navigation models. It adds presentation logic where necessary, but does not hide these raw models from the view.</p>
<p>The presentation model initializes a reference to the navigation model in its constructor, and exposes that reference as a property. It also uses that reference in other presentation properties.</p>
<div style="font-family: courier new"><span style="color: blue">public</span>&nbsp;<span style="color: blue">class</span> PresentationModel <br />{ <br />&nbsp;&nbsp;&nbsp; <span style="color: blue">private</span> PersonList _personList; <br />&nbsp;&nbsp;&nbsp; <strong><span style="color: blue">private</span> NavigationModel _navigationModel;</strong> </p>
<p>&nbsp;&nbsp;&nbsp; <span style="color: blue">public</span> PresentationModel(PersonList personList, <strong>NavigationModel navigationModel</strong>) <br />&nbsp;&nbsp;&nbsp; { <br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; _personList = personList; <br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; _<strong>navigationModel = navigationModel;</strong> <br />&nbsp;&nbsp;&nbsp; } </p>
<p>&nbsp;&nbsp;&nbsp; <span style="color: blue">public</span> PersonList PersonList <br />&nbsp;&nbsp;&nbsp; { <br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: blue">get</span> { <span style="color: blue">return</span> _personList; } <br />&nbsp;&nbsp;&nbsp; } </p>
<p><strong>&nbsp;&nbsp;&nbsp; <span style="color: blue">public</span> NavigationModel NavigationModel <br />&nbsp;&nbsp;&nbsp; { <br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: blue">get</span> { <span style="color: blue">return</span> _navigationModel; } <br />&nbsp;&nbsp;&nbsp; } <br /></strong><br />&nbsp;&nbsp;&nbsp; <span style="color: blue">public</span>&nbsp;<span style="color: blue">string</span> Title <br />&nbsp;&nbsp;&nbsp; { <br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: blue">get</span> { <span style="color: blue">return</span>&nbsp;<span style="color: maroon">"People - "</span> +</div>
<div style="font-family: courier new">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; (<strong>_navigationModel.SelectedPerson</strong> != <span style="color: blue">null</span> ?</div>
<div style="font-family: courier new">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <strong>_navigationModel.SelectedPerson</strong>.Name : <span style="color: maroon">""</span>); } <br />&nbsp;&nbsp;&nbsp; } <br />} </div>
<p>References to the data model and presentation model are not generated using Ctrl+D, G. These models don't change, so there is no need to inject Independent sentries for change tracking.</p>
<p><strong>Connect controls to the navigation model</strong><br />The view can access navigation model properties through the presentation model's reference. Connect the SelectedItem property of the list box to the navigation model to allow the user to change it. Connect the DataContext property of the details grid to the navigation model so that it responds to user selection.</p>
<pre><span style="color: blue">&lt;</span><span style="color: maroon">ListBox</span> <span style="color: red">ItemsSource</span>="<span style="color: blue">{u:Update PersonList.People}</span>" <strong><span style="color: red">SelectedItem</span>="<span style="color: blue">{u:Update NavigationModel.SelectedPerson}</span>"</strong><span style="color: blue">&gt;</span>
	<span style="color: blue">&lt;</span>!-- ... --<span style="color: blue">&gt;</span>
<span style="color: blue">&lt;</span>/<span style="color: maroon">ListBox</span><span style="color: blue">&gt;</span>

<span style="color: blue">&lt;</span><span style="color: maroon">Grid</span> <strong><span style="color: red">DataContext</span>="<span style="color: blue">{u:Update NavigationModel.SelectedPerson}</span>"</strong><span style="color: blue">&gt;</span>
	<span style="color: blue">&lt;</span>!-- ... --<span style="color: blue">&gt;</span>
	<span style="color: blue">&lt;</span><span style="color: maroon">Label</span> <span style="color: red">Grid.Row</span>="<span style="color: blue">0</span>" <span style="color: red">Grid.Column</span>="<span style="color: blue">0</span>" <span style="color: red">Content</span>="<span style="color: blue">First Name:</span>"/<span style="color: blue">&gt;</span>
	<span style="color: blue">&lt;</span><span style="color: maroon">TextBox</span> <span style="color: red">Grid.Row</span>="<span style="color: blue">0</span>" <span style="color: red">Grid.Column</span>="<span style="color: blue">1</span>" <span style="color: red">Text</span>="<span style="color: blue">{u:Update First}</span>"/<span style="color: blue">&gt;</span>
	<span style="color: blue">&lt;</span>!-- ... --<span style="color: blue">&gt;</span>
<span style="color: blue">&lt;</span>/<span style="color: maroon">Grid</span><span style="color: blue">&gt;</span>
</pre>
<p>We'll want some controls to become enabled only when conditions are right. To facilitate this, we add a boolean IsPersonSelected property to the navigation model. Be sure to use the SelectedPerson property, not the _selectedPerson field, so that we get the benefit of change tracking.</p>
<div style="font-family: courier new"><span style="color: blue">public</span>&nbsp;<span style="color: blue">class</span> NavigationModel <br />{ <br />&nbsp;&nbsp;&nbsp; <span style="color: blue">private</span> Person _selectedPerson; </p>
<p>&nbsp;&nbsp;&nbsp; <span style="color: blue">#region</span> Independent properties <span style="color: green">// ...</span> </p>
<p><strong>&nbsp;&nbsp;&nbsp; <span style="color: blue">public</span>&nbsp;<span style="color: blue">bool</span> IsPersonSelected <br />&nbsp;&nbsp;&nbsp; { <br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: blue">get</span> { <span style="color: blue">return</span> SelectedPerson != <span style="color: blue">null</span>; } <br />&nbsp;&nbsp;&nbsp; } <br /></strong>} </div>
<p>Connect this property to the IsEnabled property of selected controls. For entire groups of controls, we wrap the group in a container, and connect the property of the container to the boolean. We can't use the existing container, because it changes its own data context.</p>
<pre><span style="color: blue">&lt;</span><span style="color: maroon">Button</span> <span style="color: red">Content</span>="<span style="color: blue">Delete</span>" <strong><span style="color: red">IsEnabled</span>="<span style="color: blue">{u:Update NavigationModel.IsPersonSelected}</span>"</strong> <span style="color: red">Click</span>="<span style="color: blue">DeleteButton_Click</span>" /<span style="color: blue">&gt;</span>

<span style="color: blue">&lt;</span><span style="color: maroon">StackPanel</span> <strong><span style="color: red">IsEnabled</span>="<span style="color: blue">{u:Update NavigationModel.IsPersonSelected}</span>"</strong><span style="color: blue">&gt;</span>
	<span style="color: blue">&lt;</span><span style="color: maroon">Grid</span> <span style="color: red">DataContext</span>="<span style="color: blue">{u:Update NavigationModel.SelectedPerson}</span>"<span style="color: blue">&gt;</span>
		<span style="color: blue">&lt;</span>!-- ... --<span style="color: blue">&gt;</span>
	<span style="color: blue">&lt;</span>/<span style="color: maroon">Grid</span><span style="color: blue">&gt;</span>
<span style="color: blue">&lt;</span>/<span style="color: maroon">StackPanel</span><span style="color: blue">&gt;</span>
</pre>
<p><strong>Consequences</strong><br />While this pattern decouples view components to make them more composable, it does so at the cost of injecting code where once only markup was necessary. This means that it is difficult for a designer to express the behavior of an application without involving a developer.</p>
<p>To mitigate this cost, designers and developers should agree on a contract beforehand. Obvious properties, like SelectedPerson, should be added to the navigation model immediately. Less obvious properties, like IsPersonSelected, can be added afterward. It is very difficult to refactor in a navigation model after view components have been constructed, so the architecture should start with this pattern in place.</p>
<p>It is also troublesome that setting the DataContext of a control makes it impossible to get back to the presentation model. If detail controls need access to presentation logic or navigation state, then an additional presentation/navigation layer must be injected. This will be demonstrated in a future post.</p>
				</div>

				<p class="postmetadata">Posted in <a href="indexb0b7.html?cat=6" title="View all posts in Patterns" rel="category">Patterns</a>,  <a href="indexa88f.html?cat=36" title="View all posts in Update Controls" rel="category">Update Controls</a> |   <a href="index5b31.html?p=290#respond" title="Comment on The Navigation Model Pattern">No Comments &#187;</a></p>
			</div>

		
			<div class="post" id="post-286">
				<h2><a href="index5c97.html?p=286" rel="bookmark" title="Permanent Link to Disable smart quotes in WordPress without requiring www prefix">Disable smart quotes in WordPress without requiring www prefix</a></h2>
				<small>January 6th, 2009 <!-- by Michael L Perry --></small>

				<div class="entry">
					<p>If you've attempted to visit this site without using the "<a href="http://no-www.org/">deprecated</a>" www prefix since the beginning of the year, you probably noticed that it wasn't coming up. I hope you noticed, because I didn't until this morning.</p>
<p>On December 31, I got tired of WordPress messing with my source code and changing all of the quotes. So I found instructions from <a href="http://peterc.org/2008/71-how-to-disable-smart-curly-quotes-on-wordpress-25.html">Peter Cooper</a> on disabling that feature. I took his advice and added the line "&lt;?php remove_filter('the_content', 'wptexturize'); ?&gt;" to the bottom of functions.php. A quick test showed that it worked. Hurray! I can copy and paste source code!</p>
<p>Fast forward to today, when I tried typed in <a href="index.html">http://adventuresinsoftware.com/blog</a> and got a blank page. <a href="http://www.adventuresinsoftware.com/blog">http://www.adventuresinsoftware.com/blog</a> worked, as did <a href="../index.html">http://adventuresinsoftware.com</a> (the www. and /blog get added via redirect). So I go through my 5-step process: panic, research, try to fix, fail, and call for technical support. The folks at <a href="http://eapps.com/">eApps</a> pointed me in the right direction. They found this error message (which I had seen and disregarded, to my peril):</p>
<blockquote><p>PHP Warning:  Cannot modify header information - headers already sent by (output started at /var/www/html/wordpress/wp-content/themes/ais2/functions.php:399) in /var/www/html/wordpress/wp-includes/pluggable.php on line 390</p></blockquote>
<p>The problem is that Word Press is trying to perform a redirect to put the www back into the URL. In doing so, it ran up against the output that functions.php had already performed. The first output causes the HTTP header to be written, making it impossible to perform the redirect.</p>
<p><strong>Here's my solution</strong><br />
Before doing anything else, I deleted the line that I had added to functions.php and tried the site again. It was back to its no-www-necessary behavior. But the troublesome "smart" quotes were back.</p>
<p>So the challenge was to find a way to remove the wptexturize filter without bringing down the site. I dusted off grep and took a tour through the code. I found the places in default-filters.php where that filter was being added. So instead of removing it, I just deleted those add_filter lines.</p>
<p>And so now, thanks to the help of Peter Cooper and eApps, I have copyable code and no www necessary. Now if I could only get Word Press to stop putting the www back into the URL for me.</p>
<p><strong>Update</strong><br />
I found two places in the site options where I had www in front of the domain name. I fixed those, and now it redirects you <em>away </em>from www instead of <em>toward</em> it. So even that is fixed.</p>
				</div>

				<p class="postmetadata">Posted in <a href="index81ea.html?cat=3" title="View all posts in Error messages" rel="category">Error messages</a> |   <a href="index5c97.html?p=286#respond" title="Comment on Disable smart quotes in WordPress without requiring www prefix">No Comments &#187;</a></p>
			</div>

		
			<div class="post" id="post-285">
				<h2><a href="indexd0b8.html?p=285" rel="bookmark" title="Permanent Link to Visualize project dependencies in Visual Studio">Visualize project dependencies in Visual Studio</a></h2>
				<small>December 31st, 2008 <!-- by Michael L Perry --></small>

				<div class="entry">
					<p>When approaching a new body of code, I like to have a map. This helps me see where to start looking, what avenues to ignore for now, and why the previous authors made the decisions they did.</p>
<p>Accurate documentation is never available. It's just too costly to maintain. I think we've finally stopped beating the "not enough documentation" drum. Now we turn to the code itself.</p>
<p>For a quick first glance at a Visual Studio solution, I run this handy macro.</p>
<pre><span style="color: blue">Imports</span> System
<span style="color: blue">Imports</span> EnvDTE
<span style="color: blue">Imports</span> EnvDTE80
<span style="color: blue">Imports</span> EnvDTE90
<span style="color: blue">Imports</span> System.Diagnostics
<span style="color: blue">Imports</span> VSLangProj
<span style="color: blue">Imports</span> System.IO

<span style="color: blue">Public</span> <span style="color: blue">Module</span> Diagram

    <span style="color: blue">Sub</span> ProjectDependency()
        <span style="color: blue">Dim</span> vsProject <span style="color: blue">As</span> VSProject
        <span style="color: blue">Dim</span> file <span style="color: blue">As</span> <span style="color: blue">Integer</span>
        <span style="color: blue">Dim</span> writer <span style="color: blue">As</span> <span style="color: blue">New</span> StreamWriter(DTE.Solution.FileName &amp; <span style="color: maroon">".dot"</span>)

        writer.WriteLine(<span style="color: maroon">"digraph """</span> &amp; DTE.Solution.FullName &amp; <span style="color: maroon">""" {"</span>)
        writer.WriteLine(<span style="color: maroon">"  rankdir=LR"</span>)

        <span style="color: blue">For</span> <span style="color: blue">Each</span> project <span style="color: blue">As</span> Project <span style="color: blue">In</span> DTE.Solution.Projects
            vsProject = TryCast(project.<span style="color: blue">Object</span>, VSProject)
            <span style="color: blue">If</span> <span style="color: blue">Not</span> vsProject <span style="color: blue">Is</span> <span style="color: blue">Nothing</span> <span style="color: blue">Then</span>
                <span style="color: blue">For</span> <span style="color: blue">Each</span> reference <span style="color: blue">As</span> Reference <span style="color: blue">In</span> vsProject.References
                    <span style="color: blue">If</span> <span style="color: blue">Not</span> reference.SourceProject <span style="color: blue">Is</span> <span style="color: blue">Nothing</span> <span style="color: blue">Then</span>
                        writer.WriteLine(<span style="color: maroon">"  """</span> &amp; project.Name &amp; <span style="color: maroon">"""-&gt;"""</span> &amp; reference.SourceProject.Name &amp; <span style="color: maroon">""""</span>)
                    <span style="color: blue">End</span> <span style="color: blue">If</span>
                <span style="color: blue">Next</span>
            <span style="color: blue">End</span> <span style="color: blue">If</span>
        <span style="color: blue">Next</span>

        writer.WriteLine(<span style="color: maroon">"}"</span>)
        writer.Dispose()
    <span style="color: blue">End</span> <span style="color: blue">Sub</span>

<span style="color: blue">End</span> <span style="color: blue">Module</span>
</pre>
<p>This generates a ".dot" file in the solution's folder. Run this through <a href="http://graphviz.org/">GraphViz</a> to generate a graphical dependency map of the projects in the solution.</p>
<p>Then I start at the left side of the graph, which is where the entry points end up. I work my way down through the layers in a more-or-less breadth-first search of the project space. Tightly coupled project groups end up looking messy, and loosely coupled project groups end up looking neat.</p>
<p>Once I've oriented myself with this coarse map, I'll get more fine grained with a tool like <a href="http://www.ndepend.com/">NDepend</a>. But this is a great first step.</p>
				</div>

				<p class="postmetadata">Posted in <a href="index0b40.html?cat=9" title="View all posts in Tools" rel="category">Tools</a> |   <a href="indexd0b8.html?p=285#comments" title="Comment on Visualize project dependencies in Visual Studio">12 Comments &#187;</a></p>
			</div>

		
			<div class="post" id="post-284">
				<h2><a href="index7b2c.html?p=284" rel="bookmark" title="Permanent Link to Presentation Model in WPF without INotifyPropertyChanged">Presentation Model in WPF without INotifyPropertyChanged</a></h2>
				<small>December 27th, 2008 <!-- by Michael L Perry --></small>

				<div class="entry">
					<p>View a <a href="http://updatecontrols.net/videos/PresentationModel/PresentationModel.html">video</a> of this demo.</p>
<p>The <a href="http://martinfowler.com/eaaDev/PresentationModel.html">Presentation Model</a> pattern, otherwise known as <a href="http://blogs.msdn.com/johngossman/archive/2005/10/08/478683.aspx">Model/View/ViewModel</a>, inserts an intermediate class between your data model and your view. This intermediate class implements presentation logic, behavior directly related to user interaction. This logic doesn't belong in the data model, because it is not related to business logic. Nor does it belong in the view, because the view is difficult to unit test, and is more concerned with style and layout.</p>
<p><a href="http://www.codeproject.com/KB/smart/PMinAction.aspx">Current implementations of Presentation Model in WPF</a> rely on data binding, which <a href="http://blogs.msdn.com/mattdotson/archive/2008/07/09/presentation-model-pattern-in-wpf-part-2.aspx">requires you to implement INotifyPropertyChanged</a>. While this is just a minor inconvenience when binding directly to data objects, it is particularly troublesome to a presentation model. Since a presentation model consumes properties of a data model, it must register for PropertyChanged events. And since the view binds to the presentation model rather than the data model, it must turn around and fire those events again.</p>
<p><strong>Here's my solution</strong><br />As I <a href="index30e3.html?p=283">posted earlier</a>, Update Controls replaces WPF data binding and does not require you to implement INotifyPropertyChanged. I've just published a new version of Update Controls (2.0.2), which adds a feature especially useful for the Presentation Model pattern. You can now use dotted identifier syntax to reference objects indirectly. Now the presentation model doesn't have to pass through all of the properties of the data model. It only needs to implement those that it intends to tweak for the UI, and expose a reference to the data model for access to all the others.</p>
<p><strong>Wrap the data object</strong><br />In the previous post, we created a Person data object and some XAML that bound to it. We'll keep the same Person object, but wrap it in a PersonPresentation object. This object exposes the Person as a property, and adds UI logic for the window title.</p>
<pre><span style="color: blue">public</span> <span style="color: blue">class</span> PersonPresentation
{
    <span style="color: blue">private</span> Person _person;

    <span style="color: blue">public</span> PersonPresentation(Person person)
    {
        _person = person;
    }

    <span style="color: blue">public</span> Person Person
    {
        <span style="color: blue">get</span> { <span style="color: blue">return</span> _person; }
    }

    <span style="color: blue">public</span> <span style="color: blue">string</span> Title
    {
        <span style="color: blue">get</span> { <span style="color: blue">return</span> <span style="color: maroon">"Person - "</span> + _person.Display; }
    }
}
</pre>
<p>Instead of directly using Person as the DataContext for the window, use a PersonPresentation.</p>
<pre><span style="color: blue">public</span> <span style="color: blue">partial</span> <span style="color: blue">class</span> Window1 : Window
{
    <span style="color: blue">public</span> Window1()
    {
        InitializeComponent();
        DataContext = <strong><span style="color: blue">new</span> PersonPresentation(</strong><span style="color: blue">new</span> Person()<strong>)</strong>;
    }
}
</pre>
<p>Now use dotted-identifier syntax in the XAML to access the Person for data properties. But for UI properties, like the window title, go directly after the PersonPresentation object.</p>
<pre><span style="color: blue">&lt;</span><span style="color: maroon">Window</span> <span style="color: red">x:Class</span>="<span style="color: blue">UpdateControls.XAML.Test.Window1</span>"
    <span style="color: red">xmlns</span>="<span style="color: blue">http://schemas.microsoft.com/winfx/2006/xaml/presentation</span>"
    <span style="color: red">xmlns:x</span>="<span style="color: blue">http://schemas.microsoft.com/winfx/2006/xaml</span>"
    <span style="color: red">xmlns:u</span>="<span style="color: blue">clr-namespace:UpdateControls.XAML;assembly=UpdateControls.XAML</span>"
    <span style="color: red">Title</span>="<span style="color: blue">{u:Update <strong>Title</strong>}</span>" <span style="color: red">Height</span>="<span style="color: blue">300</span>" <span style="color: red">Width</span>="<span style="color: blue">300</span>"<span style="color: blue">&gt;</span>
    <span style="color: blue">&lt;</span><span style="color: maroon">StackPanel</span><span style="color: blue">&gt;</span>
        <span style="color: blue">&lt;</span><span style="color: maroon">StackPanel</span> <span style="color: red">Orientation</span>="<span style="color: blue">Horizontal</span>"<span style="color: blue">&gt;</span>
            <span style="color: blue">&lt;</span><span style="color: maroon">Label</span> <span style="color: red">Content</span>="<span style="color: blue">First Name:</span>" <span style="color: red">Width</span>="<span style="color: blue">100</span>"/<span style="color: blue">&gt;</span>
            <span style="color: blue">&lt;</span><span style="color: maroon">TextBox</span> <span style="color: red">Text</span>="<span style="color: blue">{u:Update <strong>Person.FirstName</strong>}</span>" <span style="color: red">Width</span>="<span style="color: blue">170</span>"/<span style="color: blue">&gt;</span>
        <span style="color: blue">&lt;</span>/<span style="color: maroon">StackPanel</span><span style="color: blue">&gt;</span>
        <span style="color: blue">&lt;</span><span style="color: maroon">StackPanel</span> <span style="color: red">Orientation</span>="<span style="color: blue">Horizontal</span>"<span style="color: blue">&gt;</span>
            <span style="color: blue">&lt;</span><span style="color: maroon">Label</span> <span style="color: red">Content</span>="<span style="color: blue">Last Name:</span>" <span style="color: red">Width</span>="<span style="color: blue">100</span>"/<span style="color: blue">&gt;</span>
            <span style="color: blue">&lt;</span><span style="color: maroon">TextBox</span> <span style="color: red">Text</span>="<span style="color: blue">{u:Update <strong>Person.LastName</strong>}</span>" <span style="color: red">Width</span>="<span style="color: blue">170</span>"/<span style="color: blue">&gt;</span>
        <span style="color: blue">&lt;</span>/<span style="color: maroon">StackPanel</span><span style="color: blue">&gt;</span>
        <span style="color: blue">&lt;</span><span style="color: maroon">StackPanel</span> <span style="color: red">Orientation</span>="<span style="color: blue">Horizontal</span>"<span style="color: blue">&gt;</span>
            <span style="color: blue">&lt;</span><span style="color: maroon">Label</span> <span style="color: red">Content</span>="<span style="color: blue">Display As:</span>" <span style="color: red">Width</span>="<span style="color: blue">100</span>"/<span style="color: blue">&gt;</span>
                <span style="color: blue">&lt;</span><span style="color: maroon">ComboBox</span> <span style="color: red">SelectedIndex</span>="<span style="color: blue">{u:Update <strong>Person.DisplayStrategy</strong>}</span>" <span style="color: red">Width</span>="<span style="color: blue">170</span>"<span style="color: blue">&gt;</span>
                    <span style="color: blue">&lt;</span><span style="color: maroon">ComboBoxItem</span> <span style="color: red">Content</span>="<span style="color: blue">{u:Update <strong>Person.FirstLast</strong>}</span>" /<span style="color: blue">&gt;</span>
                    <span style="color: blue">&lt;</span><span style="color: maroon">ComboBoxItem</span> <span style="color: red">Content</span>="<span style="color: blue">{u:Update <strong>Person.LastFirst</strong>}</span>"/<span style="color: blue">&gt;</span>
                <span style="color: blue">&lt;</span>/<span style="color: maroon">ComboBox</span><span style="color: blue">&gt;</span>
        <span style="color: blue">&lt;</span>/<span style="color: maroon">StackPanel</span><span style="color: blue">&gt;</span>
    <span style="color: blue">&lt;</span>/<span style="color: maroon">StackPanel</span><span style="color: blue">&gt;</span>
<span style="color: blue">&lt;</span>/<span style="color: maroon">Window</span><span style="color: blue">&gt;</span>
</pre>
<p>With the Presentation Model pattern, you achieve separation of concerns. Business logic is encapsulated in the data model, style and layout are in the view, and interaction logic is in the presentation model.</p>
				</div>

				<p class="postmetadata">Posted in <a href="indexb0b7.html?cat=6" title="View all posts in Patterns" rel="category">Patterns</a>,  <a href="indexa88f.html?cat=36" title="View all posts in Update Controls" rel="category">Update Controls</a> |   <a href="index7b2c.html?p=284#respond" title="Comment on Presentation Model in WPF without INotifyPropertyChanged">No Comments &#187;</a></p>
			</div>

		
		<div class="navigation">
			<div class="alignleft"><a href="index0680.html?paged=19">&laquo; Previous Entries</a></div>
			<div class="alignright"><a href="index8096.html?paged=17">Next Entries &raquo;</a></div>
		</div>

	
	</div>
		</td>
	</tr>
</table>

<hr />
<div id="footer">
<!-- If you'd like to support WordPress, having the "powered by" link someone on your blog is the best way, it's our only promotion or advertising. -->
	<p>
		Adventures in Software is proudly powered by 
		<a href="http://wordpress.org/">WordPress</a>
		<br /><a href="indexd784.html?feed=rss2">Entries (RSS)</a>
		and <a href="indexa6da.html?feed=comments-rss2">Comments (RSS)</a>.
		<!-- 21 queries. 0.478 seconds. -->
	</p>
</div>
<script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
try {
var pageTracker = _gat._getTracker("UA-389401-3");
pageTracker._trackPageview();
} catch(err) {}</script></div>

<!-- Gorgeous design by Michael Heilemann - http://binarybonsai.com/kubrick/ -->

		<div id="sk2-footer" style="color:#FFF; background-color:#444; padding: 3px 2px 3px 2px; border-top: #888 solid 1px;">This blog is protected by <a href="http://unknowngenius.com/blog/" title="Dave">dr Dave</a>'s <strong><a href="http://unknowngenius.com/blog/wordpress/spam-karma/" title="SK2">Spam Karma 2</a></strong>: <strong>274531</strong>  Spams eaten and counting...</div><script type="text/javascript" src="replies.js"></script>
<script type="text/javascript" src="blogger.js"></script>
<script type="text/javascript" src="http://twitter.com/statuses/user_timeline/michaellperry.json?callback=twitterCallback2&amp;count=5"></script>
<script type="text/javascript" src="http://search.twitter.com/search.json?q=@michaellperry&amp;callback=twitterCallbackReplies&amp;rpp=5"></script>
</body>

<!-- Mirrored from adventuresinsoftware.com/blog/?paged=18 by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 13 Jan 2017 13:10:42 GMT -->
</html>
