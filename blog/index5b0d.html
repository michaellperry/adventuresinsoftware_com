<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr">


<!-- Mirrored from adventuresinsoftware.com/blog/?cat=12 by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 13 Jan 2017 12:55:36 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- /Added by HTTrack -->
<head profile="http://gmpg.org/xfn/11">
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />

<title>Adventures in Software   &raquo; Java</title>

<meta name="generator" content="WordPress 2.3.3" /> <!-- leave this for stats -->

<link rel="stylesheet" href="wp-content/themes/ais2/style.css" type="text/css" media="screen" />
<link rel="alternate" type="application/rss+xml" title="Adventures in Software RSS Feed" href="indexd784.html?feed=rss2" />
<link rel="pingback" href="xmlrpc.html" />
    <script type="text/javascript">
        function onSilverlightError(sender, args) {
            var appSource = "";
            if (sender != null && sender != 0) {
              appSource = sender.getHost().Source;
            }
            
            var errorType = args.ErrorType;
            var iErrorCode = args.ErrorCode;

            if (errorType == "ImageError" || errorType == "MediaError") {
              return;
            }

            var errMsg = "Unhandled Error in Silverlight Application " +  appSource + "\n" ;

            errMsg += "Code: "+ iErrorCode + "    \n";
            errMsg += "Category: " + errorType + "       \n";
            errMsg += "Message: " + args.ErrorMessage + "     \n";

            if (errorType == "ParserError") {
                errMsg += "File: " + args.xamlFile + "     \n";
                errMsg += "Line: " + args.lineNumber + "     \n";
                errMsg += "Position: " + args.charPosition + "     \n";
            }
            else if (errorType == "RuntimeError") {           
                if (args.lineNumber != 0) {
                    errMsg += "Line: " + args.lineNumber + "     \n";
                    errMsg += "Position: " +  args.charPosition + "     \n";
                }
                errMsg += "MethodName: " + args.methodName + "     \n";
            }

            throw new Error(errMsg);
        }
    </script>

	<link rel="EditURI" type="application/rsd+xml" title="RSD" href="xmlrpc0db0.php?rsd" />
 <link rel="wlwmanifest" type="application/wlwmanifest+xml" href="wp-includes/wlwmanifest.xml" /> <style type='text/css'>
<!--#header { background: url('wp-content/themes/ais2/images/header-imgae03.html?upper=A7A73F&amp;lower=77773F') no-repeat bottom center; }
--></style>
</head>
<body>
<div id="page">

<div class="aisTopBar">
	<form method="get" id="searchform" action="http://adventuresinsoftware.com/blog/">
<div>
<a href="indexd784.html?feed=rss2"><img src="../images/feed-icon-28x28.png" border="0"></a>
<input type="text" value="" name="s" id="s" />
<input type="submit" id="searchsubmit" value="Search" />
</div>
</form>
</div>

<div class="aisHeaderImageRight">
	<div class="aisHeaderImage">
	<div class="aisHeaderCornerRight">
	<div class="aisHeaderCornerLeft">
	<div class="aisImageBar">
	<div class="aisSubSites">
		<a href="index.html" class="aisSubSiteLink"><span class="aisSiteTabRight"><span class="aisSiteTabLeft"><span class="aisSiteTab">
			home</span></span></span></a>
		<a class="aisSubSiteLink" href="indexb60a.html?cat=27"><span class="aisSiteTabRight"><span class="aisSiteTabLeft"><span class="aisSiteTab">
			historic modeling</span></span></span></a>
		<a class="aisSubSiteLink" href="indexa88f.html?cat=36"><span class="aisSiteTabRight"><span class="aisSiteTabLeft"><span class="aisSiteTab">
			update controls</span></span></span></a>
		<a href="index2d79.html?cat=26" class="aisSubSiteLink"><span class="aisSiteTabRight"><span class="aisSiteTabLeft"><span class="aisSiteTab">
			degrees of freedom</span></span></span></a>
		<a class="aisSubSiteLink" href="indexba53.html?page_id=2"><span class="aisSiteTabRight"><span class="aisSiteTabLeft"><span class="aisSiteTab">
			about us</span></span></span></a>

	</div>
	</div>
	</div>
	</div>
	</div>
</div>

<table style="width: 100%" cellspacing="0" cellpadding="0">
	<tr valign="top">
		<td width="210px">
<div id="sidebar">
<div class="aisLeftColumnFill">
<div class="aisLeftColumnBottom">
<div class="aisLeftColumnTop">
<div id="twitter_div" class="aisLeftNav">
<h2 class="sidebar-title">Twitter Updates</h2>
<ul id="twitter_update_list"></ul>
<a href="http://twitter.com/michaellperry" id="follow">Follow me</a>
</div>
<div id="twitter_reply_div" class="aisLeftNav">
<h2 class="sidebar-title">Twitter Replies</h2>
<ul id="twitter_reply_list"></ul>
</div>

<div class="aisLeftNav">
<a href='http://ineta.org/Speakers/SearchCommunitySpeakers.aspx?SpeakerId=c5110e21-9243-461b-a464-a6548524e885'><img alt='INETA Community Speakers Program' border='0' src='../../www.ineta.org/images/OfficialLogos/InetaCommunitySpeakersRequestMe.html' /></a>
</div>

<div class="aisLeftNav">
	<li class="pagenav"><h2>Pages</h2><ul><li class="page_item page-item-2"><a href="indexba53.html?page_id=2" title="About Us">About Us</a></li>
<li class="page_item page-item-210"><a href="index6ae3.html?page_id=210" title="Templates">Templates</a></li>
</ul></li></div>

<div class="aisLeftNav">
<h2>Archives</h2>
<ul>
	<li><a href='indexb4d5.html?m=201110' title='October 2011'>October 2011</a></li>
	<li><a href='indexc61a.html?m=201106' title='June 2011'>June 2011</a></li>
	<li><a href='indexa80d.html?m=201105' title='May 2011'>May 2011</a></li>
	<li><a href='index512b.html?m=201104' title='April 2011'>April 2011</a></li>
	<li><a href='index08fb.html?m=201103' title='March 2011'>March 2011</a></li>
	<li><a href='index52f4.html?m=201102' title='February 2011'>February 2011</a></li>
	<li><a href='index74f1.html?m=201101' title='January 2011'>January 2011</a></li>
	<li><a href='index8956.html?m=201012' title='December 2010'>December 2010</a></li>
	<li><a href='indexa1aa.html?m=201011' title='November 2010'>November 2010</a></li>
	<li><a href='indexe3d5.html?m=201010' title='October 2010'>October 2010</a></li>
	<li><a href='index9ab9.html?m=201009' title='September 2010'>September 2010</a></li>
	<li><a href='index1ff0.html?m=201008' title='August 2010'>August 2010</a></li>
	<li><a href='index9f11.html?m=201007' title='July 2010'>July 2010</a></li>
	<li><a href='index31f0.html?m=201006' title='June 2010'>June 2010</a></li>
	<li><a href='indexd189.html?m=201005' title='May 2010'>May 2010</a></li>
	<li><a href='indexb5c0.html?m=201004' title='April 2010'>April 2010</a></li>
	<li><a href='indexf258.html?m=201003' title='March 2010'>March 2010</a></li>
	<li><a href='index6e30.html?m=201002' title='February 2010'>February 2010</a></li>
	<li><a href='index6b19.html?m=201001' title='January 2010'>January 2010</a></li>
	<li><a href='index5c0a.html?m=200912' title='December 2009'>December 2009</a></li>
	<li><a href='index8f62.html?m=200911' title='November 2009'>November 2009</a></li>
	<li><a href='index451d.html?m=200910' title='October 2009'>October 2009</a></li>
	<li><a href='index3e04.html?m=200909' title='September 2009'>September 2009</a></li>
	<li><a href='index425a.html?m=200908' title='August 2009'>August 2009</a></li>
	<li><a href='index9907.html?m=200907' title='July 2009'>July 2009</a></li>
	<li><a href='index3104.html?m=200906' title='June 2009'>June 2009</a></li>
	<li><a href='indexc36d.html?m=200905' title='May 2009'>May 2009</a></li>
	<li><a href='index17e8.html?m=200904' title='April 2009'>April 2009</a></li>
	<li><a href='index10a5.html?m=200903' title='March 2009'>March 2009</a></li>
	<li><a href='index8988.html?m=200902' title='February 2009'>February 2009</a></li>
	<li><a href='index1419.html?m=200901' title='January 2009'>January 2009</a></li>
	<li><a href='index7866.html?m=200812' title='December 2008'>December 2008</a></li>
	<li><a href='index55f6.html?m=200811' title='November 2008'>November 2008</a></li>
	<li><a href='indexa7bc.html?m=200810' title='October 2008'>October 2008</a></li>
	<li><a href='indexe77c.html?m=200809' title='September 2008'>September 2008</a></li>
	<li><a href='indexcffc.html?m=200808' title='August 2008'>August 2008</a></li>
	<li><a href='index0e62.html?m=200807' title='July 2008'>July 2008</a></li>
	<li><a href='indexfda7.html?m=200806' title='June 2008'>June 2008</a></li>
	<li><a href='index7d64.html?m=200805' title='May 2008'>May 2008</a></li>
	<li><a href='index94dd.html?m=200804' title='April 2008'>April 2008</a></li>
	<li><a href='index9631.html?m=200803' title='March 2008'>March 2008</a></li>
	<li><a href='indexdd52.html?m=200802' title='February 2008'>February 2008</a></li>
	<li><a href='index21ee.html?m=200801' title='January 2008'>January 2008</a></li>
	<li><a href='index363c.html?m=200712' title='December 2007'>December 2007</a></li>
	<li><a href='index7493.html?m=200711' title='November 2007'>November 2007</a></li>
	<li><a href='index93a7.html?m=200710' title='October 2007'>October 2007</a></li>
	<li><a href='index4ca8.html?m=200709' title='September 2007'>September 2007</a></li>
	<li><a href='index6124.html?m=200708' title='August 2007'>August 2007</a></li>
	<li><a href='index6013.html?m=200707' title='July 2007'>July 2007</a></li>
	<li><a href='index2ab6.html?m=200706' title='June 2007'>June 2007</a></li>
	<li><a href='index44f0.html?m=200705' title='May 2007'>May 2007</a></li>
	<li><a href='indexf0b4.html?m=200704' title='April 2007'>April 2007</a></li>
	<li><a href='index481d.html?m=200703' title='March 2007'>March 2007</a></li>
	<li><a href='indexcbea.html?m=200702' title='February 2007'>February 2007</a></li>
	<li><a href='index9cdc.html?m=200701' title='January 2007'>January 2007</a></li>
	<li><a href='index3ea4.html?m=200612' title='December 2006'>December 2006</a></li>
	<li><a href='index67ca.html?m=200611' title='November 2006'>November 2006</a></li>
	<li><a href='indexff49.html?m=200610' title='October 2006'>October 2006</a></li>
	<li><a href='index611c.html?m=200609' title='September 2006'>September 2006</a></li>
	<li><a href='index9a21.html?m=200608' title='August 2006'>August 2006</a></li>
	<li><a href='index3ee9.html?m=200607' title='July 2006'>July 2006</a></li>
	<li><a href='indexe13a.html?m=200606' title='June 2006'>June 2006</a></li>
</ul>
</div>

<div class="aisLeftNav">
	</div>

<div class="aisLeftNav">
<h2>Books</h2>
<iframe src="http://rcm.amazon.com/e/cm?t=adventures0d2-20&amp;o=1&amp;p=8&amp;l=as1&amp;asins=0764526413&amp;fc1=000000&amp;IS2=1&amp;lt1=_blank&amp;lc1=0000ff&amp;bc1=000000&amp;bg1=ffffff&amp;f=ifr" style="width:120px;height:240px;" scrolling="no" marginwidth="0" marginheight="0" frameborder="0" name="I5" id="I5"></iframe>
<br/>
<iframe src="http://rcm.amazon.com/e/cm?t=adventures0d2-20&amp;o=1&amp;p=8&amp;l=as1&amp;asins=0201633612&amp;fc1=000000&amp;IS2=1&amp;lt1=_blank&amp;lc1=0000ff&amp;bc1=000000&amp;bg1=ffffff&amp;f=ifr" style="width:120px;height:240px;" scrolling="no" marginwidth="0" marginheight="0" frameborder="0" name="I6" id="I6"></iframe>
<br/>
<iframe src="http://rcm.amazon.com/e/cm?t=adventures0d2-20&amp;o=1&amp;p=8&amp;l=as1&amp;asins=0136291554&amp;fc1=000000&amp;IS2=1&amp;lt1=_blank&amp;lc1=0000ff&amp;bc1=000000&amp;bg1=ffffff&amp;f=ifr" style="width:120px;height:240px;" scrolling="no" marginwidth="0" marginheight="0" frameborder="0" name="I7" id="I7"></iframe>
<br/>
<iframe src="http://rcm.amazon.com/e/cm?t=adventures0d2-20&amp;o=1&amp;p=8&amp;l=as1&amp;asins=1888009195&amp;fc1=000000&amp;IS2=1&amp;lt1=_blank&amp;lc1=0000ff&amp;bc1=000000&amp;bg1=ffffff&amp;f=ifr" style="width:120px;height:240px;" scrolling="no" marginwidth="0" marginheight="0" frameborder="0" name="I8" id="I8"></iframe>
</div>
<div class="aisLeftNav">
<h2>Meta</h2>
<ul>
		<li><a href="wp-login.html">Login</a></li>
	<li><a href="http://validator.w3.org/check/referer" title="This page validates as XHTML 1.0 Transitional">Valid <abbr title="eXtensible HyperText Markup Language">XHTML</abbr></a></li>
	<li><a href="http://gmpg.org/xfn/"><abbr title="XHTML Friends Network">XFN</abbr></a></li>
	<li><a href="http://wordpress.org/" title="Powered by WordPress, state-of-the-art semantic personal publishing platform.">WordPress</a></li>
	</ul>
</div>
<div class="aisLeftContent">
<h2>Community</h2>
<ul>
	<script type="text/javascript" src="../../localhost/embed/92q2bbma.js"></script>
</ul>
</div>

</div></div></div>
</div>		</td>
		<td>

	<div id="content" class="narrowcolumn">

		
		 		<h2 class="pagetitle">Archive for the &#8216;Java&#8217; Category</h2>

 	  

		<div class="navigation">
			<div class="alignleft"></div>
			<div class="alignright"></div>
		</div>

				<div class="post">
				<h3 id="post-546"><a href="index4cfb.html?p=546" rel="bookmark" title="Permanent Link to Java Tuple update">Java Tuple update</a></h3>
				<small>Friday, August 20th, 2010</small>

				<div class="entry">
					<p>Download:</p>
<ul>
<li><a href="../bin/tuple-1.1.jar">Jar file</a></li>
<li><a href="http://github.com/mallardsoft/tuple">Source code (from GitHub)</a></li>
<li>import com.mallardsoft.tuple</li>
</ul>
<p>Four years ago I created a Java Tuple class. I needed a way to quickly create type-safe multi-valued keys in Java. Here’s what I came up with:</p>
<pre>Map&lt;Pair&lt;String, String&gt;, Integer&gt; population = <span style="color: blue">new</span> HashMap&lt;Pair&lt;String, String&gt;, Integer&gt;();
population.put(
    Tuple.from(<span style="color: maroon">&quot;TX&quot;</span>, <span style="color: maroon">&quot;Dallas&quot;</span>),
    <span style="color: maroon">1213825</span>);
population.put(
    Tuple.from(<span style="color: maroon">&quot;TX&quot;</span>, <span style="color: maroon">&quot;Fort Worth&quot;</span>),
    <span style="color: maroon">624067</span>);
population.put(
    Tuple.from(<span style="color: maroon">&quot;IL&quot;</span>, <span style="color: maroon">&quot;Springfield&quot;</span>),
    <span style="color: maroon">203564</span>);
population.put(
    Tuple.from(<span style="color: maroon">&quot;NM&quot;</span>, <span style="color: maroon">&quot;Albuquerque&quot;</span>),
    <span style="color: maroon">494236</span>);

<span style="color: blue">int</span> p = population.get(
    Tuple.from(<span style="color: maroon">&quot;TX&quot;</span>, <span style="color: maroon">&quot;Fort Worth&quot;</span>));
<span style="color: green">// p = 624067</span>
assertEquals(<span style="color: maroon">624067</span>, p);
assertNull(population.get(
    Tuple.from(<span style="color: maroon">&quot;NM&quot;</span>, <span style="color: maroon">&quot;Roswell&quot;</span>)));
assertNull(population.get(
    Tuple.from(<span style="color: maroon">&quot;NJ&quot;</span>, <span style="color: maroon">&quot;Springfield&quot;</span>)));</pre>
<p>Tuple.from() creates a type-safe object containing the listed values. It implements equals(), getHashCode(), compareTo(), and toString() in meaningful ways. And it provides for multi-valued returns.</p>
<pre>Variable&lt;Boolean&gt; found = <span style="color: blue">new</span> Variable&lt;Boolean&gt;();
Variable&lt;Integer&gt; index = <span style="color: blue">new</span> Variable&lt;Integer&gt;();

findCharacter(<span style="color: maroon">&quot;Hello, world&quot;</span>, <span style="color: maroon">'w'</span>).extract(found).extract(index);
assertTrue(found.get());
<span style="color: blue">if</span> (found.get()) {
    <span style="color: blue">int</span> i = index.get();
    assertEquals(<span style="color: maroon">7</span>, i);
}
<span style="color: blue">else</span> {
    fail();
}</pre>
<p>Where findCharacter returns Pair&lt;Boolean, Integer&gt;. I <a href="index4170.html?p=43">published the source</a> and got a few comments.</p>
<p>The most persistent complaint was that Tuple only worked with types that implemented IComparable&lt;Themselves&gt;. This constraint was only used in compareTo(). If you wanted tuples for one of the other methods, you ran into a meaningless compiler issue.</p>
<p>I have since removed that generic constraint. Now you can create tuples of non-comparable types. If you try to compare them, you will get a run time issue.</p>
<p>If you have used this library in the past, or if you need tuples in Java, please download the latest using the links at the top of this article.</p>
				</div>

				<p class="postmetadata">Posted in <a href="index5b0d.html?cat=12" title="View all posts in Java" rel="category">Java</a> |   <a href="index4cfb.html?p=546#comments" title="Comment on Java Tuple update">3 Comments &#187;</a></p>

			</div>

				<div class="post">
				<h3 id="post-481"><a href="indexf705.html?p=481" rel="bookmark" title="Permanent Link to Java/WCF Interop">Java/WCF Interop</a></h3>
				<small>Monday, February 8th, 2010</small>

				<div class="entry">
					<p>As of today (February 2010), the story of Java/WCF interoperability is fair. That wasn’t always the case. In the past, I’ve struggled to get Java and .NET to play nice. Today, I was able to make a .NET WCF client talk to a Java CXF web service with just a little coaxing. Here’s how I did it.</p>
<p><strong>Contract first</strong>    <br />The first step to successful interoperability is to define the contract. Somehow you need to generate the WSDL, and you need to tightly control what it looks like. Use tools to help you, but keep a close eye on what those tools do.</p>
<p>I started with a WCF service contract. This is a .NET interface that uses the [ServiceContract] and [OperationContract] attributes. Put this interface and all of the data types it uses into a class library project. Here’s an example:</p>
<pre>[<span style="color: #2b91af">ServiceContract</span>(Namespace = <span style="color: maroon">&quot;http://correspondence.updatecontrols.com&quot;</span>)]
<span style="color: blue">public</span> <span style="color: blue">interface</span> <span style="color: #2b91af">ISynchronizationService</span>
{
    [<span style="color: #2b91af">OperationContract</span>]
    <span style="color: #2b91af">FactTree</span> Get(<span style="color: #2b91af">FactTree</span> pivotTree, <span style="color: blue">long</span> pivotId, <span style="color: blue">long</span> timestamp);

    [<span style="color: #2b91af">OperationContract</span>]
    <span style="color: blue">void</span> Post(<span style="color: #2b91af">FactTree</span> messageBody);
}</pre>
<p>The FactTree data type used by this interface is decorated with the [DataContract] and [DataMember] attributes.</p>
<pre>[<span style="color: #2b91af">DataContract</span>(<span style="color: #2b91af">Namespace</span> = <span style="color: maroon">&quot;http://correspondence.updatecontrols.com&quot;</span>)]
<span style="color: blue">public</span> <span style="color: blue">class</span> <span style="color: #2b91af">FactTree</span>
{
    [<span style="color: #2b91af">DataMember</span>]
    <span style="color: blue">public</span> <span style="color: blue">long</span> <span style="color: #2b91af">DatabaseId</span> { <span style="color: blue">get</span>; <span style="color: blue">set</span>; }

    [<span style="color: #2b91af">DataMember</span>]
    <span style="color: blue">public</span> <span style="color: #2b91af">List</span>&lt;<span style="color: #2b91af">Fact</span>&gt; <span style="color: #2b91af">Facts</span> { <span style="color: blue">get</span>; <span style="color: blue">set</span>; }

    [<span style="color: #2b91af">DataMember</span>]
    <span style="color: blue">public</span> <span style="color: #2b91af">List</span>&lt;<span style="color: #2b91af">FactRole</span>&gt; <span style="color: #2b91af">Roles</span> { <span style="color: blue">get</span>; <span style="color: blue">set</span>; }

    [<span style="color: #2b91af">DataMember</span>]
    <span style="color: blue">public</span> <span style="color: #2b91af">List</span>&lt;<span style="color: #2b91af">FactType</span>&gt; <span style="color: #2b91af">Types</span> { <span style="color: blue">get</span>; <span style="color: blue">set</span>; }
}</pre>
<p><strong>Create a WCF service</strong></p>
<p>Even though we want to end up with a Java web service, an intermediate step is to implement this service in WCF.</p>
<ol>
<li>Create a new project in Visual Studio using the template Visual C#: Web: WCF Service Application.</li>
<li>Add a reference to the class library that defines the interface.</li>
<li>Change the name of the generated service from Service1 to something meaningful.</li>
<li>Delete the generated IService1 interface.</li>
<li>Use your own interface instead.</li>
<li>Add a [ServiceBehavior] attribute to set the Namespace.</li>
</ol>
<p>At this point, the service looks something like this:</p>
<pre><span style="color: green">// NOTE: If you change the class name &quot;Service1&quot; here, you must also update the reference to &quot;Service1&quot; in Web.config and in the associated .svc file.</span>
[<span style="color: #2b91af">ServiceBehavior</span>(<span style="color: #2b91af">Namespace</span> = <span style="color: maroon">&quot;http://correspondence.updatecontrols.com&quot;</span>)]
<span style="color: blue">public</span> <span style="color: blue">class</span> <span style="color: #2b91af">SynchronizationService</span> : <span style="color: #2b91af">ISynchronizationService</span>
{
    <span style="color: blue">public</span> <span style="color: #2b91af">FactTree</span> <span style="color: #2b91af">Get</span>(<span style="color: #2b91af">FactTree</span> pivotTree, <span style="color: blue">long</span> pivotId, <span style="color: blue">long</span> timestamp)
    {
        <span style="color: blue">throw</span> <span style="color: blue">new</span> <span style="color: #2b91af">NotImplementedException</span>();
    }

    <span style="color: blue">public</span> <span style="color: blue">void</span> <span style="color: #2b91af">Post</span>(<span style="color: #2b91af">FactTree</span> messageBody)
    {
        <span style="color: blue">throw</span> <span style="color: blue">new</span> <span style="color: #2b91af">NotImplementedException</span>();
    }
}</pre>
<p>Like the comment says, we need to edit the svc file and the web.config. Right-click the svc file in the project tree and select “View Markup”. Change the Service attribute to the fully qualified name of the service class.</p>
<pre><span style="color: blue">&lt;</span><span style="color: maroon">%@</span> ServiceHost <span style="color: red">Language</span>=&quot;<span style="color: blue">C#</span>&quot; <span style="color: red">Debug</span>=&quot;<span style="color: blue">true</span>&quot;
  <span style="color: red">Service</span>=&quot;<span style="color: blue">UpdateControls.Correspondence.WebService.SynchronizationService</span>&quot;
  <span style="color: red">CodeBehind</span>=&quot;<span style="color: blue">SynchronizationService.svc.cs</span>&quot; %<span style="color: blue">&gt;</span></pre>
<p>The web.config change is slightly more complicated. There’s a lot of junk in web.config that you don’t need to worry about. The section you want is all the way at the bottom. Look for the &lt;service&gt; tag. It has two attributes: name and behaviorConfiguration. Also look for the &lt;endpoint&gt; tag right below it. It has three attributes: address, binding, and contract.</p>
<ol>
<li>Change the service name to the fully qualified name of your service class.</li>
<li>Change the endpoint binding from wsHttpBinding to basicHttpBinding.</li>
<li>Change the endpoint contract from IService1 to the fully qualified name of your interface.</li>
</ol>
<p>Here’s a trick to getting the fully qualified names. Delete the text between the quotes of the attributes. Open the Class View by hitting Ctrl+Shift+C in Visual Studio. Expand the tree to find your service class and interface. Drag them onto the web.config file between the quotes.</p>
<p>You can also change the name of the service behavior, but that’s not necessary for this intermediate step.</p>
<p><strong>Examine the WSDL</strong></p>
<p>These steps ensure that we have nice clean WSDL to work from. Take a look at it by running your WCF service application. A directory listing will open in the browser. Click on the svc file. If you get a yellow screen, please double-check your steps.</p>
<p>Click on the link to see the WSDL you’ve created. Different browsers react differently to raw XML. IE and Firefox will show it to you, but Chrome will give you a blank screen. You’ll have to view source to see the WSDL in Chrome.</p>
<p>On this first page, you’ll see all of the input and output messages, and the operations, and the service itself. Double-check that the service uses binding=&quot;i0:BasicHttpBinding_...&quot;.</p>
<p>Hack the url to look at more detailed information. Change the query string to “?wsdl=wsdl0” to see the declaration for the binding. It uses “http://schemas.xmlsoap.org/soap/http” with the “document” style.</p>
<p>Hack the url again with “?xsd=xsd0” to see the data types. You should recognize these data types as the ones you wrote in C#. Notice that it turns all of your List&lt;T&gt;s into ArrayOfTs. When we import these into Java, they will become classes containing List&lt;T&gt;.</p>
<p><strong>Create the Java contract project</strong></p>
<p>Create a Java project in your favorite IDE (mine is Eclipse). Open a command prompt and go to the source directory of that project (probably ends in “src”). Download <a href="http://cxf.apache.org/">Apache CXF</a> and unzip it to your hard drive (mine is in “c:\apache-cxf-2.2.6”).</p>
<p>Go back to the first WSDL page, the one with the “?wsdl” query string. This is the URL that we are going to generate Java files from. Copy this URL and use it at the command line:</p>
<pre>\apache-cxf-<span style="color: maroon">2</span><span style="color: maroon">.2</span><span style="color: maroon">.6</span>\bin\wsdl2java.bat http://localhost:<span style="color: maroon">3642</span>/SynchronizationService.svc<span style="color: #2b91af">?</span>wsdl</pre>
<p>CXF will generate a bunch of class files. Most will be in a package derived from your namespace. One will be in “com.microsoft.schemas._2003._10.serialization”. If you find one in org.tempuri package, you forgot a Namespace setting in one of your attributes. These class files are decorated with enough annotations to make them compatible with the WCF service.</p>
<p><strong>Create the Java service project</strong></p>
<p>Although you could put your service implementation and contract in the same project, I prefer to keep them separate. You can use the contract project to write a different service implementation, or even to write a client.</p>
<p>Create a new Dynamic Web Project. Add to the new project a reference to the contact project. You will also need to add this reference to the Java EE Module Dependencies in the project properties. Otherwise it won’t copy the contract jar file to the service lib directory, resulting in a NoClassDefFoundError at runtime. Then add a class that implements the service contract. Copy the @WebService annotation from the interface to the class. The service looks something like this:</p>
<pre>@WebService(targetNamespace = <span style="color: maroon">&quot;http://correspondence.updatecontrols.com&quot;</span>, name = <span style="color: maroon">&quot;ISynchronizationService&quot;</span>)
<span style="color: blue">public</span> <span style="color: blue">class</span> SynchronizationService <span style="color: blue">implements</span> ISynchronizationService {

    @Override
    <span style="color: blue">public</span> FactTree get(FactTree pivotTree, Long pivotId, Long timestamp) {
        <span style="color: green">// TODO Auto-generated method stub</span>
        <span style="color: blue">return</span> <span style="color: blue">null</span>;
    }

    @Override
    <span style="color: blue">public</span> <span style="color: blue">void</span> post(FactTree messageBody) {
        <span style="color: green">// TODO Auto-generated method stub</span>

    }

}</pre>
<p>The service project needs the CXF jar files. Copy them from the CXF install folder (C:\apache-cxf-2.2.6\lib) into the project’s library folder (WebContent\WEB-INF\lib). This is the minimal set that you will need:</p>
<ul>
<li>jaxb-api-2.1.jar</li>
<li>jaxb-impl-2.1.12.jar</li>
<li>wsdl4j-1.6.2.jar</li>
<li>XmlSchema-1.4.5.jar</li>
<li>cxf-2.2.6.jar</li>
</ul>
<p>Now we need to publish this web service as a servlet. The quickest way to do that is to derive a class from CXFNonSpringServlet. Right-click the project and select &quot;New: Servlet”. Change the servlet base class to “org.apache.cxf.transport.servlet.CXFNonSpringServlet”. Uncheck the boxes to implement doGet and doPost. The base class handles those for you. Once the class is created, override the loadBus method.</p>
<pre><span style="color: blue">package</span> com.updatecontrols.correspondence.service;

<span style="color: blue">import</span> javax.servlet.ServletConfig;
<span style="color: blue">import</span> javax.servlet.ServletException;
<span style="color: blue">import</span> javax.xml.ws.Endpoint;

<span style="color: blue">import</span> org.apache.cxf.transport.servlet.CXFNonSpringServlet;

<span style="color: blue">public</span> <span style="color: blue">class</span> SynchronizationServlet <span style="color: blue">extends</span> CXFNonSpringServlet {
    @Override
    <span style="color: blue">public</span> <span style="color: blue">void</span> loadBus(ServletConfig servletConfig) <span style="color: blue">throws</span> ServletException {
        <span style="color: blue">super</span>.loadBus(servletConfig);        

        Endpoint.publish(<span style="color: maroon">&quot;/SynchronizationService&quot;</span>, <span style="color: blue">new</span> SynchronizationService());
    }
}</pre>
<p>Open the web.xml file. You will notice that a servlet mapping was created for you. This mapping is set up to handle URLs that directly address the servlet, but the CXF servlet adds the service name to the URL. Add a “/*” to the end of the URL pattern to direct all such addresses to the servlet.</p>
<pre><span style="color: blue">&lt;?</span><span style="color: maroon">xml</span> <span style="color: red">version</span>=&quot;<span style="color: blue">1.0</span>&quot; <span style="color: red">encoding</span>=&quot;<span style="color: blue">UTF-8</span>&quot;<span style="color: blue">?&gt;</span>
<span style="color: blue">&lt;</span><span style="color: maroon">web-app</span> <span style="color: red">id</span>=&quot;<span style="color: blue">WebApp_ID</span>&quot; <span style="color: red">version</span>=&quot;<span style="color: blue">2.4</span>&quot; <span style="color: red">xmlns</span>=&quot;<span style="color: blue">http://java.sun.com/xml/ns/j2ee</span>&quot; <span style="color: red">xmlns:xsi</span>=&quot;<span style="color: blue">http://www.w3.org/2001/XMLSchema-instance</span>&quot; <span style="color: red">xsi:schemaLocation</span>=&quot;<span style="color: blue">http://java.sun.com/xml/ns/j2ee http://java.sun.com/xml/ns/j2ee/web-app_2_4.xsd</span>&quot;<span style="color: blue">&gt;</span>
    <span style="color: blue">&lt;</span><span style="color: maroon">display-name</span><span style="color: blue">&gt;</span>correspondence_sync_service<span style="color: blue">&lt;</span>/<span style="color: maroon">display-name</span><span style="color: blue">&gt;</span>
    <span style="color: blue">&lt;</span><span style="color: maroon">servlet</span><span style="color: blue">&gt;</span>
        <span style="color: blue">&lt;</span><span style="color: maroon">description</span><span style="color: blue">&gt;</span>
        <span style="color: blue">&lt;</span>/<span style="color: maroon">description</span><span style="color: blue">&gt;</span>
        <span style="color: blue">&lt;</span><span style="color: maroon">display-name</span><span style="color: blue">&gt;</span>SynchronizationServlet<span style="color: blue">&lt;</span>/<span style="color: maroon">display-name</span><span style="color: blue">&gt;</span>
        <span style="color: blue">&lt;</span><span style="color: maroon">servlet-name</span><span style="color: blue">&gt;</span>SynchronizationServlet<span style="color: blue">&lt;</span>/<span style="color: maroon">servlet-name</span><span style="color: blue">&gt;</span>
        <span style="color: blue">&lt;</span><span style="color: maroon">servlet-class</span><span style="color: blue">&gt;</span>
        com.updatecontrols.correspondence.service.SynchronizationServlet<span style="color: blue">&lt;</span>/<span style="color: maroon">servlet-class</span><span style="color: blue">&gt;</span>
    <span style="color: blue">&lt;</span>/<span style="color: maroon">servlet</span><span style="color: blue">&gt;</span>
    <span style="color: blue">&lt;</span><span style="color: maroon">servlet-mapping</span><span style="color: blue">&gt;</span>
        <span style="color: blue">&lt;</span><span style="color: maroon">servlet-name</span><span style="color: blue">&gt;</span>SynchronizationServlet<span style="color: blue">&lt;</span>/<span style="color: maroon">servlet-name</span><span style="color: blue">&gt;</span>
        <span style="color: blue">&lt;</span><span style="color: maroon">url-pattern</span><span style="color: blue">&gt;</span>/SynchronizationServlet<strong>/*</strong><span style="color: blue">&lt;</span>/<span style="color: maroon">url-pattern</span><span style="color: blue">&gt;</span>
    <span style="color: blue">&lt;</span>/<span style="color: maroon">servlet-mapping</span><span style="color: blue">&gt;</span>
<span style="color: blue">&lt;</span>/<span style="color: maroon">web-app</span><span style="color: blue">&gt;</span></pre>
<p>Run the project in Tomcat to make sure the servlet is published correctly. Point a browser at the servlet (in my case http://localhost:8080/correspondence_sync_service/SynchronizationServlet) and you should see a listing of available SOAP services. Append the service name to the URL (http://localhost:8080/correspondence_sync_service/SynchronizationServlet/SynchronizationService) and you will get a 500 error. If you get a 404, you haven’t modified the web.xml file correctly.</p>
<p><strong>Create a WCF client</strong></p>
<p>The last step is the easiest. Since we started by creating a WCF service contract, we can ask WCF to create a client proxy. I documented this technique in <a href="indexbcd6.html?p=338">.NET to .NET web services without WSDL</a>. It turns out that this trick works equally well for .NET to Java web services.</p>
<p>Add an endpoint to the app.config of your client. The URL should be the servlet name followed by the service name. For example:</p>
<pre><span style="color: blue">&lt;?</span><span style="color: maroon">xml</span> <span style="color: red">version</span>=&quot;<span style="color: blue">1.0</span>&quot; <span style="color: red">encoding</span>=&quot;<span style="color: blue">utf-8</span>&quot; <span style="color: blue">?&gt;</span>
<span style="color: blue">&lt;</span><span style="color: maroon">configuration</span><span style="color: blue">&gt;</span>
  <span style="color: blue">&lt;</span><span style="color: maroon">system.serviceModel</span><span style="color: blue">&gt;</span>
    <span style="color: blue">&lt;</span><span style="color: maroon">bindings</span><span style="color: blue">&gt;</span>
      <span style="color: blue">&lt;</span><span style="color: maroon">basicHttpBinding</span><span style="color: blue">&gt;</span>
        <span style="color: blue">&lt;</span><span style="color: maroon">binding</span> <span style="color: red">name</span>=&quot;<span style="color: blue">SynchronizationServiceSoapBinding</span>&quot; <span style="color: red">closeTimeout</span>=&quot;<span style="color: blue">00:01:00</span>&quot;
            <span style="color: red">openTimeout</span>=&quot;<span style="color: blue">00:01:00</span>&quot; <span style="color: red">receiveTimeout</span>=&quot;<span style="color: blue">00:10:00</span>&quot; <span style="color: red">sendTimeout</span>=&quot;<span style="color: blue">00:01:00</span>&quot;
            <span style="color: red">allowCookies</span>=&quot;<span style="color: blue">false</span>&quot; <span style="color: red">bypassProxyOnLocal</span>=&quot;<span style="color: blue">false</span>&quot; <span style="color: red">hostNameComparisonMode</span>=&quot;<span style="color: blue">StrongWildcard</span>&quot;
            <span style="color: red">maxBufferSize</span>=&quot;<span style="color: blue">65536</span>&quot; <span style="color: red">maxBufferPoolSize</span>=&quot;<span style="color: blue">524288</span>&quot; <span style="color: red">maxReceivedMessageSize</span>=&quot;<span style="color: blue">65536</span>&quot;
            <span style="color: red">messageEncoding</span>=&quot;<span style="color: blue">Text</span>&quot; <span style="color: red">textEncoding</span>=&quot;<span style="color: blue">utf-8</span>&quot; <span style="color: red">transferMode</span>=&quot;<span style="color: blue">Buffered</span>&quot;
            <span style="color: red">useDefaultWebProxy</span>=&quot;<span style="color: blue">true</span>&quot;<span style="color: blue">&gt;</span>
          <span style="color: blue">&lt;</span><span style="color: maroon">readerQuotas</span> <span style="color: red">maxDepth</span>=&quot;<span style="color: blue">32</span>&quot; <span style="color: red">maxStringContentLength</span>=&quot;<span style="color: blue">8192</span>&quot; <span style="color: red">maxArrayLength</span>=&quot;<span style="color: blue">16384</span>&quot;
              <span style="color: red">maxBytesPerRead</span>=&quot;<span style="color: blue">4096</span>&quot; <span style="color: red">maxNameTableCharCount</span>=&quot;<span style="color: blue">16384</span>&quot; /<span style="color: blue">&gt;</span>
          <span style="color: blue">&lt;</span><span style="color: maroon">security</span> <span style="color: red">mode</span>=&quot;<span style="color: blue">None</span>&quot;<span style="color: blue">&gt;</span>
            <span style="color: blue">&lt;</span><span style="color: maroon">transport</span> <span style="color: red">clientCredentialType</span>=&quot;<span style="color: blue">None</span>&quot; <span style="color: red">proxyCredentialType</span>=&quot;<span style="color: blue">None</span>&quot; <span style="color: red">realm</span>=&quot;<span style="color: blue"></span>&quot;/<span style="color: blue">&gt;</span>
            <span style="color: blue">&lt;</span><span style="color: maroon">message</span> <span style="color: red">clientCredentialType</span>=&quot;<span style="color: blue">UserName</span>&quot; <span style="color: red">algorithmSuite</span>=&quot;<span style="color: blue">Default</span>&quot; /<span style="color: blue">&gt;</span>
          <span style="color: blue">&lt;</span>/<span style="color: maroon">security</span><span style="color: blue">&gt;</span>
        <span style="color: blue">&lt;</span>/<span style="color: maroon">binding</span><span style="color: blue">&gt;</span>
      <span style="color: blue">&lt;</span>/<span style="color: maroon">basicHttpBinding</span><span style="color: blue">&gt;</span>
    <span style="color: blue">&lt;</span>/<span style="color: maroon">bindings</span><span style="color: blue">&gt;</span>
    <span style="color: blue">&lt;</span><span style="color: maroon">client</span><span style="color: blue">&gt;</span>
      <span style="color: blue">&lt;</span><span style="color: maroon">endpoint</span> <span style="color: red">address</span>=&quot;<span style="color: blue"><strong>http://localhost:8080/correspondence_sync_service/SynchronizationServlet/SynchronizationService</strong></span>&quot;
          <span style="color: red">binding</span>=&quot;<span style="color: blue">basicHttpBinding</span>&quot; <span style="color: red">bindingConfiguration</span>=&quot;<span style="color: blue">SynchronizationServiceSoapBinding</span>&quot;
          <span style="color: red">contract</span>=&quot;<span style="color: blue">UpdateControls.Correspondence.WebService.Contract.ISynchronizationService</span>&quot; <span style="color: red">name</span>=&quot;<span style="color: blue">SynchronizationService</span>&quot; /<span style="color: blue">&gt;</span>
    <span style="color: blue">&lt;</span>/<span style="color: maroon">client</span><span style="color: blue">&gt;</span>
  <span style="color: blue">&lt;</span>/<span style="color: maroon">system.serviceModel</span><span style="color: blue">&gt;</span>
<span style="color: blue">&lt;</span>/<span style="color: maroon">configuration</span><span style="color: blue">&gt;</span></pre>
<p>And with that you have a .NET WCF client communicating with a Java CXF server. I expect that similar strategies could be used to go the other direction, although I haven’t tried yet.</p>
				</div>

				<p class="postmetadata">Posted in <a href="index8e7f.html?cat=19" title="View all posts in C#" rel="category">C#</a>,  <a href="index5b0d.html?cat=12" title="View all posts in Java" rel="category">Java</a> |   <a href="indexf705.html?p=481#respond" title="Comment on Java/WCF Interop">No Comments &#187;</a></p>

			</div>

				<div class="post">
				<h3 id="post-248"><a href="indexcf9a.html?p=248" rel="bookmark" title="Permanent Link to NullReferenceException while using bean:write">NullReferenceException while using bean:write</a></h3>
				<small>Wednesday, July 2nd, 2008</small>

				<div class="entry">
					<p>Here's an obscure error that I fought for several hours today:</p>
<p>Jul 2, 2008 5:42:42 PM org.apache.catalina.core.ApplicationDispatcher invoke<br />
SEVERE: Servlet.service() for servlet jsp threw exception<br />
java.lang.NullPointerException<br />
at org.apache.struts.taglib.TagUtils.retrieveMessageResources(TagUtils.java:1175)<br />
at org.apache.struts.taglib.TagUtils.message(TagUtils.java:1038)<br />
at org.apache.struts.taglib.TagUtils.message(TagUtils.java:1013)<br />
at org.apache.struts.taglib.bean.WriteTag.retrieveFormatString(WriteTag.java:254)<br />
at org.apache.struts.taglib.bean.WriteTag.formatValue(WriteTag.java:360)<br />
at org.apache.struts.taglib.bean.WriteTag.doStartTag(WriteTag.java:232)<br />
.... (the rest is unimportant)</p>
<p>This was thrown by the following line in a JSP:</p>
<p>&lt;bean:write name="report" property="exceptionReportId" /&gt;</p>
<p>The problem is that my method getExceptionReportId() returns an int. The struts bean tag library expects all properties to be Strings. So by changing my method to return a String and using Integer.toString, I made it happy.</p>
<p>This presents a real separation-of-concerns problem. A bean should be a dumb data container. It should give you back exactly what you put in, and it should preserve your data types. The restriction that all properties are strings puts formatting into the bean, and therefore makes it specific to the JSP page.</p>
<p>Is there a tag library that separates formatting concerns from beans?</p>
<p>[UPDATE: You can format non-String property values using the bean:write format attribute. For a date, for example, &lt;bean:write name="report" property="reportDate" format="MM/dd/yyyy"/&gt;. Furthermore, to fix the NullPointerException above, I just added an empty format attribute, as in &lt;bean:write name="report" property="exceptionReportId" format="" /&gt;.]</p>
				</div>

				<p class="postmetadata">Posted in <a href="index81ea.html?cat=3" title="View all posts in Error messages" rel="category">Error messages</a>,  <a href="index5b0d.html?cat=12" title="View all posts in Java" rel="category">Java</a> |   <a href="indexcf9a.html?p=248#comments" title="Comment on NullReferenceException while using bean:write">1 Comment &#187;</a></p>

			</div>

				<div class="post">
				<h3 id="post-247"><a href="index8cf0.html?p=247" rel="bookmark" title="Permanent Link to Inversion of Thought">Inversion of Thought</a></h3>
				<small>Monday, June 30th, 2008</small>

				<div class="entry">
					<p>I've started a new project using Spring MVC. In doing so, I've had to invert my thinking.</p>
<p><a href="http://www.theserverside.com/tt/articles/article.tss?l=IntrotoSpring25">Spring</a> is an inversion of control container, which means that you don't code dependencies of one class directly upon another. Instead you put all of your dependencies into one configuration file and keep your code as loosely coupled as possible. This one configuration file creates a graph of objects, each with references to the others. Since the configuration file specifies the classes and references, the code for one class doesn't need to know the names of other classes.</p>
<p><strong>Why is this important?</strong><br />
<a href="http://www.objectmentor.com/resources/articles/dip.pdf">The dependency inversion principle</a> tells us that it is better to depend upon something abstract than something concrete. This helps us to change how something is done without breaking the things that need it to be done. If your code depends upon an interface, you can change the thing that implements that interface without changing your code.</p>
<p>There are other reasons which have come to light since Robert Martin published his paper back in 1996. Dependency inversion makes unit testing easier, because you can replace the components that a unit calls with mock objects. Dependency inversion makes distributed computing easier, because you can replace business objects with proxies that call business logic on remote servers. In general, dependency inversion is a good goal.</p>
<p><strong>How does Spring do it?</strong><br />
So if your class depends upon an interface rather than a concrete class, how does it get a reference to an object that implements that interface? It can't use "new" to create an instance, because "new" needs a concrete class name. To invert dependency, you have to move all of your "new"s into one place. That place is an inversion of control (IoC) container.</p>
<p>Spring reads an XML file that contains a bunch of object descriptions. You can think of each of these as a call to "new". Each one specifies a class name, an instance name, and a set of properties. These are write-once properties (what I like to call <a href="indexdd23.html?p=33">definitive</a>), and should be initialized and never changed. These properties can include references to other object instances, thus forming a graph.</p>
<p><strong>MVC</strong><br />
<a href="http://static.springframework.org/spring/docs/2.0.x/reference/mvc.html">Spring MVC</a> combines the dependency inversion principle with the model-view-controller pattern to create a pretty compelling web framework. The controllers and URL mappings are all configured through the IoC container. The URL mapper has a reference to each of the controllers, so it knows how to delegate the handling of a request. Because dependency has been inverted, the URL mapper doesn't know about the concrete classes that are the controllers, it only knows about an interface. So you can use the out-of-the-box URL mapper with your own custom controllers.</p>
<p>But it just so happens that Spring has a quaint mechanism for database access. In your XML file, you can configure a data source by providing a driver class name and a connection string to an instance of "org.apache.commons.dbcp.BasicDataSource".  Then you can use this data source to execute queries using "org.springframework.jdbc.core.simple.SimpleJdbcTemplate". I wanted to use this technique from my data access layer. However, the XML file that defines the object graph is way up in my web layer. How can I push that object graph, or at least the data source, down through the business logic layer and into the data access layer?</p>
<p><strong>The epiphany</strong><br />
That's when the full realization of dependency inversion hit me. I was thinking about the web layer depending upon the business logic layer, which then depended upon the data access layer. This is not the Spring way. Instead, the web, business logic, and data access layers are all independent. The IoC container depends upon them all. The individual components within these layers only depend upon interfaces.</p>
<p>So the one XML file declares a data source. It then declares a data access component and gives it a reference to the data source. Next comes a business logic component and with a reference to the data access component. Then, the controller with a reference to the business logic component. And finally, the URL mapper comes last with a reference to the controller. As more URLs, controllers, and components are added, this chain widens into a graph.</p>
<p>You can't pick and choose which pieces of your application use dependency inversion. Please don't try. Once you start down the Spring path, all dependencies are inverted. The graph that's defined at the highest layer of your application delves deep into the lowest, and touches all layers in between. Consider dependency inversion for your next project, and think carefully about the consequences.</p>
				</div>

				<p class="postmetadata">Posted in <a href="index1cd2.html?cat=10" title="View all posts in Contracts" rel="category">Contracts</a>,  <a href="index5b0d.html?cat=12" title="View all posts in Java" rel="category">Java</a>,  <a href="indexb0b7.html?cat=6" title="View all posts in Patterns" rel="category">Patterns</a> |   <a href="index8cf0.html?p=247#comments" title="Comment on Inversion of Thought">2 Comments &#187;</a></p>

			</div>

				<div class="post">
				<h3 id="post-244"><a href="index4978.html?p=244" rel="bookmark" title="Permanent Link to Java Query">Java Query</a></h3>
				<small>Monday, May 12th, 2008</small>

				<div class="entry">
					<p>This is not linq for Java, but it does bear a small resemblance. Download the <a href="http://www.adventuresinsoftware.com/blog/wp-content/uploads/2008/05/query.zip" title="query.zip">source code</a> and <a href="http://www.adventuresinsoftware.com/blog/wp-content/uploads/2008/05/query_test.zip" title="unit test">unit test</a>. [Update: One unit test requires the <a href="http://javatuple.com/">Java tuple</a> library.]</p>
<p>If you've ever needed to return an Iterable&lt;T&gt; from a Java method, you know that it can be challenging. If you already have exactly the collection that you want to iterate, then all is well. If not, you have two choices.</p>
<p>Option 1, you could construct a new ArrayList&lt;T&gt;, populate it, and return it. This option is less memory efficient than it could be. But it is by far the easiest way to go. You get to write your iteration code using "for".</p>
<p>Or option 2, you could implement Iterable&lt;T&gt; with an anonymous inner class. Instead of using "for", you'll have to manage the state of your iterator yourself. Basically, you have to turn the looping code inside out and put the initialization, testing, and stepping code in separate methods. However, this saves on memory, as you don't have to store the results in an intermediate collection.</p>
<p>On a number of occasions, I've taken option 2. Having rewritten the same ugly code several times, I decided to generalize it.</p>
<p><strong>Inspiration from C#</strong><br />
Having spent some time in the .NET world, I'm familiar with two ways of solving this problem.</p>
<p>First, C# provides the "yield" keyword for turning a loop inside out. You write the code as per option 1, but instead of adding an object to a collection, you "yield return" it. The compiler turns the code inside out and makes it work like option 2. Yael has an implementation of <a href="http://chaoticjava.com/posts/how-to-write-iterators-really-really-fast/">yield return in java</a>, if you like this approach.</p>
<p>Second, C# now has built-in syntax for querying any data source, including collections of objects. This syntax is called linq, or language integrated query. I didn't want to implement all of the linq functionality in java, but I did use it as a source of inspiration.</p>
<p><strong>From</strong><br />
Linq is like upside-down SQL. The first thing that you write is the "from" clause. This is important for type safety and intellisense. Borrowing from this convention, you start a java query with:</p>
<pre>Query
    .from(collection)</pre>
<p>This returns a Query&lt;T&gt;, which gives you the rest of the methods.</p>
<p><strong>Where</strong><br />
A where clause filters the collection on-the-fly. The iterator that is produced only lands on the items that satisfy the where condition. You specify the condition by anonymously implementing the Predicate interface, as in:</p>
<pre>Query
    .from(collection)
    .where(<span style="color: blue">new</span> Predicate&lt;T&gt;() {
        <span style="color: blue">public</span> <span style="color: blue">boolean</span> where(T row) {
            <span style="color: blue">return</span> <span style="color: green">/* Condition based on row */</span>;
        }
    })</pre>
<p><strong>Join</strong><br />
A join traverses a nested collection. For each object of the first collection, you obtain an iterator over the second. The result is the same as two nested for loops. You return the inner collection using the Relation interface, as in:</p>
<pre>Query
    .from(collection)
    .join(<span style="color: blue">new</span> Relation&lt;PARENT, CHILD&gt; () {
        <span style="color: blue">public</span> Iterable&lt;CHILD&gt; join(PARENT parent) {
            <span style="color: blue">return</span> parent.getChildren();
        }
    })</pre>
<p>This produces an iterator of Join&lt;PARENT, CHILD&gt;.</p>
<p><strong>Select</strong><br />
The last clause in a query is the select. Now that you've built up and narrowed down your collection of objects, the select clause gives you a chance to transform them into the data type that you want. You provide an anonymous implementation of the Selector interface:</p>
<pre>Query
    .from(collection)
    .select(<span style="color: blue">new</span> Selector&lt;T, RESULT&gt;() {
        <span style="color: blue">public</span> RESULT select(T row) {
            <span style="color: blue">return</span> row.getProperty();
        }
    })</pre>
<p>If you want to get the objects themselves, you can simply use ".selectRow()" instead.</p>
<p><strong>Put it all together</strong><br />
You can combine these clauses to create the query you need. It has to start with a "from" and end with a "select", but you can have any combination of "join" and "where" clauses in between. Here's an example from the unit test:</p>
<pre><span style="color: green">// Iterate through the order items. Pull out order numbers where a widget is ordered.</span>
Iterator&lt;Integer&gt; orderNumbers = Query
    .from(customers)
    .join(<span style="color: blue">new</span> Relation&lt;Customer, Order&gt;() {
        <span style="color: blue">public</span> Iterable&lt;Order&gt; join(Customer parent) {
            <span style="color: blue">return</span> parent.getOrders();
        }
    })
    .join(<span style="color: blue">new</span> Relation&lt;Join&lt;Customer,Order&gt;, Item&gt;() {
        <span style="color: blue">public</span> Iterable&lt;Item&gt; join(Join&lt;Customer, Order&gt; parent) {
            <span style="color: blue">return</span> parent.getSecond().getItems();
        }
    })
    .where(<span style="color: blue">new</span> Predicate&lt;Join&lt;Join&lt;Customer,Order&gt;,Item&gt;&gt;() {
        <span style="color: blue">public</span> <span style="color: blue">boolean</span> where(Join&lt;Join&lt;Customer, Order&gt;, Item&gt; row) {
            <span style="color: blue">return</span> row.getSecond().getPart().getName().equals(<span style="color: maroon">"widget"</span>);
        }
    })
    .select(<span style="color: blue">new</span> Selector&lt;Join&lt;Join&lt;Customer,Order&gt;,Item&gt;, Integer&gt;() {
        <span style="color: blue">public</span> Integer select(Join&lt;Join&lt;Customer, Order&gt;, Item&gt; row) {
            <span style="color: blue">return</span> row.getFirst().getSecond().getNumber();
        }
    })
    .iterator();</pre>
<p>Now you can generate iterators on-the-fly without wasting memory or writing really ugly code. Under the covers, it's just doing what a for loop would do. But with a query, you can return the resulting collection to a caller without turning your code inside-out.</p>
				</div>

				<p class="postmetadata">Posted in <a href="index5b0d.html?cat=12" title="View all posts in Java" rel="category">Java</a> |   <a href="index4978.html?p=244#respond" title="Comment on Java Query">No Comments &#187;</a></p>

			</div>

				<div class="post">
				<h3 id="post-112"><a href="index8820.html?p=112" rel="bookmark" title="Permanent Link to Constrained dot-chaining">Constrained dot-chaining</a></h3>
				<small>Thursday, April 26th, 2007</small>

				<div class="entry">
					<p>For my recent XML parsing library -- <a href="index3f5a.html?p=100">DeclarativeXMLParser</a> -- I used a coding technique that I call constrained dot-chaining. This technique is useful for creating structures in code that more concisely express their intent.</p>
<p>Simple dot-chaining is accomplished by declaring methods that end in "return this". For example, StringBuffer in Java and StringBuilder in C# both facilitate dot-chaining by returning "this" from the "append" (or "Append" in C#) method. Thus you can chain a series of method calls as in:</p>
<pre>String greeting = new StringBuffer()
  .append("Hello, ")
  .append(name)
  .append("!")
  .toString();</pre>
<p>Notice the use of the dot at the beginning of the line. As compared to the more typical dot at the end of the line, this lends more symmetry to dot-chained code and works better with intellisense.</p>
<p>Dot-chaining is especially powerful when you pass the resulting object as a parameter. The object can be created and initialized in-line with no semicolon. No variable needs to be declared.</p>
<pre>throw new MyException(new StringBuffer()
  .append("Failed to open  file ")
  .append(fileName)
  .append(": ")
  .append(e.getMessage())
  .toString(), e);</pre>
<p>Constrained dot-chaining is useful when the order of operations should be restricted. For example, in the DeclarativeXMLParser, each element will be initialized before the attributes are matched. The attributes will be matched before the Begin delegate is called. Begin will precede the sub elements, and End will follow all. So you want the code to look like this:</p>
<pre>new Element()
  .Init(delegate() {...})
  .RequiredAttribute("id", idAttribute)
  .IgnoreOtherAttributes()
  .Begin(delegate() {...})
  .One("subElement", new Element()
    .RequiredAttribute("name", nameAttribute)
  )
  .End(delegate() {...});</pre>
<p>Unconstrained dot-chaining would allow these operations to be declared in any order. While that wouldn't confuse the parser engine, this would most certainly confuse anyone reading the code. Constraints are required to force this code to be more readable.</p>
<p><strong>Here's my solution</strong><br />
The Element class is only the leaf of a long line of inherited classes. It directly supplies the Init method, which returns Element. It's base class is ElementWithAttributes, which supplies all of the attribute related methods. ElementWithAttributes in turn inherits ElementWithFilter, which supplies the Filter method, and so on up the hierarchy until you reach ElementWithEnd.</p>
<p>The idea is simple. Once you go up the inheritance hierarchy, you can't go back down. This forces you to call the methods in the prescribed order. Inheritance allows you to skip levels if you want to, but you can't backtrack.</p>
<p>Each level of the hierarchy returns its own type for methods that can be called more than once, and its base class type for methods that can be called only once. So, for example, once you call Begin, you are now at the ElementWithContent level. You cannot call Begin again because you are too high up in the tree.</p>
<p>Download the code for more details. I hope you find this technique as useful as I have.</p>
				</div>

				<p class="postmetadata">Posted in <a href="index8e7f.html?cat=19" title="View all posts in C#" rel="category">C#</a>,  <a href="index5b0d.html?cat=12" title="View all posts in Java" rel="category">Java</a>,  <a href="indexb0b7.html?cat=6" title="View all posts in Patterns" rel="category">Patterns</a> |   <a href="index8820.html?p=112#respond" title="Comment on Constrained dot-chaining">No Comments &#187;</a></p>

			</div>

				<div class="post">
				<h3 id="post-100"><a href="index3f5a.html?p=100" rel="bookmark" title="Permanent Link to Dirt Simple XML Parser">Dirt Simple XML Parser</a></h3>
				<small>Friday, March 30th, 2007</small>

				<div class="entry">
					<p>I know there are already far too many ways to parse XML. <a href="http://support.softartisans.com/kbview.aspx?ID=673">Softartisans</a> has an entire page devoted to choosing which XML parser is best for different situations. But still I find myself facing the same trade-off each time I need to consume an XML document: do I do something simple, or do I do something efficient? DOM is easy, but very costly. SAX is the most efficient, but very difficult to use. Other technologies fall between those two on the spectrum.</p>
<p>I've finally solved that problem once and for all. I created an XML library that makes SAX dirt simple to use. You express an XML document declaratively, putting in hooks to handle elements that interest you. This declaration turns into a DefaultHandler for SAX to invoke. The source code is available in two parts: <a href="http://mallardsoft.com/bin/mallardsoft.xml.zip">mallardsoft.xml</a> depends upon <a href="http://mallardsoft.com/bin/mallardsoft.util.zip">mallardsoft.util</a>.</p>
<p>To build a parser, create a new NestedHandler and initialize it with a new Document. Using in-line dot-chaining, set up sub elements of the Document with new Element objects. Here's a quick example:</p>
<pre>final StringBuffer firstName = new StringBuffer();
final StringBuffer lastName = new StringBuffer();

DefaultHandler handler = new NestedHandler(new Document()
  .one("people", new Element()
    .zeroToMany("person", new Element()
      .init(firstName)
      .init(lastName)
      .optionalAttribute("firstName", firstName)
      .requiredAttribute("lastName", lastName)
      .end(new InvokeHandler() {
        public void handle() throws SAXException {
          newPerson(firstName.toString(), lastName.toString());
        }
      })
    )
  )
);</pre>
<p>Pass this to a SAX parser and it will extract all of the person elements, grab their first and last names, and call the newPerson() method for each one. You can nest elements as deeply as you need to. And if you need a recursive declaration, use an ElementSpec object. Give it a try with a more complex XML file and see how well it scales up.</p>
<p><strong>Update</strong><br />
I've changed the names to better reflect true XML nomenclature. The proper names are not "root" and "node", but "document" and "element".</p>
				</div>

				<p class="postmetadata">Posted in <a href="index5b0d.html?cat=12" title="View all posts in Java" rel="category">Java</a>,  <a href="index4821.html?cat=20" title="View all posts in XML" rel="category">XML</a> |   <a href="index3f5a.html?p=100#comments" title="Comment on Dirt Simple XML Parser">2 Comments &#187;</a></p>

			</div>

				<div class="post">
				<h3 id="post-71"><a href="index6cf3.html?p=71" rel="bookmark" title="Permanent Link to Unhelpful Error Message in Eclipse">Unhelpful Error Message in Eclipse</a></h3>
				<small>Monday, December 18th, 2006</small>

				<div class="entry">
					<p>I'm a big fan of the Eclipse Java IDE. I think it is at least on generation ahead of Microsoft's Visual Studio IDE. However, even Eclipse has some poorly designed features.</p>
<p>Take, for example, the error message infrastructure. Instead of handling errors in useful ways, or better yet just doing the right thing in the first place, they wrap all exceptions and present the same useless UI for everything. Here's an example:</p>
<p><img src="../../www.adventuresinsoftware.com/blog/wp-content/uploads/2006/12/refactoring.jpg" /></p>
<p>The message box tells me that an exception was caught (not helpful), and that the reason was that it encountered a problem (not helpful). It gives me the options of either undoing or aborting the refactoring, which sound a lot like the same thing. Then when I ask for more details, it tells me again that it encountered a problem.</p>
<p>To reproduce this error, you must install the Subclipse plugin to manage a project in Subversion. Delete a package. The package will not actually be deleted, since the change has not been committed to SVN. Then try to move a class into the deleted package. You can see how the separate concerns of Java packages, file systems, source control, and refactoring have all combined to produce a mess of a situation.</p>
				</div>

				<p class="postmetadata">Posted in <a href="index81ea.html?cat=3" title="View all posts in Error messages" rel="category">Error messages</a>,  <a href="index5b0d.html?cat=12" title="View all posts in Java" rel="category">Java</a> |   <a href="index6cf3.html?p=71#respond" title="Comment on Unhelpful Error Message in Eclipse">No Comments &#187;</a></p>

			</div>

				<div class="post">
				<h3 id="post-69"><a href="indexe2dc.html?p=69" rel="bookmark" title="Permanent Link to Lazy Logging">Lazy Logging</a></h3>
				<small>Friday, December 15th, 2006</small>

				<div class="entry">
					<p>I sometimes see coders trying to optimize their logging. Since it takes time to format log messages, they will first test whether logging is enabled:</p>
<pre>Logger log = Logger.getLogger(MyClass.class);
if (log.isInfoEnabled())
    log.info( "Processing customer " + customer.getName() +"." );</pre>
<p>The info() method already checks whether logging is enabled, but this additional check avoids the string concatenation. String formatting and manipulation is surprisingly expensive, so it is undesirable to take this hit only to have no effect.</p>
<p>However, this type of checking is just a distraction. Fortunately, Log4J gives you an option. The parameter to info() is not a String, as you might think by looking at this example code. It is actually an Object. Log4J will call toString() on the object you pass in. Furthermore, it will only call toString() if it really does log the message. We can take advantage of this to clean up our code.</p>
<p><strong>Here's my solution</strong><br />
I've created a class that performs string concatenation and formatting inside of the toString() method. It caches the result so that multiple calls to toString() don't repeat the work. However, if toString() is never called, the expensive operations are never performed. Using this class, the logging code looks like this:</p>
<pre>Logger log = Logger.getLogger(MyClass.class);
log.info( StringFormatter.format("Processing customer {name}.").
    set("name", customer.getName()) );</pre>
<p>Downlaod the source code here: <a id="p68" href="http://www.adventuresinsoftware.com/blog/wp-content/uploads/2006/12/stringformatter.zip">stringformatter.zip</a>.</p>
				</div>

				<p class="postmetadata">Posted in <a href="index5b0d.html?cat=12" title="View all posts in Java" rel="category">Java</a>,  <a href="indexb946.html?cat=5" title="View all posts in Logging" rel="category">Logging</a> |   <a href="indexe2dc.html?p=69#respond" title="Comment on Lazy Logging">No Comments &#187;</a></p>

			</div>

				<div class="post">
				<h3 id="post-43"><a href="index4170.html?p=43" rel="bookmark" title="Permanent Link to Java Tuple">Java Tuple</a></h3>
				<small>Friday, October 20th, 2006</small>

				<div class="entry">
					<blockquote><p><strong>Final Update</strong>The latest code is at <a href="index4cfb.html?p=546">http://adventuresinsoftware.com/blog/?p=546</a>. The javatuple.com site is going off-line.</p></blockquote>
<blockquote><p><strong>Update</strong> I've created a new version of this Java Tuple library. It can be found at <s>http://javatuple.com</s>. The new version uses generics for type safety. It also has extractor methods. If you use Java 1.4 or earlier, or you just prefer the previous version, please read on. Otherwise, visit javatuple.com.</p></blockquote>
<blockquote><p>Thanks.</p></blockquote>
<p>I don't know how many times I've needed a hash map with a compound key, but it seems to come up often. Every time, I am faced with the same question: do I really want to define a class for this key?It's seems like such a simple thing at first. Just a class with a few members. But then you have to initialize those members in the constructor. And then you need to write equals(). And don't forget hashCode(). Sometimes I'm tempted to create a concatenated string to get around the extra baggage. But that would be a hack.To solve this problem, I finally decided to create a Tuple class. A tuple is a an ordered collection of heterogeneous elements. Compare this to a vector, which is homogeneous. The type of a tuple is defined by the number and type of its elements.Examples of tuples that naturally occur in software are parameter lists and database rows. Both of these things have a fixed, finite number of elements that must occur in a certain order. All rows in a table have the same number and types of columns, but one column can have a different type from another. Some languages treat tuples as native data types, but not Java.My Tuple class comes in two pieces. The base class implements all of the comparison behavior. The concrete class lets you build a generic tuple.
<pre>package com.adventuresinsoftware.tuple;import java.util.ArrayList;import java.util.Iterator;public abstract class BaseTuple implements Comparable {    // Ordered collection of elements.    ArrayList elements = new ArrayList();    // Strings used to display the tuple.    String open;    String separator;    String close;    // Initialize the strings for this tuple type.    protected BaseTuple(String open, String separator, String close) {        this.open = open;        this.separator = separator;        this.close = close;    }    // Add elements to the tuple. Supports dot-chaining.    protected BaseTuple addElement(Object o) {        elements.add(o);        return this;    }    protected BaseTuple addElement(int i) {        return addElement(new Integer(i));    }    // Compare two tuples. All elements must be equal.    public boolean equals(Object obj) {        if (obj == null)            return false;        if (!(obj instanceof BaseTuple))            return false;        BaseTuple that = (BaseTuple) obj;        if (that.elements.size() != this.elements.size())            return false;        for (int i = 0; i &lt; elements.size(); ++i) {            if (!that.elements.get(i).equals(this.elements.get(i)))                return false;        }        return true;    }    // Calculate a hash code based on the hash of each element.    public int hashCode() {        int result = 0;        Iterator it = elements.iterator();        while (it.hasNext()) {            result = result * 37 + it.next().hashCode();        }        return result;    }    // Display the tuple using the open, separator, and close    // specified in the constructor.    public String toString() {        StringBuffer result = new StringBuffer(open);        Iterator it = elements.iterator();        while (it.hasNext()) {            result.append(it.next());            if (it.hasNext())                result.append(separator);        }        return result.append(close).toString();    }    // Order by the most significant element first.    // The tuples must agree in size and type.    public int compareTo(Object o) {        BaseTuple that = (BaseTuple) o;        for (int i = 0; i &lt; elements.size(); ++i) {            int compare = ((Comparable) this.elements.get(i))                .compareTo((Comparable) that.elements.get(i));            if (compare != 0)                return compare;        }        return 0;    }}</pre>
<pre>package com.adventuresinsoftware.tuple;public class Tuple extends BaseTuple {    // Display a coma-separated list of elements.    public Tuple() {        super("(", ", ", ")");    }    // Add generic elements to the tuple.    // Supports dot-chaining.    public Tuple add(Object o) {        super.addElement(o);        return this;    }    public Tuple add(int i) {        super.addElement(i);        return this;    }}</pre>
<p>To use a Tuple as a compound HashMap key, just construct one in place using dot-chaining.
<pre>    public void testTupleHashMap() {        Map population = new HashMap();        population.put(            new Tuple().add("TX").add("Dallas"),            new Integer(1213825));        population.put(            new Tuple().add("TX").add("Fort Worth"),            new Integer(624067));        population.put(            new Tuple().add("IL").add("Springfield"),            new Integer(203564));        population.put(            new Tuple().add("NM").add("Albuquerque"),            new Integer(494236));        assertEquals(new Integer(624067), population.get(            new Tuple().add("TX").add("Fort Worth")));        assertNull(population.get(            new Tuple().add("NM").add("Roswell")));        assertNull(population.get(            new Tuple().add("NJ").add("Springfield")));    }</pre>
<p>The Tuple class has a useful toString method.
<pre>    public void testTupleToString() {        Tuple tuple = new Tuple().add("MLB").add(1);        assertEquals( "(MLB, 1)", tuple.toString() );    }</pre>
<p>And if you want to create your own strictly typed tuples, you can declare your own derived class.
<pre>package com.adventuresinsoftware.tuple;public class Version extends BaseTuple {    // A version is a tuple of 4 integers separated by periods.    public Version(int major, int minor, int release, int qfe) {        super("", ".", "");        addElement(major).addElement(minor).addElement(release).addElement(qfe);    }}</pre>
<pre>    public void testVersion() {        Version v1 = new Version(2,0,2,3425);        Version v2 = new Version(2,1,0,241);        assertEquals("2.0.2.3425", v1.toString());        assertEquals("2.1.0.241", v2.toString());        assertTrue("Version 2.1.0.241 &gt; 2.0.2.3425", v2.compareTo(v1) &gt; 0);    }</pre>
<p>Enjoy!</p>
				</div>

				<p class="postmetadata">Posted in <a href="index5b0d.html?cat=12" title="View all posts in Java" rel="category">Java</a> |   <a href="index4170.html?p=43#comments" title="Comment on Java Tuple">43 Comments &#187;</a></p>

			</div>

		
		<div class="navigation">
			<div class="alignleft"></div>
			<div class="alignright"></div>
		</div>

	
	</div>
		</td>
	</tr>
</table>

<hr />
<div id="footer">
<!-- If you'd like to support WordPress, having the "powered by" link someone on your blog is the best way, it's our only promotion or advertising. -->
	<p>
		Adventures in Software is proudly powered by 
		<a href="http://wordpress.org/">WordPress</a>
		<br /><a href="indexd784.html?feed=rss2">Entries (RSS)</a>
		and <a href="indexa6da.html?feed=comments-rss2">Comments (RSS)</a>.
		<!-- 17 queries. 0.876 seconds. -->
	</p>
</div>
<script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
try {
var pageTracker = _gat._getTracker("UA-389401-3");
pageTracker._trackPageview();
} catch(err) {}</script></div>

<!-- Gorgeous design by Michael Heilemann - http://binarybonsai.com/kubrick/ -->

		<div id="sk2-footer" style="color:#FFF; background-color:#444; padding: 3px 2px 3px 2px; border-top: #888 solid 1px;">This blog is protected by <a href="http://unknowngenius.com/blog/" title="Dave">dr Dave</a>'s <strong><a href="http://unknowngenius.com/blog/wordpress/spam-karma/" title="SK2">Spam Karma 2</a></strong>: <strong>274531</strong>  Spams eaten and counting...</div><script type="text/javascript" src="replies.js"></script>
<script type="text/javascript" src="blogger.js"></script>
<script type="text/javascript" src="http://twitter.com/statuses/user_timeline/michaellperry.json?callback=twitterCallback2&amp;count=5"></script>
<script type="text/javascript" src="http://search.twitter.com/search.json?q=@michaellperry&amp;callback=twitterCallbackReplies&amp;rpp=5"></script>
</body>

<!-- Mirrored from adventuresinsoftware.com/blog/?cat=12 by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 13 Jan 2017 12:55:36 GMT -->
</html>
