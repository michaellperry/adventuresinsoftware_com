<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr">


<!-- Mirrored from adventuresinsoftware.com/blog/?cat=38 by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 13 Jan 2017 12:55:50 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- /Added by HTTrack -->
<head profile="http://gmpg.org/xfn/11">
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />

<title>Adventures in Software   &raquo; Commuter</title>

<meta name="generator" content="WordPress 2.3.3" /> <!-- leave this for stats -->

<link rel="stylesheet" href="wp-content/themes/ais2/style.css" type="text/css" media="screen" />
<link rel="alternate" type="application/rss+xml" title="Adventures in Software RSS Feed" href="indexd784.html?feed=rss2" />
<link rel="pingback" href="xmlrpc.html" />
    <script type="text/javascript">
        function onSilverlightError(sender, args) {
            var appSource = "";
            if (sender != null && sender != 0) {
              appSource = sender.getHost().Source;
            }
            
            var errorType = args.ErrorType;
            var iErrorCode = args.ErrorCode;

            if (errorType == "ImageError" || errorType == "MediaError") {
              return;
            }

            var errMsg = "Unhandled Error in Silverlight Application " +  appSource + "\n" ;

            errMsg += "Code: "+ iErrorCode + "    \n";
            errMsg += "Category: " + errorType + "       \n";
            errMsg += "Message: " + args.ErrorMessage + "     \n";

            if (errorType == "ParserError") {
                errMsg += "File: " + args.xamlFile + "     \n";
                errMsg += "Line: " + args.lineNumber + "     \n";
                errMsg += "Position: " + args.charPosition + "     \n";
            }
            else if (errorType == "RuntimeError") {           
                if (args.lineNumber != 0) {
                    errMsg += "Line: " + args.lineNumber + "     \n";
                    errMsg += "Position: " +  args.charPosition + "     \n";
                }
                errMsg += "MethodName: " + args.methodName + "     \n";
            }

            throw new Error(errMsg);
        }
    </script>

	<link rel="EditURI" type="application/rsd+xml" title="RSD" href="xmlrpc0db0.php?rsd" />
 <link rel="wlwmanifest" type="application/wlwmanifest+xml" href="wp-includes/wlwmanifest.xml" /> <style type='text/css'>
<!--#header { background: url('wp-content/themes/ais2/images/header-imgae03.html?upper=A7A73F&amp;lower=77773F') no-repeat bottom center; }
--></style>
</head>
<body>
<div id="page">

<div class="aisTopBar">
	<form method="get" id="searchform" action="http://adventuresinsoftware.com/blog/">
<div>
<a href="indexd784.html?feed=rss2"><img src="../images/feed-icon-28x28.png" border="0"></a>
<input type="text" value="" name="s" id="s" />
<input type="submit" id="searchsubmit" value="Search" />
</div>
</form>
</div>

<div class="aisHeaderImageRight">
	<div class="aisHeaderImage">
	<div class="aisHeaderCornerRight">
	<div class="aisHeaderCornerLeft">
	<div class="aisImageBar">
	<div class="aisSubSites">
		<a href="index.html" class="aisSubSiteLink"><span class="aisSiteTabRight"><span class="aisSiteTabLeft"><span class="aisSiteTab">
			home</span></span></span></a>
		<a class="aisSubSiteLink" href="indexb60a.html?cat=27"><span class="aisSiteTabRight"><span class="aisSiteTabLeft"><span class="aisSiteTab">
			historic modeling</span></span></span></a>
		<a class="aisSubSiteLink" href="indexa88f.html?cat=36"><span class="aisSiteTabRight"><span class="aisSiteTabLeft"><span class="aisSiteTab">
			update controls</span></span></span></a>
		<a href="index2d79.html?cat=26" class="aisSubSiteLink"><span class="aisSiteTabRight"><span class="aisSiteTabLeft"><span class="aisSiteTab">
			degrees of freedom</span></span></span></a>
		<a class="aisSubSiteLink" href="indexba53.html?page_id=2"><span class="aisSiteTabRight"><span class="aisSiteTabLeft"><span class="aisSiteTab">
			about us</span></span></span></a>

	</div>
	</div>
	</div>
	</div>
	</div>
</div>

<table style="width: 100%" cellspacing="0" cellpadding="0">
	<tr valign="top">
		<td width="210px">
<div id="sidebar">
<div class="aisLeftColumnFill">
<div class="aisLeftColumnBottom">
<div class="aisLeftColumnTop">
<div id="twitter_div" class="aisLeftNav">
<h2 class="sidebar-title">Twitter Updates</h2>
<ul id="twitter_update_list"></ul>
<a href="http://twitter.com/michaellperry" id="follow">Follow me</a>
</div>
<div id="twitter_reply_div" class="aisLeftNav">
<h2 class="sidebar-title">Twitter Replies</h2>
<ul id="twitter_reply_list"></ul>
</div>

<div class="aisLeftNav">
<a href='http://ineta.org/Speakers/SearchCommunitySpeakers.aspx?SpeakerId=c5110e21-9243-461b-a464-a6548524e885'><img alt='INETA Community Speakers Program' border='0' src='../../www.ineta.org/images/OfficialLogos/InetaCommunitySpeakersRequestMe.html' /></a>
</div>

<div class="aisLeftNav">
	<li class="pagenav"><h2>Pages</h2><ul><li class="page_item page-item-2"><a href="indexba53.html?page_id=2" title="About Us">About Us</a></li>
<li class="page_item page-item-210"><a href="index6ae3.html?page_id=210" title="Templates">Templates</a></li>
</ul></li></div>

<div class="aisLeftNav">
<h2>Archives</h2>
<ul>
	<li><a href='indexb4d5.html?m=201110' title='October 2011'>October 2011</a></li>
	<li><a href='indexc61a.html?m=201106' title='June 2011'>June 2011</a></li>
	<li><a href='indexa80d.html?m=201105' title='May 2011'>May 2011</a></li>
	<li><a href='index512b.html?m=201104' title='April 2011'>April 2011</a></li>
	<li><a href='index08fb.html?m=201103' title='March 2011'>March 2011</a></li>
	<li><a href='index52f4.html?m=201102' title='February 2011'>February 2011</a></li>
	<li><a href='index74f1.html?m=201101' title='January 2011'>January 2011</a></li>
	<li><a href='index8956.html?m=201012' title='December 2010'>December 2010</a></li>
	<li><a href='indexa1aa.html?m=201011' title='November 2010'>November 2010</a></li>
	<li><a href='indexe3d5.html?m=201010' title='October 2010'>October 2010</a></li>
	<li><a href='index9ab9.html?m=201009' title='September 2010'>September 2010</a></li>
	<li><a href='index1ff0.html?m=201008' title='August 2010'>August 2010</a></li>
	<li><a href='index9f11.html?m=201007' title='July 2010'>July 2010</a></li>
	<li><a href='index31f0.html?m=201006' title='June 2010'>June 2010</a></li>
	<li><a href='indexd189.html?m=201005' title='May 2010'>May 2010</a></li>
	<li><a href='indexb5c0.html?m=201004' title='April 2010'>April 2010</a></li>
	<li><a href='indexf258.html?m=201003' title='March 2010'>March 2010</a></li>
	<li><a href='index6e30.html?m=201002' title='February 2010'>February 2010</a></li>
	<li><a href='index6b19.html?m=201001' title='January 2010'>January 2010</a></li>
	<li><a href='index5c0a.html?m=200912' title='December 2009'>December 2009</a></li>
	<li><a href='index8f62.html?m=200911' title='November 2009'>November 2009</a></li>
	<li><a href='index451d.html?m=200910' title='October 2009'>October 2009</a></li>
	<li><a href='index3e04.html?m=200909' title='September 2009'>September 2009</a></li>
	<li><a href='index425a.html?m=200908' title='August 2009'>August 2009</a></li>
	<li><a href='index9907.html?m=200907' title='July 2009'>July 2009</a></li>
	<li><a href='index3104.html?m=200906' title='June 2009'>June 2009</a></li>
	<li><a href='indexc36d.html?m=200905' title='May 2009'>May 2009</a></li>
	<li><a href='index17e8.html?m=200904' title='April 2009'>April 2009</a></li>
	<li><a href='index10a5.html?m=200903' title='March 2009'>March 2009</a></li>
	<li><a href='index8988.html?m=200902' title='February 2009'>February 2009</a></li>
	<li><a href='index1419.html?m=200901' title='January 2009'>January 2009</a></li>
	<li><a href='index7866.html?m=200812' title='December 2008'>December 2008</a></li>
	<li><a href='index55f6.html?m=200811' title='November 2008'>November 2008</a></li>
	<li><a href='indexa7bc.html?m=200810' title='October 2008'>October 2008</a></li>
	<li><a href='indexe77c.html?m=200809' title='September 2008'>September 2008</a></li>
	<li><a href='indexcffc.html?m=200808' title='August 2008'>August 2008</a></li>
	<li><a href='index0e62.html?m=200807' title='July 2008'>July 2008</a></li>
	<li><a href='indexfda7.html?m=200806' title='June 2008'>June 2008</a></li>
	<li><a href='index7d64.html?m=200805' title='May 2008'>May 2008</a></li>
	<li><a href='index94dd.html?m=200804' title='April 2008'>April 2008</a></li>
	<li><a href='index9631.html?m=200803' title='March 2008'>March 2008</a></li>
	<li><a href='indexdd52.html?m=200802' title='February 2008'>February 2008</a></li>
	<li><a href='index21ee.html?m=200801' title='January 2008'>January 2008</a></li>
	<li><a href='index363c.html?m=200712' title='December 2007'>December 2007</a></li>
	<li><a href='index7493.html?m=200711' title='November 2007'>November 2007</a></li>
	<li><a href='index93a7.html?m=200710' title='October 2007'>October 2007</a></li>
	<li><a href='index4ca8.html?m=200709' title='September 2007'>September 2007</a></li>
	<li><a href='index6124.html?m=200708' title='August 2007'>August 2007</a></li>
	<li><a href='index6013.html?m=200707' title='July 2007'>July 2007</a></li>
	<li><a href='index2ab6.html?m=200706' title='June 2007'>June 2007</a></li>
	<li><a href='index44f0.html?m=200705' title='May 2007'>May 2007</a></li>
	<li><a href='indexf0b4.html?m=200704' title='April 2007'>April 2007</a></li>
	<li><a href='index481d.html?m=200703' title='March 2007'>March 2007</a></li>
	<li><a href='indexcbea.html?m=200702' title='February 2007'>February 2007</a></li>
	<li><a href='index9cdc.html?m=200701' title='January 2007'>January 2007</a></li>
	<li><a href='index3ea4.html?m=200612' title='December 2006'>December 2006</a></li>
	<li><a href='index67ca.html?m=200611' title='November 2006'>November 2006</a></li>
	<li><a href='indexff49.html?m=200610' title='October 2006'>October 2006</a></li>
	<li><a href='index611c.html?m=200609' title='September 2006'>September 2006</a></li>
	<li><a href='index9a21.html?m=200608' title='August 2006'>August 2006</a></li>
	<li><a href='index3ee9.html?m=200607' title='July 2006'>July 2006</a></li>
	<li><a href='indexe13a.html?m=200606' title='June 2006'>June 2006</a></li>
</ul>
</div>

<div class="aisLeftNav">
	</div>

<div class="aisLeftNav">
<h2>Books</h2>
<iframe src="http://rcm.amazon.com/e/cm?t=adventures0d2-20&amp;o=1&amp;p=8&amp;l=as1&amp;asins=0764526413&amp;fc1=000000&amp;IS2=1&amp;lt1=_blank&amp;lc1=0000ff&amp;bc1=000000&amp;bg1=ffffff&amp;f=ifr" style="width:120px;height:240px;" scrolling="no" marginwidth="0" marginheight="0" frameborder="0" name="I5" id="I5"></iframe>
<br/>
<iframe src="http://rcm.amazon.com/e/cm?t=adventures0d2-20&amp;o=1&amp;p=8&amp;l=as1&amp;asins=0201633612&amp;fc1=000000&amp;IS2=1&amp;lt1=_blank&amp;lc1=0000ff&amp;bc1=000000&amp;bg1=ffffff&amp;f=ifr" style="width:120px;height:240px;" scrolling="no" marginwidth="0" marginheight="0" frameborder="0" name="I6" id="I6"></iframe>
<br/>
<iframe src="http://rcm.amazon.com/e/cm?t=adventures0d2-20&amp;o=1&amp;p=8&amp;l=as1&amp;asins=0136291554&amp;fc1=000000&amp;IS2=1&amp;lt1=_blank&amp;lc1=0000ff&amp;bc1=000000&amp;bg1=ffffff&amp;f=ifr" style="width:120px;height:240px;" scrolling="no" marginwidth="0" marginheight="0" frameborder="0" name="I7" id="I7"></iframe>
<br/>
<iframe src="http://rcm.amazon.com/e/cm?t=adventures0d2-20&amp;o=1&amp;p=8&amp;l=as1&amp;asins=1888009195&amp;fc1=000000&amp;IS2=1&amp;lt1=_blank&amp;lc1=0000ff&amp;bc1=000000&amp;bg1=ffffff&amp;f=ifr" style="width:120px;height:240px;" scrolling="no" marginwidth="0" marginheight="0" frameborder="0" name="I8" id="I8"></iframe>
</div>
<div class="aisLeftNav">
<h2>Meta</h2>
<ul>
		<li><a href="wp-login.html">Login</a></li>
	<li><a href="http://validator.w3.org/check/referer" title="This page validates as XHTML 1.0 Transitional">Valid <abbr title="eXtensible HyperText Markup Language">XHTML</abbr></a></li>
	<li><a href="http://gmpg.org/xfn/"><abbr title="XHTML Friends Network">XFN</abbr></a></li>
	<li><a href="http://wordpress.org/" title="Powered by WordPress, state-of-the-art semantic personal publishing platform.">WordPress</a></li>
	</ul>
</div>
<div class="aisLeftContent">
<h2>Community</h2>
<ul>
	<script type="text/javascript" src="../../localhost/embed/92q2bbma.js"></script>
</ul>
</div>

</div></div></div>
</div>		</td>
		<td>

	<div id="content" class="narrowcolumn">

		
		 		<h2 class="pagetitle">Archive for the &#8216;Commuter&#8217; Category</h2>

 	  

		<div class="navigation">
			<div class="alignleft"></div>
			<div class="alignright"></div>
		</div>

				<div class="post">
				<h3 id="post-491"><a href="index87e8.html?p=491" rel="bookmark" title="Permanent Link to Commuter launch">Commuter launch</a></h3>
				<small>Wednesday, April 7th, 2010</small>

				<div class="entry">
					<p>I have officially launched <a href="http://www.facetedworlds.com/commuter/">Commuter</a>, a podcast playlist manager for iTunes. Commuter finds all of your podcast subscriptions and builds a continuous playlist of episodes. Listen to the playlist on your way to work. Dock your iPod when you get home.</p>
<p><a href="http://www.facetedworlds.com/commuter/"><img style="border-bottom: 0px; border-left: 0px; display: block; float: none; margin-left: auto; border-top: 0px; margin-right: auto; border-right: 0px" title="commuter" border="0" alt="commuter" src="wp-content/uploads/2010/04/commuter.jpg" width="784" height="377" /></a> </p>
<p>I started this project almost a year ago. Along the way, I have learned WPF, enhanced <a href="http://updatecontrols.codeplex.com/">Update Controls</a>, and built <a href="http://correspondence.codeplex.com/">Correspondence</a> to support this application. Here are some of the stories from the journey.</p>
<ul>
<li><a href="indexc2ef.html?p=342">Modeling an iTunes application</a></li>
<li><a href="index50ca.html?p=345">The Commuter View Model</a></li>
<li><a href="indexcaf0.html?p=359">How to draw a car in Expression Blend</a></li>
<li><a href="index18ee.html?p=365">A View Model based approach to star ratings</a></li>
<li><a href="index264a.html?p=376">Structure of a WPF view</a></li>
<li><a href="indexa9ab.html?p=393">Multi-threaded view model using Update Controls</a></li>
</ul>
<p>There is still much to say about what I’ve learned from working on this application. Be expecting posts about inertial navigation, 3D modeling in WPF, and synchronization.</p>
				</div>

				<p class="postmetadata">Posted in <a href="indexc733.html?cat=38" title="View all posts in Commuter" rel="category">Commuter</a> |   <a href="index87e8.html?p=491#respond" title="Comment on Commuter launch">No Comments &#187;</a></p>

			</div>

				<div class="post">
				<h3 id="post-393"><a href="indexa9ab.html?p=393" rel="bookmark" title="Permanent Link to Multi-threaded view model using Update Controls">Multi-threaded view model using Update Controls</a></h3>
				<small>Wednesday, June 10th, 2009</small>

				<div class="entry">
					<p>Multithreaded programming doesn't have to be hard. You just need to learn a few patterns.</p>
<p>Here's a common problem. How do you notify the UI thread that something has changed on a background thread? The INotifyPropertyChanged contract requires that the PropertyChanged event be fired on the UI thread. There are <a href="http://leecampbell.blogspot.com/2009/02/responsive-wpf-user-interfaces-part-3.html">ways</a> of marshalling that event from the background to the foreground, but wouldn't it be nice if you didn't have to?</p>
<p><a href="http://updatecontrols.net/">Update Controls</a> takes care of this problem for you. You make sure your code is thread-safe, and Update Controls will make sure that dependents are updated, no matter what thread they are on.</p>
<p><strong>A thread-safe model</strong><br />
For Update Controls to work properly -- and indeed for your entire application to work properly -- you need your data model to be thread safe. That means that anything that can change is protected with a lock. If it can change (and you are using Update Controls), then it should have an <a href="http://updatecontrols.net/documentation/classDocumentation/cs/UpdateControls.Independent.do">Independent</a> sentry. Just be sure to call OnGet and OnSet inside the lock.</p>
<pre><span style="color: blue">public</span> <span style="color: blue">class</span> Playlist
{
    <span style="color: blue">private</span> <span style="color: blue">int</span> _id;
    <span style="color: blue">private</span> <span style="color: blue">string</span> _name;

    <span style="color: blue">public</span> Playlist(<span style="color: blue">int</span> id)
    {
        _id = id;
    }

    <span style="color: blue">public</span> <span style="color: blue">int</span> ID
    {
        <span style="color: blue">get</span> { <span style="color: blue">return</span> _id; }
    }

    <span style="color: blue">#region</span> Independent properties
    <span style="color: green">// Generated by Update Controls --------------------------------</span>
    <span style="color: blue">private</span> Independent _indName = <span style="color: blue">new</span> Independent();

    <span style="color: blue">public</span> <span style="color: blue">string</span> Name
    {
        <span style="color: blue">get</span>
        {
            <span style="color: blue">lock</span> (<span style="color: blue">this</span>)
            {
                _indName.OnGet();
                <span style="color: blue">return</span> _name;
            }
        }
        <span style="color: blue">set</span>
        {
            <span style="color: blue">lock</span> (<span style="color: blue">this</span>)
            {
                _indName.OnSet();
                _name = value;
            }
        }
    }
    <span style="color: green">// End generated code --------------------------------</span>
    <span style="color: blue">#endregion</span>
}</pre>
<p>When dealing with collections, we need to be a little careful. If you return an IEnumerable that traverses a collection, that IEnumerable will leave the lock. This will cause problems, as another thread can come in and modify the collection while you are traversing it. To be safe, we need to create a copy of the collection within the lock.</p>
<pre><span style="color: blue">public</span> <span style="color: blue">class</span> MusicLibrary
{
    <span style="color: blue">private</span> List&lt;Playlist&gt; _playlists = <span style="color: blue">new</span> List&lt;Playlist&gt;();

    <span style="color: blue">#region</span> Independent properties
    <span style="color: green">// Generated by Update Controls --------------------------------</span>
    <span style="color: blue">private</span> Independent _indPlaylists = <span style="color: blue">new</span> Independent();

    <span style="color: blue">public</span> Playlist GetPlaylist(<span style="color: blue">int</span> playlistID)
    {
        <span style="color: blue">lock</span> (<span style="color: blue">this</span>)
        {
            <span style="color: green">// This method changes the list.</span>
            _indPlaylists.OnSet();

            <span style="color: green">// See if we already have this one.</span>
            Playlist playlist = _playlists.Where(p =&gt; p.ID == playlistID).FirstOrDefault();
            <span style="color: blue">if</span> (playlist != <span style="color: blue">null</span>)
                <span style="color: blue">return</span> playlist;

            <span style="color: green">// If not, create it.</span>
            playlist = <span style="color: blue">new</span> Playlist(playlistID);
            _playlists.Add(playlist);
            <span style="color: blue">return</span> playlist;
        }
    }

    <span style="color: blue">public</span> <span style="color: blue">void</span> DeletePlaylist(Playlist playlist)
    {
        <span style="color: blue">lock</span> (<span style="color: blue">this</span>)
        {
            _indPlaylists.OnSet();
            _playlists.Remove(playlist);
        }
    }

    <span style="color: blue">public</span> IEnumerable&lt;Playlist&gt; Playlists
    {
        <span style="color: blue">get</span>
        {
            <span style="color: blue">lock</span> (<span style="color: blue">this</span>)
            {
                _indPlaylists.OnGet();
                <span style="color: green">// Return a copy of the list so that it can be accessed in a</span>
                <span style="color: green">// thread-safe manner.</span>
                <span style="color: blue">return</span> <span style="color: blue">new</span> List&lt;Playlist&gt;(_playlists);
            }
        }
    }
    <span style="color: green">// End generated code --------------------------------</span>
    <span style="color: blue">#endregion</span>
}</pre>
<p>With this, your model is safe to access from multiple threads. So let's create one.</p>
<p><strong>Create a thread to communicate with external systems</strong><br />
The UI thread is for the user. If you use it to communicate with external systems, it might hang. Then the user will have to decide whether to "Continue Waiting" or "Switch To...". Switch to what, a Mac? But seriously, it's better if you spawn a new thread to do all of your communication with external systems.</p>
<p>Commuter communicates with iTunes. So I created a separate thread to synchronize between iTunes and my data model. It wakes up every 10 seconds and refreshes the playlists.</p>
<pre><span style="color: blue">public</span> <span style="color: blue">class</span> ITunesSynchronizationService
{
    <span style="color: blue">private</span> MusicLibrary _musicLibrary;
    <span style="color: blue">private</span> Thread _thread;
    <span style="color: blue">private</span> ManualResetEvent _stop;
    <span style="color: blue">private</span> <span style="color: blue">bool</span> _first = <span style="color: maroon">true</span>;

    <span style="color: blue">private</span> <span style="color: blue">string</span> _lastError = <span style="color: blue">string</span>.Empty;
    <span style="color: blue">private</span> Independent _indLastError = <span style="color: blue">new</span> Independent();

    <span style="color: blue">public</span> ITunesSynchronizationService(MusicLibrary musicLibrary)
    {
        _musicLibrary = musicLibrary;
        _thread = <span style="color: blue">new</span> Thread(ThreadProc);
        _thread.Name = <span style="color: maroon">"iTunes synchronization service"</span>;
        _stop = <span style="color: blue">new</span> ManualResetEvent(<span style="color: maroon">false</span>);
    }

    <span style="color: blue">public</span> <span style="color: blue">void</span> Start()
    {
        _thread.Start();
    }

    <span style="color: blue">public</span> <span style="color: blue">void</span> Stop()
    {
        _stop.Set();

        <span style="color: green">// Give it 30 seconds to shut down.</span>
        _thread.Join(<span style="color: maroon">30000</span>);
    }

    <span style="color: blue">public</span> <span style="color: blue">string</span> LastError
    {
        <span style="color: blue">get</span>
        {
            <span style="color: blue">lock</span> (<span style="color: blue">this</span>)
            {
                _indLastError.OnGet();
                <span style="color: blue">return</span> _lastError;
            }
        }

        <span style="color: blue">private</span> <span style="color: blue">set</span>
        {
            <span style="color: blue">lock</span> (<span style="color: blue">this</span>)
            {
                _indLastError.OnSet();
                _lastError = value;
            }
        }
    }

    <span style="color: blue">private</span> <span style="color: blue">void</span> ThreadProc()
    {
        <span style="color: blue">while</span> (ShouldContinue())
        {
            <span style="color: blue">try</span>
            {
                <span style="color: green">// Connect to iTunes.</span>
                iTunesApp itApp = <span style="color: blue">new</span> iTunesAppClass();

                <span style="color: green">// List all of the playlists.</span>
                List&lt;Playlist&gt; oldPlaylists = _musicLibrary.Playlists.ToList();
                <span style="color: blue">foreach</span> (IITUserPlaylist itPlaylist <span style="color: blue">in</span> itApp.LibrarySource.Playlists.OfType&lt;IITUserPlaylist&gt;())
                {
                    <span style="color: blue">string</span> name = itPlaylist.Name;
                    Playlist playlist = _musicLibrary.GetPlaylist(itPlaylist.playlistID);
                    <span style="color: blue">if</span> (name != <span style="color: blue">null</span> &amp;&amp; playlist.Name != name)
                        playlist.Name = name;
                    oldPlaylists.Remove(playlist);
                }

                <span style="color: green">// Delete all that are no longer in iTunes.</span>
                <span style="color: blue">foreach</span> (Playlist playlist <span style="color: blue">in</span> oldPlaylists)
                    _musicLibrary.DeletePlaylist(playlist);

                LastError = <span style="color: blue">string</span>.Empty;
            }
            <span style="color: blue">catch</span> (Exception ex)
            {
                LastError = ex.Message;
            }
        }
    }
    <span style="color: blue">private</span> <span style="color: blue">bool</span> ShouldContinue()
    {
        <span style="color: green">// Don't wait the first time.</span>
        <span style="color: blue">if</span> (_first)
        {
            _first = <span style="color: maroon">false</span>;
            <span style="color: blue">return</span> <span style="color: maroon">true</span>;
        }

        <span style="color: green">// Wake up every 10 seconds, or when the thread should stop.</span>
        <span style="color: blue">return</span> !_stop.WaitOne(<span style="color: maroon">10000</span>);
    }
}</pre>
<p>Notice the LastError property. This is a thread-safe way for the service to communicate its status with the user. This property is bound to a TextBlock on the UI.</p>
<p>The iTunes synchronization service makes changes directly to the data model. Because the data model is thread-safe, the UI thread and the background thread can share this resource. Update Controls will notify the UI thread whenever the background thread changes the data model.</p>
<p><strong>Try it out</strong><br />
<a href="wp-content/uploads/2009/06/commuter.zip" title="commuter.zip">Download the code</a>. When you run Commuter, it will launch iTunes. Even as iTunes launches, the Commuter user interface is responsive. If you are fast enough, you can open the Playlist drop-down before it is populated. But even if COM is faster than the mouse, you can try a few experiments.</p>
<p>Select a playlist in Commuter. Then switch to iTunes and rename that playlist. Within 10 seconds you'll see the selected playlist's name change.</p>
<p>Bring iTunes to the front, but leave Commuter visible underneath it. Place your mouse on the drop-down. Press Ctrl+N to create a new playlist, then click the mouse to bring Commuter to the front and open the drop-down. Within 10 seconds, "untitled playlist" will appear in the list.</p>
<p>Multi-threaded programming still requires some care, but Update Controls can at least take care of updating the UI when the background thread changes the data model.</p>
				</div>

				<p class="postmetadata">Posted in <a href="indexc733.html?cat=38" title="View all posts in Commuter" rel="category">Commuter</a>,  <a href="indexa88f.html?cat=36" title="View all posts in Update Controls" rel="category">Update Controls</a> |   <a href="indexa9ab.html?p=393#respond" title="Comment on Multi-threaded view model using Update Controls">No Comments &#187;</a></p>

			</div>

				<div class="post">
				<h3 id="post-376"><a href="index264a.html?p=376" rel="bookmark" title="Permanent Link to Structure of a WPF view">Structure of a WPF view</a></h3>
				<small>Friday, June 5th, 2009</small>

				<div class="entry">
					<p><a href="wp-content/uploads/2009/06/commuter-view-in-blend.png"><img style="border-right: 0px; border-top: 0px; border-left: 0px; border-bottom: 0px" height="455" alt="Commuter View in Blend" src="wp-content/uploads/2009/06/commuter-view-in-blend-thumb.png" width="579" align="right" border="0"></a> The <a href="index50ca.html?p=345">Commuter View Model interface</a> is written. The next step is to hook it to a view.</p>
<p>I like to think of the view as just a convenience. If the user could access properties directly, all they would need is the View Model interface. Thinking about the View Model this way helps me ensure that it is complete and targeted.</p>
<p>So I created the interface as a way of describing what would be on the view. A designer given the interface and a wireframe could build a view. Not having a designer handy, I did it myself. Here's how.</p>
<p><strong>Create a mock</strong><br />The first step was to create a mock implementation of the View Model interface. In truth, it's not just one interface; it's a set of interrelated interfaces. So I have interrelated mocks. Most of them are simple data access objects: collections of properties with no behavior. Create a read/write property for every property of the interface, even if the interface property is read-only. So for the IPodcastEpisode interface:</p>
<pre><span style="color: blue">public</span> <span style="color: blue">interface</span> IPodcastEpisode
{
    <span style="color: blue">string</span> Name { <span style="color: blue">get</span>; }
    <span style="color: blue">string</span> PodcastName { <span style="color: blue">get</span>; }
    <span style="color: blue">string</span> DurationAsString { <span style="color: blue">get</span>; }
}
</pre>
<p>I created a PodcastEpisodeSample class:</p>
<pre><span style="color: blue">public</span> <span style="color: blue">class</span> PodcastEpisodeSample : IPodcastEpisode
{
    <span style="color: blue">public</span> <span style="color: blue">string</span> Name { <span style="color: blue">get</span>; <span style="color: blue">set</span>; }
    <span style="color: blue">public</span> <span style="color: blue">string</span> PodcastName { <span style="color: blue">get</span>; <span style="color: blue">set</span>; }
    <span style="color: blue">public</span> <span style="color: blue">string</span> DurationAsString { <span style="color: blue">get</span>; <span style="color: blue">set</span>; }
}
</pre>
<p>The root class has a little more to it. It has to initialize itself and its children in its constructor. I don't like putting code in a constructor, but you don't have another chance to set your properties.</p>
<pre><span style="color: blue">public</span> <span style="color: blue">class</span> CommuterViewModelSample : ICommuterViewModel
{
    <span style="color: blue">public</span> CommuterViewModelSample()
    {
        <span style="color: green">// Set up some sample data.</span>
        List&lt;IPlaylist&gt; playlists = <span style="color: blue">new</span> List&lt;IPlaylist&gt;();
        playlists.Add(<span style="color: blue">new</span> PlaylistSample() { Name = <span style="color: maroon">"Favorites"</span> });
        PlaylistSample commutePlaylist = <span style="color: blue">new</span> PlaylistSample() { Name = <span style="color: maroon">"Commute"</span> };
        playlists.Add(commutePlaylist);
        playlists.Add(<span style="color: blue">new</span> PlaylistSample() { Name = <span style="color: maroon">"Energy Songs"</span> });
        Playlists = playlists;
        SelectedPlaylist = commutePlaylist;

        List&lt;IPodcast&gt; podcasts = <span style="color: blue">new</span> List&lt;IPodcast&gt;();
        podcasts.Add(<span style="color: blue">new</span> PodcastViewModel(<span style="color: blue">new</span> Podcast() { Name = <span style="color: maroon">".NET Rocks!"</span>, Selected = <span style="color: maroon">false</span>, Rank = <span style="color: maroon">0</span> }));
        podcasts.Add(<span style="color: blue">new</span> PodcastViewModel(<span style="color: blue">new</span> Podcast() { Name = <span style="color: maroon">"Hanselminutes"</span>, Selected = <span style="color: maroon">true</span>, Rank = <span style="color: maroon">3</span> }));
        podcasts.Add(<span style="color: blue">new</span> PodcastViewModel(<span style="color: blue">new</span> Podcast() { Name = <span style="color: maroon">"Deep Fried Bytes"</span>, Selected = <span style="color: maroon">true</span>, Rank = <span style="color: maroon">4</span> }));
        podcasts.Add(<span style="color: blue">new</span> PodcastViewModel(<span style="color: blue">new</span> Podcast() { Name = <span style="color: maroon">"They Might Be Giants"</span>, Selected = <span style="color: maroon">true</span>, Rank = <span style="color: maroon">5</span> }));
        Podcasts = podcasts;

        List&lt;IPodcastEpisode&gt; queue = <span style="color: blue">new</span> List&lt;IPodcastEpisode&gt;();
        queue.Add(<span style="color: blue">new</span> PodcastEpisodeSample() { Name = <span style="color: maroon">"5-A"</span>, PodcastName = <span style="color: maroon">"They Might Be Giants"</span>, DurationAsString = <span style="color: maroon">"9:30"</span> });
        queue.Add(<span style="color: blue">new</span> PodcastEpisodeSample() { Name = <span style="color: maroon">"JavaFX and the Web's Four Virtual Machines"</span>, PodcastName = <span style="color: maroon">"Hanselminutes"</span>, DurationAsString = <span style="color: maroon">"40:24"</span> });
        PodcastEpisodeSample deepFriedBytesEpisode = <span style="color: blue">new</span> PodcastEpisodeSample() { Name = <span style="color: maroon">"New Ideas for the Web with Thomas Krotkiewski"</span>, PodcastName = <span style="color: maroon">"Deep Fried Bytes"</span>, DurationAsString = <span style="color: maroon">"53:15"</span> };
        queue.Add(deepFriedBytesEpisode);
        Queue = queue;
        SelectedEpisode = deepFriedBytesEpisode;

        TotalDurationAsString = <span style="color: maroon">"1:43:09"</span>;
    }

    <span style="color: blue">public</span> IEnumerable&lt;IPlaylist&gt; Playlists { <span style="color: blue">get</span>; <span style="color: blue">set</span>; }
    <span style="color: blue">public</span> IPlaylist SelectedPlaylist { <span style="color: blue">get</span>; <span style="color: blue">set</span>; }
    <span style="color: blue">public</span> IEnumerable&lt;IPodcast&gt; Podcasts { <span style="color: blue">get</span>; <span style="color: blue">set</span>; }
    <span style="color: blue">public</span> IEnumerable&lt;IPodcastEpisode&gt; Queue { <span style="color: blue">get</span>; <span style="color: blue">set</span>; }
    <span style="color: blue">public</span> IPodcastEpisode SelectedEpisode { <span style="color: blue">get</span>; <span style="color: blue">set</span>; }
    <span style="color: blue">public</span> <span style="color: blue">string</span> TotalDurationAsString { <span style="color: blue">get</span>; <span style="color: blue">set</span>; }
    <span style="color: blue">public</span> ICommand Skip { <span style="color: blue">get</span>; <span style="color: blue">set</span>; }
}
</pre>
<p>You can hook up the mock in Blend. In the Window's properties, press the "New" button next to DataContext. Select the CommuterViewModelSample class from the solution. Now Blend will show the data from your mock object while you edit the view.</p>
<p><strong>Overall structure: Grid</strong><br />The structure of the Window itself is defined by a Grid. Grid is the best container for a window, because it supports "star" sizing. You can be specific about the size of some components, and then leave the rest of the real estate to be carved up proportionally. A Grid is the default layout root that Blend puts into a window, but if you have something else there (like a StackPanel for example), you can right-click on it and select "Change Layout Type".</p>
<p>Select the Grid in the object pane (where you right-clicked to change the layout type) and expand the layout properties. Hit the ellipsis button to set the RowDefinitions property. For Commuter I added 8 rows. I set the height of all but one to "Auto"; the remaining one I left at "1 Star". This one row will resize with the windows, and the others will be the height of their contents.</p>
<p>I populated the rows with controls, alternating between TextBlocks for labels and other controls for inputs. To tell you the truth, it was easier to drop into XML for this part. If you've set the row sizes to "Auto", then there is no space into which to drop controls. And if you haven't you spend a lot of time resetting Margin, HorizontalAlignment, and VerticalAlignment after you drag a control into the right row. Here's the structure so far.</p>
<pre><span style="color: blue">&lt;</span><span style="color: maroon">Window</span>
    <span style="color: red">xmlns</span>="<span style="color: blue">http://schemas.microsoft.com/winfx/2006/xaml/presentation</span>"
    <span style="color: red">xmlns:x</span>="<span style="color: blue">http://schemas.microsoft.com/winfx/2006/xaml</span>"
    <span style="color: red">x:Class</span>="<span style="color: blue">Commuter.Window1</span>"
    <span style="color: red">Title</span>="<span style="color: blue">Commuter</span>" <span style="color: red">Height</span>="<span style="color: blue">420</span>" <span style="color: red">Width</span>="<span style="color: blue">540</span>" <span style="color: red">xmlns:d</span>="<span style="color: blue">http://schemas.microsoft.com/expression/blend/2008</span>" <span style="color: red">xmlns:mc</span>="<span style="color: blue">http://schemas.openxmlformats.org/markup-compatibility/2006</span>" <span style="color: red">mc:Ignorable</span>="<span style="color: blue">d</span>" <span style="color: red">xmlns:Commuter</span>="<span style="color: blue">clr-namespace:Commuter</span>"<span style="color: blue">&gt;</span>
	<span style="color: blue">&lt;</span><span style="color: maroon">Window.DataContext</span><span style="color: blue">&gt;</span>
		<span style="color: blue">&lt;</span><span style="color: maroon">Commuter:CommuterViewModelSample/</span><span style="color: blue">&gt;</span>
	<span style="color: blue">&lt;</span>/<span style="color: maroon">Window.DataContext</span><span style="color: blue">&gt;</span>
    <span style="color: blue">&lt;</span><span style="color: maroon">Grid</span><span style="color: blue">&gt;</span>
    	<span style="color: blue">&lt;</span><span style="color: maroon">Grid.RowDefinitions</span><span style="color: blue">&gt;</span>
    		<span style="color: blue">&lt;</span><span style="color: maroon">RowDefinition</span> <span style="color: red">Height</span>="<span style="color: blue">Auto</span>"/<span style="color: blue">&gt;</span>
    		<span style="color: blue">&lt;</span><span style="color: maroon">RowDefinition</span> <span style="color: red">Height</span>="<span style="color: blue">Auto</span>"/<span style="color: blue">&gt;</span>
    		<span style="color: blue">&lt;</span><span style="color: maroon">RowDefinition</span> <span style="color: red">Height</span>="<span style="color: blue">Auto</span>"/<span style="color: blue">&gt;</span>
    		<span style="color: blue">&lt;</span><span style="color: maroon">RowDefinition</span> <span style="color: red">Height</span>="<span style="color: blue">Auto</span>"/<span style="color: blue">&gt;</span>
    		<span style="color: blue">&lt;</span><span style="color: maroon">RowDefinition</span> <span style="color: red">Height</span>="<span style="color: blue">Auto</span>"/<span style="color: blue">&gt;</span>
    		<span style="color: blue">&lt;</span><span style="color: maroon">RowDefinition</span> <span style="color: red">Height</span>="<span style="color: blue">*</span>"/<span style="color: blue">&gt;</span>
    		<span style="color: blue">&lt;</span><span style="color: maroon">RowDefinition</span> <span style="color: red">Height</span>="<span style="color: blue">Auto</span>"/<span style="color: blue">&gt;</span>
    		<span style="color: blue">&lt;</span><span style="color: maroon">RowDefinition</span> <span style="color: red">Height</span>="<span style="color: blue">Auto</span>"/<span style="color: blue">&gt;</span>
    	<span style="color: blue">&lt;</span>/<span style="color: maroon">Grid.RowDefinitions</span><span style="color: blue">&gt;</span>
	<span style="color: blue">&lt;</span>/<span style="color: maroon">Grid</span><span style="color: blue">&gt;</span>
<span style="color: blue">&lt;</span>/<span style="color: maroon">Window</span><span style="color: blue">&gt;</span>
</pre>
<p><strong>Non-resizeable list: ListBox of Grid</strong><br />The Podcasts list contains for each podcast a selection box, rating buttons, and the name of the podcast. The selection box and rating buttons are all fixed width. The only thing that varies is the width of the name. This sounds like a job for Grid again. The buttons can assume the width of their contents ("Auto"), while the name can consume all remaining space ("1 Star").</p>
<p>I dropped a ListBox into the appropriate row and set its Height property to a number I liked. Dragging the handle didn't do the right thing, because Blend couldn't tell whether I wanted to resize the row or not. When the property is set explicitly, it's obvious what you intend.</p>
<p>The next step was to bind the ItemsSource to the Podcasts property of the View Model. Click on the little gray dot to the right of the ItemsSource property and select "Data Binding". You'll want the "Explicit Data Context" tab, though I'm not sure why it's called that. You're using the DataContext inherited from the parent Window. Open up the View Model object and select the collection you want to show. I chose the Podcasts property.</p>
<p>Now you need to define how each item in the list looks. Right-click on the ListBox and select "Edit Control Parts (Template)", "Create Empty". Give the template an appropriate name (like PodcastsTemplate), leave "This Window" selected, and hit "OK". This creates a data template resource within the Window itself. If you had created it in the Application, it could be shared among windows. Since I don't see a need for that, I kept it local.</p>
<p>I'm not sure why this is called a "data template". It seems that it should be called a "view template". It's not a template for the data: that's defined by the bound interface property. Anyway...</p>
<p><a href="wp-content/uploads/2009/06/back-button.png"><img style="border-right: 0px; border-top: 0px; border-left: 0px; border-bottom: 0px" height="155" alt="Back Button" src="wp-content/uploads/2009/06/back-button-thumb.png" width="214" align="right" border="0"></a> From here, you can use a Grid layout just like you did for the Window, but set the ColumnDefinitions instead of the RowDefinitions. When you're done, click the button in the picture on the right to go back to the window. I can't tell you how long it took me to discover this thing.</p>
<p>You may notice that each of the rows is squashed at this point. Set the HorizontalContentAlignment property to "Stretch" to fix this.</p>
<p>Here's the resulting XAML.</p>
<pre><span style="color: blue">&lt;</span><span style="color: maroon">DataTemplate</span> <span style="color: red">x:Key</span>="<span style="color: blue">PodcastsTemplate</span>"<span style="color: blue">&gt;</span>
    <span style="color: blue">&lt;</span><span style="color: maroon">Grid</span> <span style="color: red">Height</span>="<span style="color: blue">18</span>"<span style="color: blue">&gt;</span>
        <span style="color: blue">&lt;</span><span style="color: maroon">Grid.ColumnDefinitions</span><span style="color: blue">&gt;</span>
            <span style="color: blue">&lt;</span><span style="color: maroon">ColumnDefinition</span> <span style="color: red">Width</span>="<span style="color: blue">16</span>"/<span style="color: blue">&gt;</span>
            <span style="color: blue">&lt;</span><span style="color: maroon">ColumnDefinition</span> <span style="color: red">Width</span>="<span style="color: blue">*</span>"/<span style="color: blue">&gt;</span>
            <span style="color: blue">&lt;</span><span style="color: maroon">ColumnDefinition</span> <span style="color: red">Width</span>="<span style="color: blue">38</span>"/<span style="color: blue">&gt;</span>
            <span style="color: blue">&lt;</span><span style="color: maroon">ColumnDefinition</span> <span style="color: red">Width</span>="<span style="color: blue">38</span>"/<span style="color: blue">&gt;</span>
            <span style="color: blue">&lt;</span><span style="color: maroon">ColumnDefinition</span> <span style="color: red">Width</span>="<span style="color: blue">38</span>"/<span style="color: blue">&gt;</span>
            <span style="color: blue">&lt;</span><span style="color: maroon">ColumnDefinition</span> <span style="color: red">Width</span>="<span style="color: blue">38</span>"/<span style="color: blue">&gt;</span>
            <span style="color: blue">&lt;</span><span style="color: maroon">ColumnDefinition</span> <span style="color: red">Width</span>="<span style="color: blue">38</span>"/<span style="color: blue">&gt;</span>
        <span style="color: blue">&lt;</span>/<span style="color: maroon">Grid.ColumnDefinitions</span><span style="color: blue">&gt;</span>
        <span style="color: blue">&lt;</span><span style="color: maroon">CheckBox</span> <span style="color: red">Width</span>="<span style="color: blue">13</span>" <span style="color: red">VerticalAlignment</span>="<span style="color: blue">Center</span>" <span style="color: red">Grid.Column</span>="<span style="color: blue">0</span>"/<span style="color: blue">&gt;</span>
        <span style="color: blue">&lt;</span><span style="color: maroon">TextBlock</span> <span style="color: red">Width</span>="<span style="color: blue">Auto</span>" <span style="color: red">Text</span>="<span style="color: blue">{Binding Path=Name, Mode=Default}</span>" <span style="color: red">Grid.Column</span>="<span style="color: blue">1</span>" <span style="color: red">VerticalAlignment</span>="<span style="color: blue">Center</span>"/<span style="color: blue">&gt;</span>
        <span style="color: blue">&lt;</span><span style="color: maroon">CheckBox</span> <span style="color: red">Grid.Column</span>="<span style="color: blue">2</span>" <span style="color: red">Template</span>="<span style="color: blue">{DynamicResource CarCheckBox}</span>" <span style="color: red">IsChecked</span>="<span style="color: blue">{Binding Path=Rank1, Mode=Default}</span>"/<span style="color: blue">&gt;</span>
        <span style="color: blue">&lt;</span><span style="color: maroon">CheckBox</span> <span style="color: red">Grid.Column</span>="<span style="color: blue">3</span>" <span style="color: red">Template</span>="<span style="color: blue">{DynamicResource CarCheckBox}</span>" <span style="color: red">IsChecked</span>="<span style="color: blue">{Binding Path=Rank2, Mode=Default}</span>"/<span style="color: blue">&gt;</span>
        <span style="color: blue">&lt;</span><span style="color: maroon">CheckBox</span> <span style="color: red">Grid.Column</span>="<span style="color: blue">4</span>" <span style="color: red">Template</span>="<span style="color: blue">{DynamicResource CarCheckBox}</span>" <span style="color: red">IsChecked</span>="<span style="color: blue">{Binding Path=Rank3, Mode=Default}</span>"/<span style="color: blue">&gt;</span>
        <span style="color: blue">&lt;</span><span style="color: maroon">CheckBox</span> <span style="color: red">Grid.Column</span>="<span style="color: blue">5</span>" <span style="color: red">Template</span>="<span style="color: blue">{DynamicResource CarCheckBox}</span>" <span style="color: red">IsChecked</span>="<span style="color: blue">{Binding Path=Rank4, Mode=Default}</span>"/<span style="color: blue">&gt;</span>
        <span style="color: blue">&lt;</span><span style="color: maroon">CheckBox</span> <span style="color: red">Grid.Column</span>="<span style="color: blue">6</span>" <span style="color: red">Template</span>="<span style="color: blue">{DynamicResource CarCheckBox}</span>" <span style="color: red">IsChecked</span>="<span style="color: blue">{Binding Path=Rank5, Mode=Default}</span>"/<span style="color: blue">&gt;</span>
    <span style="color: blue">&lt;</span>/<span style="color: maroon">Grid</span><span style="color: blue">&gt;</span>
<span style="color: blue">&lt;</span>/<span style="color: maroon">DataTemplate</span><span style="color: blue">&gt;</span>
...
<span style="color: blue">&lt;</span><span style="color: maroon">ListBox</span> <span style="color: red">ItemsSource</span>="<span style="color: blue">{Binding Path=Podcasts, Mode=Default}</span>" <span style="color: red">ItemTemplate</span>="<span style="color: blue">{DynamicResource PodcastsTemplate}</span>" <span style="color: red">HorizontalContentAlignment</span>="<span style="color: blue">Stretch</span>" <span style="color: red">Height</span>="<span style="color: blue">76</span>" <span style="color: red">Grid.Row</span>="<span style="color: blue">3</span>"/<span style="color: blue">&gt;</span></pre>
<p><strong>Resizable list: ListView</strong><br />The list of episodes contains three string columns. It makes sense to let the user individually resize these, unlike the single text field among a bunch of fixed-width buttons. So I decided on a ListView for this control.</p>
<p>You'll probably have to click the chevrons on the bottom of the toolbar to find the ListView tool. It's not one that's visible out-of-the-box. Set the ItemsSource just as before, But this time, rather than defining a data template, you need to set the View. Expand the "View" property hiding in "Miscellaneous". Click on the "Columns" button to add three columns. Set the Header property and bind the DisplayMemberBinding.</p>
<p>Here's one frustrating part of Blend. Even though we've bound the ItemsSource, Blend presents us with the properties of the CommuterViewModelSample. It should be able to recognize that the ItemsSource is a collection of IPodcastEpisode and give us the properties of that interface. Since it can't we just have to manually enter a path expression. Check the box at the bottom and enter the property name.</p>
<p><a href="wp-content/uploads/2009/06/use-custom-path-expression.png"><img style="border-right: 0px; border-top: 0px; border-left: 0px; border-bottom: 0px" height="104" alt="Use custom path expression" src="wp-content/uploads/2009/06/use-custom-path-expression-thumb.png" width="600" border="0"></a> </p>
<pre><span style="color: blue">&lt;</span><span style="color: maroon">ListView</span> <span style="color: red">ItemsSource</span>="<span style="color: blue">{Binding Path=Queue, Mode=Default}</span>" <span style="color: red">SelectedItem</span>="<span style="color: blue">{Binding Path=SelectedEpisode, Mode=Default}</span>" <span style="color: red">Grid.Row</span>="<span style="color: blue">5</span>" <span style="color: red">HorizontalContentAlignment</span>="<span style="color: blue">Stretch</span>"<span style="color: blue">&gt;</span>
    <span style="color: blue">&lt;</span><span style="color: maroon">ListView.View</span><span style="color: blue">&gt;</span>
        <span style="color: blue">&lt;</span><span style="color: maroon">GridView</span><span style="color: blue">&gt;</span>
            <span style="color: blue">&lt;</span><span style="color: maroon">GridViewColumn</span> <span style="color: red">Width</span>="<span style="color: blue">300</span>" <span style="color: red">Header</span>="<span style="color: blue">Name</span>" <span style="color: red">DisplayMemberBinding</span>="<span style="color: blue">{Binding Name}</span>"/<span style="color: blue">&gt;</span>
            <span style="color: blue">&lt;</span><span style="color: maroon">GridViewColumn</span> <span style="color: red">Width</span>="<span style="color: blue">140</span>" <span style="color: red">Header</span>="<span style="color: blue">Podcast</span>" <span style="color: red">DisplayMemberBinding</span>="<span style="color: blue">{Binding PodcastName}</span>"/<span style="color: blue">&gt;</span>
            <span style="color: blue">&lt;</span><span style="color: maroon">GridViewColumn</span> <span style="color: red">Width</span>="<span style="color: blue">50</span>" <span style="color: red">Header</span>="<span style="color: blue">Duration</span>" <span style="color: red">DisplayMemberBinding</span>="<span style="color: blue">{Binding DurationAsString}</span>"/<span style="color: blue">&gt;</span>
        <span style="color: blue">&lt;</span>/<span style="color: maroon">GridView</span><span style="color: blue">&gt;</span>
    <span style="color: blue">&lt;</span>/<span style="color: maroon">ListView.View</span><span style="color: blue">&gt;</span>
<span style="color: blue">&lt;</span>/<span style="color: maroon">ListView</span><span style="color: blue">&gt;</span></pre>
<p><strong>Spacing: Style</strong><br />By default, all of the controls in a grid are pushed right up next to each other. To add spacing, I defined a set of styles. Each style targets a control type in the grid, and sets the Margin property.</p>
<pre>    <span style="color: blue">&lt;</span><span style="color: maroon">Window.Resources</span><span style="color: blue">&gt;</span>
        <span style="color: blue">&lt;</span><span style="color: maroon">Style</span> <span style="color: red">TargetType</span>="<span style="color: blue">{x:Type ComboBox}</span>"<span style="color: blue">&gt;</span>
            <span style="color: blue">&lt;</span><span style="color: maroon">Setter</span> <span style="color: red">Property</span>="<span style="color: blue">Margin</span>" <span style="color: red">Value</span>="<span style="color: blue">3</span>"/<span style="color: blue">&gt;</span>
        <span style="color: blue">&lt;</span>/<span style="color: maroon">Style</span><span style="color: blue">&gt;</span>
        <span style="color: blue">&lt;</span><span style="color: maroon">Style</span> <span style="color: red">TargetType</span>="<span style="color: blue">{x:Type TextBlock}</span>"<span style="color: blue">&gt;</span>
        	<span style="color: blue">&lt;</span><span style="color: maroon">Setter</span> <span style="color: red">Property</span>="<span style="color: blue">Margin</span>" <span style="color: red">Value</span>="<span style="color: blue">3</span>"/<span style="color: blue">&gt;</span>
        <span style="color: blue">&lt;</span>/<span style="color: maroon">Style</span><span style="color: blue">&gt;</span>
        <span style="color: blue">&lt;</span><span style="color: maroon">Style</span> <span style="color: red">TargetType</span>="<span style="color: blue">{x:Type ListBox}</span>"<span style="color: blue">&gt;</span>
            <span style="color: blue">&lt;</span><span style="color: maroon">Setter</span> <span style="color: red">Property</span>="<span style="color: blue">Margin</span>" <span style="color: red">Value</span>="<span style="color: blue">3</span>"/<span style="color: blue">&gt;</span>
        <span style="color: blue">&lt;</span>/<span style="color: maroon">Style</span><span style="color: blue">&gt;</span>
        <span style="color: blue">&lt;</span><span style="color: maroon">Style</span> <span style="color: red">TargetType</span>="<span style="color: blue">{x:Type ListView}</span>"<span style="color: blue">&gt;</span>
            <span style="color: blue">&lt;</span><span style="color: maroon">Setter</span> <span style="color: red">Property</span>="<span style="color: blue">Margin</span>" <span style="color: red">Value</span>="<span style="color: blue">3</span>"/<span style="color: blue">&gt;</span>
        <span style="color: blue">&lt;</span>/<span style="color: maroon">Style</span><span style="color: blue">&gt;</span>
        <span style="color: blue">&lt;</span><span style="color: maroon">Style</span> <span style="color: red">TargetType</span>="<span style="color: blue">{x:Type Button}</span>"<span style="color: blue">&gt;</span>
            <span style="color: blue">&lt;</span><span style="color: maroon">Setter</span> <span style="color: red">Property</span>="<span style="color: blue">Margin</span>" <span style="color: red">Value</span>="<span style="color: blue">3</span>"/<span style="color: blue">&gt;</span>
        <span style="color: blue">&lt;</span>/<span style="color: maroon">Style</span><span style="color: blue">&gt;</span>
    <span style="color: blue">&lt;</span>/<span style="color: maroon">Window.Resources</span><span style="color: blue">&gt;</span></pre>
<p><strong>Going back to Visual Studio</strong><br />These patterns covered what I needed for this simple view. I suspect that they will cover most of my needs for data entry windows.</p>
<p>Overall, I find Blend to be a bit cumbersome to work in. It was great for the geometry of the car buttons, but it gets in the way when laying out a form. Dropping a control in the right place is not possible when the container size is Auto. Several extra properties get set on your behalf, which you then need to hunt down and reset. And even though the XAML that I need is small, the Blend UI hides many of the properties behind expanders, buttons, and tabs. I have to navigate several pages just to see what is immediately visible in a single line of XAML.</p>
<p>As a XAML editor, Blend is poor. It offers no intellisense the way that Visual Studio does. So now that I know the XAML that I need, I expect I'll be spending a lot more time in Visual Studio hand-crafting XAML.</p>
				</div>

				<p class="postmetadata">Posted in <a href="indexc733.html?cat=38" title="View all posts in Commuter" rel="category">Commuter</a>,  <a href="indexd65e.html?cat=8" title="View all posts in User Interface" rel="category">User Interface</a> |   <a href="index264a.html?p=376#comments" title="Comment on Structure of a WPF view">1 Comment &#187;</a></p>

			</div>

				<div class="post">
				<h3 id="post-365"><a href="index18ee.html?p=365" rel="bookmark" title="Permanent Link to A View Model based approach to star ratings">A View Model based approach to star ratings</a></h3>
				<small>Thursday, May 28th, 2009</small>

				<div class="entry">
					<p>While researching for Commuter, I found several implementations of star-rating controls on the web. Here are a few:</p>
<ul>
<li><a href="http://codingbandit.com/Blog/blog/wpf-data-templates-part-2-value-converters/">Coding Bandit's Rating Converter</a></li>
<li><a href="http://social.msdn.microsoft.com/Forums/en-US/wpf/thread/38e7296a-9892-4719-a69d-a89dea1549c0">Zhou Young's Rating Buttons</a></li>
<li><a href="http://www.codeproject.com/KB/WPF/WPF_Media_Player.aspx">Sachra Barber's Media Player</a></li>
</ul>
<p>There's some good work here, so give them a read. However, a common theme was to control the stars with code. I wanted to do a purely View Model driven design to limit the amount of code necessary.</p>
<p><strong>The View Model is dependent behavior</strong><br /><a href="wp-content/uploads/2009/05/commuter-view.png"><img style="border-right: 0px; border-top: 0px; border-left: 0px; border-bottom: 0px" height="304" alt="Commuter View" src="wp-content/uploads/2009/05/commuter-view-thumb.png" width="396" align="right" border="0"></a> The first thing to realize is that a star rating control is a combination of independent and dependent behavior. While the rating itself is independent, the state of each star is dependent. The independent data lives in the model, and the dependent data lives in the View Model. So I changed the podcast View Model contract to this:</p>
<pre><span style="color: blue">public</span> <span style="color: blue">interface</span> IPodcast
{
    <span style="color: blue">string</span> Name { <span style="color: blue">get</span>; }
    <span style="color: blue">bool</span> Selected { <span style="color: blue">get</span>; <span style="color: blue">set</span>; }
    <span style="color: blue">bool</span> Rank1 { <span style="color: blue">get</span>; <span style="color: blue">set</span>; }
    <span style="color: blue">bool</span> Rank2 { <span style="color: blue">get</span>; <span style="color: blue">set</span>; }
    <span style="color: blue">bool</span> Rank3 { <span style="color: blue">get</span>; <span style="color: blue">set</span>; }
    <span style="color: blue">bool</span> Rank4 { <span style="color: blue">get</span>; <span style="color: blue">set</span>; }
    <span style="color: blue">bool</span> Rank5 { <span style="color: blue">get</span>; <span style="color: blue">set</span>; }
}
</pre>
<p>This lets me just drop five ordinary check boxes and bind them to the five properties. Well, not <em>ordinary</em> check boxes. Mine look like cars. Here's a <a href="http://expression.microsoft.com/en-us/dd279539.aspx">step-by-step guide for styling a control</a>. Use the same technique to create star checkboxes, if you are so inclined.</p>
<p><strong>Implement the View Model contract</strong><br />A star -- er a <em>car</em> -- is on if the rating is greater than or equal to its value. When a car is clicked, it sets the rank to its value. This logic is encoded in the View Model like this:</p>
<pre><span style="color: blue">public</span> <span style="color: blue">class</span> PodcastViewModel : IPodcast
{
    <span style="color: blue">private</span> Podcast _model;

    <span style="color: blue">public</span> PodcastViewModel(Podcast model)
    {
        _model = model;
    }

    <span style="color: blue">public</span> <span style="color: blue">string</span> Name
    {
        <span style="color: blue">get</span> { <span style="color: blue">return</span> _model.Name; }
        <span style="color: blue">set</span> { _model.Name = value; }
    }

    <span style="color: blue">public</span> <span style="color: blue">bool</span> Selected
    {
        <span style="color: blue">get</span> { <span style="color: blue">return</span> _model.Selected; }
        <span style="color: blue">set</span> { _model.Selected = value; }
    }

    <span style="color: blue">public</span> <span style="color: blue">bool</span> Rank1
    {
        <span style="color: blue">get</span> { <span style="color: blue">return</span> _model.Rank &gt;= <span style="color: maroon">1</span>; }
        <span style="color: blue">set</span> { _model.Rank = <span style="color: maroon">1</span>; }
    }
    <span style="color: blue">public</span> <span style="color: blue">bool</span> Rank2
    {
        <span style="color: blue">get</span> { <span style="color: blue">return</span> _model.Rank &gt;= <span style="color: maroon">2</span>; }
        <span style="color: blue">set</span> { _model.Rank = <span style="color: maroon">2</span>; }
    }
    <span style="color: blue">public</span> <span style="color: blue">bool</span> Rank3
    {
        <span style="color: blue">get</span> { <span style="color: blue">return</span> _model.Rank &gt;= <span style="color: maroon">3</span>; }
        <span style="color: blue">set</span> { _model.Rank = <span style="color: maroon">3</span>; }
    }
    <span style="color: blue">public</span> <span style="color: blue">bool</span> Rank4
    {
        <span style="color: blue">get</span> { <span style="color: blue">return</span> _model.Rank &gt;= <span style="color: maroon">4</span>; }
        <span style="color: blue">set</span> { _model.Rank = <span style="color: maroon">4</span>; }
    }
    <span style="color: blue">public</span> <span style="color: blue">bool</span> Rank5
    {
        <span style="color: blue">get</span> { <span style="color: blue">return</span> _model.Rank &gt;= <span style="color: maroon">5</span>; }
        <span style="color: blue">set</span> { _model.Rank = <span style="color: maroon">5</span>; }
    }
}
</pre>
<p>The View Model does not maintain any state of its own. It delegates everything to the model. It is just a translator that converts model values into view behaviors.</p>
<p><strong>Implement INotifyPropertyChanged</strong><br />Oh, wait! You don't need to do that. Just use Independent sentries in your data model:</p>
<pre><span style="color: blue">public</span> <span style="color: blue">class</span> Podcast
{
    <span style="color: blue">private</span> <span style="color: blue">string</span> _name = <span style="color: blue">string</span>.Empty;
    <span style="color: blue">private</span> <span style="color: blue">bool</span> _selected = <span style="color: maroon">false</span>;
    <span style="color: blue">private</span> <span style="color: blue">int</span> _rank = <span style="color: maroon">1</span>;

    <span style="color: blue">#region</span> Independent properties
    <span style="color: green">// Generated by Update Controls --------------------------------</span>
    <span style="color: blue">private</span> Independent _indName = <span style="color: blue">new</span> Independent();
    <span style="color: blue">private</span> Independent _indSelected = <span style="color: blue">new</span> Independent();
    <span style="color: blue">private</span> Independent _indRank = <span style="color: blue">new</span> Independent();

    <span style="color: blue">public</span> <span style="color: blue">string</span> Name
    {
        <span style="color: blue">get</span> { _indName.OnGet(); <span style="color: blue">return</span> _name; }
        <span style="color: blue">set</span> { _indName.OnSet(); _name = value; }
    }

    <span style="color: blue">public</span> <span style="color: blue">bool</span> Selected
    {
        <span style="color: blue">get</span> { _indSelected.OnGet(); <span style="color: blue">return</span> _selected; }
        <span style="color: blue">set</span> { _indSelected.OnSet(); _selected = value; }
    }

    <span style="color: blue">public</span> <span style="color: blue">int</span> Rank
    {
        <span style="color: blue">get</span> { _indRank.OnGet(); <span style="color: blue">return</span> _rank; }
        <span style="color: blue">set</span> { _indRank.OnSet(); _rank = value; }
    }
    <span style="color: green">// End generated code --------------------------------</span>
    <span style="color: blue">#endregion</span>
}
</pre>
<p>And then wrap the view model for the view (requires <a href="http://updatecontrols.net/">Update Controls</a> release 2.0.4.0 or better):</p>
<pre><span style="color: blue">public</span> <span style="color: blue">partial</span> <span style="color: blue">class</span> Window1 : Window
{
    <span style="color: blue">public</span> Window1()
    {
        InitializeComponent();
        DataContext = <strong>ForView.Wrap</strong>(<span style="color: blue">new</span> CommuterViewModel(<span style="color: blue">new</span> CommuterModel()));
    }
}</pre>
<p>Now when you click on any of the cars, it will set the Rank property in the data model. Since all of the check boxes depend upon that one Rank, they are all updated accordingly.</p>
				</div>

				<p class="postmetadata">Posted in <a href="indexc733.html?cat=38" title="View all posts in Commuter" rel="category">Commuter</a>,  <a href="indexa88f.html?cat=36" title="View all posts in Update Controls" rel="category">Update Controls</a> |   <a href="index18ee.html?p=365#respond" title="Comment on A View Model based approach to star ratings">No Comments &#187;</a></p>

			</div>

				<div class="post">
				<h3 id="post-359"><a href="indexcaf0.html?p=359" rel="bookmark" title="Permanent Link to How to draw a car in Expression Blend">How to draw a car in Expression Blend</a></h3>
				<small>Sunday, May 24th, 2009</small>

				<div class="entry">
					<p>For the Commuter application, I want to rate podcasts. But instead of giving them a star rating, I decided to give them a "car" rating.</p>
<p><a href="wp-content/uploads/2009/05/car0.png"><img style="border-right: 0px; border-top: 0px; border-left: 0px; border-bottom: 0px" height="184" alt="My inspiration" src="wp-content/uploads/2009/05/car0-thumb.png" width="244" align="right" border="0"></a> I drive a blue Beetle, so naturally I decided that that would make the perfect template for my rating buttons. Here's how to draw a Beetle in Expression Blend.</p>
<p>Start with two circles for tires, and two circles for wheel wells. Choose the ellipse tool, and hold Shift while you drag from one corner to the opposite. Draw a small circle inside a big circle, then select both, hold Ctrl, and drag to create copies.</p>
<p><a href="wp-content/uploads/2009/05/car1.png"><img style="border-right: 0px; border-top: 0px; border-left: 0px; border-bottom: 0px" height="128" alt="Wheels and wheel wells" src="wp-content/uploads/2009/05/car1-thumb.png" width="244" border="0"></a> </p>
<p>Next, draw an ellipse for the body. Don't hold Shift while you drag, so the shape is unconstrained. The ellipse goes through the center of the front wheel, and is tangent with the back wheel. Switch to the rectangle tool to add a rounded rectangle for the bottom of the car.</p>
<p><a href="wp-content/uploads/2009/05/car2.png"><img style="border-right: 0px; border-top: 0px; border-left: 0px; border-bottom: 0px" height="151" alt="Body and trim" src="wp-content/uploads/2009/05/car2-thumb.png" width="244" border="0"></a> </p>
<p>Now we're going to use "Combine" operations to trim the shapes. When you combine two shapes, the originals are lost. We want to combine the rounded rectangle with several shapes, so we need to make copies of it.</p>
<p>The first operation will be to cut one wheel well with the rounded rectangle. Make a copy of the rectangle, select both it and one wheel well, and select "Combine: Intersect" from the "Object" menu. Repeat for the other wheel well, and for the body.</p>
<p><a href="wp-content/uploads/2009/05/car3.png"><img style="border-right: 0px; border-top: 0px; border-left: 0px; border-bottom: 0px" height="115" alt="Trim all parts" src="wp-content/uploads/2009/05/car3-thumb.png" width="244" border="0"></a></p>
<p>We are done with the rounded rectangle, so we can delete the original. Next, select the two wheel wells and the body and "Combine: Unite" them. There will be a strange dip where the front wheel well meets the windshield. We'll straighten this out by adding a rectangle.</p>
<p><a href="wp-content/uploads/2009/05/car4.png"><img style="border-right: 0px; border-top: 0px; border-left: 0px; border-bottom: 0px" height="115" alt="Flatten the dip" src="wp-content/uploads/2009/05/car4-thumb.png" width="244" border="0"></a>&nbsp; </p>
<p>Unite the rectangle with the outline of the car to complete the picture.</p>
<p><a href="wp-content/uploads/2009/05/car5.png"><img style="border-right: 0px; border-top: 0px; border-left: 0px; border-bottom: 0px" height="113" alt="Finished path" src="wp-content/uploads/2009/05/car5-thumb.png" width="244" border="0"></a> </p>
<p>Now we can use this path as the basis for rating buttons.</p>
				</div>

				<p class="postmetadata">Posted in <a href="indexc733.html?cat=38" title="View all posts in Commuter" rel="category">Commuter</a> |   <a href="indexcaf0.html?p=359#respond" title="Comment on How to draw a car in Expression Blend">No Comments &#187;</a></p>

			</div>

				<div class="post">
				<h3 id="post-345"><a href="index50ca.html?p=345" rel="bookmark" title="Permanent Link to The Commuter View Model">The Commuter View Model</a></h3>
				<small>Monday, May 11th, 2009</small>

				<div class="entry">
					<p>I'm working on an application to automatically manage an iTunes playlist. I've done the proof-of-concept and created a <a href="indexc2ef.html?p=342">historic model</a>. Now I want to describe the functionality of the user interface. I'll do this by drawing a UI mockup, and by defining an interface for the View Model.</p>
<p>The View Model is the name typically used in WPF for Martin Fowler's <a href="http://martinfowler.com/eaaDev/PresentationModel.html">Presentation Model</a> pattern. It is a class designed specifically for a view. It presents all of the information visible on the view, it accepts all of the input that the view gathers, and it provides all of the commands that the view exposes.</p>
<p>I like to think of a UI as merely a convenience. If the user had a compiler instead of a UI, he could still use your application. The View Model is the user's API to your program.</p>
<p><strong>The View Model</strong><br />An API is best defined as an interface. Here's the API that we are presenting to the user:</p>
<pre><span style="color: blue">public</span> <span style="color: blue">interface</span> <font color="#0080c0">IPlaylist</font>
{
    <span style="color: blue">string</span> Name { <span style="color: blue">get</span>; }
}

<span style="color: blue">public</span> <span style="color: blue">interface</span> <font color="#0080c0">IPodcast</font>
{
    <span style="color: blue">string</span> Name { <span style="color: blue">get</span>; }
    <span style="color: blue">bool</span> Selected { <span style="color: blue">get</span>; <span style="color: blue">set</span>; }
    <span style="color: blue">int</span> Rank { <span style="color: blue">get</span>; <span style="color: blue">set</span>; }
}

<span style="color: blue">public</span> <span style="color: blue">interface</span> <font color="#0080c0">IPodcastEpisode</font>
{
    <span style="color: blue">string</span> Name { <span style="color: blue">get</span>; }
    <span style="color: blue">string</span> PodcastName { <span style="color: blue">get</span>; }
    <span style="color: blue">string</span> DurationAsString { <span style="color: blue">get</span>; }
}

<span style="color: blue">public</span> <span style="color: blue">interface</span> <font color="#0080c0">ICommuterViewModel</font>
{
    <font color="#0080c0">IEnumerable</font>&lt;<font color="#0080c0">IPlaylist</font>&gt; Playlists { <span style="color: blue">get</span>; }
    <font color="#0080c0">IPlaylist</font> <font color="#0080c0">SelectedPlaylist</font> { <span style="color: blue">get</span>; <span style="color: blue">set</span>; }

    <font color="#0080c0">IEnumerable</font>&lt;<font color="#0080c0">IPodcast</font>&gt; Podcasts { <span style="color: blue">get</span>; }

    <font color="#0080c0">IEnumerable</font>&lt;<font color="#0080c0">IPodcastEpisode</font>&gt; Queue { <span style="color: blue">get</span>; }
    <font color="#0080c0">IPodcastEpisode</font> SelectedEpisode { <span style="color: blue">get</span>; <span style="color: blue">set</span>; }
    <span style="color: blue">string</span> TotalDurationAsString { <span style="color: blue">get</span>; }

    <font color="#0080c0">ICommand</font> Skip { <span style="color: blue">get</span>; }
}
</pre>
<p>This API lets the user see all of their playlists, and select one. It lets them see all of their podcasts, and individually select and rank them. Then it shows their queue, lets them select an episode, and skip it.</p>
<p><strong>The mockup</strong><br />For the user's convenience, we will also provide this view (my code is much neater than my drawing):</p>
<p align="center"><a href="wp-content/uploads/2009/05/commuter-mockup.png"><img style="border-right: 0px; border-top: 0px; border-left: 0px; border-bottom: 0px" height="556" alt="Commuter Mockup" src="wp-content/uploads/2009/05/commuter-mockup-thumb.png" width="420" border="0"></a></p>
<p> You can see how each of the View Model properties maps to the view. With this interface, mockup, and Blend, a designer can create a nice convenient UI for our user. Just so they don't have to get their hands dirty with a compiler. That's our next step.</p>
				</div>

				<p class="postmetadata">Posted in <a href="indexc733.html?cat=38" title="View all posts in Commuter" rel="category">Commuter</a>,  <a href="indexb0b7.html?cat=6" title="View all posts in Patterns" rel="category">Patterns</a> |   <a href="index50ca.html?p=345#respond" title="Comment on The Commuter View Model">No Comments &#187;</a></p>

			</div>

				<div class="post">
				<h3 id="post-342"><a href="indexc2ef.html?p=342" rel="bookmark" title="Permanent Link to Modeling an iTunes automation application">Modeling an iTunes automation application</a></h3>
				<small>Saturday, May 9th, 2009</small>

				<div class="entry">
					<p>I listen to podcasts on the way to work. I've created a playlist called "Commute" that I use to make this hands-free. Here's my workflow:</p>
<ul>
<li>Dock the iPod before bed, which launches iTunes and updates play counts.</li>
<li>Delete all episodes from the Commute playlist with a play count of 1.</li>
<li>iTunes (usually) downloads the latest episodes overnight. If not, I kick it in the morning.</li>
<li>Drag new episodes into the Commute playlist.</li>
</ul>
<p>In the car, I just start the playlist and it takes me to work and back.</p>
<p>It has occurred to me on more than one occasion that this process could be automated. I finally decided to take on the task. After a quick POC with the iTunes COM interface, I decided that it was possible.</p>
<p><strong>Commuter</strong><br />The application, currently named "Commuter", will automatically queue selected podcasts in a specified playlist. Here's what a user can do:</p>
<ul>
<li>See playlists and podcast subscriptions managed in iTunes.</li>
<li>Select a playlist into which to queue the episodes.</li>
<li>Select podcast subscriptions to use.</li>
<li>Rank subscriptions to influence the order in which they are queued.</li>
</ul>
<p>From this information, the program manages the queue within the selected playlist.</p>
<p><strong>The historic model</strong><br />I prefer to use an analysis technique that I call Historic Modeling. This technique captures more information than data modeling alone. It includes all of the changes that can be made to the system, and the relationships among those changes. Here is the model I came up with:</p>
<p align="center"><a href="wp-content/uploads/2009/05/commuter.png"><img style="border-right: 0px; border-top: 0px; border-left: 0px; border-bottom: 0px" height="272" alt="commuter" src="wp-content/uploads/2009/05/commuter-thumb.png" width="660" border="0"></a> </p>
<p>Each bubble represents a fact. A fact is an entity that was created, a property that was changed, or an operation that was performed. The arrows between facts indicate that one has to occur before the other. The successor fact has knowledge of its predecessor.</p>
<p>A Commuter, for example, has knowledge of a MusicLibrary, and cannot be created before the MusicLibrary exists. A SelectedPlaylist records the fact that a Commuter has selected a Playlist. It also records the Commuter's prior selection, if any.</p>
<p>Facts are immutable. A Commuter can select a new Playlist, but the fact that he had once selected a particular Playlist will always be true.</p>
<p>Some of these facts are operations that the user performs, some of them represent iTunes synchronization, and some represent decisions of the program itself. All of these facts are interrelated. User actions are made with knowledge of iTunes objects, and program decisions are made because of user actions.</p>
<p>The next steps will be to mock up the UI and define a view model.</p>
				</div>

				<p class="postmetadata">Posted in <a href="indexc733.html?cat=38" title="View all posts in Commuter" rel="category">Commuter</a> |   <a href="indexc2ef.html?p=342#respond" title="Comment on Modeling an iTunes automation application">No Comments &#187;</a></p>

			</div>

		
		<div class="navigation">
			<div class="alignleft"></div>
			<div class="alignright"></div>
		</div>

	
	</div>
		</td>
	</tr>
</table>

<hr />
<div id="footer">
<!-- If you'd like to support WordPress, having the "powered by" link someone on your blog is the best way, it's our only promotion or advertising. -->
	<p>
		Adventures in Software is proudly powered by 
		<a href="http://wordpress.org/">WordPress</a>
		<br /><a href="indexd784.html?feed=rss2">Entries (RSS)</a>
		and <a href="indexa6da.html?feed=comments-rss2">Comments (RSS)</a>.
		<!-- 17 queries. 0.497 seconds. -->
	</p>
</div>
<script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
try {
var pageTracker = _gat._getTracker("UA-389401-3");
pageTracker._trackPageview();
} catch(err) {}</script></div>

<!-- Gorgeous design by Michael Heilemann - http://binarybonsai.com/kubrick/ -->

		<div id="sk2-footer" style="color:#FFF; background-color:#444; padding: 3px 2px 3px 2px; border-top: #888 solid 1px;">This blog is protected by <a href="http://unknowngenius.com/blog/" title="Dave">dr Dave</a>'s <strong><a href="http://unknowngenius.com/blog/wordpress/spam-karma/" title="SK2">Spam Karma 2</a></strong>: <strong>274531</strong>  Spams eaten and counting...</div><script type="text/javascript" src="replies.js"></script>
<script type="text/javascript" src="blogger.js"></script>
<script type="text/javascript" src="http://twitter.com/statuses/user_timeline/michaellperry.json?callback=twitterCallback2&amp;count=5"></script>
<script type="text/javascript" src="http://search.twitter.com/search.json?q=@michaellperry&amp;callback=twitterCallbackReplies&amp;rpp=5"></script>
</body>

<!-- Mirrored from adventuresinsoftware.com/blog/?cat=38 by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 13 Jan 2017 12:55:50 GMT -->
</html>
