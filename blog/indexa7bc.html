<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr">


<!-- Mirrored from adventuresinsoftware.com/blog/?m=200810 by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 13 Jan 2017 12:47:21 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- /Added by HTTrack -->
<head profile="http://gmpg.org/xfn/11">
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />

<title>Adventures in Software   &raquo; 2008&raquo; October</title>

<meta name="generator" content="WordPress 2.3.3" /> <!-- leave this for stats -->

<link rel="stylesheet" href="wp-content/themes/ais2/style.css" type="text/css" media="screen" />
<link rel="alternate" type="application/rss+xml" title="Adventures in Software RSS Feed" href="indexd784.html?feed=rss2" />
<link rel="pingback" href="xmlrpc.html" />
    <script type="text/javascript">
        function onSilverlightError(sender, args) {
            var appSource = "";
            if (sender != null && sender != 0) {
              appSource = sender.getHost().Source;
            }
            
            var errorType = args.ErrorType;
            var iErrorCode = args.ErrorCode;

            if (errorType == "ImageError" || errorType == "MediaError") {
              return;
            }

            var errMsg = "Unhandled Error in Silverlight Application " +  appSource + "\n" ;

            errMsg += "Code: "+ iErrorCode + "    \n";
            errMsg += "Category: " + errorType + "       \n";
            errMsg += "Message: " + args.ErrorMessage + "     \n";

            if (errorType == "ParserError") {
                errMsg += "File: " + args.xamlFile + "     \n";
                errMsg += "Line: " + args.lineNumber + "     \n";
                errMsg += "Position: " + args.charPosition + "     \n";
            }
            else if (errorType == "RuntimeError") {           
                if (args.lineNumber != 0) {
                    errMsg += "Line: " + args.lineNumber + "     \n";
                    errMsg += "Position: " +  args.charPosition + "     \n";
                }
                errMsg += "MethodName: " + args.methodName + "     \n";
            }

            throw new Error(errMsg);
        }
    </script>

	<link rel="EditURI" type="application/rsd+xml" title="RSD" href="xmlrpc0db0.php?rsd" />
 <link rel="wlwmanifest" type="application/wlwmanifest+xml" href="wp-includes/wlwmanifest.xml" /> <style type='text/css'>
<!--#header { background: url('wp-content/themes/ais2/images/header-imgae03.html?upper=A7A73F&amp;lower=77773F') no-repeat bottom center; }
--></style>
</head>
<body>
<div id="page">

<div class="aisTopBar">
	<form method="get" id="searchform" action="http://adventuresinsoftware.com/blog/">
<div>
<a href="indexd784.html?feed=rss2"><img src="../images/feed-icon-28x28.png" border="0"></a>
<input type="text" value="" name="s" id="s" />
<input type="submit" id="searchsubmit" value="Search" />
</div>
</form>
</div>

<div class="aisHeaderImageRight">
	<div class="aisHeaderImage">
	<div class="aisHeaderCornerRight">
	<div class="aisHeaderCornerLeft">
	<div class="aisImageBar">
	<div class="aisSubSites">
		<a href="index.html" class="aisSubSiteLink"><span class="aisSiteTabRight"><span class="aisSiteTabLeft"><span class="aisSiteTab">
			home</span></span></span></a>
		<a class="aisSubSiteLink" href="indexb60a.html?cat=27"><span class="aisSiteTabRight"><span class="aisSiteTabLeft"><span class="aisSiteTab">
			historic modeling</span></span></span></a>
		<a class="aisSubSiteLink" href="indexa88f.html?cat=36"><span class="aisSiteTabRight"><span class="aisSiteTabLeft"><span class="aisSiteTab">
			update controls</span></span></span></a>
		<a href="index2d79.html?cat=26" class="aisSubSiteLink"><span class="aisSiteTabRight"><span class="aisSiteTabLeft"><span class="aisSiteTab">
			degrees of freedom</span></span></span></a>
		<a class="aisSubSiteLink" href="indexba53.html?page_id=2"><span class="aisSiteTabRight"><span class="aisSiteTabLeft"><span class="aisSiteTab">
			about us</span></span></span></a>

	</div>
	</div>
	</div>
	</div>
	</div>
</div>

<table style="width: 100%" cellspacing="0" cellpadding="0">
	<tr valign="top">
		<td width="210px">
<div id="sidebar">
<div class="aisLeftColumnFill">
<div class="aisLeftColumnBottom">
<div class="aisLeftColumnTop">
<div id="twitter_div" class="aisLeftNav">
<h2 class="sidebar-title">Twitter Updates</h2>
<ul id="twitter_update_list"></ul>
<a href="http://twitter.com/michaellperry" id="follow">Follow me</a>
</div>
<div id="twitter_reply_div" class="aisLeftNav">
<h2 class="sidebar-title">Twitter Replies</h2>
<ul id="twitter_reply_list"></ul>
</div>

<div class="aisLeftNav">
<a href='http://ineta.org/Speakers/SearchCommunitySpeakers.aspx?SpeakerId=c5110e21-9243-461b-a464-a6548524e885'><img alt='INETA Community Speakers Program' border='0' src='../../www.ineta.org/images/OfficialLogos/InetaCommunitySpeakersRequestMe.html' /></a>
</div>

<div class="aisLeftNav">
	<li class="pagenav"><h2>Pages</h2><ul><li class="page_item page-item-2"><a href="indexba53.html?page_id=2" title="About Us">About Us</a></li>
<li class="page_item page-item-210"><a href="index6ae3.html?page_id=210" title="Templates">Templates</a></li>
</ul></li></div>

<div class="aisLeftNav">
<h2>Archives</h2>
<ul>
	<li><a href='indexb4d5.html?m=201110' title='October 2011'>October 2011</a></li>
	<li><a href='indexc61a.html?m=201106' title='June 2011'>June 2011</a></li>
	<li><a href='indexa80d.html?m=201105' title='May 2011'>May 2011</a></li>
	<li><a href='index512b.html?m=201104' title='April 2011'>April 2011</a></li>
	<li><a href='index08fb.html?m=201103' title='March 2011'>March 2011</a></li>
	<li><a href='index52f4.html?m=201102' title='February 2011'>February 2011</a></li>
	<li><a href='index74f1.html?m=201101' title='January 2011'>January 2011</a></li>
	<li><a href='index8956.html?m=201012' title='December 2010'>December 2010</a></li>
	<li><a href='indexa1aa.html?m=201011' title='November 2010'>November 2010</a></li>
	<li><a href='indexe3d5.html?m=201010' title='October 2010'>October 2010</a></li>
	<li><a href='index9ab9.html?m=201009' title='September 2010'>September 2010</a></li>
	<li><a href='index1ff0.html?m=201008' title='August 2010'>August 2010</a></li>
	<li><a href='index9f11.html?m=201007' title='July 2010'>July 2010</a></li>
	<li><a href='index31f0.html?m=201006' title='June 2010'>June 2010</a></li>
	<li><a href='indexd189.html?m=201005' title='May 2010'>May 2010</a></li>
	<li><a href='indexb5c0.html?m=201004' title='April 2010'>April 2010</a></li>
	<li><a href='indexf258.html?m=201003' title='March 2010'>March 2010</a></li>
	<li><a href='index6e30.html?m=201002' title='February 2010'>February 2010</a></li>
	<li><a href='index6b19.html?m=201001' title='January 2010'>January 2010</a></li>
	<li><a href='index5c0a.html?m=200912' title='December 2009'>December 2009</a></li>
	<li><a href='index8f62.html?m=200911' title='November 2009'>November 2009</a></li>
	<li><a href='index451d.html?m=200910' title='October 2009'>October 2009</a></li>
	<li><a href='index3e04.html?m=200909' title='September 2009'>September 2009</a></li>
	<li><a href='index425a.html?m=200908' title='August 2009'>August 2009</a></li>
	<li><a href='index9907.html?m=200907' title='July 2009'>July 2009</a></li>
	<li><a href='index3104.html?m=200906' title='June 2009'>June 2009</a></li>
	<li><a href='indexc36d.html?m=200905' title='May 2009'>May 2009</a></li>
	<li><a href='index17e8.html?m=200904' title='April 2009'>April 2009</a></li>
	<li><a href='index10a5.html?m=200903' title='March 2009'>March 2009</a></li>
	<li><a href='index8988.html?m=200902' title='February 2009'>February 2009</a></li>
	<li><a href='index1419.html?m=200901' title='January 2009'>January 2009</a></li>
	<li><a href='index7866.html?m=200812' title='December 2008'>December 2008</a></li>
	<li><a href='index55f6.html?m=200811' title='November 2008'>November 2008</a></li>
	<li><a href='indexa7bc.html?m=200810' title='October 2008'>October 2008</a></li>
	<li><a href='indexe77c.html?m=200809' title='September 2008'>September 2008</a></li>
	<li><a href='indexcffc.html?m=200808' title='August 2008'>August 2008</a></li>
	<li><a href='index0e62.html?m=200807' title='July 2008'>July 2008</a></li>
	<li><a href='indexfda7.html?m=200806' title='June 2008'>June 2008</a></li>
	<li><a href='index7d64.html?m=200805' title='May 2008'>May 2008</a></li>
	<li><a href='index94dd.html?m=200804' title='April 2008'>April 2008</a></li>
	<li><a href='index9631.html?m=200803' title='March 2008'>March 2008</a></li>
	<li><a href='indexdd52.html?m=200802' title='February 2008'>February 2008</a></li>
	<li><a href='index21ee.html?m=200801' title='January 2008'>January 2008</a></li>
	<li><a href='index363c.html?m=200712' title='December 2007'>December 2007</a></li>
	<li><a href='index7493.html?m=200711' title='November 2007'>November 2007</a></li>
	<li><a href='index93a7.html?m=200710' title='October 2007'>October 2007</a></li>
	<li><a href='index4ca8.html?m=200709' title='September 2007'>September 2007</a></li>
	<li><a href='index6124.html?m=200708' title='August 2007'>August 2007</a></li>
	<li><a href='index6013.html?m=200707' title='July 2007'>July 2007</a></li>
	<li><a href='index2ab6.html?m=200706' title='June 2007'>June 2007</a></li>
	<li><a href='index44f0.html?m=200705' title='May 2007'>May 2007</a></li>
	<li><a href='indexf0b4.html?m=200704' title='April 2007'>April 2007</a></li>
	<li><a href='index481d.html?m=200703' title='March 2007'>March 2007</a></li>
	<li><a href='indexcbea.html?m=200702' title='February 2007'>February 2007</a></li>
	<li><a href='index9cdc.html?m=200701' title='January 2007'>January 2007</a></li>
	<li><a href='index3ea4.html?m=200612' title='December 2006'>December 2006</a></li>
	<li><a href='index67ca.html?m=200611' title='November 2006'>November 2006</a></li>
	<li><a href='indexff49.html?m=200610' title='October 2006'>October 2006</a></li>
	<li><a href='index611c.html?m=200609' title='September 2006'>September 2006</a></li>
	<li><a href='index9a21.html?m=200608' title='August 2006'>August 2006</a></li>
	<li><a href='index3ee9.html?m=200607' title='July 2006'>July 2006</a></li>
	<li><a href='indexe13a.html?m=200606' title='June 2006'>June 2006</a></li>
</ul>
</div>

<div class="aisLeftNav">
	</div>

<div class="aisLeftNav">
<h2>Books</h2>
<iframe src="http://rcm.amazon.com/e/cm?t=adventures0d2-20&amp;o=1&amp;p=8&amp;l=as1&amp;asins=0764526413&amp;fc1=000000&amp;IS2=1&amp;lt1=_blank&amp;lc1=0000ff&amp;bc1=000000&amp;bg1=ffffff&amp;f=ifr" style="width:120px;height:240px;" scrolling="no" marginwidth="0" marginheight="0" frameborder="0" name="I5" id="I5"></iframe>
<br/>
<iframe src="http://rcm.amazon.com/e/cm?t=adventures0d2-20&amp;o=1&amp;p=8&amp;l=as1&amp;asins=0201633612&amp;fc1=000000&amp;IS2=1&amp;lt1=_blank&amp;lc1=0000ff&amp;bc1=000000&amp;bg1=ffffff&amp;f=ifr" style="width:120px;height:240px;" scrolling="no" marginwidth="0" marginheight="0" frameborder="0" name="I6" id="I6"></iframe>
<br/>
<iframe src="http://rcm.amazon.com/e/cm?t=adventures0d2-20&amp;o=1&amp;p=8&amp;l=as1&amp;asins=0136291554&amp;fc1=000000&amp;IS2=1&amp;lt1=_blank&amp;lc1=0000ff&amp;bc1=000000&amp;bg1=ffffff&amp;f=ifr" style="width:120px;height:240px;" scrolling="no" marginwidth="0" marginheight="0" frameborder="0" name="I7" id="I7"></iframe>
<br/>
<iframe src="http://rcm.amazon.com/e/cm?t=adventures0d2-20&amp;o=1&amp;p=8&amp;l=as1&amp;asins=1888009195&amp;fc1=000000&amp;IS2=1&amp;lt1=_blank&amp;lc1=0000ff&amp;bc1=000000&amp;bg1=ffffff&amp;f=ifr" style="width:120px;height:240px;" scrolling="no" marginwidth="0" marginheight="0" frameborder="0" name="I8" id="I8"></iframe>
</div>
<div class="aisLeftNav">
<h2>Meta</h2>
<ul>
		<li><a href="wp-login.html">Login</a></li>
	<li><a href="http://validator.w3.org/check/referer" title="This page validates as XHTML 1.0 Transitional">Valid <abbr title="eXtensible HyperText Markup Language">XHTML</abbr></a></li>
	<li><a href="http://gmpg.org/xfn/"><abbr title="XHTML Friends Network">XFN</abbr></a></li>
	<li><a href="http://wordpress.org/" title="Powered by WordPress, state-of-the-art semantic personal publishing platform.">WordPress</a></li>
	</ul>
</div>
<div class="aisLeftContent">
<h2>Community</h2>
<ul>
	<script type="text/javascript" src="../../localhost/embed/92q2bbma.js"></script>
</ul>
</div>

</div></div></div>
</div>		</td>
		<td>

	<div id="content" class="narrowcolumn">

		
		 		<h2 class="pagetitle">Archive for October, 2008</h2>

		

		<div class="navigation">
			<div class="alignleft"></div>
			<div class="alignright"></div>
		</div>

				<div class="post">
				<h3 id="post-272"><a href="indexcde3.html?p=272" rel="bookmark" title="Permanent Link to Mutable properties">Mutable properties</a></h3>
				<small>Thursday, October 30th, 2008</small>

				<div class="entry">
					<p>All of the fields of a Correspondence object are immutable. They are set at the time of construction. They define the identity of an object, so they cannot be allowed to change.</p>
<p>How, then, can you represent mutable properties in Correspondence? By doing the only thing that Correspondence allows you to do: create more objects.<strong></p>
<p></strong>
<p><strong>A class for each atomic operation</strong><br />A Correspondence object represents an atomic operation. It records the fact that someone has made a change. So one such change could be the modification of a property. Let's express the atomic operations of a project and one of its mutable properties:</p>
<ul>
<li>CreateProject(): Project</li>
<li>SetProjectName(project: Project, name: string)</li>
</ul>
<p>Since we have two atomic operations, we define two Correspondence classes. The class that represents the CreateProject operation is the Project itself. The class that represents the SetProjectName operation will be called ProjectName.</p>
<p><strong>Define prerequisites</strong><br />It is apparent from the definitions of these two atomic operations that the Project is a prerequisite for the ProjectName. You can't name a project before you create it. And in order for the ProjectName to make sense, you must know which Project you are talking about.</p>
<p><a href="../../www.adventuresinsoftware.com/blog/wp-content/uploads/2008/10/image2.png"><img style="border-right: 0px; border-top: 0px; border-left: 0px; border-bottom: 0px" height="94" alt="image" src="../../www.adventuresinsoftware.com/blog/wp-content/uploads/2008/10/image-thumb.png" width="244" align="right" border="0"></a> So if Project is the only prerequisite for ProjectName, we can have an object model like the diagram on the right. If we set the project name three times, we end up with three ProjectName objects that are equal successors of the Project object.</p>
<p>There's one significant problem with the model just described. It is impossible to tell from the model alone which is the correct name of the project. It was set three times, and nothing about the diagram tells us which is the intended name. We could go by the time of creation, but that is insufficient in light of synchronization. One user might have set the name on one machine, while another user set the name on a different machine. We can't see the intent of the users in the model, so we can't make a reasonable decision.</p>
<p><strong>Current knowledge is a prerequisite</strong><br />The solution is to capture that intent by adding prerequisites. The prerequisites of an atomic operation are not just the parameters required for the operation to make sense in isolation. They also include the operations that have come before. The operation was performed by a user with a certain set of knowledge. If we capture that knowledge as prerequisites, we can glean the user's intent.</p>
<p><a href="../../www.adventuresinsoftware.com/blog/wp-content/uploads/2008/10/image5.png"><img style="border-right: 0px; border-top: 0px; border-left: 0px; border-bottom: 0px" height="177" alt="image" src="../../www.adventuresinsoftware.com/blog/wp-content/uploads/2008/10/image-thumb3.png" width="244" align="left" border="0"></a> In our case, we are going to capture the current project name as a prerequisite for any new project name. The user knew that the project was called WSE when he changed it to Indigo. Later, he knew that it was Indigo when changing it to WCF. This changes the diagram to the one on the left.</p>
<p>This diagram captures the intent of the user. He was changing the project name with the knowledge of the prior project name. And now the diagram clearly shows what the current name is: it is the last in the chain of succession.</p>
<p><strong>Detect conflicts</strong><br /><a href="../../www.adventuresinsoftware.com/blog/wp-content/uploads/2008/10/image4.png"><img style="border-right: 0px; border-top: 0px; border-left: 0px; border-bottom: 0px" height="144" alt="image" src="../../www.adventuresinsoftware.com/blog/wp-content/uploads/2008/10/image-thumb2.png" width="244" align="right" border="0"></a> So what about the case of the two users on different machines? What if the developer chose the name Indigo while the analyst chose WCF? Both of those decisions were made with the knowledge of the name WSE, and so you get the diagram on the right.</p>
<p>From this diagram, it is apparent that there is a conflict. We no longer have just one leaf of the tree of ProjectNames. Now we have two leaves. Both of these siblings are just as worthy in the chain of succession of representing the current name of the project.</p>
<p>Correspondence makes no assumptions about how to resolve conflicts. But it does make it obvious when they have occurred. It is now up to the application to decide on a conflict resolution strategy. Knowing that there was a problem is the first step.</p>
<p>Fields of a Correspondence object are immutable. Modifiable properties are implemented as a pattern involving a new class, prior operations as prerequisites, and conflict detection. Conflict resolution is the responsibility of the application.</p>
				</div>

				<p class="postmetadata">Posted in <a href="indexb60a.html?cat=27" title="View all posts in Historic Modeling" rel="category">Historic Modeling</a> |   <a href="indexcde3.html?p=272#respond" title="Comment on Mutable properties">No Comments &#187;</a></p>

			</div>

				<div class="post">
				<h3 id="post-263"><a href="index8fee.html?p=263" rel="bookmark" title="Permanent Link to Correspondence">Correspondence</a></h3>
				<small>Thursday, October 23rd, 2008</small>

				<div class="entry">
					<p>Correspondence is a base class library (currently in Java and C#) for historic data models.</p>
<p>A historic data model is one in which the objects represent atomic operations rather than entities. To record that an operation has taken place, you create an object. You can then observe the history of related objects to determine the current state.</p>
<p><strong>Anatomy of a correspondence object</strong><br />The base class is CorrespondenceObject. A correspondence object has fields (simple data types) and predecessors (references to other correspondence objects). <strong>These fields and predecessors are assigned at construction and never change.</strong></p>
<p>I'll demonstrate with the Java version of the library. Here is a simple correspondence object representing a project in a bug tracking system:</p>
<pre>@Correspondence
<span style="color: blue">public</span> <span style="color: blue">class</span> Project <span style="color: blue">extends</span> CorrespondenceObject {

	<span style="color: blue">private</span> @Field UUID id;

	<span style="color: blue">private</span> Query&lt;Issue&gt; issue = <span style="color: blue">new</span> Query&lt;Issue&gt;(<span style="color: blue">this</span>)
		.joinSuccessors(<span style="color: maroon">"project_issue"</span>);

	<span style="color: blue">public</span> Project() {
		id = UUID.randomUUID();
	}

	<span style="color: blue">public</span> Project(Memento memento) {
	}

	<span style="color: blue">public</span> Iterable&lt;Issue&gt; getIssues() {
		<span style="color: blue">return</span> issue;
	}
}</pre>
<p>And here's a bug:</p>
<pre>@Correspondence
<span style="color: blue">public</span> <span style="color: blue">class</span> Issue <span style="color: blue">extends</span> CorrespondenceObject {

	<span style="color: blue">private</span> PredecessorObj&lt;Project&gt; project;

	<span style="color: blue">private</span> @Field UUID id;

	<span style="color: blue">public</span> Issue(Project project) {
		<span style="color: blue">this</span>.project = <span style="color: blue">new</span> PredecessorObj&lt;Project&gt;(<span style="color: blue">this</span>, <span style="color: maroon">"project_issue"</span>, project);
		<span style="color: blue">this</span>.id = UUID.randomUUID();
	}

	<span style="color: blue">public</span> Issue(Memento memento) <span style="color: blue">throws</span> CorrespondenceException {
		<span style="color: blue">this</span>.project = <span style="color: blue">new</span> PredecessorObj&lt;Project&gt;(<span style="color: blue">this</span>, <span style="color: maroon">"project_issue"</span>, memento);
	}

	<span style="color: blue">public</span> Project getProject() {
		<span style="color: blue">return</span> project.getObject();
	}
}</pre>
<p>A correspondence object has two constructors. One is used by the application to create the first instance of a new object. The other is used by the library to rehydrate an existing object from a memento.</p>
<p>Notice that both of these objects have id fields that are initialized to unique random numbers. This is how identity is assured in Correspondence. <strong>The identity of a correspondence object is the set of its predecessors and fields.</strong> If you try to create another object with the same predecessors and fields, you get back the same object.</p>
<p>These predecessors and fields cannot be changed. You cannot move an issue from one project to another. That is why you don't see project name or issue name as fields. These should be modifiable properties. We'll see how to make modifiable properties in a later post.</p>
<p>The list of issues for a project is dependent. It is represented by a query for all successors of the project. When a new issue is created, it will be returned from this query. You don't write code to add the issue to the list. Instead, the library updates this query when the new issue is created.</p>
<p><strong>Data storage</strong><br />The library takes care of persisting and caching objects and their relationships with one another. When you set up your correspondence project, you select a storage strategy. In Java, I have implemented MySQL and PostgreSQL storage strategies so far. In C#, I have ADO, DAO, and SQL Server CE. The Memento class is the intermediary that separates correspondence objects from the storage strategy and make that possible.</p>
<p>Although all of the storage strategies that I've implemented so far are built on relational databases, don't confuse Correspondence for an ORM. It does not map objects to a relational schema. The database does not resemble your object model in any way. It has two tables: Object and Predecessor. If you love relational data, do us both a favor and don't look in the database.</p>
<p>Even though it does not produce a database that you would want to use for reporting (or anything else, for that matter), the Correspondence library takes care of the persistence and caching of your objects automatically. You write an object model, and you get storage and caching for free. When you create an object, it gets stored. When you follow a reference to a predecessor, it gets cached. When you execute a query, the results are cached.</p>
<p>Next, we'll continue the development of the bug tracking system to demonstrate some of the common patterns that occur while using Correspondece.</p>
				</div>

				<p class="postmetadata">Posted in <a href="indexb60a.html?cat=27" title="View all posts in Historic Modeling" rel="category">Historic Modeling</a> |   <a href="index8fee.html?p=263#respond" title="Comment on Correspondence">No Comments &#187;</a></p>

			</div>

				<div class="post">
				<h3 id="post-262"><a href="index7d69.html?p=262" rel="bookmark" title="Permanent Link to Partial order of transactions">Partial order of transactions</a></h3>
				<small>Tuesday, October 21st, 2008</small>

				<div class="entry">
					<p>Prerequisites define a partial order among transactions.</p>
<p>We've established that an object's state is dependent upon its history. All of the operations in the object's history are transactions. As such, they obey all four of the ACID principles.</p>
<p>An operation performed on an object is <strong>atomic</strong>. Remember that there is no method body for an operation. The system simply records that it has occurred. Since there are no imperative steps required to complete the operation, it cannot be partially done. It has either occurred, or it hasn't.</p>
<p>An operation is <strong>consistent</strong>. It exercises only one degree of freedom. Everything that depends upon that operation is represented by dependent data. When the operation is performed, and the dependent data is subsequently observed, it will be found to be consistent with the results of the operation.</p>
<p>An operation is <strong>durable</strong>. The system permanently records that it has occurred. When the object is observed later, the operation will be visible.</p>
<p>An operation is <strong>isolated</strong> from other operations occurring simultaneously. Again, since there are no imperative steps, this is easy to achieve. But there's more to it than that. Either of two operations that have occurred simultaneously could be assumed to have taken place before the other. There is no order prescribed between them. Instead of imposing a full order on the set of operations, we can only define a <a href="http://en.wikipedia.org/wiki/Partially_ordered_set">partial order</a>.</p>
<p><strong>Prerequisites of an operation</strong><br />
Every operation performed on an object is made within the context of prior information. All of the transactions that lead up to the current state of the object are known. These are prerequisites of the next operation.</p>
<p>Prerequisites are operations that must have occurred prior to a given operation. If those prerequisites themselves have prerequisites, we can trace a tree back to its root. This gives us a list of operations that must have occurred in the given order. But parallel branches of this tree that split off from the root could have occurred before or after any other branch.</p>
<p>Going back to the canonical chess board example, we have three operations:</p>
<ul>
<li>CreatePlayer(): Player</li>
<li>CreateGame(black: Player, white: Player): Game</li>
<li>MakeMove(from: int, to: int, game: Game, prior: Move ?): Move</li>
</ul>
<p><a href="../../www.adventuresinsoftware.com/blog/wp-content/uploads/2008/10/chess-game-model.png"><img src="../../www.adventuresinsoftware.com/blog/wp-content/uploads/2008/10/chess-game-model.png" style="border: 0px none " title="chess-game-model.png" alt="chess-game-model.png" align="right" border="0" width="250" height="378" /></a>A game must have two players. Those player objects must have been created prior to the game. Each move is made within the context of one game. The prior move must have been made before the current one. The first move will have a null prior, hence the question mark.</p>
<p>This chain of prerequisites constrains the moves such that they must have been made in the specified order. It makes no sense to play the moves out of order. But if the players decide to start a parallel game, that one is completely isolated. It could have occurred before, after, or during the current game, with no loss of integrity.</p>
<p><strong>Summary</strong><br />
With this, we have enough theory to build a robust synchronization system. This system uses atomic operations for persistence, representation, caching, and communication. It relies upon the three axioms that we've just discussed:</p>
<ul>
<li>All object behavior is either dependent or independent.</li>
<li>An object’s state is dependent upon its history.</li>
<li>Prerequisites define a partial order among transactions.</li>
</ul>
<p>Now it's time to turn the theory into practice.</p>
				</div>

				<p class="postmetadata">Posted in <a href="indexb60a.html?cat=27" title="View all posts in Historic Modeling" rel="category">Historic Modeling</a>,  <a href="index489b.html?cat=34" title="View all posts in Synchronization" rel="category">Synchronization</a> |   <a href="index7d69.html?p=262#respond" title="Comment on Partial order of transactions">No Comments &#187;</a></p>

			</div>

				<div class="post">
				<h3 id="post-258"><a href="indexb773.html?p=258" rel="bookmark" title="Permanent Link to Synchronization of history, not state">Synchronization of history, not state</a></h3>
				<small>Friday, October 17th, 2008</small>

				<div class="entry">
					<p>An object's state is dependent upon its history.</p>
<p>When an object is constructed, it is initialized to a starting state. From then on, every action performed on that object changes its state. If you constructed another object and performed exactly the same actions on it, then it would end up in exactly the same state.</p>
<p>Suppose the object is a chess board. Its initial state has the two teams facing off against each other. Each move alters that state by one or two pieces. Start a new game and make the same moves, and the board will end up in the same position.</p>
<p><strong>Store history</strong>    <br />Caching aside, it is better to store independent data than dependent data. The dependent data can be calculated from the independent data, so there is no loss of information.</p>
<p>But the converse is not true. Several different sequences of moves could lead to the same board position. Given a board position, it is impossible to determine exactly which path was taken to get there.</p>
<p>The current state of an object is usually sufficient to make business decisions. That's why most of our business systems can get by with storing state, not history. A chess player makes his next move based solely on the current position of the pieces.</p>
<p>But the current state of an object does not carry sufficient information for synchronization. Synchronization is all about bringing two or more discrete representations into agreement. If I claim that an object is in one state, and you claim that it is in another, who is right? To decide, we have to go back through the histories and see where they diverge.</p>
<p><strong>Calculate state</strong>    <br />In an imperative object-oriented language, every mutating operation performed on an object causes changes to its member variables. Code inside the body of the method assigns new values to the members of the object. The prior state of the object, combined with the parameters of the method, determine what values get assigned.</p>
<p>If we allow our languages to be more functional and declarative, we could instead express the current state as a function of history. Suppose that there was no code in the method. The object just records the fact that the method was called. Now, move the code to the member variable. Its job is to calculate the value of that member variable given the history of method calls.</p>
<p>With this new declaration of an object, the current state is calculated based on history. From the outside it looks the same. You can call a method, then observe the state of the object to see that it has changed. The difference is that the method call did not imperatively change the state of the object, it just recorded a fact. It was the observation of that object's state, seeing this new fact, that caused the change. And now that the object retains history, it can be easily synchronized.</p>
<p>My synchronization system uses history, not state, to persist, exchange, and represent objects.</p>
				</div>

				<p class="postmetadata">Posted in <a href="indexb60a.html?cat=27" title="View all posts in Historic Modeling" rel="category">Historic Modeling</a>,  <a href="index489b.html?cat=34" title="View all posts in Synchronization" rel="category">Synchronization</a> |   <a href="indexb773.html?p=258#respond" title="Comment on Synchronization of history, not state">No Comments &#187;</a></p>

			</div>

				<div class="post">
				<h3 id="post-257"><a href="index548d.html?p=257" rel="bookmark" title="Permanent Link to Dependent and independent object data">Dependent and independent object data</a></h3>
				<small>Wednesday, October 15th, 2008</small>

				<div class="entry">
					<p>An object has two kinds of data: dependent and independent. Independent data can be changed at any time by a user action. Dependent data is derived from other data in the system.</p>
<p>For example, a Person object has three properties: FirstName, LastName, and FullName. The user can directly set the first and last name, but the full name is derived. The user has no direct control over the full name. She can only influence it by changing the first or last name.</p>
<p>Sometimes it's hard to see the difference between dependent and independent data. Both kinds of data change in response to a user action. The key question is not &quot;when does it change&quot;, but rather &quot;what determines its value&quot;. </p>
<p>The UI might allow the user to enter a full name. When she types a new value, the UI parses the text she enters and determines the first and last names. It sets these two independent properties, and then calculates the full name. If the user entered well-formed input, the calculated output will be exactly the same. If not, the system will have &quot;fixed&quot; her mistakes (extra spaces, inconsistent formatting, etc.)</p>
<p>The number of independent properties is exactly equal to the number of <a href="http://www.adventuresinsoftware.com/blog/?p=169">degrees of freedom</a> that an object has. Ideally, independent properties are unconstrained. Constraints are codified in the dependent properties.</p>
<p><strong>Keep the data flowing</strong>    <br />There are several strategies for updating dependent data. The most straight forward strategy is to recalculate dependent properties directly when an independent property is changed. I could code my person object to set the full name every time the first or last name is changed. This solution is easy to code, but breaks down quickly. For example, when I import a person from a CSV file, the importer writes both the first and last names. My naive implementation would calculate the full name twice.</p>
<p>Another strategy is to keep a marker for dependent data that is out-of-date. When the independent data changes, set the marker. When someone asks for the dependent data, check the marker. This postpones the update and therefore avoids redundancy.</p>
<p>When dependent data in one object relies upon independent data in another, things get even more interesting. If you take the direct approach of notifying the dependent object from the independent one, you end up with tightly coupled objects. The <a href="http://en.wikipedia.org/wiki/Observer_pattern">observer pattern</a> breaks that coupling. There are several other patterns that offer benefits over observer (including <a href="http://updatecontrols.net/">my own</a>) that are too numerous to list here.</p>
<p>Now add to the mix the fact that dependent data may rely on other dependent data. So a change to an independent property should result in the update of all of its direct and indirect dependencies. This could be accomplished through cascading notifications, whereby the direct dependent upon receipt of notice turns around and notifies the indirect dependent. But to avoid potential redundancy or cycles, this is more often handled through dependency analysis. That is certainly too deep for this post.</p>
<p><strong>Ebb and flow</strong>    <br />No matter which strategy you use to update dependent properties, these two types of data create an ebb and flow within a system. A user action directly changes one or more independent properties. Those changes flow back toward the user in the form of dependent properties.</p>
<p>My synchronization framework starts with this fundamental concept. All object behavior is either dependent or independent.</p>
				</div>

				<p class="postmetadata">Posted in <a href="index489b.html?cat=34" title="View all posts in Synchronization" rel="category">Synchronization</a>,  <a href="index2d79.html?cat=26" title="View all posts in dof" rel="category">dof</a> |   <a href="index548d.html?p=257#respond" title="Comment on Dependent and independent object data">No Comments &#187;</a></p>

			</div>

				<div class="post">
				<h3 id="post-256"><a href="index03bd.html?p=256" rel="bookmark" title="Permanent Link to Object representations and transformations">Object representations and transformations</a></h3>
				<small>Monday, October 13th, 2008</small>

				<div class="entry">
					<p>An object has many representations. In a relational database, objects are represented as related tuples. In an object-oriented language, objects are instances of classes that have properties and behaviors. In an XML file, objects are elements conforming to a schema, belonging to other elements, and having both attributes and child elements.</p>
<p>Each representation of an object obeys certain rules. A relational database has foreign key constraints. An object-oriented language has a type system. XML must be well-formed.</p>
<p>Each representation of an object has certain limitations. In a relational database, all related objects must be co-located. In an object-oriented language, not all objects can be loaded into memory simultaneously. In XML, only one narrow branch of a hierarchy can be represented in a single document.</p>
<p>Each representation of an object has its own concept of identity. A relational database has keys. An object-oriented language has references. XML has paths.</p>
<p>When an object crosses the boundary between two representations, it must simultaneously conform to two sets of constraints. To load an object graph from a database into memory, we map ids to references, we map data types, and we store related objects in collections. To turn that object graph into an XML document, we traverse the collections hierarchically, convert non-hierarchical references into paths, and serialize it according to a documented schema.</p>
<p>I am building a framework for moving objects across boundaries while preserving their integrity. This system has its own concept of identity, its own set of rules, and its own limitations. Rather than trying to accommodate all of the other possible representations, I've started from scratch. In the coming posts, I'll define the system.</p>
				</div>

				<p class="postmetadata">Posted in <a href="index489b.html?cat=34" title="View all posts in Synchronization" rel="category">Synchronization</a> |   <a href="index03bd.html?p=256#comments" title="Comment on Object representations and transformations">3 Comments &#187;</a></p>

			</div>

				<div class="post">
				<h3 id="post-255"><a href="index0c93.html?p=255" rel="bookmark" title="Permanent Link to Moving bits">Moving bits</a></h3>
				<small>Friday, October 10th, 2008</small>

				<div class="entry">
					<p>I'm solving the same problem again. I have an object written in C# that I need to store in a database.</p>
<p>Even though I've expressed the object in C#, I need to also express the same object in XSD and in SQL. I've run &quot;xsd.exe&quot; to generate a memento class that contains the data but no business logic. I've written code to move the data from the business object into the memento class, serialize it to XML, and send it to the server. On the server, I've written code to receive the XML, deserialize it back to a memento, and turn it into a stored procedure call. I've written the stored procedure to update the row, unless it does not exist in which case it inserts.</p>
<p>I've done all this before. Every time the domain model changes, I do it all over again. Every year some new technology comes out that replaces part of the old stack, and I start writing the same code for that.</p>
<p>This stops now.</p>
				</div>

				<p class="postmetadata">Posted in <a href="index489b.html?cat=34" title="View all posts in Synchronization" rel="category">Synchronization</a> |   <a href="index0c93.html?p=255#respond" title="Comment on Moving bits">No Comments &#187;</a></p>

			</div>

		
		<div class="navigation">
			<div class="alignleft"></div>
			<div class="alignright"></div>
		</div>

	
	</div>
		</td>
	</tr>
</table>

<hr />
<div id="footer">
<!-- If you'd like to support WordPress, having the "powered by" link someone on your blog is the best way, it's our only promotion or advertising. -->
	<p>
		Adventures in Software is proudly powered by 
		<a href="http://wordpress.org/">WordPress</a>
		<br /><a href="indexd784.html?feed=rss2">Entries (RSS)</a>
		and <a href="indexa6da.html?feed=comments-rss2">Comments (RSS)</a>.
		<!-- 17 queries. 0.347 seconds. -->
	</p>
</div>
<script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
try {
var pageTracker = _gat._getTracker("UA-389401-3");
pageTracker._trackPageview();
} catch(err) {}</script></div>

<!-- Gorgeous design by Michael Heilemann - http://binarybonsai.com/kubrick/ -->

		<div id="sk2-footer" style="color:#FFF; background-color:#444; padding: 3px 2px 3px 2px; border-top: #888 solid 1px;">This blog is protected by <a href="http://unknowngenius.com/blog/" title="Dave">dr Dave</a>'s <strong><a href="http://unknowngenius.com/blog/wordpress/spam-karma/" title="SK2">Spam Karma 2</a></strong>: <strong>274531</strong>  Spams eaten and counting...</div><script type="text/javascript" src="replies.js"></script>
<script type="text/javascript" src="blogger.js"></script>
<script type="text/javascript" src="http://twitter.com/statuses/user_timeline/michaellperry.json?callback=twitterCallback2&amp;count=5"></script>
<script type="text/javascript" src="http://search.twitter.com/search.json?q=@michaellperry&amp;callback=twitterCallbackReplies&amp;rpp=5"></script>
</body>

<!-- Mirrored from adventuresinsoftware.com/blog/?m=200810 by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 13 Jan 2017 12:47:45 GMT -->
</html>
