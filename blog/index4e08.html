<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr">


<!-- Mirrored from adventuresinsoftware.com/blog/?paged=33 by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 13 Jan 2017 13:11:13 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- /Added by HTTrack -->
<head profile="http://gmpg.org/xfn/11">
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />

<title>Adventures in Software  </title>

<meta name="generator" content="WordPress 2.3.3" /> <!-- leave this for stats -->

<link rel="stylesheet" href="wp-content/themes/ais2/style.css" type="text/css" media="screen" />
<link rel="alternate" type="application/rss+xml" title="Adventures in Software RSS Feed" href="indexd784.html?feed=rss2" />
<link rel="pingback" href="xmlrpc.html" />
    <script type="text/javascript">
        function onSilverlightError(sender, args) {
            var appSource = "";
            if (sender != null && sender != 0) {
              appSource = sender.getHost().Source;
            }
            
            var errorType = args.ErrorType;
            var iErrorCode = args.ErrorCode;

            if (errorType == "ImageError" || errorType == "MediaError") {
              return;
            }

            var errMsg = "Unhandled Error in Silverlight Application " +  appSource + "\n" ;

            errMsg += "Code: "+ iErrorCode + "    \n";
            errMsg += "Category: " + errorType + "       \n";
            errMsg += "Message: " + args.ErrorMessage + "     \n";

            if (errorType == "ParserError") {
                errMsg += "File: " + args.xamlFile + "     \n";
                errMsg += "Line: " + args.lineNumber + "     \n";
                errMsg += "Position: " + args.charPosition + "     \n";
            }
            else if (errorType == "RuntimeError") {           
                if (args.lineNumber != 0) {
                    errMsg += "Line: " + args.lineNumber + "     \n";
                    errMsg += "Position: " +  args.charPosition + "     \n";
                }
                errMsg += "MethodName: " + args.methodName + "     \n";
            }

            throw new Error(errMsg);
        }
    </script>

	<link rel="EditURI" type="application/rsd+xml" title="RSD" href="xmlrpc0db0.php?rsd" />
 <link rel="wlwmanifest" type="application/wlwmanifest+xml" href="wp-includes/wlwmanifest.xml" /> <style type='text/css'>
<!--#header { background: url('wp-content/themes/ais2/images/header-imgae03.html?upper=A7A73F&amp;lower=77773F') no-repeat bottom center; }
--></style>
</head>
<body>
<div id="page">

<div class="aisTopBar">
	<form method="get" id="searchform" action="http://adventuresinsoftware.com/blog/">
<div>
<a href="indexd784.html?feed=rss2"><img src="../images/feed-icon-28x28.png" border="0"></a>
<input type="text" value="" name="s" id="s" />
<input type="submit" id="searchsubmit" value="Search" />
</div>
</form>
</div>

<div class="aisHeaderImageRight">
	<div class="aisHeaderImage">
	<div class="aisHeaderCornerRight">
	<div class="aisHeaderCornerLeft">
	<div class="aisImageBar">
	<div class="aisSubSites">
		<a href="index.html" class="aisSubSiteLink"><span class="aisSiteTabRight"><span class="aisSiteTabLeft"><span class="aisSiteTab">
			home</span></span></span></a>
		<a class="aisSubSiteLink" href="indexb60a.html?cat=27"><span class="aisSiteTabRight"><span class="aisSiteTabLeft"><span class="aisSiteTab">
			historic modeling</span></span></span></a>
		<a class="aisSubSiteLink" href="indexa88f.html?cat=36"><span class="aisSiteTabRight"><span class="aisSiteTabLeft"><span class="aisSiteTab">
			update controls</span></span></span></a>
		<a href="index2d79.html?cat=26" class="aisSubSiteLink"><span class="aisSiteTabRight"><span class="aisSiteTabLeft"><span class="aisSiteTab">
			degrees of freedom</span></span></span></a>
		<a class="aisSubSiteLink" href="indexba53.html?page_id=2"><span class="aisSiteTabRight"><span class="aisSiteTabLeft"><span class="aisSiteTab">
			about us</span></span></span></a>

	</div>
	</div>
	</div>
	</div>
	</div>
</div>

<table style="width: 100%" cellspacing="0" cellpadding="0">
	<tr valign="top">
		<td width="210px">
<div id="sidebar">
<div class="aisLeftColumnFill">
<div class="aisLeftColumnBottom">
<div class="aisLeftColumnTop">
<div id="twitter_div" class="aisLeftNav">
<h2 class="sidebar-title">Twitter Updates</h2>
<ul id="twitter_update_list"></ul>
<a href="http://twitter.com/michaellperry" id="follow">Follow me</a>
</div>
<div id="twitter_reply_div" class="aisLeftNav">
<h2 class="sidebar-title">Twitter Replies</h2>
<ul id="twitter_reply_list"></ul>
</div>

<div class="aisLeftNav">
<a href='http://ineta.org/Speakers/SearchCommunitySpeakers.aspx?SpeakerId=c5110e21-9243-461b-a464-a6548524e885'><img alt='INETA Community Speakers Program' border='0' src='../../www.ineta.org/images/OfficialLogos/InetaCommunitySpeakersRequestMe.html' /></a>
</div>

<div class="aisLeftNav">
	<li class="pagenav"><h2>Pages</h2><ul><li class="page_item page-item-2"><a href="indexba53.html?page_id=2" title="About Us">About Us</a></li>
<li class="page_item page-item-210"><a href="index6ae3.html?page_id=210" title="Templates">Templates</a></li>
</ul></li></div>

<div class="aisLeftNav">
<h2>Archives</h2>
<ul>
	<li><a href='indexb4d5.html?m=201110' title='October 2011'>October 2011</a></li>
	<li><a href='indexc61a.html?m=201106' title='June 2011'>June 2011</a></li>
	<li><a href='indexa80d.html?m=201105' title='May 2011'>May 2011</a></li>
	<li><a href='index512b.html?m=201104' title='April 2011'>April 2011</a></li>
	<li><a href='index08fb.html?m=201103' title='March 2011'>March 2011</a></li>
	<li><a href='index52f4.html?m=201102' title='February 2011'>February 2011</a></li>
	<li><a href='index74f1.html?m=201101' title='January 2011'>January 2011</a></li>
	<li><a href='index8956.html?m=201012' title='December 2010'>December 2010</a></li>
	<li><a href='indexa1aa.html?m=201011' title='November 2010'>November 2010</a></li>
	<li><a href='indexe3d5.html?m=201010' title='October 2010'>October 2010</a></li>
	<li><a href='index9ab9.html?m=201009' title='September 2010'>September 2010</a></li>
	<li><a href='index1ff0.html?m=201008' title='August 2010'>August 2010</a></li>
	<li><a href='index9f11.html?m=201007' title='July 2010'>July 2010</a></li>
	<li><a href='index31f0.html?m=201006' title='June 2010'>June 2010</a></li>
	<li><a href='indexd189.html?m=201005' title='May 2010'>May 2010</a></li>
	<li><a href='indexb5c0.html?m=201004' title='April 2010'>April 2010</a></li>
	<li><a href='indexf258.html?m=201003' title='March 2010'>March 2010</a></li>
	<li><a href='index6e30.html?m=201002' title='February 2010'>February 2010</a></li>
	<li><a href='index6b19.html?m=201001' title='January 2010'>January 2010</a></li>
	<li><a href='index5c0a.html?m=200912' title='December 2009'>December 2009</a></li>
	<li><a href='index8f62.html?m=200911' title='November 2009'>November 2009</a></li>
	<li><a href='index451d.html?m=200910' title='October 2009'>October 2009</a></li>
	<li><a href='index3e04.html?m=200909' title='September 2009'>September 2009</a></li>
	<li><a href='index425a.html?m=200908' title='August 2009'>August 2009</a></li>
	<li><a href='index9907.html?m=200907' title='July 2009'>July 2009</a></li>
	<li><a href='index3104.html?m=200906' title='June 2009'>June 2009</a></li>
	<li><a href='indexc36d.html?m=200905' title='May 2009'>May 2009</a></li>
	<li><a href='index17e8.html?m=200904' title='April 2009'>April 2009</a></li>
	<li><a href='index10a5.html?m=200903' title='March 2009'>March 2009</a></li>
	<li><a href='index8988.html?m=200902' title='February 2009'>February 2009</a></li>
	<li><a href='index1419.html?m=200901' title='January 2009'>January 2009</a></li>
	<li><a href='index7866.html?m=200812' title='December 2008'>December 2008</a></li>
	<li><a href='index55f6.html?m=200811' title='November 2008'>November 2008</a></li>
	<li><a href='indexa7bc.html?m=200810' title='October 2008'>October 2008</a></li>
	<li><a href='indexe77c.html?m=200809' title='September 2008'>September 2008</a></li>
	<li><a href='indexcffc.html?m=200808' title='August 2008'>August 2008</a></li>
	<li><a href='index0e62.html?m=200807' title='July 2008'>July 2008</a></li>
	<li><a href='indexfda7.html?m=200806' title='June 2008'>June 2008</a></li>
	<li><a href='index7d64.html?m=200805' title='May 2008'>May 2008</a></li>
	<li><a href='index94dd.html?m=200804' title='April 2008'>April 2008</a></li>
	<li><a href='index9631.html?m=200803' title='March 2008'>March 2008</a></li>
	<li><a href='indexdd52.html?m=200802' title='February 2008'>February 2008</a></li>
	<li><a href='index21ee.html?m=200801' title='January 2008'>January 2008</a></li>
	<li><a href='index363c.html?m=200712' title='December 2007'>December 2007</a></li>
	<li><a href='index7493.html?m=200711' title='November 2007'>November 2007</a></li>
	<li><a href='index93a7.html?m=200710' title='October 2007'>October 2007</a></li>
	<li><a href='index4ca8.html?m=200709' title='September 2007'>September 2007</a></li>
	<li><a href='index6124.html?m=200708' title='August 2007'>August 2007</a></li>
	<li><a href='index6013.html?m=200707' title='July 2007'>July 2007</a></li>
	<li><a href='index2ab6.html?m=200706' title='June 2007'>June 2007</a></li>
	<li><a href='index44f0.html?m=200705' title='May 2007'>May 2007</a></li>
	<li><a href='indexf0b4.html?m=200704' title='April 2007'>April 2007</a></li>
	<li><a href='index481d.html?m=200703' title='March 2007'>March 2007</a></li>
	<li><a href='indexcbea.html?m=200702' title='February 2007'>February 2007</a></li>
	<li><a href='index9cdc.html?m=200701' title='January 2007'>January 2007</a></li>
	<li><a href='index3ea4.html?m=200612' title='December 2006'>December 2006</a></li>
	<li><a href='index67ca.html?m=200611' title='November 2006'>November 2006</a></li>
	<li><a href='indexff49.html?m=200610' title='October 2006'>October 2006</a></li>
	<li><a href='index611c.html?m=200609' title='September 2006'>September 2006</a></li>
	<li><a href='index9a21.html?m=200608' title='August 2006'>August 2006</a></li>
	<li><a href='index3ee9.html?m=200607' title='July 2006'>July 2006</a></li>
	<li><a href='indexe13a.html?m=200606' title='June 2006'>June 2006</a></li>
</ul>
</div>

<div class="aisLeftNav">
			<li id="linkcat-16" class="linkcat"><h2>Blogroll</h2>
	<ul>
<li><a href="http://ayende.com/Blog">Ayende Rahien</a></li>
<li><a href="http://www.softinsight.com/bnoyes/default.aspx">Brian Noyes</a></li>
<li><a href="http://chriskoenig.net/">Chris Koenig</a></li>
<li><a href="http://scienceblogs.com/goodmath/" title="MarkCC reveals the beauty in mathematics and exposes its misuse.">Good Math, Bad Math</a></li>
<li><a href="http://joshsmithonwpf.wordpress.com/">Josh Smith on WPF</a></li>
<li><a href="http://west-wind.com/Weblog/default.aspx">Rick Strahl</a></li>
<li><a href="http://www.udidahan.com/?blog=true">Udi Dahan</a></li>

	</ul>
</li>
<li id="linkcat-17" class="linkcat"><h2>Links</h2>
	<ul>
<li><a href="http://www.absg.com/" title="my day job">ABSG</a></li>
<li><a href="http://www.d20universe.com/" title="my friends boostrap">d20 Universe</a></li>
<li><a href="http://updatecontrols.net/" title="my open source project">Update Controls .NET</a></li>

	</ul>
</li>
<li id="linkcat-32" class="linkcat"><h2>Podroll</h2>
	<ul>
<li><a href="http://dotnetrocks.com/" title="Interviews with leaders in the .NET community.">.NET Rocks!</a></li>
<li><a href="http://hanselminutes.com/" title="News and interviews from all aspects of software, with an insider&#039;s view of Microsoft.">Hanselminutes</a></li>

	</ul>
</li>
	</div>

<div class="aisLeftNav">
<h2>Books</h2>
<iframe src="http://rcm.amazon.com/e/cm?t=adventures0d2-20&amp;o=1&amp;p=8&amp;l=as1&amp;asins=0764526413&amp;fc1=000000&amp;IS2=1&amp;lt1=_blank&amp;lc1=0000ff&amp;bc1=000000&amp;bg1=ffffff&amp;f=ifr" style="width:120px;height:240px;" scrolling="no" marginwidth="0" marginheight="0" frameborder="0" name="I5" id="I5"></iframe>
<br/>
<iframe src="http://rcm.amazon.com/e/cm?t=adventures0d2-20&amp;o=1&amp;p=8&amp;l=as1&amp;asins=0201633612&amp;fc1=000000&amp;IS2=1&amp;lt1=_blank&amp;lc1=0000ff&amp;bc1=000000&amp;bg1=ffffff&amp;f=ifr" style="width:120px;height:240px;" scrolling="no" marginwidth="0" marginheight="0" frameborder="0" name="I6" id="I6"></iframe>
<br/>
<iframe src="http://rcm.amazon.com/e/cm?t=adventures0d2-20&amp;o=1&amp;p=8&amp;l=as1&amp;asins=0136291554&amp;fc1=000000&amp;IS2=1&amp;lt1=_blank&amp;lc1=0000ff&amp;bc1=000000&amp;bg1=ffffff&amp;f=ifr" style="width:120px;height:240px;" scrolling="no" marginwidth="0" marginheight="0" frameborder="0" name="I7" id="I7"></iframe>
<br/>
<iframe src="http://rcm.amazon.com/e/cm?t=adventures0d2-20&amp;o=1&amp;p=8&amp;l=as1&amp;asins=1888009195&amp;fc1=000000&amp;IS2=1&amp;lt1=_blank&amp;lc1=0000ff&amp;bc1=000000&amp;bg1=ffffff&amp;f=ifr" style="width:120px;height:240px;" scrolling="no" marginwidth="0" marginheight="0" frameborder="0" name="I8" id="I8"></iframe>
</div>
<div class="aisLeftNav">
<h2>Meta</h2>
<ul>
		<li><a href="wp-login.html">Login</a></li>
	<li><a href="http://validator.w3.org/check/referer" title="This page validates as XHTML 1.0 Transitional">Valid <abbr title="eXtensible HyperText Markup Language">XHTML</abbr></a></li>
	<li><a href="http://gmpg.org/xfn/"><abbr title="XHTML Friends Network">XFN</abbr></a></li>
	<li><a href="http://wordpress.org/" title="Powered by WordPress, state-of-the-art semantic personal publishing platform.">WordPress</a></li>
	</ul>
</div>
<div class="aisLeftContent">
<h2>Community</h2>
<ul>
	<script type="text/javascript" src="../../localhost/embed/92q2bbma.js"></script>
</ul>
</div>

</div></div></div>
</div>		</td>
		<td>

	<div id="content" class="narrowcolumn">

	
		
			<div class="post" id="post-76">
				<h2><a href="index04cd.html?p=76" rel="bookmark" title="Permanent Link to Paging in a MySQL Stored Procedure">Paging in a MySQL Stored Procedure</a></h2>
				<small>January 5th, 2007 <!-- by Michael L Perry --></small>

				<div class="entry">
					<p>At Handmark, we make on-line services for both cell phones and web browsers. A common need on both platforms is to return search results to the client a page  at a time. The way to accomplish this in MySQL is to use the LIMIT ... OFFSET clause. Unfortunately, this doesn't work so well in a stored procedure.</p>
<p>The parameters of LIMIT ... OFFSET are the number of rows to return, and the number of rows to skip. So if you want to display 25 rows at a time you end your SELECT statement with LIMIT 25 OFFSET 0. When the user clicks the "next" button, you use LIMIT 25 OFFSET 25.</p>
<p>Mobile devices come in many different sizes and form factors. A Windows Mobile Pocket PC has a larger screen than a Blackberry, for example, and can therefore display more results per page without scrolling. We adjust the number of results based on the device type to optimize the user experience.</p>
<p>The combination of these concerns means that the parameters to the LIMIT ... OFFSET clause must be soft. We cannot hardcode them into our stored procedures, nor can we afford to maintain several different procedures with different hardcoded values. But it would seem that the designers of MySQL expect us to do just that, since you cannot use procedure parameters with this clause.</p>
<p><strong>Here's my solution</strong><br />
There are several quirks that I discovered on the road to getting this working correctly. Some of them I am convinced are simply bugs, and will probably be fixed soon. But the pattern that I found to work is to prepare a statement, then call it using user-defined "@" variables. The actual stored procedure parameters won't work.</p>
<pre>DELIMITER $$

CREATE PROCEDURE call_log_by_user_enum_v1(
    IN i_user_id INT,
    IN i_limit INT,
    IN i_offset INT,
    OUT o_count INT )
BEGIN
    SET TRANSACTION ISOLATION LEVEL READ UNCOMMITTED;
    SET o_count = (SELECT COUNT(1) FROM call_log WHERE user_id = i_user_id);

    PREPARE ps FROM 'SELECT call_date, command
        FROM call_log
        WHERE user_id = ?
        LIMIT ? OFFSET ?';

    SET @v_user_id = i_user_id;
    SET @v_limit = i_limit;
    SET @v_offset = i_offset;
    EXECUTE ps USING @v_user_id, @v_limit, @v_offset;
    DROP PREPARE ps;
END$$

DELIMITER ;</pre>
<p>A recent release has thankfully allowed the limit clause in a prepared statement to accept "?" placeholders. Prior to that release, you had to concatenate the SQL string in a variable (an "@" variable, not a DECLAREd variable). That's one small step toward the right solution, but there are still a couple more to take.</p>
				</div>

				<p class="postmetadata">Posted in <a href="indexc728.html?cat=7" title="View all posts in Databases" rel="category">Databases</a> |   <a href="index04cd.html?p=76#comments" title="Comment on Paging in a MySQL Stored Procedure">1 Comment &#187;</a></p>
			</div>

		
			<div class="post" id="post-75">
				<h2><a href="indexe839.html?p=75" rel="bookmark" title="Permanent Link to AiS 7: Techniques for Quality Improvement">AiS 7: Techniques for Quality Improvement</a></h2>
				<small>January 3rd, 2007 <!-- by Michael L Perry --></small>

				<div class="entry">
					<p><a href="http://media.libsyn.com/media/ais/AiS7.mp3">Listen Now</a><br />
User interaction design<br />
Unit testing<br />
Automated testing<br />
Code generation<br />
Contract-based design<br />
Use-case analysis<br />
Litterate programming</p>
				</div>

				<p class="postmetadata">Posted in <a href="indexb5e7.html?cat=15" title="View all posts in Shows" rel="category">Shows</a> |   <a href="indexe839.html?p=75#respond" title="Comment on AiS 7: Techniques for Quality Improvement">No Comments &#187;</a></p>
			</div>

		
			<div class="post" id="post-74">
				<h2><a href="index49a5.html?p=74" rel="bookmark" title="Permanent Link to Unable to call a stored procedure in MySQL">Unable to call a stored procedure in MySQL</a></h2>
				<small>December 28th, 2006 <!-- by Michael L Perry --></small>

				<div class="entry">
					<p>You've created a procedure in MySQL 5. You've granted EXECUTE privileges to your application's user account. But when your application prepares a statement to call that procedure, an exception is thrown. Perhaps it's a NullPointerException deep inside of ConnectorJ. Perhaps the exception claims that the procedure does not exist. Or perhaps you've gotten lucky enough to get the exception that leads you down the right path (Driver requires declaration of procedure to either contain a ''\nbegin'' or ''\n'' to follow argument declaration, or SELECT privilege on mysql.proc to parse column types). Here are the troubleshooting steps that I've gleaned from hours of searching the MySQL forums.</p>
<p>First, open two console windows. In one, log into MySQL as the application user. In the other, log in as root. In your app window, list the databases.</p>
<pre>SHOW DATABASES;</pre>
<p>If your application's database does not appear, then you should go to your root window and grant database privileges.</p>
<pre>USE mydatabase;
GRANT ALL ON mydatabase TO appuser;</pre>
<p>Now go back to the app window. List the databases again to ensure that it appears. Now that it does, go into it.</p>
<pre>USE mydatabase;</pre>
<p>Once you're in, try to view the procedure.</p>
<pre>SHOW CREATE PROCEDURE myproc /G</pre>
<p>One of three things will happen. If you get a message saying "PROCEDURE myproc does not exist" then the app user does not have privileges for it. Go back to the root window and grant them.</p>
<pre>GRANT EXECUTE ON PROCEDURE myproc TO appuser;</pre>
<p>The second thing that might happen is that the procedure will be found, but the body will not be listed. Instead, it will say "Create Procedure: NULL". If so, go back to the root window and take care of that.</p>
<pre>GRANT SELECT ON mysql.proc TO appuser;</pre>
<p>The third thing that could happen is what you want to happen; the body of the procedure will be listed. Now you should be able to call the procedure from your application.</p>
<p><strong>Warnings<br />
</strong>You may be tempted to take a couple of short-cuts to resolve problems like these. Please don't. Shortcuts may cause bigger problems down the road.</p>
<p>The first thing you might try is to use the root account from within your application. This is extremely dangerous. Security comes in layers. While you should use stored procedures and prepared statements to avoid SQL injection attacks, you should also apply the principle of least privilege just in case they occur anyway. Allowing your application to connect as root gives an attacker access to your most valuable resource: your data. But giving each part of the application a separate account with only the privilege that it requires quarantines the bad guy.</p>
<p>The second thing that you might try after hours of research is to set the "noAccessToProcedureBodies" flag in the ConnectorJ connection string. Please avoid this flag, as it circumvents the parameter type checking that the JDBC driver provides for you. This flag causes ConnectorJ to convert all of the parameters to strings, which MySQL will then convert back to the required type.</p>
<p>But by walking through the problem step-by-step, these short-cuts should not be necessary.</p>
				</div>

				<p class="postmetadata">Posted in <a href="indexc728.html?cat=7" title="View all posts in Databases" rel="category">Databases</a> |   <a href="index49a5.html?p=74#respond" title="Comment on Unable to call a stored procedure in MySQL">No Comments &#187;</a></p>
			</div>

		
			<div class="post" id="post-73">
				<h2><a href="index8cae.html?p=73" rel="bookmark" title="Permanent Link to Episode 6: Datacenter Separation">Episode 6: Datacenter Separation</a></h2>
				<small>December 26th, 2006 <!-- by Michael L Perry --></small>

				<div class="entry">
					<p><a href="http://media.libsyn.com/media/ais/AiS6.mp3">Listen Now</a></p>
<p>Advice on keeping development and production servers separate.</p>
				</div>

				<p class="postmetadata">Posted in <a href="indexb5e7.html?cat=15" title="View all posts in Shows" rel="category">Shows</a> |   <a href="index8cae.html?p=73#respond" title="Comment on Episode 6: Datacenter Separation">No Comments &#187;</a></p>
			</div>

		
			<div class="post" id="post-72">
				<h2><a href="indexae74.html?p=72" rel="bookmark" title="Permanent Link to Episode 5: Web Services">Episode 5: Web Services</a></h2>
				<small>December 19th, 2006 <!-- by Michael L Perry --></small>

				<div class="entry">
					<p><a href="http://media.libsyn.com/media/ais/AiS5.mp3">Listen Now</a></p>
<p>Lessons Learned about Web Services:</p>
<p>Lesson #1 - Don't put example code from books into production code.<br />
Lesson #2 - Don't reinvent the wheel.<br />
Lesson #3 - Don't jump on the early technology that is not fully proven.<br />
Lesson #4 - Don't expect interoperability between programming platforms or libraries right out of the box (or in version 1.0).</p>
				</div>

				<p class="postmetadata">Posted in <a href="indexb5e7.html?cat=15" title="View all posts in Shows" rel="category">Shows</a> |   <a href="indexae74.html?p=72#respond" title="Comment on Episode 5: Web Services">No Comments &#187;</a></p>
			</div>

		
			<div class="post" id="post-71">
				<h2><a href="index6cf3.html?p=71" rel="bookmark" title="Permanent Link to Unhelpful Error Message in Eclipse">Unhelpful Error Message in Eclipse</a></h2>
				<small>December 18th, 2006 <!-- by Michael L Perry --></small>

				<div class="entry">
					<p>I'm a big fan of the Eclipse Java IDE. I think it is at least on generation ahead of Microsoft's Visual Studio IDE. However, even Eclipse has some poorly designed features.</p>
<p>Take, for example, the error message infrastructure. Instead of handling errors in useful ways, or better yet just doing the right thing in the first place, they wrap all exceptions and present the same useless UI for everything. Here's an example:</p>
<p><img src="../../www.adventuresinsoftware.com/blog/wp-content/uploads/2006/12/refactoring.jpg" /></p>
<p>The message box tells me that an exception was caught (not helpful), and that the reason was that it encountered a problem (not helpful). It gives me the options of either undoing or aborting the refactoring, which sound a lot like the same thing. Then when I ask for more details, it tells me again that it encountered a problem.</p>
<p>To reproduce this error, you must install the Subclipse plugin to manage a project in Subversion. Delete a package. The package will not actually be deleted, since the change has not been committed to SVN. Then try to move a class into the deleted package. You can see how the separate concerns of Java packages, file systems, source control, and refactoring have all combined to produce a mess of a situation.</p>
				</div>

				<p class="postmetadata">Posted in <a href="index81ea.html?cat=3" title="View all posts in Error messages" rel="category">Error messages</a>,  <a href="index5b0d.html?cat=12" title="View all posts in Java" rel="category">Java</a> |   <a href="index6cf3.html?p=71#respond" title="Comment on Unhelpful Error Message in Eclipse">No Comments &#187;</a></p>
			</div>

		
			<div class="post" id="post-69">
				<h2><a href="indexe2dc.html?p=69" rel="bookmark" title="Permanent Link to Lazy Logging">Lazy Logging</a></h2>
				<small>December 15th, 2006 <!-- by Michael L Perry --></small>

				<div class="entry">
					<p>I sometimes see coders trying to optimize their logging. Since it takes time to format log messages, they will first test whether logging is enabled:</p>
<pre>Logger log = Logger.getLogger(MyClass.class);
if (log.isInfoEnabled())
    log.info( "Processing customer " + customer.getName() +"." );</pre>
<p>The info() method already checks whether logging is enabled, but this additional check avoids the string concatenation. String formatting and manipulation is surprisingly expensive, so it is undesirable to take this hit only to have no effect.</p>
<p>However, this type of checking is just a distraction. Fortunately, Log4J gives you an option. The parameter to info() is not a String, as you might think by looking at this example code. It is actually an Object. Log4J will call toString() on the object you pass in. Furthermore, it will only call toString() if it really does log the message. We can take advantage of this to clean up our code.</p>
<p><strong>Here's my solution</strong><br />
I've created a class that performs string concatenation and formatting inside of the toString() method. It caches the result so that multiple calls to toString() don't repeat the work. However, if toString() is never called, the expensive operations are never performed. Using this class, the logging code looks like this:</p>
<pre>Logger log = Logger.getLogger(MyClass.class);
log.info( StringFormatter.format("Processing customer {name}.").
    set("name", customer.getName()) );</pre>
<p>Downlaod the source code here: <a id="p68" href="http://www.adventuresinsoftware.com/blog/wp-content/uploads/2006/12/stringformatter.zip">stringformatter.zip</a>.</p>
				</div>

				<p class="postmetadata">Posted in <a href="index5b0d.html?cat=12" title="View all posts in Java" rel="category">Java</a>,  <a href="indexb946.html?cat=5" title="View all posts in Logging" rel="category">Logging</a> |   <a href="indexe2dc.html?p=69#respond" title="Comment on Lazy Logging">No Comments &#187;</a></p>
			</div>

		
			<div class="post" id="post-67">
				<h2><a href="index96f1.html?p=67" rel="bookmark" title="Permanent Link to Thanks, Steve">Thanks, Steve</a></h2>
				<small>December 13th, 2006 <!-- by Michael L Perry --></small>

				<div class="entry">
					<p>Just a quick note to Steve Jobs and all the talented people at Apple. Thank you for fixing my iPod.</p>
<p>I have a fifth generation, and I just recently upgraded the firmware. Yes, I'm slow to adopt new versions of software. And iTunes 7 has not had a spotless reputation, so I was particularly reluctant to upgrade. But now that I have, I couldn't be happier.</p>
<p>iTunes 7 adds a few features that really amount to little more than iCandy. But even so, that sugar tastes pretty good. In particular, I love cover flow. It acknowledges my conceptual model of music by displaying the artwork of all my albums. Sure, we all know that digital music is stored in files, not on circular disks in square covers, but we still think in the album-oriented metaphor. It's good of Apple to give a nod to a music-lover's way of thinking.</p>
<p>But it's the firmware upgrade for my iPod that really has me singing Steve's praise. With absolutely no work on my part, Apple has restored the continuous experience of listening to my Pink Floyd and Frank Zappa albums. The tiny quarter-second gap that it used to put between consecutive tracks is finally gone. I had previously edited together all 21 tracks of They Might Be Giants' "Fingertips" because the fractional pause every twenty seconds was driving me crazy. This is a fix long overdue.</p>
<p>The iTunes 7 experience is not completely without flaws, however. As I mentioned on Episode 4 of the Adventures in Software talk show, cover flow highlights an identity problem with the file-oriented implementation model. Since albums don't have identity, iTunes sometimes gets confused and displays multiple copies of the same album art. Perhaps a fix in iTunes 7.1?</p>
				</div>

				<p class="postmetadata">Posted in <a href="indexd65e.html?cat=8" title="View all posts in User Interface" rel="category">User Interface</a> |   <a href="index96f1.html?p=67#respond" title="Comment on Thanks, Steve">No Comments &#187;</a></p>
			</div>

		
			<div class="post" id="post-66">
				<h2><a href="index4f61.html?p=66" rel="bookmark" title="Permanent Link to Episode 4: Identity-Based Patterns">Episode 4: Identity-Based Patterns</a></h2>
				<small>December 12th, 2006 <!-- by Michael L Perry --></small>

				<div class="entry">
					<p><a href="http://media.libsyn.com/media/ais/AiS4.mp3">Listen Now</a></p>
<p>Java Enums:<br />
<a href="http://www.javaworld.com/javaworld/jw-07-1997/jw-07-enumerated.html">http://www.javaworld.com/javaworld/jw-07-1997/jw-07-enumerated.html</a><br />
<a href="http://www.javaworld.com/javaworld/javatips/jw-javatip122.html">http://www.javaworld.com/javaworld/javatips/jw-javatip122.html</a><br />
<a href="http://java.sun.com/j2se/1.5.0/docs/guide/language/enums.html">http://java.sun.com/j2se/1.5.0/docs/guide/language/enums.html</a></p>
<p>Command:<br />
<a href="http://en.wikipedia.org/wiki/Command_pattern">http://en.wikipedia.org/wiki/Command_pattern</a></p>
<p>Easy Mock (Java only)<br />
<a href="http://www.easymock.org/">http://www.easymock.org/</a></p>
<p>NMock<br />
<a href="http://nmock.org/">http://nmock.org/</a></p>
<p>.Net port of Easy Mock<br />
<a href="http://www.easymock.net/">http://www.easymock.net/</a></p>
<p>Action command object:<br />
<a href="http://java.sun.com/j2se/1.5.0/docs/api/javax/swing/Action.html">http://java.sun.com/j2se/1.5.0/docs/api/javax/swing/Action.html</a></p>
<p>Strategy:<br />
<a href="http://en.wikipedia.org/wiki/Strategy_pattern">http://en.wikipedia.org/wiki/Strategy_pattern</a></p>
<p>State:<br />
<a href="http://en.wikipedia.org/wiki/State_pattern">http://en.wikipedia.org/wiki/State_pattern</a></p>
<p>Lex<br />
<a href="http://en.wikipedia.org/wiki/Lex_programming_tool">http://en.wikipedia.org/wiki/Lex_programming_tool</a></p>
<p>Microsoft Windows Workflow Foundation<br />
<a href="http://msdn.microsoft.com/workflow">http://msdn.microsoft.com/workflow</a></p>
				</div>

				<p class="postmetadata">Posted in <a href="indexb0b7.html?cat=6" title="View all posts in Patterns" rel="category">Patterns</a>,  <a href="indexb5e7.html?cat=15" title="View all posts in Shows" rel="category">Shows</a> |   <a href="index4f61.html?p=66#respond" title="Comment on Episode 4: Identity-Based Patterns">No Comments &#187;</a></p>
			</div>

		
			<div class="post" id="post-65">
				<h2><a href="index7665.html?p=65" rel="bookmark" title="Permanent Link to MySQL LAST_INSERT_ID() is Broken, Too">MySQL LAST_INSERT_ID() is Broken, Too</a></h2>
				<small>December 11th, 2006 <!-- by Michael L Perry --></small>

				<div class="entry">
					<p>Stored procedures are finally supported in MySQL 5. This makes for better encapsulation of the database, and gives us hooks for logging and optimization. However, it also means that we have to find our way through a new set of gotchas.</p>
<p>We've defined a stored procedure that inserts data into three separate tables. The ID of the first table is used as a foriegn key in the second, and the ID of the second table is used in the third. This revealed a problem with the LAST_INSERT_ID() function. Here's the code:</p>
<pre>    INSERT queue_user (queue_user_name) VALUES (publisher);
    SET publisher_id = LAST_INSERT_ID();
    INSERT queue_entry (publisher_queue_user_id)
    VALUES (publisher_id);
    SET entry_id = LAST_INSERT_ID();
    INSERT queue_data (queue_entry_id, request)
        VALUES (entry_id, data);</pre>
<p>The queue_user row was inserted correctly, and returned an ID of 7. The queue_entry row was correctly associated to publisher ID 7 with the new entry ID 5. However, the entry_id variable was set by LAST_INSERT_ID() to 7, not 5. This caused the queue_data row to be associated with the wrong entry ID. Apparently, within a stored procedure LAST_INSERT_ID() returns the ID generated by the first INSERT statement, not the last one.</p>
<p><strong>Here's my solution</strong><br />
If you wrap the first insert in a transaction, then the problem is solved. This, of course, violates the atomic intent of the transaction, but in our case that wasn't an issue. Here's the "fixed" code:</p>
<pre>    START TRANSACTION;
INSERT queue_user (queue_user_name) VALUES (publisher);
    SET publisher_id = LAST_INSERT_ID();
    COMMIT;
INSERT queue_entry (publisher_queue_user_id)
        VALUES (publisher_id);
    SET entry_id = LAST_INSERT_ID();
  INSERT queue_data (queue_entry_id, request)
        VALUES (entry_id, data);</pre>
<p>I only hope they fix this soon.</p>
				</div>

				<p class="postmetadata">Posted in <a href="indexc728.html?cat=7" title="View all posts in Databases" rel="category">Databases</a> |   <a href="index7665.html?p=65#respond" title="Comment on MySQL LAST_INSERT_ID() is Broken, Too">No Comments &#187;</a></p>
			</div>

		
		<div class="navigation">
			<div class="alignleft"><a href="index20c4.html?paged=34">&laquo; Previous Entries</a></div>
			<div class="alignright"><a href="index4c4e.html?paged=32">Next Entries &raquo;</a></div>
		</div>

	
	</div>
		</td>
	</tr>
</table>

<hr />
<div id="footer">
<!-- If you'd like to support WordPress, having the "powered by" link someone on your blog is the best way, it's our only promotion or advertising. -->
	<p>
		Adventures in Software is proudly powered by 
		<a href="http://wordpress.org/">WordPress</a>
		<br /><a href="indexd784.html?feed=rss2">Entries (RSS)</a>
		and <a href="indexa6da.html?feed=comments-rss2">Comments (RSS)</a>.
		<!-- 21 queries. 0.362 seconds. -->
	</p>
</div>
<script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
try {
var pageTracker = _gat._getTracker("UA-389401-3");
pageTracker._trackPageview();
} catch(err) {}</script></div>

<!-- Gorgeous design by Michael Heilemann - http://binarybonsai.com/kubrick/ -->

		<div id="sk2-footer" style="color:#FFF; background-color:#444; padding: 3px 2px 3px 2px; border-top: #888 solid 1px;">This blog is protected by <a href="http://unknowngenius.com/blog/" title="Dave">dr Dave</a>'s <strong><a href="http://unknowngenius.com/blog/wordpress/spam-karma/" title="SK2">Spam Karma 2</a></strong>: <strong>274531</strong>  Spams eaten and counting...</div><script type="text/javascript" src="replies.js"></script>
<script type="text/javascript" src="blogger.js"></script>
<script type="text/javascript" src="http://twitter.com/statuses/user_timeline/michaellperry.json?callback=twitterCallback2&amp;count=5"></script>
<script type="text/javascript" src="http://search.twitter.com/search.json?q=@michaellperry&amp;callback=twitterCallbackReplies&amp;rpp=5"></script>
</body>

<!-- Mirrored from adventuresinsoftware.com/blog/?paged=33 by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 13 Jan 2017 13:11:13 GMT -->
</html>
