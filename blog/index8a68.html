<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr">


<!-- Mirrored from adventuresinsoftware.com/blog/?paged=3 by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 13 Jan 2017 13:03:01 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- /Added by HTTrack -->
<head profile="http://gmpg.org/xfn/11">
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />

<title>Adventures in Software  </title>

<meta name="generator" content="WordPress 2.3.3" /> <!-- leave this for stats -->

<link rel="stylesheet" href="wp-content/themes/ais2/style.css" type="text/css" media="screen" />
<link rel="alternate" type="application/rss+xml" title="Adventures in Software RSS Feed" href="indexd784.html?feed=rss2" />
<link rel="pingback" href="xmlrpc.html" />
    <script type="text/javascript">
        function onSilverlightError(sender, args) {
            var appSource = "";
            if (sender != null && sender != 0) {
              appSource = sender.getHost().Source;
            }
            
            var errorType = args.ErrorType;
            var iErrorCode = args.ErrorCode;

            if (errorType == "ImageError" || errorType == "MediaError") {
              return;
            }

            var errMsg = "Unhandled Error in Silverlight Application " +  appSource + "\n" ;

            errMsg += "Code: "+ iErrorCode + "    \n";
            errMsg += "Category: " + errorType + "       \n";
            errMsg += "Message: " + args.ErrorMessage + "     \n";

            if (errorType == "ParserError") {
                errMsg += "File: " + args.xamlFile + "     \n";
                errMsg += "Line: " + args.lineNumber + "     \n";
                errMsg += "Position: " + args.charPosition + "     \n";
            }
            else if (errorType == "RuntimeError") {           
                if (args.lineNumber != 0) {
                    errMsg += "Line: " + args.lineNumber + "     \n";
                    errMsg += "Position: " +  args.charPosition + "     \n";
                }
                errMsg += "MethodName: " + args.methodName + "     \n";
            }

            throw new Error(errMsg);
        }
    </script>

	<link rel="EditURI" type="application/rsd+xml" title="RSD" href="xmlrpc0db0.php?rsd" />
 <link rel="wlwmanifest" type="application/wlwmanifest+xml" href="wp-includes/wlwmanifest.xml" /> <style type='text/css'>
<!--#header { background: url('wp-content/themes/ais2/images/header-imgae03.html?upper=A7A73F&amp;lower=77773F') no-repeat bottom center; }
--></style>
</head>
<body>
<div id="page">

<div class="aisTopBar">
	<form method="get" id="searchform" action="http://adventuresinsoftware.com/blog/">
<div>
<a href="indexd784.html?feed=rss2"><img src="../images/feed-icon-28x28.png" border="0"></a>
<input type="text" value="" name="s" id="s" />
<input type="submit" id="searchsubmit" value="Search" />
</div>
</form>
</div>

<div class="aisHeaderImageRight">
	<div class="aisHeaderImage">
	<div class="aisHeaderCornerRight">
	<div class="aisHeaderCornerLeft">
	<div class="aisImageBar">
	<div class="aisSubSites">
		<a href="index.html" class="aisSubSiteLink"><span class="aisSiteTabRight"><span class="aisSiteTabLeft"><span class="aisSiteTab">
			home</span></span></span></a>
		<a class="aisSubSiteLink" href="indexb60a.html?cat=27"><span class="aisSiteTabRight"><span class="aisSiteTabLeft"><span class="aisSiteTab">
			historic modeling</span></span></span></a>
		<a class="aisSubSiteLink" href="indexa88f.html?cat=36"><span class="aisSiteTabRight"><span class="aisSiteTabLeft"><span class="aisSiteTab">
			update controls</span></span></span></a>
		<a href="index2d79.html?cat=26" class="aisSubSiteLink"><span class="aisSiteTabRight"><span class="aisSiteTabLeft"><span class="aisSiteTab">
			degrees of freedom</span></span></span></a>
		<a class="aisSubSiteLink" href="indexba53.html?page_id=2"><span class="aisSiteTabRight"><span class="aisSiteTabLeft"><span class="aisSiteTab">
			about us</span></span></span></a>

	</div>
	</div>
	</div>
	</div>
	</div>
</div>

<table style="width: 100%" cellspacing="0" cellpadding="0">
	<tr valign="top">
		<td width="210px">
<div id="sidebar">
<div class="aisLeftColumnFill">
<div class="aisLeftColumnBottom">
<div class="aisLeftColumnTop">
<div id="twitter_div" class="aisLeftNav">
<h2 class="sidebar-title">Twitter Updates</h2>
<ul id="twitter_update_list"></ul>
<a href="http://twitter.com/michaellperry" id="follow">Follow me</a>
</div>
<div id="twitter_reply_div" class="aisLeftNav">
<h2 class="sidebar-title">Twitter Replies</h2>
<ul id="twitter_reply_list"></ul>
</div>

<div class="aisLeftNav">
<a href='http://ineta.org/Speakers/SearchCommunitySpeakers.aspx?SpeakerId=c5110e21-9243-461b-a464-a6548524e885'><img alt='INETA Community Speakers Program' border='0' src='../../www.ineta.org/images/OfficialLogos/InetaCommunitySpeakersRequestMe.html' /></a>
</div>

<div class="aisLeftNav">
	<li class="pagenav"><h2>Pages</h2><ul><li class="page_item page-item-2"><a href="indexba53.html?page_id=2" title="About Us">About Us</a></li>
<li class="page_item page-item-210"><a href="index6ae3.html?page_id=210" title="Templates">Templates</a></li>
</ul></li></div>

<div class="aisLeftNav">
<h2>Archives</h2>
<ul>
	<li><a href='indexb4d5.html?m=201110' title='October 2011'>October 2011</a></li>
	<li><a href='indexc61a.html?m=201106' title='June 2011'>June 2011</a></li>
	<li><a href='indexa80d.html?m=201105' title='May 2011'>May 2011</a></li>
	<li><a href='index512b.html?m=201104' title='April 2011'>April 2011</a></li>
	<li><a href='index08fb.html?m=201103' title='March 2011'>March 2011</a></li>
	<li><a href='index52f4.html?m=201102' title='February 2011'>February 2011</a></li>
	<li><a href='index74f1.html?m=201101' title='January 2011'>January 2011</a></li>
	<li><a href='index8956.html?m=201012' title='December 2010'>December 2010</a></li>
	<li><a href='indexa1aa.html?m=201011' title='November 2010'>November 2010</a></li>
	<li><a href='indexe3d5.html?m=201010' title='October 2010'>October 2010</a></li>
	<li><a href='index9ab9.html?m=201009' title='September 2010'>September 2010</a></li>
	<li><a href='index1ff0.html?m=201008' title='August 2010'>August 2010</a></li>
	<li><a href='index9f11.html?m=201007' title='July 2010'>July 2010</a></li>
	<li><a href='index31f0.html?m=201006' title='June 2010'>June 2010</a></li>
	<li><a href='indexd189.html?m=201005' title='May 2010'>May 2010</a></li>
	<li><a href='indexb5c0.html?m=201004' title='April 2010'>April 2010</a></li>
	<li><a href='indexf258.html?m=201003' title='March 2010'>March 2010</a></li>
	<li><a href='index6e30.html?m=201002' title='February 2010'>February 2010</a></li>
	<li><a href='index6b19.html?m=201001' title='January 2010'>January 2010</a></li>
	<li><a href='index5c0a.html?m=200912' title='December 2009'>December 2009</a></li>
	<li><a href='index8f62.html?m=200911' title='November 2009'>November 2009</a></li>
	<li><a href='index451d.html?m=200910' title='October 2009'>October 2009</a></li>
	<li><a href='index3e04.html?m=200909' title='September 2009'>September 2009</a></li>
	<li><a href='index425a.html?m=200908' title='August 2009'>August 2009</a></li>
	<li><a href='index9907.html?m=200907' title='July 2009'>July 2009</a></li>
	<li><a href='index3104.html?m=200906' title='June 2009'>June 2009</a></li>
	<li><a href='indexc36d.html?m=200905' title='May 2009'>May 2009</a></li>
	<li><a href='index17e8.html?m=200904' title='April 2009'>April 2009</a></li>
	<li><a href='index10a5.html?m=200903' title='March 2009'>March 2009</a></li>
	<li><a href='index8988.html?m=200902' title='February 2009'>February 2009</a></li>
	<li><a href='index1419.html?m=200901' title='January 2009'>January 2009</a></li>
	<li><a href='index7866.html?m=200812' title='December 2008'>December 2008</a></li>
	<li><a href='index55f6.html?m=200811' title='November 2008'>November 2008</a></li>
	<li><a href='indexa7bc.html?m=200810' title='October 2008'>October 2008</a></li>
	<li><a href='indexe77c.html?m=200809' title='September 2008'>September 2008</a></li>
	<li><a href='indexcffc.html?m=200808' title='August 2008'>August 2008</a></li>
	<li><a href='index0e62.html?m=200807' title='July 2008'>July 2008</a></li>
	<li><a href='indexfda7.html?m=200806' title='June 2008'>June 2008</a></li>
	<li><a href='index7d64.html?m=200805' title='May 2008'>May 2008</a></li>
	<li><a href='index94dd.html?m=200804' title='April 2008'>April 2008</a></li>
	<li><a href='index9631.html?m=200803' title='March 2008'>March 2008</a></li>
	<li><a href='indexdd52.html?m=200802' title='February 2008'>February 2008</a></li>
	<li><a href='index21ee.html?m=200801' title='January 2008'>January 2008</a></li>
	<li><a href='index363c.html?m=200712' title='December 2007'>December 2007</a></li>
	<li><a href='index7493.html?m=200711' title='November 2007'>November 2007</a></li>
	<li><a href='index93a7.html?m=200710' title='October 2007'>October 2007</a></li>
	<li><a href='index4ca8.html?m=200709' title='September 2007'>September 2007</a></li>
	<li><a href='index6124.html?m=200708' title='August 2007'>August 2007</a></li>
	<li><a href='index6013.html?m=200707' title='July 2007'>July 2007</a></li>
	<li><a href='index2ab6.html?m=200706' title='June 2007'>June 2007</a></li>
	<li><a href='index44f0.html?m=200705' title='May 2007'>May 2007</a></li>
	<li><a href='indexf0b4.html?m=200704' title='April 2007'>April 2007</a></li>
	<li><a href='index481d.html?m=200703' title='March 2007'>March 2007</a></li>
	<li><a href='indexcbea.html?m=200702' title='February 2007'>February 2007</a></li>
	<li><a href='index9cdc.html?m=200701' title='January 2007'>January 2007</a></li>
	<li><a href='index3ea4.html?m=200612' title='December 2006'>December 2006</a></li>
	<li><a href='index67ca.html?m=200611' title='November 2006'>November 2006</a></li>
	<li><a href='indexff49.html?m=200610' title='October 2006'>October 2006</a></li>
	<li><a href='index611c.html?m=200609' title='September 2006'>September 2006</a></li>
	<li><a href='index9a21.html?m=200608' title='August 2006'>August 2006</a></li>
	<li><a href='index3ee9.html?m=200607' title='July 2006'>July 2006</a></li>
	<li><a href='indexe13a.html?m=200606' title='June 2006'>June 2006</a></li>
</ul>
</div>

<div class="aisLeftNav">
			<li id="linkcat-16" class="linkcat"><h2>Blogroll</h2>
	<ul>
<li><a href="http://ayende.com/Blog">Ayende Rahien</a></li>
<li><a href="http://www.softinsight.com/bnoyes/default.aspx">Brian Noyes</a></li>
<li><a href="http://chriskoenig.net/">Chris Koenig</a></li>
<li><a href="http://scienceblogs.com/goodmath/" title="MarkCC reveals the beauty in mathematics and exposes its misuse.">Good Math, Bad Math</a></li>
<li><a href="http://joshsmithonwpf.wordpress.com/">Josh Smith on WPF</a></li>
<li><a href="http://west-wind.com/Weblog/default.aspx">Rick Strahl</a></li>
<li><a href="http://www.udidahan.com/?blog=true">Udi Dahan</a></li>

	</ul>
</li>
<li id="linkcat-17" class="linkcat"><h2>Links</h2>
	<ul>
<li><a href="http://www.absg.com/" title="my day job">ABSG</a></li>
<li><a href="http://www.d20universe.com/" title="my friends boostrap">d20 Universe</a></li>
<li><a href="http://updatecontrols.net/" title="my open source project">Update Controls .NET</a></li>

	</ul>
</li>
<li id="linkcat-32" class="linkcat"><h2>Podroll</h2>
	<ul>
<li><a href="http://dotnetrocks.com/" title="Interviews with leaders in the .NET community.">.NET Rocks!</a></li>
<li><a href="http://hanselminutes.com/" title="News and interviews from all aspects of software, with an insider&#039;s view of Microsoft.">Hanselminutes</a></li>

	</ul>
</li>
	</div>

<div class="aisLeftNav">
<h2>Books</h2>
<iframe src="http://rcm.amazon.com/e/cm?t=adventures0d2-20&amp;o=1&amp;p=8&amp;l=as1&amp;asins=0764526413&amp;fc1=000000&amp;IS2=1&amp;lt1=_blank&amp;lc1=0000ff&amp;bc1=000000&amp;bg1=ffffff&amp;f=ifr" style="width:120px;height:240px;" scrolling="no" marginwidth="0" marginheight="0" frameborder="0" name="I5" id="I5"></iframe>
<br/>
<iframe src="http://rcm.amazon.com/e/cm?t=adventures0d2-20&amp;o=1&amp;p=8&amp;l=as1&amp;asins=0201633612&amp;fc1=000000&amp;IS2=1&amp;lt1=_blank&amp;lc1=0000ff&amp;bc1=000000&amp;bg1=ffffff&amp;f=ifr" style="width:120px;height:240px;" scrolling="no" marginwidth="0" marginheight="0" frameborder="0" name="I6" id="I6"></iframe>
<br/>
<iframe src="http://rcm.amazon.com/e/cm?t=adventures0d2-20&amp;o=1&amp;p=8&amp;l=as1&amp;asins=0136291554&amp;fc1=000000&amp;IS2=1&amp;lt1=_blank&amp;lc1=0000ff&amp;bc1=000000&amp;bg1=ffffff&amp;f=ifr" style="width:120px;height:240px;" scrolling="no" marginwidth="0" marginheight="0" frameborder="0" name="I7" id="I7"></iframe>
<br/>
<iframe src="http://rcm.amazon.com/e/cm?t=adventures0d2-20&amp;o=1&amp;p=8&amp;l=as1&amp;asins=1888009195&amp;fc1=000000&amp;IS2=1&amp;lt1=_blank&amp;lc1=0000ff&amp;bc1=000000&amp;bg1=ffffff&amp;f=ifr" style="width:120px;height:240px;" scrolling="no" marginwidth="0" marginheight="0" frameborder="0" name="I8" id="I8"></iframe>
</div>
<div class="aisLeftNav">
<h2>Meta</h2>
<ul>
		<li><a href="wp-login.html">Login</a></li>
	<li><a href="http://validator.w3.org/check/referer" title="This page validates as XHTML 1.0 Transitional">Valid <abbr title="eXtensible HyperText Markup Language">XHTML</abbr></a></li>
	<li><a href="http://gmpg.org/xfn/"><abbr title="XHTML Friends Network">XFN</abbr></a></li>
	<li><a href="http://wordpress.org/" title="Powered by WordPress, state-of-the-art semantic personal publishing platform.">WordPress</a></li>
	</ul>
</div>
<div class="aisLeftContent">
<h2>Community</h2>
<ul>
	<script type="text/javascript" src="../../localhost/embed/92q2bbma.js"></script>
</ul>
</div>

</div></div></div>
</div>		</td>
		<td>

	<div id="content" class="narrowcolumn">

	
		
			<div class="post" id="post-645">
				<h2><a href="indexc725.html?p=645" rel="bookmark" title="Permanent Link to Thought Cloud structure">Thought Cloud structure</a></h2>
				<small>May 16th, 2011 <!-- by Michael L Perry --></small>

				<div class="entry">
					<p>I am building <a href="https://github.com/michaellperry/FacetedWorlds.ThoughtCloud">Thought Cloud</a>, a collaborative mind mapper, for an upcoming demo. Please grab the code and follow along.</p>
<p>I’ve created the structure of the application:</p>
<p><a href="../pictures/0e2c79eb5d70_694F/FacetedWorlds.ThoughtCloud.sln.gif"><img border="0" width="940" src="../pictures/0e2c79eb5d70_694F/FacetedWorlds.ThoughtCloud.sln_thumb.gif" alt="FacetedWorlds.ThoughtCloud.sln" height="251" style="padding-right: 0px; display: inline; padding-left: 0px; background-image: none; padding-top: 0px; border: 0px" title="FacetedWorlds.ThoughtCloud.sln" /></a></p>
<p>FacetedWorlds.ThoughtCloud is the main Silverlight application. It has out-of-browser settings enabled. I added a reference to the NuGet package “Correspondence.Silverlight.App”.</p>
<p>The UnitTest project is also a Silverlight application, as required by Jeff Wilcox’s Silverlight Unit Test Framework. But I didn’t create it with the project template from the Silverlight Toolkit. Instead, I added a reference to the NuGet package “Correspondence.Silverlight.UnitTest”, which has a dependency on the framework’s package.</p>
<p>The ViewModel project is a Silverlight class library to which I simply added the “Correspondence” package. Not much is required for a Correspondence view model, since it is built on Update Controls.</p>
<p>Finally, the Model project is a Silverlight class library to which I added “Correspondence.Model”. This package adds a “Models” folder, which is great when using the all-in-one package. But since this project structure is broken down, that folder is redundant. So I moved the contents of the folder up to the root of the project, and change the namespaces to drop the folder name.</p>
<p>This structure gives me the ability to build Thought Cloud in a test-driven manner. I write separate tests for the view models and the models, even though the view models <em>use</em> the models. I’ll show you why as we go along.</p>
				</div>

				<p class="postmetadata">Posted in <a href="index38d0.html?cat=46" title="View all posts in Correspondence" rel="category">Correspondence</a> |   <a href="indexc725.html?p=645#respond" title="Comment on Thought Cloud structure">No Comments &#187;</a></p>
			</div>

		
			<div class="post" id="post-644">
				<h2><a href="index6ade.html?p=644" rel="bookmark" title="Permanent Link to Preparing a Correspondence example">Preparing a Correspondence example</a></h2>
				<small>May 16th, 2011 <!-- by Michael L Perry --></small>

				<div class="entry">
					<p>On the 9th of June, I’ll be presenting Correspondence to the <a href="http://ddnug.net/">Dallas .NET User Group</a>. I will reprise the presentation on the 13th for <a href="http://ntsilverlight.com/">North Texas Silverlight</a>. Please come see whichever one you can attend.</p>
<p>I’ll be showing how to use Correspondence to build Silverlight out-of-browser applications. These apps will reside on your desktop (Mac or PC), use isolated storage, synchronize with the server while online, and push updates in real time as they happen. Not only is it good for keeping your data on two or more machines, this pattern is ideal for collaboration with other users.</p>
<p>You can help me to build the demo. It is a collaborative mind mapper called Thought Cloud. I’m hosting it on <a href="https://github.com/michaellperry/FacetedWorlds.ThoughtCloud">GitHub</a>, so please pull the code and try it out.</p>
				</div>

				<p class="postmetadata">Posted in <a href="index38d0.html?cat=46" title="View all posts in Correspondence" rel="category">Correspondence</a> |   <a href="index6ade.html?p=644#respond" title="Comment on Preparing a Correspondence example">No Comments &#187;</a></p>
			</div>

		
			<div class="post" id="post-643">
				<h2><a href="indexb0f8.html?p=643" rel="bookmark" title="Permanent Link to Windows Phone navigation workarounds">Windows Phone navigation workarounds</a></h2>
				<small>April 26th, 2011 <!-- by Michael L Perry --></small>

				<div class="entry">
					<p>Silverlight for Windows Phone has adopted a navigation mechanism reminiscent of a web browser. Each page is authored as a separate resource. The application issues commands to a NavigationService to move from one page to the next. The phone even has a hardware back button. This choice of web-like navigation causes no end of difficulties to application developers.</p>
<p>Navigation in Windows Phone starts with a URI. But rather than identifying an HTML resource, this URI identifies a XAML resource. The application doesn’t create pages; it just identifies them. The runtime creates each page based on the given URI. This causes three problems.</p>
<ul>
<li>Parameters</li>
<li>View model location</li>
<li>Back-stack modification</li>
</ul>
<h3>Parameters</h3>
<p>The URI must contain all of the information required to construct the page. For the main page of the application, this is usually fine. Just bring up the XAML representation of the main menu. But subsequent pages often drill down into detail. If the main page displays a list of articles, and we want to bring up a specific article when the user taps, then we have to identify the article in the URI. <em>All</em> of the article links target the same XAML resource. It’s the data that differs.</p>
<p>To differentiate the links, many developers take the typical web-based approach. They add <strong>query string</strong> parameters to the URL. Chris Koenig gives <a href="http://chriskoenig.net/2010/05/16/wp7-part-3-navigation/">an excellent example of parameter-passing</a>. The Silverlight NavigationContext object exposes these parameters via the QueryString property, specifically for this purpose.</p>
<p>The problem with query string parameters is that they requires an application to drop down to string-based identification, rather than rely upon direct object access. To generate the query string, an application has to extract an ID from an object. To consume the query string, it has to look that ID up in an object model. It usually ends up getting right back to the object that it started with. Wouldn’t it be easier to use that object reference directly?</p>
<p>The web was designed for stateless operation. Each request is isolated from the ones that came before. No objects are assumed to be kept on the server for the user’s next request. Each request must contain enough information to reload those objects and generate the required page. This is what allows the web to scale.</p>
<p>But the phone isn’t like a stateless web server. It has rich object state. It exists to serve just one user. It can afford to load objects into memory, and use references among those objects as that user navigates through the application. To drop down to a string only to come back to the same object is not taking full advantage of the platform. What’s good for the web is not necessarily good for the phone.</p>
<h3>View model location</h3>
<p>The second problem is pairing a view model with a view. Since navigation is based on identifying the view, Windows Phone forces you into a view-first approach. The view is left with the responsibility of finding its view model. To complicate matters, the view must sometimes pass its query string parameters to the view model. The view model uses the parameters to find a reference to the model object.</p>
<p>A common solution to this problem is the view model locator pattern. A view model locator is a single-instance object registered as an application resource. Each view binds its DataContext to a property of this resource, which is an instance of a view model.</p>
<pre class="code">    <span style="color: blue">&lt;</span><span style="color: #a31515">Application.Resources</span><span style="color: blue">&gt;
        &lt;</span><span style="color: #a31515">vm</span><span style="color: blue">:</span><span style="color: #a31515">ViewModelLocator </span><span style="color: red">x</span><span style="color: blue">:</span><span style="color: red">Key</span><span style="color: blue">=&quot;Locator&quot;/&gt;
    &lt;/</span><span style="color: #a31515">Application.Resources</span><span style="color: blue">&gt;

</span></pre>
<pre class="code"><span style="color: blue">public class </span><span style="color: #2b91af">ViewModelLocator
</span>{
    <span style="color: blue">private readonly </span><span style="color: #2b91af">MainViewModel </span>_main;

    <span style="color: blue">public </span>ViewModelLocator()
    {
        _main = <span style="color: blue">new </span><span style="color: #2b91af">MainViewModel</span>();
    }

    <span style="color: blue">public </span><span style="color: #2b91af">MainViewModel </span>Main
    {
        <span style="color: blue">get </span>{ <span style="color: blue">return </span>_main; }
    }
}</pre>
<pre class="code"><span style="color: blue">&lt;</span><span style="color: #a31515">UserControl </span><span style="color: red">x</span><span style="color: blue">:</span><span style="color: red">Class</span><span style="color: blue">=&quot;ToDoList.MainPage&quot;
    ...</span><span style="color: blue">
    </span><span style="color: red">DataContext</span><span style="color: blue">=&quot;{</span><span style="color: #a31515">Binding </span><span style="color: red">Main</span><span style="color: blue">, </span><span style="color: red">Source</span><span style="color: blue">={</span><span style="color: #a31515">StaticResource </span><span style="color: red">Locator</span><span style="color: blue">}}&quot;&gt;
</span></pre>
<p>The biggest problem with the view model locator pattern is that it treats view models as <strong>singletons</strong>. Since the view model locator is an application resource, there is only one instance serving all of the view models. And since each view data binds to a property, the view model locator can only have one instance of each view model. It is not a view model <em>factory</em>. There is no way to pass query string parameters to a method in order to <em>construct</em> an instance of a view model. You have to write code in the view to pass the parameters to the view model in its DataContext. That one and only instance of the view model must be able to change its behavior to point to a different model instance every time the user navigates.</p>
<h3>Back-stack modification</h3>
<p>The third problem is removing pages from the back-stack. Some interactions have intermediate steps: the user logs in before seeing content, or a wizard guides a user through a multi-page process to achieve a result. When the user has completed these intermediate steps, they don’t want to return to them. If they have completed the steps prior to reaching the main menu (as in the login example), then they want to exit the application when they hit back from the main menu. They don’t want to see the login screen again. Or if the intermediate steps occur after the main page (as in the wizard example), then they want to return to the main page when they are finished. These intermediate pages should be popped off the stack.</p>
<p>Unfortunately, the Windows Phone OS is completely in charge of the back-stack. It keeps track of each URI that the user visits, and returns to past URIs when they hit the back button. There is no API for removing a URI from the stack. We are left with a couple of hacks. To skip intermediate pages at the beginning of the stack (login), we can <a href="http://blogs.msdn.com/b/ptorr/archive/2010/08/01/exiting-a-windows-phone-application.aspx">exit the application prematurely by throwing an unhandled exception</a>. To skip pages later in the stack (wizard), we can <a href="http://stackoverflow.com/questions/3809578/how-to-remove-a-page-from-the-navigation-history">bounce to each intermediate page in the main page’s OnNavigatedTo</a>. Neither solution is particularly appealing.</p>
<h3>Conclusion</h3>
<p>The Windows Phone navigation system is based on the web metaphor. Unfortunately, the web is the wrong model for a single-user device. The decision to model navigation in this way has caused phone applications to act like web pages. The intent was to bring a well-understood interaction language to the phone. But in practice, it just forced application developers to work around the shortcomings of a misappropriated model.</p>
<p>This decision leads developers into a view-first approach, rather than beginning with the view model. It forces developers to convert object references to strings, only to convert them back into object references. And it requires ugly hacks to produce even the simplest of interactions. If you write Windows Phone apps, prepare to use these workarounds.</p>
				</div>

				<p class="postmetadata">Posted in <a href="indexb0b4.html?cat=48" title="View all posts in Windows Phone 7" rel="category">Windows Phone 7</a> |   <a href="indexb0f8.html?p=643#comments" title="Comment on Windows Phone navigation workarounds">2 Comments &#187;</a></p>
			</div>

		
			<div class="post" id="post-642">
				<h2><a href="indexd1c3.html?p=642" rel="bookmark" title="Permanent Link to How to Make the MacBook Pro Trackpad Less Jumpy">How to Make the MacBook Pro Trackpad Less Jumpy</a></h2>
				<small>April 21st, 2011 <!-- by Michael L Perry --></small>

				<div class="entry">
					<p>To right-click on the MacBook Pro, you put two fingers on the trackpad, then click. To scroll, you put two fingers on the trackpad and move up or down. In Visual Studio, the scrolling is extremely sensitive. When you try to right-click something, it often scrolls out from underneath the mouse. You end up right-clicking on something else entirely.</p>
<p>It seems that the problem is related to the horizontal motion rather than the vertical. If you reduce the number of lines that the mouse rocker moves left and right, the problem subsides. But the Mouse control panel applet won’t let you set this value to zero, so you can’t make it go away entirely.</p>
<p>Unless you hack the registry.</p>
<p>Download the attached file, <strong>examine it to make sure you understand what it does</strong>, then merge it into your registry. Reboot, and you will be able to right-click without the jumpiness.</p>
<div style="padding-bottom: 0px; margin: 0px; padding-left: 0px; padding-right: 0px; display: inline; float: none; padding-top: 0px" id="scid:8eb9d37f-1541-4f29-b6f4-1eea890d4876:6617625d-0945-405c-a02c-4e0d5025ff04" class="wlWriterEditableSmartContent">
<div><a href="../pictures/68e9b42d3c6f_13A2B/NoScroll.mp3" target="_self">NoScroll.reg</a></div>
</p>
</div>
				</div>

				<p class="postmetadata">Posted in <a href="index97dc.html?cat=33" title="View all posts in Problems" rel="category">Problems</a> |   <a href="indexd1c3.html?p=642#respond" title="Comment on How to Make the MacBook Pro Trackpad Less Jumpy">No Comments &#187;</a></p>
			</div>

		
			<div class="post" id="post-641">
				<h2><a href="indexd2ad.html?p=641" rel="bookmark" title="Permanent Link to Building an occasionally connected Silverlight application with Correspondence">Building an occasionally connected Silverlight application with Correspondence</a></h2>
				<small>April 18th, 2011 <!-- by Michael L Perry --></small>

				<div class="entry">
					<p>I posted a <a href="index55df.html?p=640">to-do list application built with Correspondence</a>. It holds the user’s data in isolated storage, and pushes it to a synchronization service. It took about 56 minutes and 41 seconds to build.</p>
<p><iframe src="http://player.vimeo.com/video/22700086" width="600" frameborder="0" height="353"></iframe></p>
<p><a href="http://vimeo.com/22700086">Building an occasionally connected Silverlight application with Correspondence</a> from <a href="http://vimeo.com/michaellperry">Michael L Perry</a> on <a href="http://vimeo.com/">Vimeo</a>.</p>
				</div>

				<p class="postmetadata">Posted in <a href="index38d0.html?cat=46" title="View all posts in Correspondence" rel="category">Correspondence</a> |   <a href="indexd2ad.html?p=641#respond" title="Comment on Building an occasionally connected Silverlight application with Correspondence">No Comments &#187;</a></p>
			</div>

		
			<div class="post" id="post-640">
				<h2><a href="index55df.html?p=640" rel="bookmark" title="Permanent Link to Correspondence for Silverlight in NuGet">Correspondence for Silverlight in NuGet</a></h2>
				<small>April 16th, 2011 <!-- by Michael L Perry --></small>

				<div class="entry">
					<p>With Correspondence for Silverlight, you can create occasionally-connected client applications that run either in or out of the browser. They use isolated storage to save the user’s changes before pushing them up to the synchronization service. From there, they are pushed out to other Silverlight or Windows Phone clients. Create a Silverlight application and use NuGet to add a reference to:
<p><font size="4"><strong>Correspondence.Silverlight.AllInOne</strong></font></p>
<p>The package will add the following features to your application:</p>
<ul>
<li>Main view model </li>
<li>View model locator </li>
<li>Model </li>
<li>Navigation model </li>
<li>Synchronization service </li>
</ul>
<p>Open the Readme.txt file for instructions on adding the view model locator to App.xaml and MainPage.xaml.</p>
<h3>To-do list</h3>
<p>As an example, try out this to-do list application. Log in using any user name you like; this example app doesn’t authenticate. You can add tasks, update their name, and mark them completed.</p>
<p><object data="data:application/x-silverlight-2," type="application/x-silverlight-2" width="540" height="300" autoupdate="true">
<param name="source" value="../pictures/Correspondence_E090/ToDoList_3.xap" />
<param name="minRuntimeVersion" value="3.0.40624.0" />
<param name="background" value="White" />
<param name="autoUpgrade" value="true" /> <a href="http://go.microsoft.com/fwlink/?LinkID=149156&amp;v=3.0.40624.0" style="text-decoration:none">          			  <img src="http://go.microsoft.com/fwlink/?LinkId=161376" alt="Get Microsoft Silverlight" style="border-style:none" /> </a> </object></p>
<p>Some things to try. Log in using your name, enter some tasks, then switch to another user. Those tasks disappear. Switch back and they reappear.</p>
<p>Close the browser, then come back to this page. Your data is still here. Disconnect from the network and this still works.</p>
<p>Now go to a different machine and log in using your name again. At first the list will be empty, but you’ll see tasks come down as the app synchronizes.</p>
<p>A web page that lets you share data between two browsers is nothing new. What makes this different is:</p>
<ul>
<li>Data is still accessible while off line. This is particularly important for out-of-browser applications. </li>
<li>There is no application-specific server-side schema or code. The data model and all of your logic is in the client. </li>
<li>Silverlight applications can synchronize with Windows Phone applications. </li>
</ul>
<p>Here’s how the to-do list example is built. Download the <a href="../pictures/Correspondence_E090/ToDoList.zip" target="_self">source code</a> and follow along. </p>
<h3>Log on</h3>
<p>A User is a fact identified by a user name. We represent the user in the Factual model:</p>
<pre class="code">fact User {
key:
    string userName;
}</pre>
<p>Any time we create a User with a give user name, we get back the same instance. This allows the user to log in. Of course, a production system would authenticate the user, but it would still follow the same pattern. The user input is captured first in a transient navigation model: </p>
<pre class="code"><span style="color: blue">public class </span><span style="color: #2b91af">NavigationModel
</span>{
    <span style="color: blue">private </span><span style="color: #2b91af">Independent</span>&lt;<span style="color: blue">string</span>&gt; _userName = <span style="color: blue">new </span><span style="color: #2b91af">Independent</span>&lt;<span style="color: blue">string</span>&gt;();

    <span style="color: blue">public string </span>UserName
    {
        <span style="color: blue">get </span>{ <span style="color: blue">return </span>_userName; }
        <span style="color: blue">set </span>{ _userName.Value = <span style="color: blue">value</span>; }
    }
}</pre>
<p>This is where the user name is stored while the user is logging in. We expose this property and a login command through the view model. </p>
<pre class="code"><span style="color: blue">public string </span>UserName
{
    <span style="color: blue">get </span>{ <span style="color: blue">return </span>_navigationModel.UserName; }
    <span style="color: blue">set </span>{ _navigationModel.UserName = <span style="color: blue">value</span>; }
}

<span style="color: blue">public </span><span style="color: #2b91af">ICommand </span>LogIn
{
    <span style="color: blue">get
    </span>{
        <span style="color: blue">return </span><span style="color: #2b91af">MakeCommand
            </span>.When(() =&gt; !<span style="color: #2b91af">String</span>.IsNullOrEmpty(_navigationModel.UserName))
            .Do(() =&gt;
            {
                <span style="color: #2b91af">User </span>user = _community.AddFact(<span style="color: blue">new </span><span style="color: #2b91af">User</span>(_navigationModel.UserName));
                _navigationModel.CurrentUser = user;
                _navigationModel.UserName = <span style="color: blue">string</span>.Empty;
            });
    }
}</pre>
<p>The login command is only enabled when a user name has been entered. When the user clicks the button, a new User is created with the name that they entered. That User is then stored in the navigation model, and the entered name is cleared out. </p>
<h3>List tasks</h3>
<p>Once we have a User fact in our navigation model, we can list the tasks assigned to that user. A task is another fact, which references the User to which it is assigned.</p>
<pre class="code">fact Task {
key:
    unique;
    User assignedTo;
}</pre>
<p>Because the key doesn’t already contain enough information to distinguish one task from another, it is marked as “unique”. This causes Correspondence to generate a new Task every time one is created, rather than looking for an existing one. </p>
<p>The User queries for related tasks.</p>
<pre class="code">fact User {
    ...

query:
    Task* openTasks {
        Task t : t.assignedTo = this
            where not t.isCompleted
    }
}</pre>
<p>That query is exposed through the view model. The MainViewModel generates a list of TaskViewModels to wrap the Tasks.</p>
<pre class="code"><span style="color: blue">public </span><span style="color: #2b91af">IEnumerable</span>&lt;<span style="color: #2b91af">TaskViewModel</span>&gt; OpenTasks
{
    <span style="color: blue">get
    </span>{
        <span style="color: blue">if </span>(_navigationModel.CurrentUser != <span style="color: blue">null</span>)
            <span style="color: blue">return
                from </span><span style="color: #2b91af">Task </span>t <span style="color: blue">in </span>_navigationModel.CurrentUser.OpenTasks
                <span style="color: blue">select new </span><span style="color: #2b91af">TaskViewModel</span>(t);
        <span style="color: blue">else
            return </span><span style="color: #2b91af">Enumerable</span>.Empty&lt;<span style="color: #2b91af">TaskViewModel</span>&gt;();
    }
}</pre>
<h3>Add a task</h3>
<p>The user can enter the name of a task, then hit the Add button to add it to the list. Just like the user name, the task name is stored in the navigation model temporarily. When a user is logged on and a name has been entered, the button becomes enabled. When clicked, it adds a task assigned to the user, and sets the task name.</p>
<pre class="code"><span style="color: blue">public </span><span style="color: #2b91af">ICommand </span>AddTask
{
    <span style="color: blue">get
    </span>{
        <span style="color: blue">return </span><span style="color: #2b91af">MakeCommand
            </span>.When(() =&gt;
                _navigationModel.CurrentUser != <span style="color: blue">null </span>&amp;&amp;
                !<span style="color: #2b91af">String</span>.IsNullOrEmpty(_navigationModel.TaskName))
            .Do(() =&gt;
            {
                <span style="color: #2b91af">Task </span>task = _community.AddFact(<span style="color: blue">new </span><span style="color: #2b91af">Task</span>(_navigationModel.CurrentUser));
                task.Name = _navigationModel.TaskName;
                _navigationModel.TaskName = <span style="color: #2b91af">String</span>.Empty;
            });
    }
}</pre>
<h3>Change a task name</h3>
<p>Notice that the constructor above only takes the User to which the task is assigned. That’s because the User is part of the key. The task name is not. It is a mutable property.</p>
<pre class="code">fact Task {
    ...

mutable:
    string name;
}</pre>
<p>Because the property is mutable, the user can edit the name and hit the Update button. The button is only enabled when a task is selected and the name has been entered. </p>
<pre class="code"><span style="color: blue">public </span><span style="color: #2b91af">ICommand </span>UpdateTask
{
    <span style="color: blue">get
    </span>{
        <span style="color: blue">return </span><span style="color: #2b91af">MakeCommand
            </span>.When(() =&gt;
                _navigationModel.SelectedTask != <span style="color: blue">null </span>&amp;&amp;
                !<span style="color: #2b91af">String</span>.IsNullOrEmpty(_navigationModel.TaskName))
            .Do(() =&gt;
            {
                _navigationModel.SelectedTask.Name = _navigationModel.TaskName;
                _navigationModel.TaskName = <span style="color: #2b91af">String</span>.Empty;
            });
    }
}</pre>
<h3>Mark a task completed</h3>
<p>Finally, the user can mark a task as completed. This is itself a new fact.</p>
<pre class="code">fact TaskCompleted {
key:
    Task completedTask;
}</pre>
<p>The Task fact queries for related TaskCompleted facts to see if it is completed. </p>
<pre class="code">fact Task {
    ...

query:
    bool isCompleted {
        exists TaskCompleted c : c.completedTask = this
    }
}</pre>
<p>This query is then used in the User’s query so that he sees only the open tasks. </p>
<pre class="code">fact User {
    ...

query:
    Task* openTasks {
        Task t : t.assignedTo = this
            where not t.isCompleted
    }
}</pre>
<p>When the user clicks the Complete button, it completes the task. We added this method to the Task itself using a partial class. </p>
<pre class="code"><span style="color: blue">public </span><span style="color: #2b91af">ICommand </span>CompleteTask
{
    <span style="color: blue">get
    </span>{
        <span style="color: blue">return </span><span style="color: #2b91af">MakeCommand
            </span>.When(() =&gt; _navigationModel.SelectedTask != <span style="color: blue">null</span>)
            .Do(() =&gt;
            {
                _navigationModel.SelectedTask.Complete();
            });
    }
}</pre>
<pre class="code"><span style="color: blue">public partial class </span><span style="color: #2b91af">Task
</span>{
    <span style="color: blue">public void </span>Complete()
    {
        Community.AddFact(<span style="color: blue">new </span><span style="color: #2b91af">TaskCompleted</span>(<span style="color: blue">this</span>));
    }
}</pre>
<p>Because this creates the TaskCompleted fact, it causes the list to refresh, and the task is removed. </p>
<h3>Build your own apps</h3>
<p>Please download Correspondence and try it out. If you have any questions about building your own models, please contact me by <a href="mailto:mperry@mallardsoft.com">email</a> or <a href="http://twitter.com/michaellperry">Twitter</a>. If you’d like to use my synchronization server, just send me a request for an API key. I’ll be glad to help you get set up.</p>
				</div>

				<p class="postmetadata">Posted in <a href="index38d0.html?cat=46" title="View all posts in Correspondence" rel="category">Correspondence</a> |   <a href="index55df.html?p=640#respond" title="Comment on Correspondence for Silverlight in NuGet">No Comments &#187;</a></p>
			</div>

		
			<div class="post" id="post-635">
				<h2><a href="indexb753.html?p=635" rel="bookmark" title="Permanent Link to Correspondence in NuGet">Correspondence in NuGet</a></h2>
				<small>April 1st, 2011 <!-- by Michael L Perry --></small>

				<div class="entry">
					<p>I have released Correspondence for Windows Phone 7 to NuGet. Correspondence is a NoSQL database for the phone and other occasionally connected clients. While offline, it queues all of your user’s changes. While online, it pushes those changes to a synchronization server, which in turn pushes it to other devices.Create a Windows Phone 7 application and install the following package:</p>
<p><strong><font size="3">Correspondence.WindowsPhone.AllInOne</font></strong><strong></strong></p>
<p>This will add models, view models, a view model locator, and a synchronization service to your application.</p>
<h3>Models</h3>
<p>Correspondence models are expressed in a language called <a href="http://historicalmodeling.com/book/factual">Factual</a>. The package adds a folder called Models that contains a Factual file and a T4 template to parse it. The first thing you’ll want to do after adding the package reference is to hit the “Transform All Templates” button to generate some code.The starter model contains concepts useful for any Windows Phone 7 application. First it has an Identity:</p>
<pre>fact Identity {
key:
   string anonymousId;
   ...
}</pre>
<p>The Identity fact is uniquely identified by the user’s anonymous Windows Live ID. If they move to a different device, they carry their Identity with them. This makes it really easy to collaborate between users.The model also has the ability to disable and reenable toast notifications:</p>
<pre>fact DisableToastNotification {
key:
   unique;
   Identity identity;
query:
   bool isReenabled {
       exists EnableToastNotification e : e.disable = this
   }
}

fact EnableToastNotification {
key:
   DisableToastNotification* disable;
}</pre>
<p>The Identity fact queries to see if there are any DisableToastNotification facts:<br />
  </p>
<pre>fact Identity {
   ...
query:
   DisableToastNotification* isToastNotificationDisabled {
       DisableToastNotification d : d.identity = this
           where not d.isReenabled
   }
}</pre>
<p>The Identity partial class adds a property that turns these successor facts into a simple boolean property:</p>
<pre class="code"><span style="color: blue">public partial class </span><span style="color: #2b91af">Identity</span>
{
    <span style="color: blue">public bool </span>ToastNotificationEnabled
    {
        <span style="color: blue">get </span>{ <span style="color: blue">return </span>!IsToastNotificationDisabled.Any(); }
        <span style="color: blue">set
        </span>{
            <span style="color: blue">if </span>(IsToastNotificationDisabled.Any() &amp;&amp; <span style="color: blue">value</span>)
            {
                Community.AddFact(<span style="color: blue">new </span><span style="color: #2b91af">EnableToastNotification</span>(IsToastNotificationDisabled));
            }
            <span style="color: blue">else if </span>(!IsToastNotificationDisabled.Any() &amp;&amp; !<span style="color: blue">value</span>)
            {
                Community.AddFact(<span style="color: blue">new </span><span style="color: #2b91af">DisableToastNotification</span>(<span style="color: blue">this</span>));
            }
        }
    }
}</pre>
<p>Extend these facts and build your model in model.fact. Hit “Transform All Templates” after each change to regenerate the classes. Create partial classes to add your own business logic. ViewModelsThe package also adds a ViewModels folder, which contains two view models:</p>
<ul>
<li>MainViewModel </li>
<li>SettingsViewModel </li>
</ul>
<p>The main view model is just an empty starting place. Add properties to this view model to data bind to controls on your main page.Settings view model has one property started for you. It exposes the ToastNotificationEnabled property in the Identity. This is just a simple pass-through. You don’t raise PropertyChanged events or inherit a base class. Correspondence will raise the PropertyChanged event for you. This works because Correspondence is built on <a href="http://updatecontrols.net/">Update Controls</a>.</p>
<pre class="code"><span style="color: blue">public bool </span>ToastNotificationEnabled
{
    <span style="color: blue">get </span>{ <span style="color: blue">return </span>_identity.ToastNotificationEnabled; }
    <span style="color: blue">set </span>{ _identity.ToastNotificationEnabled = <span style="color: blue">value</span>; }
}</pre>
<p>The ViewModels folder also contains a ViewModelLocator class. Open the Readme.txt file for instructions on adding this class to your application resources, and referencing it in your views. As you create your own view models, follow the pattern demonstrated with these two existing view models to add them to the locator.</p>
<pre class="code"><span style="color: blue">public class </span><span style="color: #2b91af">ViewModelLocator</span>
{
    <span style="color: blue">private readonly </span><span style="color: #2b91af">MainViewModel </span>_main;
    <span style="color: blue">public </span>ViewModelLocator()
    {
        ...
        _main = <span style="color: blue">new </span><span style="color: #2b91af">MainViewModel</span>(_synchronizationService.Identity);
        ...
    }
    <span style="color: blue">public object </span>Main
    {
        <span style="color: blue">get </span>{ <span style="color: blue">return </span><span style="color: #2b91af">ForView</span>.Wrap(_main); }
    }
}</pre>
<h3>SynchronizationService</h3>
<p>Correspondence would be just another isolated-storage-based NoSQL database if it weren’t for the synchronization service. For the most part, this class will be invisible to you. It is initialized in the view model locator, and it works automatically.Every time you store a published fact, the synchronization service wakes up and pushes it to the server. If the device is off-line at the time, the fact is queued. The synchronization service will wake up when the network becomes available and start pushing facts.</p>
<p>When another device publishes a fact to which you have subscribed, the server will send a push notification. The synchronization service responds to these push notifications and adds the facts to the repository. Your app is notified via data binding, and the UI updates.The synchronization service is also watching the ToastNotificationEnabled property. When it is true, it subscribes for toast notifications. When it is false, it unsubscribes.</p>
<p>There are two parts of the synchronization service that you are likely to change. The first is the POXConfigurationProvider. When you create an account with a synchronization server, you will be issued a URL, a user name, and a password. Put these into this class.</p>
<pre class="code"><span style="color: blue">public </span><span style="color: #2b91af">POXConfiguration </span>Configuration
{
    <span style="color: blue">get
    </span>{
        <span style="color: blue">string </span>address = <span style="color: #a31515">&quot;https://historicalmodeling.com/correspondence_server_web/pox&quot;</span>;
        <span style="color: blue">string </span>userName = <span style="color: #a31515">&quot;&lt;&lt;Your username&gt;&gt;&quot;</span>;
        <span style="color: blue">string </span>password = <span style="color: #a31515">&quot;&lt;&lt;Your password&gt;&gt;&quot;</span>;
        <span style="color: blue">return new </span><span style="color: #2b91af">POXConfiguration</span>(address, <span style="color: #a31515">&quot;MyCoolWindowsPhoneApplication&quot;</span>, userName, password);
    }
}</pre>
<p>The second is the subscriptions. The synchronization service subscribes to the Identity. The device will receive any facts published to the user’s Identity. As you develop your own model, you will create other publications. Add linq expressions here to subscribe to those facts.</p>
<pre class="code">_community = <span style="color: blue">new </span><span style="color: #2b91af">Community</span>(<span style="color: #2b91af">IsolatedStorageStorageStrategy</span>.Load())
    .AddAsynchronousCommunicationStrategy(<span style="color: blue">new </span><span style="color: #2b91af">POXAsynchronousCommunicationStrategy</span>(configurationProvider))
    .Register&lt;<span style="color: #2b91af">CorrespondenceModel</span>&gt;()
    <strong>.Subscribe(() =&gt; _identity)</strong>
    ;</pre>
<h3>More to come</h3>
<p>There is definitely a learning curve for historical modeling in general, and Correspondence in particular. Please review the body of articles <a href="index38d0.html?cat=46">here</a> and on <a href="http://historicalmodeling.com/book/">Historical Modeling</a>. I will also be posting videos and examples over the next few weeks.I am also opening my synchronization server for a private beta. Please email or mention me to reserve your place. mperry@mallardsoft.com or <a href="http://twitter.com/michaellperry">@michaellperry</a>.</p>
				</div>

				<p class="postmetadata">Posted in <a href="index38d0.html?cat=46" title="View all posts in Correspondence" rel="category">Correspondence</a> |   <a href="indexb753.html?p=635#respond" title="Comment on Correspondence in NuGet">No Comments &#187;</a></p>
			</div>

		
			<div class="post" id="post-634">
				<h2><a href="index5cd0.html?p=634" rel="bookmark" title="Permanent Link to Mutable fields in Correspondence">Mutable fields in Correspondence</a></h2>
				<small>March 29th, 2011 <!-- by Michael L Perry --></small>

				<div class="entry">
					<p><a href="wp-content/uploads/2011/03/image1.png"><img style="border-right-width: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; margin-left: 0px; border-left-width: 0px; margin-right: 0px" title="image" border="0" alt="image" align="right" src="wp-content/uploads/2011/03/image-thumb1.png" width="427" height="351" /></a> <a href="http://correspondence.codeplex.com/">Correspondence</a> is a client-side NoSQL database that synchronizes with other clients through a shared server. If you’ve experimented with the bits, there is a breaking change in the latest changeset. A new build is coming soon, as well as a closed beta of the synchronization server.</p>
<p>Correspondence is built on the concept of <a href="http://historicalmodeling.com/book">historical modeling</a>. This is a set of theory describing historical facts with partial order. The facts have predecessor/successor relationships that define both the order in which they can consistently be applied, and the mechanism for graph traversal.</p>
<p>One of the core tenets of historical modeling is that facts are immutable. This makes them easy to synchronize. Fields also determine the fact’s identity. Two facts having equal fields are actually the same fact.</p>
<p>In many applications, it is desirable to have mutable fields. In historical modeling, you have to use the <a href="http://historicalmodeling.com/book/patterns/entity_property">Entity Property</a> pattern to simulate mutability. This pattern builds on the strengths of historical modeling, allowing participants to unambiguously synchronize state changes. It also has the added benefit of detecting conflicts, and allowing users and applications to resolve them. Unfortunately, this pattern can be cumbersome to apply.</p>
<h3>The mutable keyword</h3>
<p>A Correspondence model is defined using a language called “Factual”. The upcoming release adds three keywords to the Factual modeling language. These three keywords break a fact into sections:</p>
<ul>
<li><strong>key</strong> - Required. Contains all key fields. </li>
<li><strong>mutable</strong> - Optional. Contains all mutable fields. </li>
<li><strong>query</strong> - Optional. Contains all queries and predicates. </li>
</ul>
<p>The key and query sections contain members that have always been in the language. The mutable section adds new functionality.</p>
<p>Fields in the mutable section are mutable. The compiler generates the Entity Property pattern on your behalf. These fields are not part of the key, since they are not actually stored within the fact itself. They are stored in successor facts that track changes.</p>
<p>You write this:</p>
<pre>fact Person {
key:
    unique;

mutable:
    string name;
}</pre>
<p>The Factual compiler generates this:</p>
<pre>fact Person {
key:
    unique;

query:
    PersonName* nameCandidates {
        PersonName n : n.person = this
            where n.isCurrent
    }
}

fact PersonName {
key:
    Person person;
    string value;
    PersonName* prior;

query:
    bool isCurrent {
        not exists PersonName next : next.prior = this
    }
}</pre>
<h3>Disputable properties</h3>
<p>The Entity Property pattern detects conflicts and allows the application to resolve them. To aide the application in this task, Correspondence defines Disputable&lt;T&gt;. This template can be converted to and from the raw type T, but it also exposes two additional properties.</p>
<ul>
<li><strong>InConflict</strong> – A boolean that is true if a conflict has been detected. </li>
<li><strong>Candidates</strong> – A collection of possible values. </li>
</ul>
<p>Using Disputable&lt;T&gt;, the view model can apply an alternate style when a conflict has been detected, and allow the user to choose from among the candidates to resolve it.</p>
<pre class="code"><span style="color: blue">public class </span><span style="color: #2b91af">PersonViewModel
</span>{
    <span style="color: blue">private </span><span style="color: #2b91af">Person </span>_person;

    <span style="color: blue">public </span>PersonViewModel(<span style="color: #2b91af">Person </span>person)
    {
        _person = person;
    }

    <span style="color: blue">public string </span>Name
    {
        <span style="color: blue">get </span>{ <span style="color: blue">return </span>_person.Name; }
        <span style="color: blue">set </span>{ _person.Name = <span style="color: blue">value</span>; }
    }

    <span style="color: blue">public bool </span>ShowConflictStyle
    {
        <span style="color: blue">get </span>{ <span style="color: blue">return </span>_person.Name.InConflict; }
    }

    <span style="color: blue">public </span><span style="color: #2b91af">IEnumerable</span>&lt;<span style="color: blue">string</span>&gt; CandidateNamesItemsSource
    {
        <span style="color: blue">get </span>{ <span style="color: blue">return </span>_person.Name.Candidates; }
    }

    <span style="color: blue">public string </span>CandidateNamesSelectedItem
    {
        <span style="color: blue">get </span>{ <span style="color: blue">return </span>_person.Name; }
        <span style="color: blue">set </span>{ _person.Name = <span style="color: blue">value</span>; }
    }
}</pre>
<p>The <a href="http://historicalmodeling.com/book/factual">Factual modeling language specification</a> has been updated to reflect the new mutable keyword. If you’ve created Correspondence models in the past, you will be required to add key and query section headers once you upgrade. Then you will be able to take advantage of mutability.</p>
				</div>

				<p class="postmetadata">Posted in <a href="index38d0.html?cat=46" title="View all posts in Correspondence" rel="category">Correspondence</a>,  <a href="indexb60a.html?cat=27" title="View all posts in Historic Modeling" rel="category">Historic Modeling</a> |   <a href="index5cd0.html?p=634#respond" title="Comment on Mutable fields in Correspondence">No Comments &#187;</a></p>
			</div>

		
			<div class="post" id="post-631">
				<h2><a href="indexa123.html?p=631" rel="bookmark" title="Permanent Link to User identity on Windows Phone 7">User identity on Windows Phone 7</a></h2>
				<small>March 11th, 2011 <!-- by Michael L Perry --></small>

				<div class="entry">
					<p>When you can challenge another person to a Faceted Reversi game, you provide their name. So Reversi needs a way of authenticating the user so it can send them the correct games. I didn’t want the user to have to enter a password to play my game, so I relied upon the <a href="index475a.html?p=569">anonymous Live ID</a> already available on the phone. I just have to associate your anonymous ID with your chosen screen name.</p>
<h3>Windows Live provides identity</h3>
<p>Once I’ve gotten the anonymous Live ID using the technique I previously blogged about, I create an Identity fact. An Identity is defined in the factual model as:</p>
<pre class="code">fact Identity {
    string anonymousId;

    Claim* claims {
        Claim c : c.identity = this
    }
}</pre>
<p>The anonymoudId string is the only field in an Identity. That means that it comprises the entire key of that fact. No matter how many times I construct an Identity with that anonymoudId, it will be the same instance. The Identity instance is created and added to the Community.</p>
<pre class="code">_community = <span style="color: blue">new </span>Community(storageStrategy)
    .AddAsynchronousCommunicationStrategy(<span style="color: blue">new </span>POXAsynchronousCommunicationStrategy(configurationProvider))
    .Register&lt;CorrespondenceModule&gt;()
    .Subscribe(() =&gt; _identity.Claims);

<span style="color: blue">string </span>anid = UserExtendedProperties.GetValue(<span style="color: #a31515">&quot;ANID&quot;</span>) <span style="color: blue">as string</span>;
<span style="color: blue">string </span>anonymousUserId = <span style="color: #2b91af">String</span>.IsNullOrEmpty(anid)
    ? <span style="color: #a31515">&quot;test:user12&quot;
    </span>: <span style="color: #a31515">&quot;liveid:&quot; </span>+ ParseAnonymousId(anid);
_identity = _community.AddFact(<span style="color: blue">new </span>Identity(anonymousUserId));</pre>
<p>The first time you run the app, it creates this Identity instance. Every subsequent run is simply loading it from isolated storage.</p>
<p>Notice that I’m subscribing to _identity.Claims before the _identity is even instantiated. The subscription is a lambda expression, so it will be executed later. So what are Claims?</p>
<h3>A user claims a name</h3>
<p>A Claim is the desire for a person to have a specific user name. It is defined in factual as:</p>
<pre class="code">fact Claim {
    publish Identity identity;
    User user;
    publish IdentityService identityService;

    ClaimResponse* responses {
        ClaimResponse r : r.claim = this
    }

    bool isPending {
        not exists ClaimResponse r : r.claim = this
    }
}</pre>
<p>The Claim refers to the Identity from the phone, and the User that is being claimed. A User is:</p>
<pre class="code">fact User {
    string userName;

    Claim* claims {
        Claim c : c.user = this
    }
}</pre>
<p>Just like Identity, User has only one field. This field is its key, so any User object that I create with userName = “michael” will be the same instance. This is what makes it possible to challenge another user: the User instance I create on my phone will be the same as the one that he creates on his phone.</p>
<h3>A service approves and denies claims</h3>
<p>So when the user selects a name, a Claim is created. This Claim is published to an IdentityService, which is defined as:</p>
<pre class="code">fact IdentityService {
    Claim* pendingClaims {
        Claim c : c.identityService = this
            where c.isPending
    }
}</pre>
<p>Notice that IdentityService has no fields. Since fields define identity in Correspondence, there is nothing to distinguish one IdentityService from another. Every time I create a new IdentityService, I get back the same instance. It is a singleton.</p>
<p>There is a subscriber on my server looking for Claims published to the IdentityService. When it finds a Claim, it verifies that the user name is not taken by another Identity. It will then generate a ClaimResponse:</p>
<pre class="code">fact ClaimResponse {
    publish Claim claim;
    int approved;
}</pre>
<p><a href="http://11011.net/software/vspaste"></a></p>
<p>This response is published to the Claim. Remember the lambda expression in the Community Subscribe method? The phone has subscribed to all Claims attached to the Identity. That means that the ClaimResponse will be pushed to the phone, and the user will know whether it was accepted or rejected.</p>
<p>This is an example of the <a href="http://historicalmodeling.com/book/patterns/service">Service</a> pattern in Historical Modeling. With this pattern, I can allow people to choose their own name, but still rely upon Windows Live to authenticate them for me.</p>
				</div>

				<p class="postmetadata">Posted in <a href="indexb31a.html?cat=1" title="View all posts in Uncategorized" rel="category">Uncategorized</a> |   <a href="indexa123.html?p=631#respond" title="Comment on User identity on Windows Phone 7">No Comments &#187;</a></p>
			</div>

		
			<div class="post" id="post-630">
				<h2><a href="indexa1c1.html?p=630" rel="bookmark" title="Permanent Link to Flip pieces on the way out">Flip pieces on the way out</a></h2>
				<small>March 9th, 2011 <!-- by Michael L Perry --></small>

				<div class="entry">
					<p>I recently released Faceted Reversi, the first Windows Phone 7 application based on the Correspondence framework. Let me take a few posts to tell you how it works, and how you can build your own Correspondence application.</p>
<p>Faceted Reversi is, of course, a Reversi game. Reversi pieces have two sides: black and white. Each color represents one player. When a player moves, he places a piece with his color up. He then flips all of the enemy pieces that were flanked by that move.</p>
<p>When we describe the rules, we say that the player flips the pieces as he makes a move. This is in fact <strong>not</strong> how the code is written. On a players turn, all the program does is record the move. Pieces are flipped on the way out.</p>
<h3>GameBoard and GameState</h3>
<p>The game logic is controlled by two classes: GameBoard and GameState. A GameBoard is an immutable object that records a fixed board position. A GameBoard can tell you:</p>
<ul>
<li>which color is on each square </li>
<li>who’s move it is </li>
<li>how many pieces of each color are on the board </li>
<li>what moves are legal </li>
<li>what the board would look like after a legal move </li>
</ul>
<p>Or saying the same thing in code:</p>
<pre class="code"><span style="color: blue">public class </span><span style="color: #2b91af">GameBoard
</span>{
    <span style="color: blue">public static </span><font color="#2b91af">GameBoard</font> OpeningPosition { <span style="color: blue">get</span>; }
    <span style="color: blue">public int </span>MoveIndex { <span style="color: blue">get</span>; }
    <span style="color: blue">public </span><font color="#2b91af">PieceColor</font> PieceAt(Square square);
    <span style="color: blue">public </span><font color="#2b91af">PieceColor</font> ToMove { <span style="color: blue">get</span>; }
    <span style="color: blue">public int </span>BlackCount { <span style="color: blue">get</span>; }
    <span style="color: blue">public int </span>WhiteCount { <span style="color: blue">get</span>; }
    <span style="color: blue">public </span><span style="color: #2b91af">IEnumerable</span>&lt;Square&gt; LegalMoves { <span style="color: blue">get</span>; }
    <span style="color: blue">public </span><font color="#2b91af">GameBoard</font> AfterMove(Square square);
}</pre>
<p>GameState, on the other hand, is mutable. It records the current GameBoard and lets the user make a move.</p>
<p>The separation of immutable state from mutable state is significant. It makes it clear that the board position is dependent upon the sequence of moves. We represent that dependency using Update Controls. The current position is governed by a Dependent sentry that runs UpdateGameBoard when it becomes out-of-date.</p>
<pre class="code"><span style="color: blue">public class </span><span style="color: #2b91af">GameState
</span>{
    <span style="color: blue">private </span><font color="#2b91af">Game</font> _game;

    <span style="color: blue">private </span><font color="#2b91af">GameBoard</font> _gameBoard;
    <span style="color: blue">private </span><font color="#2b91af">Dependent</font> _depGameBoard;

    <span style="color: blue">public </span>GameState(<font color="#2b91af">Game</font> game)
    {
        _game = game;

        _depGameBoard = <span style="color: blue">new </span><font color="#2b91af">Dependent</font>(UpdateGameBoard);
    }

    <span style="color: blue">public </span><font color="#2b91af">PieceColor</font> PieceAt(<font color="#2b91af">Square</font> square)
    {
        <font color="#2b91af">GameBoard</font> gameBoard = GetGameBoard();
        <span style="color: blue">return </span>gameBoard.PieceAt(square);
    }

    <span style="color: blue">private </span><font color="#2b91af">GameBoard</font> GetGameBoard()
    {
        _depGameBoard.OnGet();
        <span style="color: blue">return </span>_gameBoard;
    }

    <span style="color: blue">private void </span>UpdateGameBoard()
    {
        _gameBoard = <font color="#2b91af">GameBoard</font>.OpeningPosition;
        <span style="color: blue">if </span>(_game != <span style="color: blue">null</span>)
        {
            <span style="color: #2b91af">List</span>&lt;<font color="#2b91af">Move</font>&gt; moves = _game.Moves.ToList();
            moves.Sort(<span style="color: blue">new </span><font color="#2b91af">LocalMoveComparer</font>());
            <span style="color: blue">int </span>expectedIndex = 0;
            <span style="color: blue">foreach </span>(<font color="#2b91af">Move</font> move <span style="color: blue">in </span>moves)
            {
                <span style="color: blue">if </span>(move.Index != expectedIndex)
                    <span style="color: blue">return</span>;
                <span style="color: blue">if </span>(move.Player.Index == 0 &amp;&amp; _gameBoard.ToMove != <font color="#2b91af">PieceColor</font>.Black)
                    <span style="color: blue">return</span>;
                <span style="color: blue">if </span>(move.Player.Index == 1 &amp;&amp; _gameBoard.ToMove != <font color="#2b91af">PieceColor</font>.White)
                    <span style="color: blue">return</span>;

                <font color="#2b91af">Square</font> square = <font color="#2b91af">Square</font>.FromIndex(move.Square);
                <span style="color: blue">if </span>(!_gameBoard.LegalMoves.Contains(square))
                    <span style="color: blue">return</span>;

                _gameBoard = _gameBoard.AfterMove(square);
                ++expectedIndex;
            }
        }
    }
}</pre>
<p>UpdateGameBoard runs through the list of moves in the game, sorted by move index. It validates each move against the current position. If an invalid or out-of-place move is found, it just gives up. The assumption is that moves were validated before they were added to the game, but we don’t want to crash the app or enter an invalid state if something goes wrong.</p>
<h3>Record a move</h3>
<p>So what happens when the player makes a move? Simple:</p>
<pre class="code"><span style="color: blue">public partial class </span><span style="color: #2b91af">Player
</span>{
    <span style="color: blue">public void </span>MakeMove(<span style="color: blue">int </span>index, <span style="color: blue">int </span>square)
    {
        Community.AddFact(<span style="color: blue">new </span>Move(<span style="color: blue">this</span>, index, square));
    }
}</pre>
<p>All we do is record that move. This adds it to the Moves collection in the game, stores it in the local database, sends it to the other player, and makes GameBoard out-of-date. Let’s break that down.</p>
<h3>Publish a move to other subscribers</h3>
<p>The Move fact is declared in a language called “factual”, specifically designed for Correspondence.</p>
<pre class="code">fact Move {
    Player player;
    int index;
    int square;
}</pre>
<p>Adding a fact to the Correspondence community stores it in the local database. It also sends the fact to the server, which forwards it to all interested subscribers. We can tell that the other player is interested because he subscribed to the Game.</p>
<pre class="code">_community = <span style="color: blue">new </span><font color="#2b91af">Community</font>(storageStrategy)
    .AddAsynchronousCommunicationStrategy(<span style="color: blue">new </span><font color="#2b91af">POXAsynchronousCommunicationStrategy</font>(configurationProvider))
    .Register&lt;<font color="#2b91af">CorrespondenceModule</font>&gt;()
    .Subscribe(() =&gt; _identity.ApprovedUsers
        .SelectMany(user =&gt; user.ActivePlayers)
        .Select(player =&gt; player.Game)
    );</pre>
<p>The linq query in the Subscribe call returns all of the Game facts that the player is currently involved in. When a player subscribes to a game, the server will send him all of the published facts. A Player fact is published to a game, as indicated by the “publish” keyword in the factual model.</p>
<pre class="code">fact Player {
    publish User user;
    publish Game game;
    int index;
}</pre>
<p>A Move fact belongs to a Player, so it is pushed as well. This is how Correspondence knows to send the move to the other player.</p>
<h3>Update the UI when a move arrives</h3>
<p>So when the move reaches the other player, how does the game know to refresh the board? The Game fact queries for related moves, again in the factual model.</p>
<pre class="code">fact Game {
    unique;

    Move* moves {
        Move m : m.player.game = this
    }
}</pre>
<p>This makes _game.Moves a live collection. Whenever a fact is added, whether on this phone or from another one, this collection changes. Update Controls recognizes that GameBoard depends upon this collection. So when it changes, GameBoard becomes out-of-date, and Update Controls notifies the view to redraw itself through data binding.</p>
<p>All Correspondence applications work this way. State changes cannot be side-effects of a user action. Instead, the program simply has to store the user action into the model. State changes occur on the way out, back toward the user interface. They are dependent upon the history of user actions.</p>
<p>It doesn’t matter if the move comes from the user interface, from the local database, or from another user. Flipping the pieces is not a side-effect of making a move. It is dependent upon the sequence of moves, regardless where they come from.</p>
				</div>

				<p class="postmetadata">Posted in <a href="indexb31a.html?cat=1" title="View all posts in Uncategorized" rel="category">Uncategorized</a> |   <a href="indexa1c1.html?p=630#respond" title="Comment on Flip pieces on the way out">No Comments &#187;</a></p>
			</div>

		
		<div class="navigation">
			<div class="alignleft"><a href="indexe377.html?paged=4">&laquo; Previous Entries</a></div>
			<div class="alignright"><a href="index6146.html?paged=2">Next Entries &raquo;</a></div>
		</div>

	
	</div>
		</td>
	</tr>
</table>

<hr />
<div id="footer">
<!-- If you'd like to support WordPress, having the "powered by" link someone on your blog is the best way, it's our only promotion or advertising. -->
	<p>
		Adventures in Software is proudly powered by 
		<a href="http://wordpress.org/">WordPress</a>
		<br /><a href="indexd784.html?feed=rss2">Entries (RSS)</a>
		and <a href="indexa6da.html?feed=comments-rss2">Comments (RSS)</a>.
		<!-- 21 queries. 0.776 seconds. -->
	</p>
</div>
<script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
try {
var pageTracker = _gat._getTracker("UA-389401-3");
pageTracker._trackPageview();
} catch(err) {}</script></div>

<!-- Gorgeous design by Michael Heilemann - http://binarybonsai.com/kubrick/ -->

		<div id="sk2-footer" style="color:#FFF; background-color:#444; padding: 3px 2px 3px 2px; border-top: #888 solid 1px;">This blog is protected by <a href="http://unknowngenius.com/blog/" title="Dave">dr Dave</a>'s <strong><a href="http://unknowngenius.com/blog/wordpress/spam-karma/" title="SK2">Spam Karma 2</a></strong>: <strong>274531</strong>  Spams eaten and counting...</div><script type="text/javascript" src="replies.js"></script>
<script type="text/javascript" src="blogger.js"></script>
<script type="text/javascript" src="http://twitter.com/statuses/user_timeline/michaellperry.json?callback=twitterCallback2&amp;count=5"></script>
<script type="text/javascript" src="http://search.twitter.com/search.json?q=@michaellperry&amp;callback=twitterCallbackReplies&amp;rpp=5"></script>
</body>

<!-- Mirrored from adventuresinsoftware.com/blog/?paged=3 by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 13 Jan 2017 13:03:01 GMT -->
</html>
