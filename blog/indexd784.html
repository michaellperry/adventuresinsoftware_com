<?xml version="1.0" encoding="UTF-8"?>
<!-- generator="wordpress/2.3.3" -->
<rss version="2.0"
	xmlns:content="http://purl.org/rss/1.0/modules/content/"
	xmlns:wfw="http://wellformedweb.org/CommentAPI/"
	xmlns:dc="http://purl.org/dc/elements/1.1/"
	>

<channel>
	<title>Adventures in Software</title>
	<link>http://adventuresinsoftware.com/blog</link>
	<description>Lessons learned on the road to quality computing</description>
	<pubDate>Wed, 26 Oct 2011 22:21:40 +0000</pubDate>
	<generator>http://wordpress.org/?v=2.3.3</generator>
	<language>en</language>
			<item>
		<title>The adventure continues</title>
		<link>http://adventuresinsoftware.com/blog/?p=682</link>
		<comments>http://adventuresinsoftware.com/blog/?p=682#comments</comments>
		<pubDate>Wed, 26 Oct 2011 22:16:11 +0000</pubDate>
		<dc:creator>Michael L Perry</dc:creator>
		
		<category><![CDATA[Uncategorized]]></category>

		<guid isPermaLink="false">http://adventuresinsoftware.com/blog/?p=682</guid>
		<description><![CDATA[Please follow me over to qedcode.com.
]]></description>
			<content:encoded><![CDATA[<p>Please follow me over to <a href="http://qedcode.com">qedcode.com</a>.</p>
]]></content:encoded>
			<wfw:commentRss>http://adventuresinsoftware.com/blog/?feed=rss2&amp;p=682</wfw:commentRss>
		</item>
		<item>
		<title>Remembering Steve</title>
		<link>http://adventuresinsoftware.com/blog/?p=681</link>
		<comments>http://adventuresinsoftware.com/blog/?p=681#comments</comments>
		<pubDate>Thu, 06 Oct 2011 13:40:30 +0000</pubDate>
		<dc:creator>Michael L Perry</dc:creator>
		
		<category><![CDATA[Uncategorized]]></category>

		<guid isPermaLink="false">http://adventuresinsoftware.com/blog/?p=681</guid>
		<description><![CDATA[My adventure, like so many others of my generation, started on a plastic box built by two guys named Steve in a garage in Los Altos, California.
My sister came home from the first day of high school and told us about these amazing machines that she was working with. You could give these things simple [...]]]></description>
			<content:encoded><![CDATA[<p>My adventure, like so many others of my generation, started on a plastic box built by two guys named Steve in a garage in Los Altos, California.</p>
<p>My sister came home from the first day of high school and told us about these amazing machines that she was working with. You could give these things simple instructions, and they would follow them. Put enough of these instructions together, and it does whatever you want. The next time I went to the mall department store, I saw one of these computers. I played with it until I had a square bouncing around the screen. It went something like this:</p>
<pre class="csharpcode">10 x = 0
20 y = 0
30 dx = 1
40 dy = 1
50 putchar(<span class="str">&quot; &quot;</span>, x, y)
60 x = x + dx
70 y = y + dy
80 putchar(<span class="str">&quot;*&quot;</span>, x, y)
90 <span class="kwrd">if</span> x &lt;= 0 <span class="kwrd">or</span> x &gt;= 39 <span class="kwrd">then</span> dx = -dx
100 <span class="kwrd">if</span> y &lt;= 0 <span class="kwrd">or</span> y &gt;= 39 <span class="kwrd">then</span> dy = -dy
110 <span class="kwrd">goto</span> 50</pre>
<p>
<style type="text/css">
.csharpcode, .csharpcode pre
{
	font-size: small;
	color: black;
	font-family: consolas, "Courier New", courier, monospace;
	background-color: #ffffff;
	/*white-space: pre;*/
}
.csharpcode pre { margin: 0em; }
.csharpcode .rem { color: #008000; }
.csharpcode .kwrd { color: #0000ff; }
.csharpcode .str { color: #006080; }
.csharpcode .op { color: #0000c0; }
.csharpcode .preproc { color: #cc6633; }
.csharpcode .asp { background-color: #ffff00; }
.csharpcode .html { color: #800000; }
.csharpcode .attr { color: #ff0000; }
.csharpcode .alt 
{
	background-color: #f4f4f4;
	width: 100%;
	margin: 0em;
}
.csharpcode .lnum { color: #606060; }</style>
<p>The syntax is wrong, but the spirit is right. I typed in variations of this program on several subsequent visits. I added gravity at some point, but I never saved the program. I always typed it in fresh from memory.</p>
<p><a href="http://adventuresinsoftware.com/blog/wp-content/uploads/2011/10/image.png"><img style="background-image: none; border-bottom: 0px; border-left: 0px; padding-left: 0px; padding-right: 0px; display: inline; float: right; border-top: 0px; border-right: 0px; padding-top: 0px" title="image" border="0" alt="image" align="right" src="http://adventuresinsoftware.com/blog/wp-content/uploads/2011/10/image-thumb.png" width="240" height="240" /></a>I started writing code on paper. This code wouldn’t run on any real machine, only the one in my head. My parents saw this and decided that it was time I got a chance to save my programs. They bought me an Apple II+ with a floppy drive.</p>
<p>I wrote more and more complex programs. I started looking at the machine code and comparing it to the assembly listing in the back of the Apple II users manual. I still remember the comments in that code with the author’s name: Steve Wozniak. I could see the actual loop that made the cursor blink.</p>
<p>Eventually, my Dad got me a subscription to Byte magazine. He also got me the Apple Macro Assembler and a second floppy drive. You had to put the assembler disk in one and write your program on the other.</p>
<p>After that first machine, I went on to an Apple IIe, various “IBM Clones”, and finally became a professional Windows programmer. I came back to Apple when I discovered that a MacBook Pro was the best available laptop for running Vista. I still use that 2007 MBP today (running Windows 7, and with a hard drive and memory upgrade) as my primary machine.</p>
<p>Steve Jobs and Steve Wozniak (and my Dad, of course) fed my love for software and helped start this adventure. And now one of them is gone. Let us continue the adventure in his honor.</p>
]]></content:encoded>
			<wfw:commentRss>http://adventuresinsoftware.com/blog/?feed=rss2&amp;p=681</wfw:commentRss>
		</item>
		<item>
		<title>Thought Cloud demo launch</title>
		<link>http://adventuresinsoftware.com/blog/?p=678</link>
		<comments>http://adventuresinsoftware.com/blog/?p=678#comments</comments>
		<pubDate>Fri, 03 Jun 2011 19:28:06 +0000</pubDate>
		<dc:creator>Michael L Perry</dc:creator>
		
		<category><![CDATA[Correspondence]]></category>

		<guid isPermaLink="false">http://adventuresinsoftware.com/blog/?p=678</guid>
		<description><![CDATA[The Thought Cloud demo is up at Q.E.D. Code. I will be presenting this demo at:

Dallas .NET User Group, June 9th at Paladin Consulting 
North Texas Silverlight User Group, June 13th at Microsoft Las Colinas 
DevLink, August 17th-19th in Chattanooga 
Possibly other venues 

You can download the source code from GitHub. Follow the creation of [...]]]></description>
			<content:encoded><![CDATA[<p>The Thought Cloud demo is up at <a href="http://qedcode.com/thoughtcloud">Q.E.D. Code</a>. I will be presenting this demo at:</p>
<ul>
<li><a href="http://ddnug.net/">Dallas .NET User Group</a>, June 9th at Paladin Consulting </li>
<li><a href="http://www.ntsilverlight.com/">North Texas Silverlight User Group</a>, June 13th at Microsoft Las Colinas </li>
<li><a href="http://devlink.net/">DevLink</a>, August 17th-19th in Chattanooga </li>
<li>Possibly other venues </li>
</ul>
<p>You can download the source code from <a href="https://github.com/michaellperry/FacetedWorlds.ThoughtCloud">GitHub</a>. Follow the creation of this demo step-by-step:</p>
<ul>
<li><a href="http://adventuresinsoftware.com/blog/?p=645">Thought Cloud structure</a></li>
<li><a href="http://adventuresinsoftware.com/blog/?p=646">Thought Cloud TDD #1: Initial thoughts</a></li>
<li><a href="http://adventuresinsoftware.com/blog/?p=647">Thought Cloud TDD #2: A new thought</a></li>
<li><a href="http://adventuresinsoftware.com/blog/?p=649">Thought Cloud TDD #3: Train of thought</a></li>
<li><a href="http://adventuresinsoftware.com/blog/?p=650">Thought Cloud TDD #4: Cloud factory</a></li>
<li><a href="http://adventuresinsoftware.com/blog/?p=651">Thought Cloud TDD #5: Backward thinking</a></li>
<li><a href="http://adventuresinsoftware.com/blog/?p=652">Thought Cloud TDD #6: Get your thoughts in order</a></li>
<li><a href="http://adventuresinsoftware.com/blog/?p=653">Thought Cloud TDD #7: Devoid of thought</a></li>
<li><a href="http://adventuresinsoftware.com/blog/?p=654">Thought Cloud TDD #8: Hey, you, get onto my cloud</a></li>
<li><a href="http://adventuresinsoftware.com/blog/?p=655">Thought Cloud TDD #9: Penny for your thoughts</a></li>
<li><a href="http://adventuresinsoftware.com/blog/?p=656">Thought Cloud TDD #10: Think back</a></li>
<li><a href="http://adventuresinsoftware.com/blog/?p=657">Thought Cloud UI #1: Structure of the UI project</a></li>
<li><a href="http://adventuresinsoftware.com/blog/?p=672">Thought Cloud UI #2: Summary view models</a></li>
<li><a href="http://adventuresinsoftware.com/blog/?p=673">Thought Cloud UI #3: Synchronization status</a></li>
<li><a href="http://adventuresinsoftware.com/blog/?p=674">Thought Cloud UI #4: Open the clouds</a></li>
<li><a href="http://adventuresinsoftware.com/blog/?p=675">Thought Cloud UI #5: Arrange your thoughts</a></li>
<li><a href="http://adventuresinsoftware.com/blog/?p=676">Thought Cloud UI #6: Change your mind</a></li>
<li><a href="http://adventuresinsoftware.com/blog/?p=677">Thought Cloud TDD #11: Conflict detection</a></li>
</ul>
<p>To create your own Correspondence application for Silverlight, add a NuGet reference to <a href="http://nuget.org/List/Packages/Correspondence.Silverlight.AllInOne">Correspondence.Silverlight.AllInOne</a>. The project is hosted on <a href="http://correspondence.codeplex.com">CodePlex</a>. Contact me at <a href="mailto:mperry@mallardsoft.com">mperry@mallardsoft.com</a> or <a href="http://twitter.com/michaellperry">@michaellperry</a> for an API key for the Correspondence server.</p>
]]></content:encoded>
			<wfw:commentRss>http://adventuresinsoftware.com/blog/?feed=rss2&amp;p=678</wfw:commentRss>
		</item>
		<item>
		<title>Thought Cloud TDD #11: Conflict detection</title>
		<link>http://adventuresinsoftware.com/blog/?p=677</link>
		<comments>http://adventuresinsoftware.com/blog/?p=677#comments</comments>
		<pubDate>Thu, 02 Jun 2011 12:53:00 +0000</pubDate>
		<dc:creator>Michael L Perry</dc:creator>
		
		<category><![CDATA[Correspondence]]></category>

		<guid isPermaLink="false">http://adventuresinsoftware.com/blog/?p=677</guid>
		<description><![CDATA[The Thought Cloud application is just about ready to release. Get the code now, or watch this space for a live deployment.
An occasionally-connected client application works off line as well as on. While off line, it queues changes that the user makes. It synchronizes those changes when the connection is reestablished. So the question arises: [...]]]></description>
			<content:encoded><![CDATA[<p>The <a href="https://github.com/michaellperry/FacetedWorlds.ThoughtCloud">Thought Cloud</a> application is just about ready to release. Get the code now, or watch this space for a live deployment.</p>
<p>An occasionally-connected client application works off line as well as on. While off line, it queues changes that the user makes. It synchronizes those changes when the connection is reestablished. So the question arises: what happens if someone made a conflicting change while I was off line?</p>
<p>Correspondence performs conflict detection. Conflict resolution is up to your application.</p>
<p>Every mutable field is represented in code with the Disputable&lt;T&gt; type. This type implicitly converts to T. The Text property of a Thought is a mutable string.</p>
<pre class="code">fact Thought {
key:
    unique;
    publish Cloud cloud;

<strong>mutable</strong>:
    string text;

    ...
}</pre>
<p>This generates to a Disputable&lt;string&gt;, which the view model treats as a regular string.</p>
<pre class="code"><span style="color: blue">public class </span><span style="color: #2b91af">ThoughtViewModelActual </span>: <span style="color: #2b91af">ThoughtViewModel
</span>{
    ...

    <span style="color: blue">public <strong>string</strong> </span>Text
    {
        <span style="color: blue">get </span>{ <span style="color: blue">return </span>_thought.<strong>Text</strong> ?? <span style="color: #a31515">&quot;My thought&quot;</span>; }
        <span style="color: blue">set
        </span>{
            _thought.<strong>Text</strong> = <span style="color: blue">value</span>;
            _container.EditThought = <span style="color: blue">null</span>;
        }
    }
}</pre>
<p>Disputable&lt;T&gt; has a Value property which can be used in place of implicit type conversion. It also has two extra properties:</p>
<ul>
<li>InConflict – true when a conflict is detected.</li>
<li>Candidates – the collection of possible values.</li>
</ul>
<p>With these two properties, your application can present conflicts to the user.</p>
<pre class="code">[<span style="color: #2b91af">TestMethod</span>]
<span style="color: blue">public void </span>ConflictsAreDetected()
{
    <span style="color: #2b91af">Cloud </span>cloud_Mike = MikeSharesCloudWithRussell();
    <span style="color: #2b91af">Thought </span>thought_Mike = cloud_Mike.NewThought();
    cloud_Mike.CentralThought = thought_Mike;
    thought_Mike.Text = <span style="color: #a31515">&quot;Initial value&quot;</span>;

    Synchronize();

    <span style="color: #2b91af">Thought </span>thought_Russell = _russellsIdentity.SharedClouds.Single().CentralThought;
    thought_Mike.Text = <span style="color: #a31515">&quot;Mike's change&quot;</span>;
    thought_Russell.Text = <span style="color: #a31515">&quot;Russell's change&quot;</span>;

    Synchronize();

    <span style="color: #2b91af">Assert</span>.IsTrue(thought_Mike.Text.InConflict);
    <span style="color: #2b91af">Assert</span>.IsTrue(thought_Mike.Text.Candidates.Contains(<span style="color: #a31515">&quot;Mike's change&quot;</span>));
    <span style="color: #2b91af">Assert</span>.IsTrue(thought_Mike.Text.Candidates.Contains(<span style="color: #a31515">&quot;Russell's change&quot;</span>));
    <span style="color: #2b91af">Assert</span>.Is<strong>False</strong>(thought_Mike.Text.Candidates.Contains(<span style="color: #a31515">&quot;Initial value&quot;</span>));

    <span style="color: #2b91af">Assert</span>.IsTrue(thought_Russell.Text.InConflict);
    <span style="color: #2b91af">Assert</span>.IsTrue(thought_Russell.Text.Candidates.Contains(<span style="color: #a31515">&quot;Mike's change&quot;</span>));
    <span style="color: #2b91af">Assert</span>.IsTrue(thought_Russell.Text.Candidates.Contains(<span style="color: #a31515">&quot;Russell's change&quot;</span>));
    <span style="color: #2b91af">Assert</span>.Is<strong>False</strong>(thought_Russell.Text.Candidates.Contains(<span style="color: #a31515">&quot;Initial value&quot;</span>));
}</pre>
<p>To resolve a conflict, simply assign the field to the desired value. It does not necessarily have to be one of the candidates.</p>
<pre class="code">[<span style="color: #2b91af">TestMethod</span>]
<span style="color: blue">public void </span>ConflictsCanBeResolved()
{
    <span style="color: #2b91af">Cloud </span>cloud_Mike = MikeSharesCloudWithRussell();
    <span style="color: #2b91af">Thought </span>thought_Mike = cloud_Mike.NewThought();
    cloud_Mike.CentralThought = thought_Mike;
    thought_Mike.Text = <span style="color: #a31515">&quot;Initial value&quot;</span>;

    Synchronize();

    <span style="color: #2b91af">Thought </span>thought_Russell = _russellsIdentity.SharedClouds.Single().CentralThought;
    thought_Mike.Text = <span style="color: #a31515">&quot;Mike's change&quot;</span>;
    thought_Russell.Text = <span style="color: #a31515">&quot;Russell's change&quot;</span>;

    Synchronize();

    thought_Mike.Text = <span style="color: #a31515">&quot;Mike's resolution&quot;</span>;

    Synchronize();

    <span style="color: #2b91af">Assert</span>.Is<strong>False</strong>(thought_Mike.Text.InConflict);
    <span style="color: #2b91af">Assert</span>.AreEqual(<span style="color: #a31515">&quot;Mike's resolution&quot;</span>, thought_Mike.Text.Value);

    <span style="color: #2b91af">Assert</span>.Is<strong>False</strong>(thought_Russell.Text.InConflict);
    <span style="color: #2b91af">Assert</span>.AreEqual(<span style="color: #a31515">&quot;Mike's resolution&quot;</span>, thought_Russell.Text.Value);
}</pre>
<p>You can leave conflict resolution to the user. Expose these properties through the data model to give the user a visual indicator of the conflict. When they set the value, they will resolve the conflict.</p>
]]></content:encoded>
			<wfw:commentRss>http://adventuresinsoftware.com/blog/?feed=rss2&amp;p=677</wfw:commentRss>
		</item>
		<item>
		<title>Thought Cloud UI #6: Change your mind</title>
		<link>http://adventuresinsoftware.com/blog/?p=676</link>
		<comments>http://adventuresinsoftware.com/blog/?p=676#comments</comments>
		<pubDate>Wed, 01 Jun 2011 13:04:00 +0000</pubDate>
		<dc:creator>Michael L Perry</dc:creator>
		
		<category><![CDATA[Correspondence]]></category>

		<guid isPermaLink="false">http://adventuresinsoftware.com/blog/?p=676</guid>
		<description><![CDATA[The Thought Cloud demo is almost feature complete. Just a few more changes.
The application is not very interactive yet. The user should be able to switch focus from one thought to another. They should also be able to edit thought text. Let’s take these features one at a time.
When you think about a user switching [...]]]></description>
			<content:encoded><![CDATA[<p>The <a href="https://github.com/michaellperry/FacetedWorlds.ThoughtCloud">Thought Cloud</a> demo is almost feature complete. Just a few more changes.</p>
<p>The application is not very interactive yet. The user should be able to switch focus from one thought to another. They should also be able to edit thought text. Let’s take these features one at a time.</p>
<p>When you think about a user switching their focus from one object to another, what word comes to mind? If you said “navigation”, then we are on the same page. As the user switches focus from one thought to another, they are navigating through the cloud. They aren’t changing the cloud itself. They are only changing their own point-of-view. We need a place to store that point-of-view.</p>
<pre class="code"><span style="color: blue">public class </span><span style="color: #2b91af">CloudNavigationModel
</span>{
    <span style="color: blue">private readonly </span><span style="color: #2b91af">Cloud </span>_cloud;

    <span style="color: blue">private </span><span style="color: #2b91af">Independent</span>&lt;<span style="color: #2b91af">Thought</span>&gt; _focusThought = <span style="color: blue">new </span><span style="color: #2b91af">Independent</span>&lt;<span style="color: #2b91af">Thought</span>&gt;();

    <span style="color: blue">public </span>CloudNavigationModel(<span style="color: #2b91af">Cloud </span>cloud)
    {
        _cloud = cloud;
    }

    <span style="color: blue">public </span><span style="color: #2b91af">Thought </span>FocusThought
    {
        <span style="color: blue">get </span>{ <span style="color: blue">return </span>_focusThought.Value ?? _cloud.CentralThought.Value; }
        <span style="color: blue">set </span>{ _focusThought.Value = <span style="color: blue">value</span>; }
    }
}</pre>
<p>The focus thought is independent. The user can change it whenever they want. If they haven’t set it yet, then it defaults to the central thought of the cloud. We don’t just initialize the focus thought to the central thought, because this is another example of honoring the default value. The default of null is a valid value, and should indicate that we want to focus on the cloud’s central thought. As an added bonus, if the cloud’s central thought changes after the navigation model is initialized, the focus thought will shift as well.</p>
<p>Like any navigation model, the cloud navigation model should be injected into the view model. We’ll do that in the MainViewModel, where the cloud view models are constructed.</p>
<pre class="code"><span style="color: blue">public </span><span style="color: #2b91af">IEnumerable</span>&lt;<span style="color: #2b91af">CloudTabViewModel</span>&gt; OpenClouds
{
    <span style="color: blue">get
    </span>{
        <span style="color: blue">return
            from </span>cloud <span style="color: blue">in </span>_navigationModel.OpenClouds
            <span style="color: blue">select new </span><span style="color: #2b91af">CloudTabViewModel</span>(cloud, <strong><span style="color: blue">new </span><span style="color: #2b91af">CloudNavigationModel</span>(cloud)</strong>);
    }
}</pre>
<p>Now each cloud view model has its own navigation model. We can easily switch all of the positioning code from the central thought to the focus thought. But how do we change the focus thought? The user should switch focus when they click on a thought. So we add a command to the ThoughtViewModel.</p>
<pre class="code"><span style="color: blue">public class </span><span style="color: #2b91af">ThoughtViewModelActual </span>: <span style="color: #2b91af">ThoughtViewModel
</span>{
    ...

    <span style="color: blue">public </span><span style="color: #2b91af">ICommand </span>Focus
    {
        <span style="color: blue">get
        </span>{
            <span style="color: blue">return </span><span style="color: #2b91af">MakeCommand
                </span>.Do(() =&gt;
                {
                    <span style="color: blue">if </span>(_container.FocusThought != _thought)
                        <strong>_container.FocusThought = _thought</strong>;
                });
        }
    }
}</pre>
<p>Then we can just use <a href="http://expressionblend.codeplex.com/">InvokeDataCommand</a> to execute this command on click. When the user clicks on a thought bubble, the focus thought is changed. This causes the positioning to go out-of-date, and all of the thought bubbles to shuffle.</p>
<h3>Edit your thoughts</h3>
<p>The user needs to change the text of a thought in two circumstances. First, when they have just added the thought. And second, when they click on it. Since clicking on a thought already makes it the focus, we’ll say that clicking on the focus thought puts it in edit mode.</p>
<p>Only one thought at a time can be in edit mode, so we’ll store that edit thought in the navigation model.</p>
<pre class="code"><span style="color: blue">public class </span><span style="color: #2b91af">CloudNavigationModel
</span>{
    ...

    <span style="color: blue">private </span><strong><span style="color: #2b91af">Independent</span>&lt;<span style="color: #2b91af">Thought</span>&gt;</strong> _editThought = <span style="color: blue">new </span><span style="color: #2b91af">Independent</span>&lt;<span style="color: #2b91af">Thought</span>&gt;();

    <span style="color: blue">public </span><span style="color: #2b91af">Thought </span>EditThought
    {
        <span style="color: blue">get </span>{ <span style="color: blue">return </span>_editThought; }
        <span style="color: blue">set </span>{ _editThought.Value = <span style="color: blue">value</span>; }
    }
}</pre>
<p>The view model needs a property that will determine when the text box is visible. It will be true when this thought is the edit thought.</p>
<pre class="code"><span style="color: blue">public class </span><span style="color: #2b91af">ThoughtViewModelActual </span>: <span style="color: #2b91af">ThoughtViewModel
</span>{
    ...

    <span style="color: blue">public bool </span>Editing
    {
        <span style="color: blue">get </span>{ <span style="color: blue">return </span>_container.EditThought == _thought; }
    }
}</pre>
<p>When the user clicks the thought bubble, it enters edit mode if it is already the focus thought. So let’s add that to the Focus command.</p>
<pre class="code"><span style="color: blue">public class </span><span style="color: #2b91af">ThoughtViewModelActual </span>: <span style="color: #2b91af">ThoughtViewModel
</span>{
    ...

    <span style="color: blue">public </span><span style="color: #2b91af">ICommand </span>Focus
    {
        <span style="color: blue">get
        </span>{
            <span style="color: blue">return </span><span style="color: #2b91af">MakeCommand
                </span>.Do(() =&gt;
                {
                    <span style="color: blue">if </span>(_container.FocusThought != _thought)
                        _container.FocusThought = _thought;
                    <span style="color: blue">else if </span>(_container.EditThought != _thought)
                        <strong>_container.EditThought = _thought</strong>;
                    <span style="color: blue">else
                        </span>_container.EditThought = <span style="color: blue">null</span>;
                });
        }
    }
}</pre>
<p>When the user clicks on the background, we want to exit edit mode. So we bind a command to the click event of the background border.</p>
<pre class="code"><span style="color: blue">public class </span><span style="color: #2b91af">CloudViewModel </span>: <span style="color: #2b91af">IThoughtContainer
</span>{
    ...

    <span style="color: blue">public </span><span style="color: #2b91af">ICommand </span>ClearEdit
    {
        <span style="color: blue">get
        </span>{
            <span style="color: blue">return </span><span style="color: #2b91af">MakeCommand
                </span>.Do(() =&gt; <strong>_navigation.EditThought = <span style="color: blue">null</span></strong>);
        }
    }
}</pre>
<p>Finally, when the user adds a new thought, we want to put that thought into edit mode. So we add that to the NewThought command.</p>
<pre class="code"><span style="color: blue">public class </span><span style="color: #2b91af">CloudViewModel </span>: <span style="color: #2b91af">IThoughtContainer
</span>{
    ...

    <span style="color: blue">public </span><span style="color: #2b91af">ICommand </span>NewThought
    {
        <span style="color: blue">get
        </span>{
            <span style="color: blue">return </span><span style="color: #2b91af">MakeCommand</span>.Do(() =&gt;
            {
                <span style="color: #2b91af">Thought </span>thought = _cloud.NewThought();
                <span style="color: #2b91af">Thought </span>focusThought = _navigation.FocusThought;
                <span style="color: blue">if </span>(focusThought == <span style="color: blue">null</span>)
                {
                    focusThought = _cloud.NewThought();
                    _cloud.CentralThought = focusThought;
                }
                focusThought.LinkTo(thought);
                _<strong>navigation.EditThought = thought</strong>;
            });
        }
    }
}</pre>
<p>With the Navigation Model pattern, we can keep information about the user’s point-of-view. Several different view models can interact with and respond to this navigation model. They don’t need to pass messages to each other. It’s a simple way to help the user browse and edit their information.</p>
]]></content:encoded>
			<wfw:commentRss>http://adventuresinsoftware.com/blog/?feed=rss2&amp;p=676</wfw:commentRss>
		</item>
		<item>
		<title>Thought Cloud UI #5: Arrange your thoughts</title>
		<link>http://adventuresinsoftware.com/blog/?p=675</link>
		<comments>http://adventuresinsoftware.com/blog/?p=675#comments</comments>
		<pubDate>Tue, 31 May 2011 13:36:00 +0000</pubDate>
		<dc:creator>Michael L Perry</dc:creator>
		
		<category><![CDATA[Correspondence]]></category>

		<guid isPermaLink="false">http://adventuresinsoftware.com/blog/?p=675</guid>
		<description><![CDATA[I’ll be presenting Thought Cloud at the Dallas .NET User Group and the North Texas Silverlight User Group in a couple of weeks. I’m finishing up the demo now.
In the last installment, we added the ability to open a cloud in a tab. Now we need to display the thoughts in a cloud of bubbles [...]]]></description>
			<content:encoded><![CDATA[<p>I’ll be presenting <a href="https://github.com/michaellperry/FacetedWorlds.ThoughtCloud">Thought Cloud</a> at the Dallas .NET User Group and the North Texas Silverlight User Group in a couple of weeks. I’m finishing up the demo now.</p>
<p>In the last installment, we added the ability to open a cloud in a tab. Now we need to display the thoughts in a cloud of bubbles rather than in a list. To make a plan, I created a mock view.</p>
<p><a href="http://adventuresinsoftware.com/pictures/Thought-Cloud-UI-_11FED/image.png"><img style="background-image: none; border-bottom: 0px; border-left: 0px; padding-left: 0px; padding-right: 0px; display: inline; border-top: 0px; border-right: 0px; padding-top: 0px" title="image" border="0" alt="image" src="http://adventuresinsoftware.com/pictures/Thought-Cloud-UI-_11FED/image_thumb.png" width="634" height="484" /></a></p>
<p>The mock is not backed by sample data. It does not bind to the view models. But it does exercise some XAML that we want to use for the real view. Most significantly, I determined how to position the bubbles.</p>
<p>First, I determined how to position the text within an ellipse. I want the ellipse to be a fixed margin away from the text, but to expand with the text’s length. After playing around with a few variations, the one that worked best for me was to put both the ellipse and the text block in a grid. The text determines the size of the grid, and the grid determines the size of the ellipse.</p>
<pre class="code"><span style="color: blue">&lt;</span><span style="color: #a31515">Grid</span><span style="color: blue">&gt;
    &lt;</span><span style="color: #a31515">Ellipse </span><span style="color: blue">/&gt;
    &lt;</span><span style="color: #a31515">TextBlock </span><span style="color: red">Text</span><span style="color: blue">=&quot;Star Wars&quot; </span><span style="color: red">Margin</span><span style="color: blue">=&quot;15,10&quot; </span><span style="color: red">HorizontalAlignment</span><span style="color: blue">=&quot;Center&quot; </span><span style="color: red">VerticalAlignment</span><span style="color: blue">=&quot;Center&quot; </span><span style="color: blue">/&gt;
&lt;/</span><span style="color: #a31515">Grid</span><span style="color: blue">&gt;
</span></pre>
<p>Then there was the question of positioning the thought bubble within the cloud. My first thought was to use a Canvas. Unfortunately, Canvas lays out its children based on the left and top. I want to position my thought bubbles based on the center. In order to convert center to left and top, I would need to measure width and height. That would require doing the layout in the view. I’m going to try to do everything through data binding in the view model.</p>
<p>What I settled on was using a Grid as a container, centering each thought bubble, and positioning them thought their margins. A centered bubble at {0,0,0,0} will appear in the center of the Grid. When I change the margin to {10,0,-10,0}, it moves to the right by 10 units. So I need to bind the margin to {X, Y, -X,-Y}.</p>
<p>Throw in a text block for editing the thought and this is the item template that I need to bind.</p>
<pre class="code"><span style="color: blue">&lt;</span><span style="color: #a31515">DataTemplate </span><span style="color: red">x</span><span style="color: blue">:</span><span style="color: red">Key</span><span style="color: blue">=&quot;ThoughtItemTemplate&quot;&gt;
    &lt;</span><span style="color: #a31515">Grid </span><span style="color: red">HorizontalAlignment</span><span style="color: blue">=&quot;Center&quot; </span><span style="color: red">VerticalAlignment</span><span style="color: blue">=&quot;Center&quot; </span><span style="color: red">Margin</span><span style="color: blue">=&quot;{</span><span style="color: #a31515">Binding </span><span style="color: red">Margin</span><span style="color: blue">}&quot;&gt;
        &lt;</span><span style="color: #a31515">Ellipse </span><span style="color: blue">/&gt;
        &lt;</span><span style="color: #a31515">TextBlock </span><span style="color: red">Text</span><span style="color: blue">=&quot;{</span><span style="color: #a31515">Binding </span><span style="color: red">Text</span><span style="color: blue">}&quot; </span><span style="color: red">Margin</span><span style="color: blue">=&quot;15,10&quot; </span><span style="color: red">HorizontalAlignment</span><span style="color: blue">=&quot;Center&quot; </span><span style="color: red">VerticalAlignment</span><span style="color: blue">=&quot;Center&quot; </span><span style="color: blue">/&gt;
        &lt;</span><span style="color: #a31515">TextBox </span><span style="color: red">Text</span><span style="color: blue">=&quot;{</span><span style="color: #a31515">Binding </span><span style="color: red">Text</span><span style="color: blue">, </span><span style="color: red">Mode</span><span style="color: blue">=TwoWay}&quot; </span><span style="color: red">VerticalAlignment</span><span style="color: blue">=&quot;Center&quot; </span><span style="color: red">HorizontalAlignment</span><span style="color: blue">=&quot;Center&quot; </span><span style="color: red">Visibility</span><span style="color: blue">=&quot;{</span><span style="color: #a31515">Binding </span><span style="color: red">Editing</span><span style="color: blue">, </span><span style="color: red">Converter</span><span style="color: blue">={</span><span style="color: #a31515">StaticResource </span><span style="color: red">VisibleWhenTrueConverter</span><span style="color: blue">}}&quot;/&gt;
    &lt;/</span><span style="color: #a31515">Grid</span><span style="color: blue">&gt;
&lt;/</span><span style="color: #a31515">DataTemplate</span><span style="color: blue">&gt;
</span></pre>
<p>Let’s add these properties to the ThoughtViewModel.</p>
<pre class="code"><span style="color: blue">public interface </span><span style="color: #2b91af">ThoughtViewModel
</span>{
    <span style="color: blue">string </span>Text { <span style="color: blue">get</span>; <span style="color: blue">set</span>; }
    <span style="color: #2b91af">Thickness </span>Margin { <span style="color: blue">get</span>; }
    <span style="color: blue">bool </span>Editing { <span style="color: blue">get</span>; }
}</pre>
<h3>Calculate position</h3>
<p>The position of a thought is calculated. In other words, it’s dependent. The user doesn’t get to position it. The tricky part is that it depends upon where the thought falls within the cloud among its neighbors. So a ThoughtViewModel doesn’t have enough information to calculate position. That is the responsibility of the CloudViewModel.</p>
<p>Let’s give the CloudViewModel a dependent dictionary of Points by Thought. We introduce the Dependent class from Update Controls, which tracks dependency using an update method. It will invoke the update method only when the property is out-of-date. In this case, the dictionary depends upon the collection of thoughts.</p>
<pre class="code"><span style="color: blue">public class </span><span style="color: #2b91af">CloudViewModel
</span>{
    ...
    <span style="color: blue">private </span><span style="color: #2b91af">Dictionary</span>&lt;<span style="color: #2b91af">Thought</span>, <span style="color: #2b91af">Point</span>&gt; _centerByThought = <span style="color: blue">new </span><span style="color: #2b91af">Dictionary</span>&lt;<span style="color: #2b91af">Thought</span>, <span style="color: #2b91af">Point</span>&gt;();
    <span style="color: blue">private </span><span style="color: #2b91af">Dependent </span>_depCenterByThought;

    <span style="color: blue">public </span>CloudViewModel(<span style="color: #2b91af">Cloud </span>cloud)
    {
        _depCenterByThought = <span style="color: blue">new </span><span style="color: #2b91af">Dependent</span>(() =&gt; _centerByThought = CalculateCenterByThought());
    }

    <span style="color: blue">private </span><span style="color: #2b91af">Dictionary</span>&lt;<span style="color: #2b91af">Thought</span>, <span style="color: #2b91af">Point</span>&gt; CalculateCenterByThought()
    {
        <span style="color: #2b91af">Thought </span>centralThought = _cloud.<strong>CentralThought</strong>;
        <span style="color: #2b91af">Dictionary</span>&lt;<span style="color: #2b91af">Thought</span>, <span style="color: #2b91af">Point</span>&gt; centerByThought = <span style="color: blue">new </span><span style="color: #2b91af">Dictionary</span>&lt;<span style="color: #2b91af">Thought</span>, <span style="color: #2b91af">Point</span>&gt;();
        <span style="color: blue">if </span>(centralThought != <span style="color: blue">null</span>)
        {
            centerByThought.Add(centralThought, <span style="color: blue">new </span><span style="color: #2b91af">Point</span>(0.0, 0.0));
            <span style="color: #2b91af">List</span>&lt;<span style="color: #2b91af">Thought</span>&gt; neighbors = centralThought.<strong>Neighbors</strong>
                .Where(n =&gt; n != centralThought)
                .ToList();
            <span style="color: blue">int </span>step = 0;
            <span style="color: blue">double </span>horizontalRadius = 230.0;
            <span style="color: blue">double </span>verticalRadius = 120.0;
            <span style="color: blue">foreach </span>(<span style="color: #2b91af">Thought </span>neighbor <span style="color: blue">in </span>neighbors)
            {
                <span style="color: blue">double </span>theta = 2 * <span style="color: #2b91af">Math</span>.PI * (<span style="color: blue">double</span>)step / (<span style="color: blue">double</span>)neighbors.Count;
                centerByThought.Add(neighbor, <span style="color: blue">new </span><span style="color: #2b91af">Point</span>(
                    horizontalRadius * <span style="color: #2b91af">Math</span>.Cos(theta),
                    verticalRadius * <span style="color: #2b91af">Math</span>.Sin(theta)));
                ++step;
            }
        }
        <span style="color: blue">return </span>centerByThought;
    }
}</pre>
<p>Because the update method gets the neighbors of the central thought, it will become out-of-date whenever a neighbor is added or removed, or the central thought is changed.</p>
<p>Next we need to give the ThoughtViewModel a way to access its own center point. Let’s pass a function into its constructor. This function will look up the thought’s center point from the dictionary. The call to OnGet will ensure that the dictionary is up-to-date.</p>
<pre class="code"><span style="color: blue">public class </span><span style="color: #2b91af">CloudViewModel
</span>{
    ...

    <span style="color: blue">public </span><span style="color: #2b91af">IEnumerable</span>&lt;<span style="color: #2b91af">ThoughtViewModel</span>&gt; Thoughts
    {
        <span style="color: blue">get
        </span>{
            <span style="color: #2b91af">Thought </span>centralThought = _cloud.CentralThought;
            <span style="color: blue">if </span>(centralThought == <span style="color: blue">null</span>)
            {
                <span style="color: blue">return </span><span style="color: #2b91af">Enumerable</span>.Repeat(<span style="color: blue">new </span><span style="color: #2b91af">ThoughtViewModelSimulated</span>(_cloud), 1)
                    .OfType&lt;<span style="color: #2b91af">ThoughtViewModel</span>&gt;();
            }
            <span style="color: blue">else
            </span>{
                <span style="color: blue">return </span><span style="color: #2b91af">Enumerable</span>.Repeat(<span style="color: blue">new </span><span style="color: #2b91af">ThoughtViewModelActual</span>(centralThought, <strong>GetCenterByThought</strong>), 1).Union(
                    <span style="color: blue">from </span>n <span style="color: blue">in </span>centralThought.Neighbors
                    <span style="color: blue">where </span>n != centralThought
                    <span style="color: blue">select new </span><span style="color: #2b91af">ThoughtViewModelActual</span>(n, <strong>GetCenterByThought</strong>))
                    .OfType&lt;<span style="color: #2b91af">ThoughtViewModel</span>&gt;();
            }
        }
    }

    <span style="color: blue">private </span><span style="color: #2b91af">Point </span>GetCenterByThought(<span style="color: #2b91af">Thought </span>thought)
    {
        _depCenterByThought.OnGet();
        <span style="color: #2b91af">Point </span>center = <span style="color: blue">new </span><span style="color: #2b91af">Point</span>();
        _centerByThought.TryGetValue(thought, <span style="color: blue">out </span>center);
        <span style="color: blue">return </span>center;
    }
}</pre>
<p>Now the ThoughtViewModel can calculate its own Margin.</p>
<pre class="code"><span style="color: blue">public class </span><span style="color: #2b91af">ThoughtViewModelActual </span>: <span style="color: #2b91af">ThoughtViewModel
</span>{
    ...
    <span style="color: blue">private readonly </span>Func&lt;<span style="color: #2b91af">Thought</span>, <span style="color: #2b91af">Point</span>&gt; _getCenterByThought;

    <span style="color: blue">public </span>ThoughtViewModelActual(<span style="color: #2b91af">Thought </span>thought, Func&lt;<span style="color: #2b91af">Thought</span>, <span style="color: #2b91af">Point</span>&gt; getCenterByThought)
    {
        _getCenterByThought = getCenterByThought;
    }

    <span style="color: blue">public </span><span style="color: #2b91af">Thickness </span>Margin
    {
        <span style="color: blue">get
        </span>{
            <span style="color: #2b91af">Point </span>center = _getCenterByThought(_thought);
            <span style="color: blue">return new </span><span style="color: #2b91af">Thickness</span>(center.X, center.Y, -center.X, -center.Y);
        }
    }
}</pre>
<p>By using a dependent dictionary, the cloud can calculate the position of all of its thoughts once, and let each thought access it to data bind into place. When a new thought arrives, either from the local user or from a remote collaborator, the positioning will be recalculated and all thoughts will move to their new locations.</p>
<p><a href="http://adventuresinsoftware.com/pictures/Thought-Cloud-UI-_11FED/Thought-Cloud.png"><img style="background-image: none; border-bottom: 0px; border-left: 0px; padding-left: 0px; padding-right: 0px; display: inline; border-top: 0px; border-right: 0px; padding-top: 0px" title="Thought Cloud" border="0" alt="Thought Cloud" src="http://adventuresinsoftware.com/pictures/Thought-Cloud-UI-_11FED/Thought-Cloud_thumb.png" width="609" height="346" /></a></p>
]]></content:encoded>
			<wfw:commentRss>http://adventuresinsoftware.com/blog/?feed=rss2&amp;p=675</wfw:commentRss>
		</item>
		<item>
		<title>Thought Cloud UI #4: Open the clouds</title>
		<link>http://adventuresinsoftware.com/blog/?p=674</link>
		<comments>http://adventuresinsoftware.com/blog/?p=674#comments</comments>
		<pubDate>Mon, 30 May 2011 13:19:00 +0000</pubDate>
		<dc:creator>Michael L Perry</dc:creator>
		
		<category><![CDATA[Correspondence]]></category>

		<guid isPermaLink="false">http://adventuresinsoftware.com/blog/?p=674</guid>
		<description><![CDATA[The Thought Cloud example will be ready just in time for my talk at the Dallas .NET User Group. I hope you’ll join me.
We’ve created a very simple home view that shows a list of clouds and has an add button. Next we’ll need to open a cloud and show it in a separate view. [...]]]></description>
			<content:encoded><![CDATA[<p>The <a href="https://github.com/michaellperry/FacetedWorlds.ThoughtCloud">Thought Cloud</a> example will be ready just in time for my talk at the Dallas .NET User Group. I hope you’ll join me.</p>
<p>We’ve created a very simple home view that shows a list of clouds and has an add button. Next we’ll need to open a cloud and show it in a separate view. Remember how we keep track of what the user has opened? That’s right: the navigation model.</p>
<pre class="code"><span style="color: blue">public class </span><span style="color: #2b91af">NavigationModel
</span>{
    ... </pre>
<pre class="code">    <span style="color: blue">private </span><span style="color: #2b91af"><strong>IndependentList</strong></span>&lt;<span style="color: #2b91af">Cloud</span>&gt; _openClouds = <span style="color: blue">new </span><span style="color: #2b91af">IndependentList</span>&lt;<span style="color: #2b91af">Cloud</span>&gt;();

    <span style="color: blue">public </span><span style="color: #2b91af">IEnumerable</span>&lt;<span style="color: #2b91af">Cloud</span>&gt; OpenClouds
    {
        <span style="color: blue">get </span>{ <span style="color: blue">return </span>_openClouds; }
    }

    <span style="color: blue">public void </span>OpenCloud(<span style="color: #2b91af">Cloud </span>cloud)
    {
        <span style="color: blue">if </span>(!_openClouds.Contains(cloud))
            _openClouds.Add(cloud);
    }
}</pre>
<p>We keep an IndependentList of opened clouds. This is kind of like an ObservableCollection, but it works with dependency tracking. Whenever a cloud is added or removed, all dependent properties that reference this list will be updated.</p>
<p>To add a cloud to the list, we need to know which one the user has selected. So we add that to the navigation model too.</p>
<pre class="code"><span style="color: blue">public class </span><span style="color: #2b91af">NavigationModel
</span>{
    ...

    <span style="color: blue">private </span><span style="color: #2b91af">Independent</span>&lt;<span style="color: #2b91af">Cloud</span>&gt; _selectedCloud = <span style="color: blue">new </span><span style="color: #2b91af">Independent</span>&lt;<span style="color: #2b91af">Cloud</span>&gt;();

    <span style="color: blue">public </span><span style="color: #2b91af">Cloud </span>SelectedCloud
    {
        <span style="color: blue">get </span>{ <span style="color: blue">return </span>_selectedCloud; }
        <span style="color: blue">set </span>{ _selectedCloud.Value = <span style="color: blue">value</span>; }
    }
}</pre>
<p>And then we need to data bind that to the SelectedItem of the list box. Since the list box shows CloudSummaryViewModels, the SelectedItem needs to be of that type as well.</p>
<pre class="code"><span style="color: blue">public class </span><span style="color: #2b91af">HomeViewModel
</span>{
    ...

    <span style="color: blue">public </span><span style="color: #2b91af">CloudSummaryViewModel </span>SelectedCloud
    {
        <span style="color: blue">get
        </span>{
            <span style="color: blue">return </span>_navigation.SelectedCloud == <span style="color: blue">null
                </span>? <span style="color: blue">null
                </span>: <span style="color: blue">new </span><span style="color: #2b91af">CloudSummaryViewModel</span>(_navigation.SelectedCloud);
        }
        <span style="color: blue">set
        </span>{
            _navigation.SelectedCloud = <span style="color: blue">value </span>== <span style="color: blue">null
                </span>? <span style="color: blue">null
                </span>: <span style="color: blue">value</span>.Cloud;
        }
    }
}</pre>
<p>Now we have all the pieces to create the OpenCloud command.</p>
<pre class="code"><span style="color: blue">public class </span><span style="color: #2b91af">HomeViewModel
</span>{
    ...

    <span style="color: blue">public </span><span style="color: #2b91af">ICommand </span>OpenCloud
    {
        <span style="color: blue">get
        </span>{
            <span style="color: blue">return </span><span style="color: #2b91af">MakeCommand
                </span>.When(() =&gt; _navigation.SelectedCloud != <span style="color: blue">null</span>)
                .Do(() =&gt; _navigation.OpenCloud(_navigation.SelectedCloud));
        }
    }
}</pre>
</p>
<p>Data bind the SelectedItem of the cloud list and an “Open Cloud” button in the home view. Now the user can select a cloud and open it. Nothing happens, yet, but it’s added to the navigation model.</p>
<h3>Tab through the open clouds</h3>
<p>Next we want a tab control that displays all of the open clouds. So we’ll need a view model for a tab. This will determine the tab header and content.</p>
<pre class="code"><span style="color: blue">public class </span><span style="color: #2b91af">CloudTabViewModel
</span>{
    <span style="color: blue">private readonly </span><span style="color: #2b91af">Cloud </span>_cloud;

    <span style="color: blue">public </span>CloudTabViewModel(<span style="color: #2b91af">Cloud </span>cloud)
    {
        _cloud = cloud;
    }

    <span style="color: blue">internal </span><span style="color: #2b91af">Cloud </span>Cloud
    {
        <span style="color: blue">get </span>{ <span style="color: blue">return </span>_cloud; }
    }

    <span style="color: blue">public string </span><strong>Header</strong>
    {
        <span style="color: blue">get
        </span>{
            <span style="color: #2b91af">Thought </span>centralThought = _cloud.CentralThought;
            <span style="color: blue">if </span>(centralThought == <span style="color: blue">null</span>)
                <span style="color: blue">return </span><span style="color: #a31515">&quot;&lt;New cloud&gt;&quot;</span>;
            <span style="color: blue">string </span>text = centralThought.Text;
            <span style="color: blue">if </span>(text == <span style="color: blue">null</span>)
                <span style="color: blue">return </span><span style="color: #a31515">&quot;&lt;New cloud&gt;&quot;</span>;
            <span style="color: blue">return </span>text;
        }
    }

    <span style="color: blue">public </span><span style="color: #2b91af">CloudViewModel </span><strong>Content</strong>
    {
        <span style="color: blue">get </span>{ <span style="color: blue">return new </span><span style="color: #2b91af">CloudViewModel</span>(_cloud); }
    }
}</pre>
<p>The content, of course, will be a CloudView. We’ll build that user control next time. For now, we add the open clouds to the MainViewModel.</p>
<pre class="code"><span style="color: blue">public class </span><span style="color: #2b91af">MainViewModel
</span>{
    ...

    <span style="color: blue">public </span><span style="color: #2b91af">IEnumerable</span>&lt;<span style="color: #2b91af">CloudTabViewModel</span>&gt; OpenClouds
    {
        <span style="color: blue">get
        </span>{
            <span style="color: blue">return
                from </span>cloud <span style="color: blue">in </span>_navigationModel.OpenClouds
                <span style="color: blue">select new </span><span style="color: #2b91af">CloudTabViewModel</span>(cloud);
        }
    }
}</pre>
<p>Add a tab control to the MainPage and bind ItemsSource to OpenClouds. This should work, but Silverlight throws an exception.</p>
<blockquote>
<p>Unable to cast object of type 'UpdateControls.XAML.Wrapper.ObjectInstance`1[FacetedWorlds.ThoughtCloud.ViewModel.CloudTabViewModel]' to type 'System.Windows.Controls.TabItem'.</p>
</blockquote>
<p>Amanda Wang provides the <a href="http://forums.silverlight.net/forums/t/44291.aspx">solution</a>. We’ve given the view a list of CloudTabViewModels (which Update Controls has wrapped for dependency tracking), but it expects a list of TabItems. We need to convert them.</p>
<p>I created a value converter based on Amanda’s proposed solution, but I made it specific to Update Controls. It data binds the Header and Content properties to the source object. It also expects an ObservableCollection, so that changes to the collection result in changes to tabs. See the source code for details.</p>
<p>Now when a user selects a cloud from the list and hits the open button, the cloud is added to the navigation model. The tabs depend upon the navigation model, so the new tab is opened.</p>
]]></content:encoded>
			<wfw:commentRss>http://adventuresinsoftware.com/blog/?feed=rss2&amp;p=674</wfw:commentRss>
		</item>
		<item>
		<title>Thought Cloud UI #3: Synchronization status</title>
		<link>http://adventuresinsoftware.com/blog/?p=673</link>
		<comments>http://adventuresinsoftware.com/blog/?p=673#comments</comments>
		<pubDate>Thu, 26 May 2011 12:47:00 +0000</pubDate>
		<dc:creator>Michael L Perry</dc:creator>
		
		<category><![CDATA[Correspondence]]></category>

		<guid isPermaLink="false">http://adventuresinsoftware.com/blog/?p=673</guid>
		<description><![CDATA[The Thought Cloud demo is on GitHub. Fork it and follow along.
We just got an application limping along. It hard-codes the user, and it displays a list of clouds. We can see that isolated storage is working for us, because we can close the application and our clouds don’t disappear. But how do we know [...]]]></description>
			<content:encoded><![CDATA[<p>The <a href="https://github.com/michaellperry/FacetedWorlds.ThoughtCloud">Thought Cloud</a> demo is on GitHub. Fork it and follow along.</p>
<p>We just got an application limping along. It hard-codes the user, and it displays a list of clouds. We can see that isolated storage is working for us, because we can close the application and our clouds don’t disappear. But how do we know if the communication strategy is working?</p>
<p>You can report the status of the communications directly to your user through data binding. Community has two properties designed for this:</p>
<ul>
<li>Synchronizing</li>
<li>LastException</li>
</ul>
<p>These two properties are Independent, so you can data bind them through any view model. Let’s add these to the MainViewModel.</p>
<pre class="code"><span style="color: blue">public bool </span>Synchronizing
{
    <span style="color: blue">get </span>{ <span style="color: blue">return </span>_community.Synchronizing; }
}

<span style="color: blue">public bool </span>HasError
{
    <span style="color: blue">get </span>{ <span style="color: blue">return </span>_community.LastException != <span style="color: blue">null</span>; }
}

<span style="color: blue">public string </span>LastError
{
    <span style="color: blue">get
    </span>{
        <span style="color: blue">return </span>_community.LastException == <span style="color: blue">null
            </span>? <span style="color: blue">null
            </span>: _community.LastException.Message;
    }
}</pre>
<p>Then we can data bind these properties to some controls. The busy indicator will be visible when Synchronizing is true. The error indicator will be visible when HasError is true. And the text of the error indicator will be the LastError string. To help us convert boolean to Visibility, let’s add a reference to Itzben. It contains a useful little VisibleWhenTrueConverter. Itzben is available on NuGet.</p>
<p><a href="http://adventuresinsoftware.com/pictures/Thought-Cloud-UI-3-Status-reporting_110DB/image.png"><img style="background-image: none; border-bottom: 0px; border-left: 0px; padding-left: 0px; padding-right: 0px; display: inline; border-top: 0px; border-right: 0px; padding-top: 0px" title="image" border="0" alt="image" src="http://adventuresinsoftware.com/pictures/Thought-Cloud-UI-3-Status-reporting_110DB/image_thumb.png" width="618" height="738" /></a></p>
<p>When we run the app, we see a problem. The error message says: “Domain &lt;&lt;Your API key&gt;&gt; not registered.” We have to use a real Correspondence API key. If you want to use my Correspondence server, please email or mention me for a key. I am letting people use the server free for a limited time.</p>
<pre class="code"><span style="color: blue">public class </span><span style="color: #2b91af">POXConfigurationProvider </span>: <span style="color: #2b91af">IPOXConfigurationProvider
</span>{
    <span style="color: blue">public </span><span style="color: #2b91af">POXConfiguration </span>Configuration
    {
        <span style="color: blue">get
        </span>{
            <span style="color: blue">string </span>address = <span style="color: #a31515">&quot;https://api.facetedworlds.com:9443/correspondence_server_web/pox&quot;</span>;
            <span style="color: blue">string </span>apiKey = <span style="color: #a31515">&quot;<strong>B22E33EB0ABD46FE9161BF4FB8748A65</strong>&quot;</span>;
            <span style="color: blue">return new </span><span style="color: #2b91af">POXConfiguration</span>(address, <span style="color: #a31515">&quot;FacetedWorlds.ThoughtCloud&quot;</span>, apiKey);
        }
    }
}</pre>
<p>Once we put the real API key in place, the service works. It sends new clouds to the server. If you run the application on a different machine, it will pull those clouds back down from the server.</p>
]]></content:encoded>
			<wfw:commentRss>http://adventuresinsoftware.com/blog/?feed=rss2&amp;p=673</wfw:commentRss>
		</item>
		<item>
		<title>Thought Cloud UI #2: Summary view models</title>
		<link>http://adventuresinsoftware.com/blog/?p=672</link>
		<comments>http://adventuresinsoftware.com/blog/?p=672#comments</comments>
		<pubDate>Wed, 25 May 2011 13:14:00 +0000</pubDate>
		<dc:creator>Michael L Perry</dc:creator>
		
		<category><![CDATA[Correspondence]]></category>

		<guid isPermaLink="false">http://adventuresinsoftware.com/blog/?p=672</guid>
		<description><![CDATA[We’ve started building the Thought Cloud user interface. It won’t be long until we see something working.
 I like to build Silverlight user interfaces via composition. I construct each view as a separate UserControl. Then I compose them into a working application. Taking this approach, let’s create a Views folder in the application, and a [...]]]></description>
			<content:encoded><![CDATA[<p>We’ve started building the <a href="https://github.com/michaellperry/FacetedWorlds.ThoughtCloud">Thought Cloud</a> user interface. It won’t be long until we see something working.</p>
<p><a href="http://adventuresinsoftware.com/blog/wp-content/uploads/2011/05/image.png"><img style="border-right-width: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; margin-left: 0px; border-left-width: 0px; margin-right: 0px" title="image" border="0" alt="image" align="right" src="http://adventuresinsoftware.com/blog/wp-content/uploads/2011/05/image-thumb.png" width="288" height="266" /></a> I like to build Silverlight user interfaces via composition. I construct each view as a separate UserControl. Then I compose them into a working application. Taking this approach, let’s create a Views folder in the application, and a HomeView UserControl.</p>
<p>I use Visual Studio to cerate all of my user controls, since Blend messes up the namespaces. But once it’s created, I switch to Blend for everything else.</p>
<h3>Create sample data</h3>
<p>The HomeView will be data bound to the HomeViewModel. The first step is to create sample data from that class. This will give us all of the properties that we can data bind to, and it will let Blend automatically generate some very useful things.</p>
<p><a href="http://adventuresinsoftware.com/blog/wp-content/uploads/2011/05/image1.png"><img style="border-bottom: 0px; border-left: 0px; display: inline; border-top: 0px; border-right: 0px" title="image" border="0" alt="image" src="http://adventuresinsoftware.com/blog/wp-content/uploads/2011/05/image-thumb1.png" width="280" height="134" /></a> </p>
<p><a href="http://adventuresinsoftware.com/blog/wp-content/uploads/2011/05/image2.png"><img style="border-bottom: 0px; border-left: 0px; display: inline; border-top: 0px; border-right: 0px" title="image" border="0" alt="image" src="http://adventuresinsoftware.com/blog/wp-content/uploads/2011/05/image-thumb2.png" width="324" height="484" /></a> </p>
<p>The home view model simply has a list of clouds and a command to add a new cloud. Each cloud in the list has a list of thoughts and a command to add a new thought. There’s a problem with that. On <em>this</em> view, we intend to show a summary of each cloud. The <em>next</em> view will let you edit thoughts. Let’s change our cloud view models to cloud summary view models.</p>
<pre class="code"><span style="color: blue">public class </span><span style="color: #2b91af">CloudSummaryViewModel
</span>{
    <span style="color: blue">private </span><span style="color: #2b91af">Cloud </span>_cloud;

    <span style="color: blue">public </span>CloudSummaryViewModel(<span style="color: #2b91af">Cloud </span>cloud)
    {
        _cloud = cloud;
    }

    <span style="color: blue"><strong>internal</strong> </span><span style="color: #2b91af">Cloud </span>Cloud
    {
        <span style="color: blue">get </span>{ <span style="color: blue">return </span>_cloud; }
    }

    <span style="color: blue">public string </span>Text
    {
        <span style="color: blue">get
        </span>{
            <span style="color: #2b91af">Thought </span>centralThought = _cloud.CentralThought;
            <span style="color: blue">if </span>(centralThought == <span style="color: blue">null</span>)
                <span style="color: blue">return </span><span style="color: #a31515">&quot;&lt;New cloud&gt;&quot;</span>;
            <span style="color: blue">string </span>text = centralThought.Text;
            <span style="color: blue">if </span>(text == <span style="color: blue">null</span>)
                <span style="color: blue">return </span><span style="color: #a31515">&quot;&lt;New cloud&gt;&quot;</span>;
            <span style="color: blue">return </span>text;
        }
    }

    <span style="color: blue">public override bool </span><strong>Equals</strong>(<span style="color: blue">object </span>obj)
    {
        <span style="color: blue">if </span>(obj == <span style="color: blue">this</span>)
            <span style="color: blue">return true</span>;
        <span style="color: #2b91af">CloudSummaryViewModel </span>that = obj <span style="color: blue">as </span><span style="color: #2b91af">CloudSummaryViewModel</span>;
        <span style="color: blue">if </span>(that == <span style="color: blue">null</span>)
            <span style="color: blue">return false</span>;
        <span style="color: blue">return </span>_cloud == that._cloud;
    }

    <span style="color: blue">public override int </span><strong>GetHashCode</strong>()
    {
        <span style="color: blue">return </span>_cloud.GetHashCode();
    }
}</pre>
<p>The cloud summary view model displays the text of the central thought. If it has no central thought, or if the text is not yet initialized, then it displays “&lt;New cloud&gt;”. This is different than the “My thought” behavior that we implemented in the cloud view model. When the user is looking at a list of clouds, they might get confused if one of them claims to be a thought.</p>
<p>The cloud summary view model also returns the wrapped Cloud object, and implements Equals and GetHashCode. This pattern always arises for a view model that appears in a selectable list. The Cloud property let’s us correlate user selection with the model (it is internal so that we don’t accidentally data bind to it). And the Equals and GetHashCode methods make sure that the user selection is equal to a member of the list, even if a new view model is created.</p>
<h3>Regenerate sample data</h3>
<p>Since we changed the view model after generating the sample data, Blend warns us that it is incorrect.</p>
<p><a href="http://adventuresinsoftware.com/blog/wp-content/uploads/2011/05/image3.png"><img style="border-bottom: 0px; border-left: 0px; display: inline; border-top: 0px; border-right: 0px" title="image" border="0" alt="image" src="http://adventuresinsoftware.com/blog/wp-content/uploads/2011/05/image-thumb3.png" width="282" height="150" /></a> </p>
<p><a href="http://adventuresinsoftware.com/blog/wp-content/uploads/2011/05/image4.png"><img style="border-bottom: 0px; border-left: 0px; display: inline; margin-left: 0px; border-top: 0px; margin-right: 0px; border-right: 0px" title="image" border="0" alt="image" align="right" src="http://adventuresinsoftware.com/blog/wp-content/uploads/2011/05/image-thumb4.png" width="244" height="192" /></a>The easiest thing to do is delete it and recreate it. Then we can drag the Clouds property onto the art board. We end up with a list box filled with lorem ipsum text for several clouds.</p>
<p>What Blend has done is to create an item template that brings in the item properties. In this case, the list contains CloudSummaryViewModels, which has only the Text property. (Remember that we made the Cloud property internal so Blend would ignore it.) To see the generated item template, right-click the list, choose “Edit Additional Templates”, “Edit Generated Items (ItemTemplate)”, “Edit Current”.</p>
<p><a href="http://adventuresinsoftware.com/blog/wp-content/uploads/2011/05/image5.png"><img style="border-bottom: 0px; border-left: 0px; display: inline; border-top: 0px; border-right: 0px" title="image" border="0" alt="image" src="http://adventuresinsoftware.com/blog/wp-content/uploads/2011/05/image-thumb5.png" width="650" height="105" /></a> </p>
<p>This will dive into the list box and show you an item template with just one TextBlock. It is bound to the Text property.</p>
<h3>Compose the application</h3>
<p>To see the application running, we need to do a couple more things. First, drop a button on the HomeView and drag the AddCloud command onto it. This data binds the button to the command. Then open the MainPage and add a HomeView to the page. You can get to the HomeView by clicking the “Assets” toolbar button and selecting “Project”.</p>
<p><a href="http://adventuresinsoftware.com/blog/wp-content/uploads/2011/05/image6.png"><img style="border-bottom: 0px; border-left: 0px; display: inline; border-top: 0px; border-right: 0px" title="image" border="0" alt="image" src="http://adventuresinsoftware.com/blog/wp-content/uploads/2011/05/image-thumb6.png" width="468" height="138" /></a> </p>
</p>
</p>
<p>Now we need to give the view a view model. Recall from the last post that MainPage uses a view model locator to find a MainViewModel. So we can just expose a HomeViewModel from MainViewModel.</p>
<pre class="code"><span style="color: blue">public </span><span style="color: #2b91af">HomeViewModel </span>Home
{
    <span style="color: blue">get
    </span>{
        <span style="color: blue">return </span>_navigationModel.CurrentUser == <span style="color: blue">null
            </span>? <span style="color: blue">null
            </span>: <span style="color: blue">new </span><span style="color: #2b91af">HomeViewModel</span>(_navigationModel.CurrentUser);
    }
}</pre>
<p>This property will give us a home view model if the user is logged in. If not, it will return null. When the user logs in or out, CurrentUser changes (remember that it is Independent), so the view model will fire PropertyChanged. We haven’t implemented the log in logic, so let’s just fake it for now.</p>
<pre class="code"><span style="color: blue">public class </span><span style="color: #2b91af">SynchronizationService
</span>{
    ...

    <span style="color: blue">public void </span>Initialize()
    {
        ...

        _navigationModel.CurrentUser = _community.AddFact(<span style="color: blue">new </span><span style="color: #2b91af">Identity</span>(<span style="color: #a31515">&quot;mike&quot;</span>));
    }
}</pre>
<p>All that remains is to data bind the DataContext of the HomeView inside of the MainPage to the Home property. Generate sample data for MainViewModel, and drag the Home property onto the HomeView. We now have an app that will add “&lt;New Cloud&gt;” to a list box whenever you hit the “New Cloud” button.</p>
]]></content:encoded>
			<wfw:commentRss>http://adventuresinsoftware.com/blog/?feed=rss2&amp;p=672</wfw:commentRss>
		</item>
		<item>
		<title>Thought Cloud UI #1: Structure of the UI project</title>
		<link>http://adventuresinsoftware.com/blog/?p=657</link>
		<comments>http://adventuresinsoftware.com/blog/?p=657#comments</comments>
		<pubDate>Tue, 24 May 2011 23:12:00 +0000</pubDate>
		<dc:creator>Michael L Perry</dc:creator>
		
		<category><![CDATA[Correspondence]]></category>

		<guid isPermaLink="false">http://adventuresinsoftware.com/blog/?p=657</guid>
		<description><![CDATA[The TDD phase of Thought Cloud is done (for now). Now we begin building the user interface.
When I set up the project structure, I added the NuGet package “Correspondence.Silverlight.App” to a Silverlight application. In addition to adding a reference to the Correspondence and Update Controls assemblies, this added a few features to the app:

View Model [...]]]></description>
			<content:encoded><![CDATA[<p>The TDD phase of <a href="https://github.com/michaellperry/FacetedWorlds.ThoughtCloud">Thought Cloud</a> is done (for now). Now we begin building the user interface.</p>
<p>When I set up the project structure, I added the NuGet package “Correspondence.Silverlight.App” to a Silverlight application. In addition to adding a reference to the Correspondence and Update Controls assemblies, this added a few features to the app:</p>
<ul>
<li>View Model Locator </li>
<li>Synchronization Service </li>
<li>Navigation Model </li>
</ul>
<h3>View Model Locator</h3>
<p>I am not a big fan of the View Model Locator pattern. I believe that it is backwards. A view should not locate its view model: a view model should be injected into a view. Nevertheless, Silverlight’s architecture makes it easier to work with the VML than against it. So I’ll fight that battle another day.</p>
<p>The ViewModelLocator class created by the NuGet package exposes a MainViewModel. It wraps the view model for the view using Update Controls’ ForView.Wrap() method. This sets up all of the property changed notification through automatic dependency tracking.</p>
<pre class="code"><span style="color: blue">public class </span><span style="color: #2b91af">ViewModelLocator
</span>{
    <span style="color: blue">private readonly </span><span style="color: #2b91af">SynchronizationService </span>_synchronizationService;

    <span style="color: blue">private readonly </span><span style="color: #2b91af">MainViewModel </span>_main;

    <span style="color: blue">public </span>ViewModelLocator()
    {
        <span style="color: #2b91af">NavigationModel </span>navigationModel = <span style="color: blue">new </span><span style="color: #2b91af">NavigationModel</span>();
        _synchronizationService = <span style="color: blue">new </span><span style="color: #2b91af">SynchronizationService</span>(navigationModel);
        <span style="color: blue">if </span>(!<span style="color: #2b91af">DesignerProperties</span>.IsInDesignTool)
            _synchronizationService.Initialize();
        _main = <span style="color: blue">new </span><span style="color: #2b91af">MainViewModel</span>(_synchronizationService.Community, navigationModel, _synchronizationService);
    }

    <span style="color: blue">public object </span>Main
    {
        <span style="color: blue">get </span>{ <span style="color: blue">return </span><strong><span style="color: #2b91af">ForView</span>.Wrap</strong>(_main); }
    }
}</pre>
<p>To use the view model locator, we follow the instructions in Readme.txt. We need to add it to application resources, and reference it from the main page.</p>
<p>In addition, the view model locator creates the synchronization service and navigation model, and passes those into the main view model.</p>
<h3>Synchronization Service</h3>
<p>The SynchronizationService class is responsible for synchronizing the local data storage with the remote service. As part of that responsibility, it sets up the Community. It uses the IsolatedStorageStorageStrategy to persist facts locally, and the POXAsynchronousCommunicationStrategy to exchange those facts with the server.</p>
<pre class="code"><span style="color: blue">public class </span><span style="color: #2b91af">SynchronizationService
</span>{
    ...

    <span style="color: blue">public void </span>Initialize()
    {
        <span style="color: #2b91af">POXConfigurationProvider </span>configurationProvider = <span style="color: blue">new </span><span style="color: #2b91af">POXConfigurationProvider</span>();
        _community = <span style="color: blue">new </span><span style="color: #2b91af">Community</span>(<span style="color: #2b91af">IsolatedStorageStorageStrategy</span>.Load())
            .AddAsynchronousCommunicationStrategy(<span style="color: blue">new </span><span style="color: #2b91af">POXAsynchronousCommunicationStrategy</span>(configurationProvider))
            .Register&lt;<span style="color: #2b91af">CorrespondenceModel</span>&gt;()
            <strong>.Subscribe(() =&gt; _navigationModel.CurrentUser)
</strong>            <strong>.Subscribe(() =&gt; _navigationModel.CurrentUser.SharedClouds)
</strong>            <strong>.Subscribe(() =&gt; _navigationModel.CurrentUser.Clouds)
</strong>            ;

        <span style="color: green">// Synchronize whenever the user has something to send.
        </span>_community.FactAdded += <span style="color: blue">delegate
        </span>{
            Synchronize();
        };

        <span style="color: green">// And synchronize on startup.
        </span>Synchronize();
    }

    ...
}</pre>
<p>During testing, we found which subscriptions need to be set up. We add those subscriptions here. The synchronization service subscribes to the current user as provided by the navigation model.</p>
<h3>Navigation Model</h3>
<p>The NavigationModel class is responsible for maintaining the user temporary state. This state represents the user’s point-of-view as they navigate through the system. Typical things that you will find in a <a href="http://updatecontrols.net/doc/tips/navigationmodel">navigation model</a> are:</p>
<ul>
<li>Selected items </li>
<li>Search terms </li>
<li>Open windows </li>
<li>User session </li>
</ul>
<p>These things are all important to the user, but not actually part of the model. They are transient, and don’t get persisted to storage or shared with other users.</p>
<pre class="code"><span style="color: blue">public class </span><span style="color: #2b91af">NavigationModel
</span>{
    <span style="color: blue">private </span><span style="color: #2b91af"><strong>Independent</strong></span>&lt;<span style="color: #2b91af">Identity</span>&gt; _currentUser = <span style="color: blue">new </span><span style="color: #2b91af">Independent</span>&lt;<span style="color: #2b91af">Identity</span>&gt;();

    <span style="color: blue">public </span><span style="color: #2b91af">Identity </span>CurrentUser
    {
        <span style="color: blue">get </span>{ <span style="color: blue">return </span>_currentUser; }
        <span style="color: blue">set </span>{ _currentUser.Value = <span style="color: blue">value</span>; }
    }
}</pre>
<p>Fields of a navigation model are independent, meaning that the user can change them directly. We have to mark them using the Update Controls Independent modifier. Dependent behaviors, like view model properties and subscriptions, will respond to changes in independent fields. So when a user logs on and CurrentUser is set, not only will the view model update (and fire the appropriate PropertyChanged events), but the Community subscriptions will refresh as well.</p>
<p>With these three components generated for us, we can start assembling the user interface of the application.</p>
]]></content:encoded>
			<wfw:commentRss>http://adventuresinsoftware.com/blog/?feed=rss2&amp;p=657</wfw:commentRss>
		</item>
	</channel>
</rss>
