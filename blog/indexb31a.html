<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr">


<!-- Mirrored from adventuresinsoftware.com/blog/?cat=1 by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 13 Jan 2017 12:52:33 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- /Added by HTTrack -->
<head profile="http://gmpg.org/xfn/11">
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />

<title>Adventures in Software   &raquo; Uncategorized</title>

<meta name="generator" content="WordPress 2.3.3" /> <!-- leave this for stats -->

<link rel="stylesheet" href="wp-content/themes/ais2/style.css" type="text/css" media="screen" />
<link rel="alternate" type="application/rss+xml" title="Adventures in Software RSS Feed" href="indexd784.html?feed=rss2" />
<link rel="pingback" href="xmlrpc.html" />
    <script type="text/javascript">
        function onSilverlightError(sender, args) {
            var appSource = "";
            if (sender != null && sender != 0) {
              appSource = sender.getHost().Source;
            }
            
            var errorType = args.ErrorType;
            var iErrorCode = args.ErrorCode;

            if (errorType == "ImageError" || errorType == "MediaError") {
              return;
            }

            var errMsg = "Unhandled Error in Silverlight Application " +  appSource + "\n" ;

            errMsg += "Code: "+ iErrorCode + "    \n";
            errMsg += "Category: " + errorType + "       \n";
            errMsg += "Message: " + args.ErrorMessage + "     \n";

            if (errorType == "ParserError") {
                errMsg += "File: " + args.xamlFile + "     \n";
                errMsg += "Line: " + args.lineNumber + "     \n";
                errMsg += "Position: " + args.charPosition + "     \n";
            }
            else if (errorType == "RuntimeError") {           
                if (args.lineNumber != 0) {
                    errMsg += "Line: " + args.lineNumber + "     \n";
                    errMsg += "Position: " +  args.charPosition + "     \n";
                }
                errMsg += "MethodName: " + args.methodName + "     \n";
            }

            throw new Error(errMsg);
        }
    </script>

	<link rel="EditURI" type="application/rsd+xml" title="RSD" href="xmlrpc0db0.php?rsd" />
 <link rel="wlwmanifest" type="application/wlwmanifest+xml" href="wp-includes/wlwmanifest.xml" /> <style type='text/css'>
<!--#header { background: url('wp-content/themes/ais2/images/header-imgae03.html?upper=A7A73F&amp;lower=77773F') no-repeat bottom center; }
--></style>
</head>
<body>
<div id="page">

<div class="aisTopBar">
	<form method="get" id="searchform" action="http://adventuresinsoftware.com/blog/">
<div>
<a href="indexd784.html?feed=rss2"><img src="../images/feed-icon-28x28.png" border="0"></a>
<input type="text" value="" name="s" id="s" />
<input type="submit" id="searchsubmit" value="Search" />
</div>
</form>
</div>

<div class="aisHeaderImageRight">
	<div class="aisHeaderImage">
	<div class="aisHeaderCornerRight">
	<div class="aisHeaderCornerLeft">
	<div class="aisImageBar">
	<div class="aisSubSites">
		<a href="index.html" class="aisSubSiteLink"><span class="aisSiteTabRight"><span class="aisSiteTabLeft"><span class="aisSiteTab">
			home</span></span></span></a>
		<a class="aisSubSiteLink" href="indexb60a.html?cat=27"><span class="aisSiteTabRight"><span class="aisSiteTabLeft"><span class="aisSiteTab">
			historic modeling</span></span></span></a>
		<a class="aisSubSiteLink" href="indexa88f.html?cat=36"><span class="aisSiteTabRight"><span class="aisSiteTabLeft"><span class="aisSiteTab">
			update controls</span></span></span></a>
		<a href="index2d79.html?cat=26" class="aisSubSiteLink"><span class="aisSiteTabRight"><span class="aisSiteTabLeft"><span class="aisSiteTab">
			degrees of freedom</span></span></span></a>
		<a class="aisSubSiteLink" href="indexba53.html?page_id=2"><span class="aisSiteTabRight"><span class="aisSiteTabLeft"><span class="aisSiteTab">
			about us</span></span></span></a>

	</div>
	</div>
	</div>
	</div>
	</div>
</div>

<table style="width: 100%" cellspacing="0" cellpadding="0">
	<tr valign="top">
		<td width="210px">
<div id="sidebar">
<div class="aisLeftColumnFill">
<div class="aisLeftColumnBottom">
<div class="aisLeftColumnTop">
<div id="twitter_div" class="aisLeftNav">
<h2 class="sidebar-title">Twitter Updates</h2>
<ul id="twitter_update_list"></ul>
<a href="http://twitter.com/michaellperry" id="follow">Follow me</a>
</div>
<div id="twitter_reply_div" class="aisLeftNav">
<h2 class="sidebar-title">Twitter Replies</h2>
<ul id="twitter_reply_list"></ul>
</div>

<div class="aisLeftNav">
<a href='http://ineta.org/Speakers/SearchCommunitySpeakers.aspx?SpeakerId=c5110e21-9243-461b-a464-a6548524e885'><img alt='INETA Community Speakers Program' border='0' src='../../www.ineta.org/images/OfficialLogos/InetaCommunitySpeakersRequestMe.html' /></a>
</div>

<div class="aisLeftNav">
	<li class="pagenav"><h2>Pages</h2><ul><li class="page_item page-item-2"><a href="indexba53.html?page_id=2" title="About Us">About Us</a></li>
<li class="page_item page-item-210"><a href="index6ae3.html?page_id=210" title="Templates">Templates</a></li>
</ul></li></div>

<div class="aisLeftNav">
<h2>Archives</h2>
<ul>
	<li><a href='indexb4d5.html?m=201110' title='October 2011'>October 2011</a></li>
	<li><a href='indexc61a.html?m=201106' title='June 2011'>June 2011</a></li>
	<li><a href='indexa80d.html?m=201105' title='May 2011'>May 2011</a></li>
	<li><a href='index512b.html?m=201104' title='April 2011'>April 2011</a></li>
	<li><a href='index08fb.html?m=201103' title='March 2011'>March 2011</a></li>
	<li><a href='index52f4.html?m=201102' title='February 2011'>February 2011</a></li>
	<li><a href='index74f1.html?m=201101' title='January 2011'>January 2011</a></li>
	<li><a href='index8956.html?m=201012' title='December 2010'>December 2010</a></li>
	<li><a href='indexa1aa.html?m=201011' title='November 2010'>November 2010</a></li>
	<li><a href='indexe3d5.html?m=201010' title='October 2010'>October 2010</a></li>
	<li><a href='index9ab9.html?m=201009' title='September 2010'>September 2010</a></li>
	<li><a href='index1ff0.html?m=201008' title='August 2010'>August 2010</a></li>
	<li><a href='index9f11.html?m=201007' title='July 2010'>July 2010</a></li>
	<li><a href='index31f0.html?m=201006' title='June 2010'>June 2010</a></li>
	<li><a href='indexd189.html?m=201005' title='May 2010'>May 2010</a></li>
	<li><a href='indexb5c0.html?m=201004' title='April 2010'>April 2010</a></li>
	<li><a href='indexf258.html?m=201003' title='March 2010'>March 2010</a></li>
	<li><a href='index6e30.html?m=201002' title='February 2010'>February 2010</a></li>
	<li><a href='index6b19.html?m=201001' title='January 2010'>January 2010</a></li>
	<li><a href='index5c0a.html?m=200912' title='December 2009'>December 2009</a></li>
	<li><a href='index8f62.html?m=200911' title='November 2009'>November 2009</a></li>
	<li><a href='index451d.html?m=200910' title='October 2009'>October 2009</a></li>
	<li><a href='index3e04.html?m=200909' title='September 2009'>September 2009</a></li>
	<li><a href='index425a.html?m=200908' title='August 2009'>August 2009</a></li>
	<li><a href='index9907.html?m=200907' title='July 2009'>July 2009</a></li>
	<li><a href='index3104.html?m=200906' title='June 2009'>June 2009</a></li>
	<li><a href='indexc36d.html?m=200905' title='May 2009'>May 2009</a></li>
	<li><a href='index17e8.html?m=200904' title='April 2009'>April 2009</a></li>
	<li><a href='index10a5.html?m=200903' title='March 2009'>March 2009</a></li>
	<li><a href='index8988.html?m=200902' title='February 2009'>February 2009</a></li>
	<li><a href='index1419.html?m=200901' title='January 2009'>January 2009</a></li>
	<li><a href='index7866.html?m=200812' title='December 2008'>December 2008</a></li>
	<li><a href='index55f6.html?m=200811' title='November 2008'>November 2008</a></li>
	<li><a href='indexa7bc.html?m=200810' title='October 2008'>October 2008</a></li>
	<li><a href='indexe77c.html?m=200809' title='September 2008'>September 2008</a></li>
	<li><a href='indexcffc.html?m=200808' title='August 2008'>August 2008</a></li>
	<li><a href='index0e62.html?m=200807' title='July 2008'>July 2008</a></li>
	<li><a href='indexfda7.html?m=200806' title='June 2008'>June 2008</a></li>
	<li><a href='index7d64.html?m=200805' title='May 2008'>May 2008</a></li>
	<li><a href='index94dd.html?m=200804' title='April 2008'>April 2008</a></li>
	<li><a href='index9631.html?m=200803' title='March 2008'>March 2008</a></li>
	<li><a href='indexdd52.html?m=200802' title='February 2008'>February 2008</a></li>
	<li><a href='index21ee.html?m=200801' title='January 2008'>January 2008</a></li>
	<li><a href='index363c.html?m=200712' title='December 2007'>December 2007</a></li>
	<li><a href='index7493.html?m=200711' title='November 2007'>November 2007</a></li>
	<li><a href='index93a7.html?m=200710' title='October 2007'>October 2007</a></li>
	<li><a href='index4ca8.html?m=200709' title='September 2007'>September 2007</a></li>
	<li><a href='index6124.html?m=200708' title='August 2007'>August 2007</a></li>
	<li><a href='index6013.html?m=200707' title='July 2007'>July 2007</a></li>
	<li><a href='index2ab6.html?m=200706' title='June 2007'>June 2007</a></li>
	<li><a href='index44f0.html?m=200705' title='May 2007'>May 2007</a></li>
	<li><a href='indexf0b4.html?m=200704' title='April 2007'>April 2007</a></li>
	<li><a href='index481d.html?m=200703' title='March 2007'>March 2007</a></li>
	<li><a href='indexcbea.html?m=200702' title='February 2007'>February 2007</a></li>
	<li><a href='index9cdc.html?m=200701' title='January 2007'>January 2007</a></li>
	<li><a href='index3ea4.html?m=200612' title='December 2006'>December 2006</a></li>
	<li><a href='index67ca.html?m=200611' title='November 2006'>November 2006</a></li>
	<li><a href='indexff49.html?m=200610' title='October 2006'>October 2006</a></li>
	<li><a href='index611c.html?m=200609' title='September 2006'>September 2006</a></li>
	<li><a href='index9a21.html?m=200608' title='August 2006'>August 2006</a></li>
	<li><a href='index3ee9.html?m=200607' title='July 2006'>July 2006</a></li>
	<li><a href='indexe13a.html?m=200606' title='June 2006'>June 2006</a></li>
</ul>
</div>

<div class="aisLeftNav">
	</div>

<div class="aisLeftNav">
<h2>Books</h2>
<iframe src="http://rcm.amazon.com/e/cm?t=adventures0d2-20&amp;o=1&amp;p=8&amp;l=as1&amp;asins=0764526413&amp;fc1=000000&amp;IS2=1&amp;lt1=_blank&amp;lc1=0000ff&amp;bc1=000000&amp;bg1=ffffff&amp;f=ifr" style="width:120px;height:240px;" scrolling="no" marginwidth="0" marginheight="0" frameborder="0" name="I5" id="I5"></iframe>
<br/>
<iframe src="http://rcm.amazon.com/e/cm?t=adventures0d2-20&amp;o=1&amp;p=8&amp;l=as1&amp;asins=0201633612&amp;fc1=000000&amp;IS2=1&amp;lt1=_blank&amp;lc1=0000ff&amp;bc1=000000&amp;bg1=ffffff&amp;f=ifr" style="width:120px;height:240px;" scrolling="no" marginwidth="0" marginheight="0" frameborder="0" name="I6" id="I6"></iframe>
<br/>
<iframe src="http://rcm.amazon.com/e/cm?t=adventures0d2-20&amp;o=1&amp;p=8&amp;l=as1&amp;asins=0136291554&amp;fc1=000000&amp;IS2=1&amp;lt1=_blank&amp;lc1=0000ff&amp;bc1=000000&amp;bg1=ffffff&amp;f=ifr" style="width:120px;height:240px;" scrolling="no" marginwidth="0" marginheight="0" frameborder="0" name="I7" id="I7"></iframe>
<br/>
<iframe src="http://rcm.amazon.com/e/cm?t=adventures0d2-20&amp;o=1&amp;p=8&amp;l=as1&amp;asins=1888009195&amp;fc1=000000&amp;IS2=1&amp;lt1=_blank&amp;lc1=0000ff&amp;bc1=000000&amp;bg1=ffffff&amp;f=ifr" style="width:120px;height:240px;" scrolling="no" marginwidth="0" marginheight="0" frameborder="0" name="I8" id="I8"></iframe>
</div>
<div class="aisLeftNav">
<h2>Meta</h2>
<ul>
		<li><a href="wp-login.html">Login</a></li>
	<li><a href="http://validator.w3.org/check/referer" title="This page validates as XHTML 1.0 Transitional">Valid <abbr title="eXtensible HyperText Markup Language">XHTML</abbr></a></li>
	<li><a href="http://gmpg.org/xfn/"><abbr title="XHTML Friends Network">XFN</abbr></a></li>
	<li><a href="http://wordpress.org/" title="Powered by WordPress, state-of-the-art semantic personal publishing platform.">WordPress</a></li>
	</ul>
</div>
<div class="aisLeftContent">
<h2>Community</h2>
<ul>
	<script type="text/javascript" src="../../localhost/embed/92q2bbma.js"></script>
</ul>
</div>

</div></div></div>
</div>		</td>
		<td>

	<div id="content" class="narrowcolumn">

		
		 		<h2 class="pagetitle">Archive for the &#8216;Uncategorized&#8217; Category</h2>

 	  

		<div class="navigation">
			<div class="alignleft"><a href="index2155.html?cat=1&amp;paged=2">&laquo; Previous Entries</a></div>
			<div class="alignright"></div>
		</div>

				<div class="post">
				<h3 id="post-682"><a href="index31fc.html?p=682" rel="bookmark" title="Permanent Link to The adventure continues">The adventure continues</a></h3>
				<small>Wednesday, October 26th, 2011</small>

				<div class="entry">
					<p>Please follow me over to <a href="http://qedcode.com/">qedcode.com</a>.</p>
				</div>

				<p class="postmetadata">Posted in <a href="indexb31a.html?cat=1" title="View all posts in Uncategorized" rel="category">Uncategorized</a> |   <a href="index31fc.html?p=682#respond" title="Comment on The adventure continues">No Comments &#187;</a></p>

			</div>

				<div class="post">
				<h3 id="post-681"><a href="index1565.html?p=681" rel="bookmark" title="Permanent Link to Remembering Steve">Remembering Steve</a></h3>
				<small>Thursday, October 6th, 2011</small>

				<div class="entry">
					<p>My adventure, like so many others of my generation, started on a plastic box built by two guys named Steve in a garage in Los Altos, California.</p>
<p>My sister came home from the first day of high school and told us about these amazing machines that she was working with. You could give these things simple instructions, and they would follow them. Put enough of these instructions together, and it does whatever you want. The next time I went to the mall department store, I saw one of these computers. I played with it until I had a square bouncing around the screen. It went something like this:</p>
<pre class="csharpcode">10 x = 0
20 y = 0
30 dx = 1
40 dy = 1
50 putchar(<span class="str">&quot; &quot;</span>, x, y)
60 x = x + dx
70 y = y + dy
80 putchar(<span class="str">&quot;*&quot;</span>, x, y)
90 <span class="kwrd">if</span> x &lt;= 0 <span class="kwrd">or</span> x &gt;= 39 <span class="kwrd">then</span> dx = -dx
100 <span class="kwrd">if</span> y &lt;= 0 <span class="kwrd">or</span> y &gt;= 39 <span class="kwrd">then</span> dy = -dy
110 <span class="kwrd">goto</span> 50</pre>
<p>
<style type="text/css">
.csharpcode, .csharpcode pre
{
	font-size: small;
	color: black;
	font-family: consolas, "Courier New", courier, monospace;
	background-color: #ffffff;
	/*white-space: pre;*/
}
.csharpcode pre { margin: 0em; }
.csharpcode .rem { color: #008000; }
.csharpcode .kwrd { color: #0000ff; }
.csharpcode .str { color: #006080; }
.csharpcode .op { color: #0000c0; }
.csharpcode .preproc { color: #cc6633; }
.csharpcode .asp { background-color: #ffff00; }
.csharpcode .html { color: #800000; }
.csharpcode .attr { color: #ff0000; }
.csharpcode .alt 
{
	background-color: #f4f4f4;
	width: 100%;
	margin: 0em;
}
.csharpcode .lnum { color: #606060; }</style>
<p>The syntax is wrong, but the spirit is right. I typed in variations of this program on several subsequent visits. I added gravity at some point, but I never saved the program. I always typed it in fresh from memory.</p>
<p><a href="wp-content/uploads/2011/10/image.png"><img style="background-image: none; border-bottom: 0px; border-left: 0px; padding-left: 0px; padding-right: 0px; display: inline; float: right; border-top: 0px; border-right: 0px; padding-top: 0px" title="image" border="0" alt="image" align="right" src="wp-content/uploads/2011/10/image-thumb.png" width="240" height="240" /></a>I started writing code on paper. This code wouldn’t run on any real machine, only the one in my head. My parents saw this and decided that it was time I got a chance to save my programs. They bought me an Apple II+ with a floppy drive.</p>
<p>I wrote more and more complex programs. I started looking at the machine code and comparing it to the assembly listing in the back of the Apple II users manual. I still remember the comments in that code with the author’s name: Steve Wozniak. I could see the actual loop that made the cursor blink.</p>
<p>Eventually, my Dad got me a subscription to Byte magazine. He also got me the Apple Macro Assembler and a second floppy drive. You had to put the assembler disk in one and write your program on the other.</p>
<p>After that first machine, I went on to an Apple IIe, various “IBM Clones”, and finally became a professional Windows programmer. I came back to Apple when I discovered that a MacBook Pro was the best available laptop for running Vista. I still use that 2007 MBP today (running Windows 7, and with a hard drive and memory upgrade) as my primary machine.</p>
<p>Steve Jobs and Steve Wozniak (and my Dad, of course) fed my love for software and helped start this adventure. And now one of them is gone. Let us continue the adventure in his honor.</p>
				</div>

				<p class="postmetadata">Posted in <a href="indexb31a.html?cat=1" title="View all posts in Uncategorized" rel="category">Uncategorized</a> |   <a href="index1565.html?p=681#respond" title="Comment on Remembering Steve">No Comments &#187;</a></p>

			</div>

				<div class="post">
				<h3 id="post-631"><a href="indexa123.html?p=631" rel="bookmark" title="Permanent Link to User identity on Windows Phone 7">User identity on Windows Phone 7</a></h3>
				<small>Friday, March 11th, 2011</small>

				<div class="entry">
					<p>When you can challenge another person to a Faceted Reversi game, you provide their name. So Reversi needs a way of authenticating the user so it can send them the correct games. I didn’t want the user to have to enter a password to play my game, so I relied upon the <a href="index475a.html?p=569">anonymous Live ID</a> already available on the phone. I just have to associate your anonymous ID with your chosen screen name.</p>
<h3>Windows Live provides identity</h3>
<p>Once I’ve gotten the anonymous Live ID using the technique I previously blogged about, I create an Identity fact. An Identity is defined in the factual model as:</p>
<pre class="code">fact Identity {
    string anonymousId;

    Claim* claims {
        Claim c : c.identity = this
    }
}</pre>
<p>The anonymoudId string is the only field in an Identity. That means that it comprises the entire key of that fact. No matter how many times I construct an Identity with that anonymoudId, it will be the same instance. The Identity instance is created and added to the Community.</p>
<pre class="code">_community = <span style="color: blue">new </span>Community(storageStrategy)
    .AddAsynchronousCommunicationStrategy(<span style="color: blue">new </span>POXAsynchronousCommunicationStrategy(configurationProvider))
    .Register&lt;CorrespondenceModule&gt;()
    .Subscribe(() =&gt; _identity.Claims);

<span style="color: blue">string </span>anid = UserExtendedProperties.GetValue(<span style="color: #a31515">&quot;ANID&quot;</span>) <span style="color: blue">as string</span>;
<span style="color: blue">string </span>anonymousUserId = <span style="color: #2b91af">String</span>.IsNullOrEmpty(anid)
    ? <span style="color: #a31515">&quot;test:user12&quot;
    </span>: <span style="color: #a31515">&quot;liveid:&quot; </span>+ ParseAnonymousId(anid);
_identity = _community.AddFact(<span style="color: blue">new </span>Identity(anonymousUserId));</pre>
<p>The first time you run the app, it creates this Identity instance. Every subsequent run is simply loading it from isolated storage.</p>
<p>Notice that I’m subscribing to _identity.Claims before the _identity is even instantiated. The subscription is a lambda expression, so it will be executed later. So what are Claims?</p>
<h3>A user claims a name</h3>
<p>A Claim is the desire for a person to have a specific user name. It is defined in factual as:</p>
<pre class="code">fact Claim {
    publish Identity identity;
    User user;
    publish IdentityService identityService;

    ClaimResponse* responses {
        ClaimResponse r : r.claim = this
    }

    bool isPending {
        not exists ClaimResponse r : r.claim = this
    }
}</pre>
<p>The Claim refers to the Identity from the phone, and the User that is being claimed. A User is:</p>
<pre class="code">fact User {
    string userName;

    Claim* claims {
        Claim c : c.user = this
    }
}</pre>
<p>Just like Identity, User has only one field. This field is its key, so any User object that I create with userName = “michael” will be the same instance. This is what makes it possible to challenge another user: the User instance I create on my phone will be the same as the one that he creates on his phone.</p>
<h3>A service approves and denies claims</h3>
<p>So when the user selects a name, a Claim is created. This Claim is published to an IdentityService, which is defined as:</p>
<pre class="code">fact IdentityService {
    Claim* pendingClaims {
        Claim c : c.identityService = this
            where c.isPending
    }
}</pre>
<p>Notice that IdentityService has no fields. Since fields define identity in Correspondence, there is nothing to distinguish one IdentityService from another. Every time I create a new IdentityService, I get back the same instance. It is a singleton.</p>
<p>There is a subscriber on my server looking for Claims published to the IdentityService. When it finds a Claim, it verifies that the user name is not taken by another Identity. It will then generate a ClaimResponse:</p>
<pre class="code">fact ClaimResponse {
    publish Claim claim;
    int approved;
}</pre>
<p><a href="http://11011.net/software/vspaste"></a></p>
<p>This response is published to the Claim. Remember the lambda expression in the Community Subscribe method? The phone has subscribed to all Claims attached to the Identity. That means that the ClaimResponse will be pushed to the phone, and the user will know whether it was accepted or rejected.</p>
<p>This is an example of the <a href="http://historicalmodeling.com/book/patterns/service">Service</a> pattern in Historical Modeling. With this pattern, I can allow people to choose their own name, but still rely upon Windows Live to authenticate them for me.</p>
				</div>

				<p class="postmetadata">Posted in <a href="indexb31a.html?cat=1" title="View all posts in Uncategorized" rel="category">Uncategorized</a> |   <a href="indexa123.html?p=631#respond" title="Comment on User identity on Windows Phone 7">No Comments &#187;</a></p>

			</div>

				<div class="post">
				<h3 id="post-630"><a href="indexa1c1.html?p=630" rel="bookmark" title="Permanent Link to Flip pieces on the way out">Flip pieces on the way out</a></h3>
				<small>Wednesday, March 9th, 2011</small>

				<div class="entry">
					<p>I recently released Faceted Reversi, the first Windows Phone 7 application based on the Correspondence framework. Let me take a few posts to tell you how it works, and how you can build your own Correspondence application.</p>
<p>Faceted Reversi is, of course, a Reversi game. Reversi pieces have two sides: black and white. Each color represents one player. When a player moves, he places a piece with his color up. He then flips all of the enemy pieces that were flanked by that move.</p>
<p>When we describe the rules, we say that the player flips the pieces as he makes a move. This is in fact <strong>not</strong> how the code is written. On a players turn, all the program does is record the move. Pieces are flipped on the way out.</p>
<h3>GameBoard and GameState</h3>
<p>The game logic is controlled by two classes: GameBoard and GameState. A GameBoard is an immutable object that records a fixed board position. A GameBoard can tell you:</p>
<ul>
<li>which color is on each square </li>
<li>who’s move it is </li>
<li>how many pieces of each color are on the board </li>
<li>what moves are legal </li>
<li>what the board would look like after a legal move </li>
</ul>
<p>Or saying the same thing in code:</p>
<pre class="code"><span style="color: blue">public class </span><span style="color: #2b91af">GameBoard
</span>{
    <span style="color: blue">public static </span><font color="#2b91af">GameBoard</font> OpeningPosition { <span style="color: blue">get</span>; }
    <span style="color: blue">public int </span>MoveIndex { <span style="color: blue">get</span>; }
    <span style="color: blue">public </span><font color="#2b91af">PieceColor</font> PieceAt(Square square);
    <span style="color: blue">public </span><font color="#2b91af">PieceColor</font> ToMove { <span style="color: blue">get</span>; }
    <span style="color: blue">public int </span>BlackCount { <span style="color: blue">get</span>; }
    <span style="color: blue">public int </span>WhiteCount { <span style="color: blue">get</span>; }
    <span style="color: blue">public </span><span style="color: #2b91af">IEnumerable</span>&lt;Square&gt; LegalMoves { <span style="color: blue">get</span>; }
    <span style="color: blue">public </span><font color="#2b91af">GameBoard</font> AfterMove(Square square);
}</pre>
<p>GameState, on the other hand, is mutable. It records the current GameBoard and lets the user make a move.</p>
<p>The separation of immutable state from mutable state is significant. It makes it clear that the board position is dependent upon the sequence of moves. We represent that dependency using Update Controls. The current position is governed by a Dependent sentry that runs UpdateGameBoard when it becomes out-of-date.</p>
<pre class="code"><span style="color: blue">public class </span><span style="color: #2b91af">GameState
</span>{
    <span style="color: blue">private </span><font color="#2b91af">Game</font> _game;

    <span style="color: blue">private </span><font color="#2b91af">GameBoard</font> _gameBoard;
    <span style="color: blue">private </span><font color="#2b91af">Dependent</font> _depGameBoard;

    <span style="color: blue">public </span>GameState(<font color="#2b91af">Game</font> game)
    {
        _game = game;

        _depGameBoard = <span style="color: blue">new </span><font color="#2b91af">Dependent</font>(UpdateGameBoard);
    }

    <span style="color: blue">public </span><font color="#2b91af">PieceColor</font> PieceAt(<font color="#2b91af">Square</font> square)
    {
        <font color="#2b91af">GameBoard</font> gameBoard = GetGameBoard();
        <span style="color: blue">return </span>gameBoard.PieceAt(square);
    }

    <span style="color: blue">private </span><font color="#2b91af">GameBoard</font> GetGameBoard()
    {
        _depGameBoard.OnGet();
        <span style="color: blue">return </span>_gameBoard;
    }

    <span style="color: blue">private void </span>UpdateGameBoard()
    {
        _gameBoard = <font color="#2b91af">GameBoard</font>.OpeningPosition;
        <span style="color: blue">if </span>(_game != <span style="color: blue">null</span>)
        {
            <span style="color: #2b91af">List</span>&lt;<font color="#2b91af">Move</font>&gt; moves = _game.Moves.ToList();
            moves.Sort(<span style="color: blue">new </span><font color="#2b91af">LocalMoveComparer</font>());
            <span style="color: blue">int </span>expectedIndex = 0;
            <span style="color: blue">foreach </span>(<font color="#2b91af">Move</font> move <span style="color: blue">in </span>moves)
            {
                <span style="color: blue">if </span>(move.Index != expectedIndex)
                    <span style="color: blue">return</span>;
                <span style="color: blue">if </span>(move.Player.Index == 0 &amp;&amp; _gameBoard.ToMove != <font color="#2b91af">PieceColor</font>.Black)
                    <span style="color: blue">return</span>;
                <span style="color: blue">if </span>(move.Player.Index == 1 &amp;&amp; _gameBoard.ToMove != <font color="#2b91af">PieceColor</font>.White)
                    <span style="color: blue">return</span>;

                <font color="#2b91af">Square</font> square = <font color="#2b91af">Square</font>.FromIndex(move.Square);
                <span style="color: blue">if </span>(!_gameBoard.LegalMoves.Contains(square))
                    <span style="color: blue">return</span>;

                _gameBoard = _gameBoard.AfterMove(square);
                ++expectedIndex;
            }
        }
    }
}</pre>
<p>UpdateGameBoard runs through the list of moves in the game, sorted by move index. It validates each move against the current position. If an invalid or out-of-place move is found, it just gives up. The assumption is that moves were validated before they were added to the game, but we don’t want to crash the app or enter an invalid state if something goes wrong.</p>
<h3>Record a move</h3>
<p>So what happens when the player makes a move? Simple:</p>
<pre class="code"><span style="color: blue">public partial class </span><span style="color: #2b91af">Player
</span>{
    <span style="color: blue">public void </span>MakeMove(<span style="color: blue">int </span>index, <span style="color: blue">int </span>square)
    {
        Community.AddFact(<span style="color: blue">new </span>Move(<span style="color: blue">this</span>, index, square));
    }
}</pre>
<p>All we do is record that move. This adds it to the Moves collection in the game, stores it in the local database, sends it to the other player, and makes GameBoard out-of-date. Let’s break that down.</p>
<h3>Publish a move to other subscribers</h3>
<p>The Move fact is declared in a language called “factual”, specifically designed for Correspondence.</p>
<pre class="code">fact Move {
    Player player;
    int index;
    int square;
}</pre>
<p>Adding a fact to the Correspondence community stores it in the local database. It also sends the fact to the server, which forwards it to all interested subscribers. We can tell that the other player is interested because he subscribed to the Game.</p>
<pre class="code">_community = <span style="color: blue">new </span><font color="#2b91af">Community</font>(storageStrategy)
    .AddAsynchronousCommunicationStrategy(<span style="color: blue">new </span><font color="#2b91af">POXAsynchronousCommunicationStrategy</font>(configurationProvider))
    .Register&lt;<font color="#2b91af">CorrespondenceModule</font>&gt;()
    .Subscribe(() =&gt; _identity.ApprovedUsers
        .SelectMany(user =&gt; user.ActivePlayers)
        .Select(player =&gt; player.Game)
    );</pre>
<p>The linq query in the Subscribe call returns all of the Game facts that the player is currently involved in. When a player subscribes to a game, the server will send him all of the published facts. A Player fact is published to a game, as indicated by the “publish” keyword in the factual model.</p>
<pre class="code">fact Player {
    publish User user;
    publish Game game;
    int index;
}</pre>
<p>A Move fact belongs to a Player, so it is pushed as well. This is how Correspondence knows to send the move to the other player.</p>
<h3>Update the UI when a move arrives</h3>
<p>So when the move reaches the other player, how does the game know to refresh the board? The Game fact queries for related moves, again in the factual model.</p>
<pre class="code">fact Game {
    unique;

    Move* moves {
        Move m : m.player.game = this
    }
}</pre>
<p>This makes _game.Moves a live collection. Whenever a fact is added, whether on this phone or from another one, this collection changes. Update Controls recognizes that GameBoard depends upon this collection. So when it changes, GameBoard becomes out-of-date, and Update Controls notifies the view to redraw itself through data binding.</p>
<p>All Correspondence applications work this way. State changes cannot be side-effects of a user action. Instead, the program simply has to store the user action into the model. State changes occur on the way out, back toward the user interface. They are dependent upon the history of user actions.</p>
<p>It doesn’t matter if the move comes from the user interface, from the local database, or from another user. Flipping the pieces is not a side-effect of making a move. It is dependent upon the sequence of moves, regardless where they come from.</p>
				</div>

				<p class="postmetadata">Posted in <a href="indexb31a.html?cat=1" title="View all posts in Uncategorized" rel="category">Uncategorized</a> |   <a href="indexa1c1.html?p=630#respond" title="Comment on Flip pieces on the way out">No Comments &#187;</a></p>

			</div>

				<div class="post">
				<h3 id="post-629"><a href="indexe703.html?p=629" rel="bookmark" title="Permanent Link to How not to sell a two-player game on Windows Phone 7">How not to sell a two-player game on Windows Phone 7</a></h3>
				<small>Thursday, March 3rd, 2011</small>

				<div class="entry">
					<p>Last week I launched Faceted Reversi, a two-player strategy game for Windows Phone 7. In this game, you play Reversi against other people who have also downloaded the application. It uses <a href="http://correspondence.codeplex.com/">Correspondence</a> to coordinate moves between the two phones. So far the adoption has been … slow.</p>
<p><a href="wp-content/uploads/2011/03/image.png"><img style="border-bottom: 0px; border-left: 0px; display: inline; border-top: 0px; border-right: 0px" title="image" border="0" alt="image" src="wp-content/uploads/2011/03/image-thumb.png" width="644" height="368" /></a> </p>
<p>Faceted Reversi has two ways to play:</p>
<ul>
<li>pass the phone</li>
<li>remote</li>
</ul>
<p>In pass-the-phone, you play against another person, but the two of you sit together and share a device. It just acts like a game board. In remote mode, you play against somebody else with their own device. Think “Words with Friends”. To begin a remote game, you either pick someone that you know or let the server choose a random player.</p>
<p>Faceted Reversi is priced at $1.99, and has a trial mode. In trial mode, you can play as many pass-the-phone games as you like. But you can only play one remote game. To unlock the ability to play more games, you have to pay.</p>
<p>There are a couple of problems with this revenue model. First, trial apps don’t appear in the Free section of the Marketplace. And second, the network is a catch-22.</p>
<h3>Free vs Trial</h3>
<p>Neither iOS nor Android has trial mode built into their applications. You have to buy it before you can try it. As a result, many developers published two versions of their apps: the free one and the paid one. Windows Phone implemented the trial feature to solve this problem. A developer can publish one application, yet still give the end user both experiences.</p>
<p>But Windows Phone also has a Free section in the Marketplace. This section includes applications that have a $0.00 price tag. It does not include applications with a trial mode. Many developers have found that people download apps from the Free section much more frequently than they do from the paid sections. As a result, developers have been abandoning the trial model and publishing two versions of the app.</p>
<h3>Catch-22</h3>
<p>The only reason to pay for Faceted Reversi is to play games against the network of people who have also paid for Faceted Reversi. The value of the application is proportional to the size of this network. When nobody has bought the app, nobody is in the network. And when nobody is in the network, nobody will buy the app. The only way to get people to buy the app is to seed the network.</p>
<h3>Faceted Reversi Free</h3>
<p>To solve these two problems, I am working on Faceted Reversi Free. This will be a completely separate app. It will be priced at $0.00, so it will appear in the Free section of the Marketplace. This should drive higher download numbers. I don’t think that a full order of magnitude increase (i.e. 40) is unreasonable to expect.</p>
<p>This version of the game will have only one feature: random player. You will be able to play against another player, but you won’t be able to say who. This will have the effect of seeding the network with a sea of random players … at least 40 of them!</p>
<p>This version will also serve ads. Before each game, it will display an ad while it waits for the server to select a random player. This should provided some revenue to keep the Correspondence server running, and incentivize people to buy the paid version.</p>
<p>In upcoming posts, I’ll describe how to build a two-player game with Correspondence. I’ll also keep you posted regarding the uptake of Faceted Reversi Free and whether my clever scheme succeeds.</p>
				</div>

				<p class="postmetadata">Posted in <a href="indexb31a.html?cat=1" title="View all posts in Uncategorized" rel="category">Uncategorized</a> |   <a href="indexe703.html?p=629#comments" title="Comment on How not to sell a two-player game on Windows Phone 7">2 Comments &#187;</a></p>

			</div>

				<div class="post">
				<h3 id="post-626"><a href="indexe90e.html?p=626" rel="bookmark" title="Permanent Link to Itzben on NuGet">Itzben on NuGet</a></h3>
				<small>Tuesday, February 15th, 2011</small>

				<div class="entry">
					<p>Do you need a Silverlight or Windows Phone 7 TextBox to update on every key? Do you need to data bind a visual state or a set of radio buttons to an enumeration? How about making a control visible whenever a property is equal to a certain value?</p>
<p><a href="http://itzben.codeplex.com/">Itzben</a> is a collection of universally useful XAML behaviors, value converters, and styles. Open the Assets tab in Blend and drag them onto your art board.</p>
<p><a href="wp-content/uploads/2011/02/image4.png"><img style="border-right-width: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px" title="image" border="0" alt="image" src="wp-content/uploads/2011/02/image-thumb4.png" width="341" height="376" /></a> </p>
<p>There are four ways to enjoy Itzben.</p>
<h3>NuGet Powershell</h3>
<p>Just open the <a href="http://nuget.org/">NuGet</a> Package Manager Console and type:</p>
<pre>install-package itzben</pre>
<p>Or if you are in a Windows Phone 7 project:</p>
<pre>install-package itzbenwp7</pre>
<h3>NuGet Dialog</h3>
<p>Don’t do Powershell? Just Add Library Package Reference:</p>
<p><a href="wp-content/uploads/2011/02/image5.png"><img style="border-right-width: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px" title="image" border="0" alt="image" src="wp-content/uploads/2011/02/image-thumb5.png" width="644" height="431" /></a> </p>
<h3>Zip file</h3>
<p>Don’t want to install NuGet? Just download the zip file from <a href="http://itzben.codeplex.com/">Codeplex</a>. Find the Itzben.dll for your project type.</p>
<h3>Source code</h3>
<p>Don’t want to take a dependency on a third-party library? I’m with you. Every Itzben class is self-contained. Just go to the <a href="http://itzben.codeplex.com/SourceControl/BrowseLatest">Codeplex Source Code</a> page, pick the class you want, and copy it directly into your project.</p>
</p>
<h3>Contribute</h3>
<p>Please enjoy this collection. It was created as a way to stop writing the same code in every project. And if you have a behavior, value converter, or style that you find universally useful, please <a href="http://itzben.codeplex.com/WorkItem/Create">open an issue</a> and we’ll include your patch.</p>
				</div>

				<p class="postmetadata">Posted in <a href="indexb31a.html?cat=1" title="View all posts in Uncategorized" rel="category">Uncategorized</a> |   <a href="indexe90e.html?p=626#respond" title="Comment on Itzben on NuGet">No Comments &#187;</a></p>

			</div>

				<div class="post">
				<h3 id="post-612"><a href="index4494.html?p=612" rel="bookmark" title="Permanent Link to Turn software architecture on its ear">Turn software architecture on its ear</a></h3>
				<small>Monday, January 31st, 2011</small>

				<div class="entry">
					<p>Software architectures have evolved since the first computers were put to use. Early computer operators would hardly recognize the systems we build today. Architecture continues to evolve at a pace where we will not recognize the systems of tomorrow.</p>
<p><a href="wp-content/uploads/2011/01/image.png"><img style="border-bottom: 0px; border-left: 0px; display: inline; margin-left: 0px; border-top: 0px; margin-right: 0px; border-right: 0px" title="image" border="0" alt="image" align="right" src="wp-content/uploads/2011/01/image-thumb.png" width="104" height="100" /></a> A computer used to be a large, noisy machine enshrined within a windowless room. The only access to it was through punched cards, teletype printouts, and eventually dumb terminals. Computer programs were input/output routines that ran business logic over data.</p>
<p>Then the personal computer revolution hit and a computer became a briefcase-sized box sitting on your desk with a television on top. People could run their own logic on their own data without having to lease space on the mainframe. Rather than building custom programs for every need, people could buy applications. Thus the software industry was born.</p>
<p><a href="wp-content/uploads/2011/01/image1.png"><img style="border-bottom: 0px; border-left: 0px; display: inline; margin-left: 0px; border-top: 0px; margin-right: 0px; border-right: 0px" title="image" border="0" alt="image" align="left" src="wp-content/uploads/2011/01/image-thumb1.png" width="117" height="244" /></a> Unfortunately, applications didn’t make it easy to collaborate with other people. The data and the logic were both on your PC. And so people adopted the World Wide Web as a way of sharing data. With the advent of the web, applications again became centralized. The personal computer started to resemble the dumb terminal again, becoming only a host for a web browser.</p>
<p>Then rich web applications brought interactivity and power back to the personal computer. The browser gained the ability to run JavaScript, making the dumb terminal a little bit smarter. This trend continued with Flash, JQuery, and Silverlight.</p>
<p>Smart phones broke the user experience out of the browser and moved it into apps. Apps had some of the benefits of browser-based clients in that they were quicker to develop, and easier to deploy. But they also were like an application in that they were useful offline.</p>
</p>
<p><a href="wp-content/uploads/2011/01/image2.png"><img style="border-bottom: 0px; border-left: 0px; display: inline; margin-left: 0px; border-top: 0px; margin-right: 0px; border-right: 0px" title="image" border="0" alt="image" align="right" src="wp-content/uploads/2011/01/image-thumb2.png" width="117" height="368" /></a> This is our current state of software architecture. The data still resides in a large noisy machine in a windowless room, but we have installed layers of access in front of it. We can call an API – whether it be REST or Web Services – to invoke the business logic and access that data. We have a service agent on the client side – perhaps AJAX or RIA Services – to invoke that API. It brings back a model – JSON or XML converted into objects – that we can translate through a view model and display on a view.</p>
<p>Writing software today, it seems like we’ve always done it this way. But it was only 50 years ago that we started on this journey. Some of the people who made the earliest advances are still with us now.</p>
<h3>Where we are going</h3>
<p>Take a look at the work of people like <a href="http://www.udidahan.com/">Udi Dahan</a>, <a href="http://codebetter.com/gregyoung/">Greg Young</a>, and <a href="http://www.ayende.com/">Ayende Rahein</a> to see the next step in this architectural evolution. Look at where NoSQL projects like <a href="http://www.mongodb.org/">MongoDB</a> and <a href="http://couchdb.apache.org/docs/intro.html">CouchDB</a> are leading us. This architectural stack is about to be turned on its ear.</p>
<p>One of the big problems that we are about to solve is the synchronous nature of our current APIs. REST and Web Services are based on the idea of request/response. Synchronous protocols have scaling and reliability issues. Udi and Greg are proposing new ways of creating asynchronous services.</p>
<p>Another problem that we are working on is impedance mismatch. The database is relational. The logic is object-oriented. The API is document-oriented. And the view is a scene graph (HTML or XAML). At every layer, we have to map one format onto the next. NoSQL databases skip the relational and object-oriented layers and go straight to documents. Microsoft’s <a href="http://msdn.microsoft.com/en-us/library/ms752347.aspx">data binding</a>, John Resig’s <a href="http://jquery.org/">JQuery</a>, and Steve Sanderson’s <a href="http://knockoutjs.com/">Knockout</a> bridge the object/scene graph gap.</p>
<p>What will the architectural diagram look like in 5 years? I have a guess, but I can’t say for sure. The only thing certain is that it will look nothing like it does today.</p>
				</div>

				<p class="postmetadata">Posted in <a href="indexb31a.html?cat=1" title="View all posts in Uncategorized" rel="category">Uncategorized</a> |   <a href="index4494.html?p=612#respond" title="Comment on Turn software architecture on its ear">No Comments &#187;</a></p>

			</div>

				<div class="post">
				<h3 id="post-601"><a href="indexbdc9.html?p=601" rel="bookmark" title="Permanent Link to TDD Dojo">TDD Dojo</a></h3>
				<small>Thursday, January 6th, 2011</small>

				<div class="entry">
					<p>I’ve been conducting lunch classes at work to help us improve the confidence in our software. I call these sessions “Q.E.D.”, based on my foundation in mathematics and my practice of applying mathematical proof to software (see my other blog <a href="http://qedcode.com/">qedcode.com</a>).</p>
<p>In the past, these have been lectures, where I present mathematical concepts like <a href="http://qedcode.com/content/degrees-freedom">Degrees of freedom</a>, <a href="http://qedcode.com/closure">Closure</a>, or how to write <a href="http://qedcode.com/speaking/provable_apis">Provable APIs</a>. These sessions have earned me the nickname “Professor”, which I answer to proudly. But lately, I’ve been thinking it would be better for the team if I were a “Sensei” instead.</p>
<h3>The end of lectures</h3>
<p><a href="wp-content/uploads/2011/01/yoda.jpg"><img style="border-bottom: 0px; border-left: 0px; display: inline; margin-left: 0px; border-top: 0px; margin-right: 0px; border-right: 0px" title="Yoda" border="0" alt="Yoda" align="right" src="wp-content/uploads/2011/01/yoda-thumb.jpg" width="244" height="184" /></a> As the Professor, I would get up in front of the class and give a lecture. This would include not just PowerPoint, but also a good deal of coding in Visual Studio. I would get some good questions from the group, and I would also throw out questions of my own.</p>
<p>Then I would assign homework. Make this unit test pass, or refactor that API to make it more provable. People would do the homework individually and email me the results. At the beginning of the next class, I would choose the person who did the best homework and recognize them with the Yoda Award. They get to keep Yoda at their desk until next week’s class.</p>
<p>The main problem I saw with this kind of session was that not many people were putting the concepts into practice. Only two or three people would email me homework each week. It was a different set of people each time, so I wasn’t concerned about particular individuals. But work and other obligations got in the way, people didn’t seek help from me or each other, and the week just slipped by.</p>
<p>To solve this problem, I decided that we should do homework in class. When thinking about how practically to do that, I remembered the evenings I spent at a local meetup group called <a href="http://www.grahambrooks.com/blog/?p=280">Geek Night</a>, hosted at Thought Works and led by local Though Worker <a href="http://paulhammant.com/">Paul Hammant</a>. At Geek Night, we pair program on open source projects.</p>
<p>To get people practicing together, we need the pair programming bit more than the open source bit. So I decided to have them pair on very simple exercises at first. We are starting off with the <a href="http://butunclebob.com/ArticleS.UncleBob.TheBowlingGameKata">Bowling Game Kata</a>. But instead of solving the whole thing, I’ve broken it down. The original kata has you write test like “When I roll 20 gutters, my score is zero” and “When I roll 12 strikes, my score is 300.” That’s too big, in my opinion. The problem should be broken down into testable pieces that you can then assemble into a working solution.</p>
<p>The first piece that we are working on is a class called GameData. This class will record all of the rolls. It will eventually be used by the Frame class, which will observe rolls by index. This leads to a number of simpler test, like “there are initially no rolls” and “after one roll, you can retrieve the first roll by index.”</p>
<p>With that inspiration, I closed the classroom and opened a dojo. In a martial arts dojo, the sensei doesn’t stand at the front. He walks around and interacts with the students. The students work individually or in pairs on routine forms. The sensei will call out commands, and correct individual students on their form.</p>
<h3>The rules of the dojo</h3>
<p>I brought in a deck of cards. I leave two cards of the same value on each desk (for example the 3 of hearts and the 3 of spades). The other two (3 of clubs and 3 of diamonds), I put in a deck near the door. When you enter the room, you take a card. You sit at the table with that value. This creates up to 13 pairs. I have on average 12 people attend, so I only used Ace through 6. If we have extra people, then we create additional pairs. If we have empty chairs, we consolidate. And if we have an odd number of people, one pair becomes a triple.</p>
<p>Each person brings a laptop with Visual Studio 2010. They have all pulled the same solution from TFS and mapped it to their drive. When we are in the dojo, we cannot connect to the network. So we all open the solution and select “Go Offline”.</p>
<p>I give the group a requirement to test. For example, “Given a GameData class, the Rolls collection should initially be empty.” One person writes that test, which should initially not compile (the test uses a property that the code doesn’t have yet). The other makes it compile (by adding the GameData.Rolls property), sees it fail, and then makes it pass.</p>
<p>I walk around the room observing how each pair is doing. If they write working code without seeing the test fail, I ask them to delete the code and see the failure. If they are leaving sloppy tests behind, I ask them to refactor. If they are using the debugger, I ask them to make the test fail in such a way as to tell you why it failed. And if their test names don’t reveal their intention, I ask them to rename them.</p>
<p>When every pair has the test working, I call out the next test. “When I add a roll, I can get that roll by index 0.” The person who wrote the code last time writes the test this time. Then they pass it off to their partner to write the code.</p>
<p>In the first hour, we were able to get through 4 tests. This included learning the rules of the dojo, setting up the project (for those who didn’t come prepared), and leaving 10 minutes at the end.</p>
<p>During the last 10 minutes, I ask each pair to bring their laptop to the projector and show us their tests. We all ask questions about the tests and the code. The pair defends their naming, their refactoring, and their implementation. “The test”, I explain, “is the example that you give to the consumers of your API. It says, ‘I want you to use this class in this way.’ Is this the way you want people to see your API?”</p>
<p>Finally, each pair selects one <em>other</em> pair that has the best code. They cannot select themselves. The pair must vote as one. They write down that pair’s number (Ace through 6 in my case). Then we reveal the votes and decide the winner. The winners get to share Yoda for the week.</p>
<p>When they get back to their desks, they hit the “Go Online” button to reconnect the solution to TFS. The winning pair gets to check in their code. Everyone else must roll back. Then next week, everyone gets latest and starts from there. This encourages people to vote for the code that they want to work on.</p>
<h3>The reaction so far</h3>
<p>People really seemed to enjoy the first session. More importantly, it was the most engaged that I saw them since we started these lunches.</p>
<p>All of the pairs made some pretty basic mistakes. Not all of them realized that they were mistakes. For example, one pair did not refactor between tests. They took each test as a separate requirement that, once completed, could not be altered. So when they saw that another pair had refactored the first test, they complained that they had rewritten requirements. I explained that the requirement was still met, but now the design was improved.</p>
<p>If I were a real sensei, I would not feel the need to explain. I would simply correct, expecting that understanding will come in time. I don’t feel that I can take this approach with my team at this point. Perhaps eventually we will be able to leave our egos at the dojo door.</p>
<p>I had to come up with the rule that you vote for <em>another</em> pair because initially everyone voted for themselves. Rolling back your own code is painful at first. Over time, they will recognize that deleting your project at the end of the kata is actually quite a cleansing sensation.</p>
				</div>

				<p class="postmetadata">Posted in <a href="indexb31a.html?cat=1" title="View all posts in Uncategorized" rel="category">Uncategorized</a> |   <a href="indexbdc9.html?p=601#respond" title="Comment on TDD Dojo">No Comments &#187;</a></p>

			</div>

				<div class="post">
				<h3 id="post-506"><a href="index8ce5.html?p=506" rel="bookmark" title="Permanent Link to Find one solution to many problems">Find one solution to many problems</a></h3>
				<small>Tuesday, May 25th, 2010</small>

				<div class="entry">
					<p>I’m working on a graphical editor in WPF. One feature of this editor is the ability to resize an object. As cool as that feature is, the comment I got from my partner on the project was even better.</p>
<p>In this editor, you can drag the mouse across the surface to pan. You can use your scroll wheel to zoom in and out. And you can select an object and use your scroll wheel to resize it. The trick is figuring out just how much to resize with every tick.</p>
<p>When the scale is zoomed out, you want each tick of the mouse to adjust the size by large amount. When the scale is zoomed in tight, you want to adjust by a proportionally smaller amount. This gives the user a chance to fine-tune by zooming in.</p>
<p><a href="../pictures/Findonesolutiontomanyproblems_142C6/image.png"><img style="border-bottom: 0px; border-left: 0px; display: inline; border-top: 0px; border-right: 0px" title="image" border="0" alt="image" src="../pictures/Findonesolutiontomanyproblems_142C6/image_thumb.png" width="627" height="410" /></a> </p>
<p><a href="../pictures/Findonesolutiontomanyproblems_142C6/image_3.png"><img style="border-bottom: 0px; border-left: 0px; display: inline; border-top: 0px; border-right: 0px" title="image" border="0" alt="image" src="../pictures/Findonesolutiontomanyproblems_142C6/image_thumb_3.png" width="633" height="410" /></a> </p>
<p>But on the other end of the spectrum, you have to prevent the size of the object from reaching zero. So when the object gets small, it no longer shrinks in proportion to the zoom.</p>
<p><a href="../pictures/Findonesolutiontomanyproblems_142C6/image_4.png"><img style="border-bottom: 0px; border-left: 0px; display: inline; border-top: 0px; border-right: 0px" title="image" border="0" alt="image" src="../pictures/Findonesolutiontomanyproblems_142C6/image_thumb_4.png" width="627" height="410" /></a> </p>
<p><strong>Design an equation</strong>    <br />The first problem is to change the size in proportion to the zoom. The easiest way to do this is to convert the object size into screen size, adjust by a constant amount, and then convert back. Here’s the math to do that:</p>
<ul>
<li>Screen size = actual size * zoom factor</li>
<li>New screen size = screen size + ticks * pixels per tick</li>
<li>New actual size = new screen size / zoom factor</li>
</ul>
<p>The second problem is to switch modes when the object appears small on the screen. Instead of changing screen size by a fixed number of pixels per tick, you want to change by fewer pixels as the object gets smaller. This way you will approach zero but never actually reach it.</p>
<p>The key to solving this second problem is that idea of approaching a target without reaching it. In mathematical terms, that target – or limit – is an asymptote. We want to design an equation that asymptotically approaches zero as we scale down. But at the same time, we want to asymptotically approach a constant growth as we scale up. Here are the two asymptotes:</p>
<ul>
<li>y = 0</li>
<li>y = x</li>
</ul>
<p>The first asymptote (y = 0) makes the size of our object to approach zero but never actually reach it. The second asymptote (y = x) makes the size of the object to increase by the same amount each time we tick the scroll wheel. Let y be the screen position, and all this happens relative to the zoom.</p>
<p>To design an equation with asymptotes, simply multiply to make each one a root of the equation:</p>
<ul>
<li>(y – 0) * (y – x) = 0</li>
</ul>
<p>The first factor represents the first asymptote (y = 0). The second represents the second (y = x). We just subtract one side from the other to turn the equation into a root (i.e. y = x, y – x = 0).</p>
<p><strong>Study the equation</strong>    <br /><a href="../pictures/Findonesolutiontomanyproblems_142C6/image_5.png"><img style="border-bottom: 0px; border-left: 0px; display: inline; margin-left: 0px; border-top: 0px; margin-right: 0px; border-right: 0px" title="image" border="0" alt="image" align="right" src="../pictures/Findonesolutiontomanyproblems_142C6/image_thumb_5.png" width="221" height="216" /></a> Plug this equation into <a href="http://www.wolframalpha.com/input/?i=y%28y-x%29%3D0">Wolfram Alpha</a> and it tells you that it is a pair of intersecting lines. We already knew that. We need to pull back from those two lines and see what happens. Let’s change the equation to this:</p>
<ul>
<li>y * (y – x) = 9</li>
</ul>
<p>Now <a href="http://www.wolframalpha.com/input/?i=y%28y-x%29%3D9">Wolfram Alpha</a> tells us that it is a hyperbola. We can visually verify that it approaches zero on the left, and it approaches a 1-to-1 slope on the right.</p>
<p>We can also see that the equation crosses the y axis at 3. This is about where we “switch modes” from a big object to a little one. And finally, we can see the solution for y:</p>
<ul>
<li>y = 1/2 (x-sqrt(x^2+36))</li>
</ul>
<p>With a little work on the whiteboard, we can confirm that the numbers 3 and 36 are related to the arbitrarily chosen constant 9. The y intercept (3) is the square root, and the constant (36) is quadruple. With this knowledge, we can adjust the equation to “switch modes” at any screen size.</p>
<p><strong>Complete the algorithm</strong>    <br />With a little more help from Steven Wolfram, we can find the inverse of this equation. With that, we turn this equation into an algorithm for determining the new size of an object:</p>
<ul>
<li>Screen size = actual size * zoom factor</li>
<li>Starting x = (screen size^2 – small object^2) / screen size</li>
<li>New x = starting x + ticks * pixels per tick</li>
<li>New screen size = 1/2 (new x-sqrt(new x^2 + small object * 4))</li>
<li>New actual size = new screen size / zoom factor</li>
</ul>
<p>And with that we have one algorithm that operates one way on small objects, and another way on large objects. And it allows the user to fine tune by zooming in.</p>
<p><strong>My partner’s comment</strong>    <br />I walked through this code with my partner, and explained how it solved three problems at once. His reaction was, “You used math where I would have used an if statement.” I think that was the most telling result of the whole exercise.</p>
<p>When we write code using discrete concepts like conditions, we apply brute force. We decide exactly where the solution changes from one mode to another. We force a corner into the solution. A singularity at which the behavior of the system changes violently. Bugs gather at such singularities. And those corners poke the user in the eye, even if he can’t put his finger on them.</p>
<p>But when we find one simple, continuous, elegant solution to many problems, we allow that solution to take its own form. It emerges naturally from the problem space itself. The benefit is not simply more beautiful code. It is also fewer bugs, and a more pleasant user experience. So when faced with a multitude of problems, put them all together and see if a single solution emerges.</p>
				</div>

				<p class="postmetadata">Posted in <a href="indexb31a.html?cat=1" title="View all posts in Uncategorized" rel="category">Uncategorized</a> |   <a href="index8ce5.html?p=506#respond" title="Comment on Find one solution to many problems">No Comments &#187;</a></p>

			</div>

				<div class="post">
				<h3 id="post-494"><a href="indexdba8.html?p=494" rel="bookmark" title="Permanent Link to Hands-on MVVM 1: Model and View">Hands-on MVVM 1: Model and View</a></h3>
				<small>Monday, May 3rd, 2010</small>

				<div class="entry">
					<p>I will be presenting this material at Dallas XAML tomorrow (May 4, 2010). If you are in the area, please come by. If not, just <a href="wp-content/uploads/2010/05/dallasxaml_mvvm.zip" title="download the demo code">download the demo code</a> and follow along.</p>
<p>Microsoft has finally nailed data binding in WPF and Silverlight. It has long been ridiculed as a demo-only feature. But now it is useful in real application development.</p>
<p>As people apply data binding to real applications, patterns have emerged. One of the most prevalent is Model-View-ViewModel. In truth, MVVM is not just one pattern. It is a collection if interrelated patterns. Each person has a different idea of what MVVM actually looks like. This is my opinion.</p>
<p>The goal of this series is to understand why it is good to follow these patterns. We are going to start with direct data binding. We won’t add any code until we need it. When we find that things don’t work, we’ll add code to make them work. When things start to get messy, we will refactor to clean them up.</p>
<p><strong>The model</strong><br />
The application that we are building keeps track of people. It starts innocently enough with a class called Person:</p>
<pre><span style="color: blue">public</span> <span style="color: blue">class</span> <span style="color: #2b91af">Person</span>
{
    <span style="color: blue">private</span> <span style="color: blue">string</span> _firstName;
    <span style="color: blue">private</span> <span style="color: blue">string</span> _lastName;
    <span style="color: blue">private</span> <span style="color: blue">string</span> _email;
    <span style="color: blue">private</span> <span style="color: blue">string</span> _phone;

    <span style="color: blue">public</span> <span style="color: blue">string</span> FirstName
    {
        <span style="color: blue">get</span> { <span style="color: blue">return</span> _firstName; }
        <span style="color: blue">set</span> { _firstName = value; }
    }

    <span style="color: blue">public</span> <span style="color: blue">string</span> LastName
    {
        <span style="color: blue">get</span> { <span style="color: blue">return</span> _lastName; }
        <span style="color: blue">set</span> { _lastName = value; }
    }

    <span style="color: blue">public</span> <span style="color: blue">string</span> Email
    {
        <span style="color: blue">get</span> { <span style="color: blue">return</span> _email; }
        <span style="color: blue">set</span> { _email = value; }
    }

    <span style="color: blue">public</span> <span style="color: blue">string</span> Phone
    {
        <span style="color: blue">get</span> { <span style="color: blue">return</span> _phone; }
        <span style="color: blue">set</span> { _phone = value; }
    }
}</pre>
<p>Notice that this class does not implement INotifyPropertyChanged. We are starting simple so we know why we need that code.</p>
<p><strong>The view</strong></p>
<p>We’ll data bind our view directly to our model. Data binding works against properties. The Person user control defines one text box for each Person property.</p>
<pre><span style="color: blue">&lt;</span><span style="color: maroon">UserControl</span> <span style="color: red">x:Class</span>="<span style="color: blue">Step1.View.PersonUserControl</span>"
    <span style="color: red">xmlns</span>="<span style="color: blue">http://schemas.microsoft.com/winfx/2006/xaml/presentation</span>"
    <span style="color: red">xmlns:x</span>="<span style="color: blue">http://schemas.microsoft.com/winfx/2006/xaml</span>" <span style="color: red">Background</span>="<span style="color: blue">#FF353535</span>"<span style="color: blue">&gt;</span>
    <span style="color: blue">&lt;</span><span style="color: maroon">Grid</span> <span style="color: red">Margin</span>="<span style="color: blue">5</span>"<span style="color: blue">&gt;</span>
        <span style="color: blue">&lt;</span><span style="color: maroon">Grid.RowDefinitions</span><span style="color: blue">&gt;</span>
            <span style="color: blue">&lt;</span><span style="color: maroon">RowDefinition</span> <span style="color: red">Height</span>="<span style="color: blue">Auto</span>"/<span style="color: blue">&gt;</span>
            <span style="color: blue">&lt;</span><span style="color: maroon">RowDefinition</span> <span style="color: red">Height</span>="<span style="color: blue">Auto</span>"/<span style="color: blue">&gt;</span>
            <span style="color: blue">&lt;</span><span style="color: maroon">RowDefinition</span> <span style="color: red">Height</span>="<span style="color: blue">Auto</span>"/<span style="color: blue">&gt;</span>
            <span style="color: blue">&lt;</span><span style="color: maroon">RowDefinition</span> <span style="color: red">Height</span>="<span style="color: blue">Auto</span>"/<span style="color: blue">&gt;</span>
            <span style="color: blue">&lt;</span><span style="color: maroon">RowDefinition/</span><span style="color: blue">&gt;</span>
        <span style="color: blue">&lt;</span>/<span style="color: maroon">Grid.RowDefinitions</span><span style="color: blue">&gt;</span>
        <span style="color: blue">&lt;</span><span style="color: maroon">Grid.ColumnDefinitions</span><span style="color: blue">&gt;</span>
            <span style="color: blue">&lt;</span><span style="color: maroon">ColumnDefinition</span> <span style="color: red">Width</span>="<span style="color: blue">Auto</span>"/<span style="color: blue">&gt;</span>
            <span style="color: blue">&lt;</span><span style="color: maroon">ColumnDefinition</span> <span style="color: red">Width</span>="<span style="color: blue">*</span>"/<span style="color: blue">&gt;</span>
        <span style="color: blue">&lt;</span>/<span style="color: maroon">Grid.ColumnDefinitions</span><span style="color: blue">&gt;</span>

        <span style="color: blue">&lt;</span><span style="color: maroon">Label</span> <span style="color: red">Grid.Row</span>="<span style="color: blue">0</span>" <span style="color: red">Target</span>="<span style="color: blue">{Binding ElementName=firstName}</span>" <span style="color: red">Content</span>="<span style="color: blue">_First Name:</span>"/<span style="color: blue">&gt;</span>
        <span style="color: blue">&lt;</span><span style="color: maroon">Label</span> <span style="color: red">Grid.Row</span>="<span style="color: blue">1</span>" <span style="color: red">Target</span>="<span style="color: blue">{Binding ElementName=lastName}</span>" <span style="color: red">Content</span>="<span style="color: blue">_Last Name:</span>"/<span style="color: blue">&gt;</span>
        <span style="color: blue">&lt;</span><span style="color: maroon">Label</span> <span style="color: red">Grid.Row</span>="<span style="color: blue">2</span>" <span style="color: red">Target</span>="<span style="color: blue">{Binding ElementName=email}</span>" <span style="color: red">Content</span>="<span style="color: blue">_Email:</span>"/<span style="color: blue">&gt;</span>
        <span style="color: blue">&lt;</span><span style="color: maroon">Label</span> <span style="color: red">Grid.Row</span>="<span style="color: blue">3</span>" <span style="color: red">Target</span>="<span style="color: blue">{Binding ElementName=phone}</span>" <span style="color: red">Content</span>="<span style="color: blue">_Phone:</span>"/<span style="color: blue">&gt;</span>

        <span style="color: blue">&lt;</span><span style="color: maroon">TextBox</span> <span style="color: red">Grid.Row</span>="<span style="color: blue">0</span>" <span style="color: red">Grid.Column</span>="<span style="color: blue">1</span>" <span style="color: red">x:Name</span>="<span style="color: blue">firstName</span>" <span style="color: red">Text</span>="<span style="color: blue">{Binding FirstName}</span>"/<span style="color: blue">&gt;</span>
        <span style="color: blue">&lt;</span><span style="color: maroon">TextBox</span> <span style="color: red">Grid.Row</span>="<span style="color: blue">1</span>" <span style="color: red">Grid.Column</span>="<span style="color: blue">1</span>" <span style="color: red">x:Name</span>="<span style="color: blue">lastName</span>" <span style="color: red">Text</span>="<span style="color: blue">{Binding LastName}</span>"/<span style="color: blue">&gt;</span>
        <span style="color: blue">&lt;</span><span style="color: maroon">TextBox</span> <span style="color: red">Grid.Row</span>="<span style="color: blue">2</span>" <span style="color: red">Grid.Column</span>="<span style="color: blue">1</span>" <span style="color: red">x:Name</span>="<span style="color: blue">email</span>" <span style="color: red">Text</span>="<span style="color: blue">{Binding Email}</span>"/<span style="color: blue">&gt;</span>
        <span style="color: blue">&lt;</span><span style="color: maroon">TextBox</span> <span style="color: red">Grid.Row</span>="<span style="color: blue">3</span>" <span style="color: red">Grid.Column</span>="<span style="color: blue">1</span>" <span style="color: red">x:Name</span>="<span style="color: blue">phone</span>" <span style="color: red">Text</span>="<span style="color: blue">{Binding Phone}</span>"/<span style="color: blue">&gt;</span>
    <span style="color: blue">&lt;</span>/<span style="color: maroon">Grid</span><span style="color: blue">&gt;</span>
<span style="color: blue">&lt;</span>/<span style="color: maroon">UserControl</span><span style="color: blue">&gt;</span></pre>
<p>Notice that the view only contains layout and controls. All of the styling is expressed in App.xaml.</p>
<p><strong>The application</strong></p>
<p>The view needs an instance of the model to bind to. Our application will load this instance from a data source – most likely a database or a web service – and give it to the view. The view is hosted within a window. This is all accomplished in Application_Startup.</p>
<pre><span style="color: #2b91af">DataSource</span> dataSource = <span style="color: blue">new</span> <span style="color: #2b91af">DataSource</span>();
<span style="color: blue">this</span>.MainWindow = <span style="color: blue">new</span> <span style="color: #2b91af">PersonWindow</span>();
<span style="color: blue">this</span>.MainWindow.DataContext = dataSource.GetPerson();
<span style="color: blue">this</span>.MainWindow.Show();</pre>
<p>Again, we are keeping it simple. There is no dependency injection. There is no service locator. If we see that we need that code, we will add it.</p>
<p><a href="wp-content/uploads/2010/05/person-window.jpg"><img src="wp-content/uploads/2010/05/person-window-thumb.jpg" title="person_window" style="border: 0px none; display: inline; margin-left: 0px; margin-right: 0px" alt="person_window" width="244" align="right" border="0" height="158" /></a> When you run this program, the Person window appears. It is bound to the person that we loaded from the data source. When you edit the properties of a person, your changes are set directly into the model.</p>
<p>The code is extremely simple, and it worked out-of-the-box. So far we haven’t seen a need to implement INotifyPropertyChanged. Strictly speaking, that interface is not necessary for data binding to work. But very soon we will run into situations in which it is necessary.</p>
<p>Also, we have not yet created a ViewModel. It is not strictly necessary for getting an application working. But again, we will soon see a situation in which it makes our code much cleaner.</p>
<p>In <a href="index5b8d.html?p=498">part 2</a>, we will add features to this application. Let’s see how those features look when we bind the view directly to the model.</p>
				</div>

				<p class="postmetadata">Posted in <a href="indexb0b7.html?cat=6" title="View all posts in Patterns" rel="category">Patterns</a>,  <a href="indexb31a.html?cat=1" title="View all posts in Uncategorized" rel="category">Uncategorized</a> |   <a href="indexdba8.html?p=494#respond" title="Comment on Hands-on MVVM 1: Model and View">No Comments &#187;</a></p>

			</div>

		
		<div class="navigation">
			<div class="alignleft"><a href="index2155.html?cat=1&amp;paged=2">&laquo; Previous Entries</a></div>
			<div class="alignright"></div>
		</div>

	
	</div>
		</td>
	</tr>
</table>

<hr />
<div id="footer">
<!-- If you'd like to support WordPress, having the "powered by" link someone on your blog is the best way, it's our only promotion or advertising. -->
	<p>
		Adventures in Software is proudly powered by 
		<a href="http://wordpress.org/">WordPress</a>
		<br /><a href="indexd784.html?feed=rss2">Entries (RSS)</a>
		and <a href="indexa6da.html?feed=comments-rss2">Comments (RSS)</a>.
		<!-- 17 queries. 0.469 seconds. -->
	</p>
</div>
<script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
try {
var pageTracker = _gat._getTracker("UA-389401-3");
pageTracker._trackPageview();
} catch(err) {}</script></div>

<!-- Gorgeous design by Michael Heilemann - http://binarybonsai.com/kubrick/ -->

		<div id="sk2-footer" style="color:#FFF; background-color:#444; padding: 3px 2px 3px 2px; border-top: #888 solid 1px;">This blog is protected by <a href="http://unknowngenius.com/blog/" title="Dave">dr Dave</a>'s <strong><a href="http://unknowngenius.com/blog/wordpress/spam-karma/" title="SK2">Spam Karma 2</a></strong>: <strong>274531</strong>  Spams eaten and counting...</div><script type="text/javascript" src="replies.js"></script>
<script type="text/javascript" src="blogger.js"></script>
<script type="text/javascript" src="http://twitter.com/statuses/user_timeline/michaellperry.json?callback=twitterCallback2&amp;count=5"></script>
<script type="text/javascript" src="http://search.twitter.com/search.json?q=@michaellperry&amp;callback=twitterCallbackReplies&amp;rpp=5"></script>
</body>

<!-- Mirrored from adventuresinsoftware.com/blog/?cat=1 by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 13 Jan 2017 12:52:33 GMT -->
</html>
